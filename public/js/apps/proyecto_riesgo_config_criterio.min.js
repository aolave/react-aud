(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';

var $table = $('#table-riesgos-config-criterios');
var template = _.template($("#criterio_row_template").html());
var defaultChoiceSiNo = [{ 'label': 'SI', 'value': '1' }, { 'label': 'NO', 'value': '0' }];
var drawTableRow = function drawTableRow(control, k) {
    control.choices_style = getChoicesStyle(control);
    var tr = template({ 'control': control, 'key': k });
    if ($table.find("#riesgocriteria_row_" + k).length) {
        $("#riesgocriteria_row_" + k).html(tr);
    } else {
        $table.children('tbody').append("<tr id=\"riesgocriteria_row_" + k + "\">" + tr + "</tr>");
    }
    $("#riesgocriteria_row_" + k).find('.riesgocriterio-enabled').trigger('change');
};
var drawTable = function drawTable() {
    $table.find('tbody').html("");
    _.forEach(app.vars.widget_values, function (widget_value, k) {
        drawTableRow(widget_value, k);
    });
};
var generateRandomId = function generateRandomId() {
    return new Date().valueOf() + Math.random().toString(16).substr(2, 9);
};
var getChoicesStyle = function getChoicesStyle(control) {
    var isSiNo = _.isEqual(control.choices, defaultChoiceSiNo);
    if (isSiNo) {
        return 'SI/NO';
    }
    return 'Personalizado';
};
$table.on('change', '.riesgocriterio-enabled', function (ev) {
    ev.preventDefault();
    if (this.checked) {
        $(this).closest('tr').removeClass('disabled');
    } else {
        $(this).closest('tr').addClass('disabled');
    }
});
$table.on('change', 'input[data-model]', function (ev) {
    var model = $(this).attr("data-model");
    var row_id = $(this).closest('tr').prop('id').substr(19);
    var value;
    if ($(this).is(':checkbox')) {
        value = this.checked;
    } else {
        value = $(this).val();
    }
    app.vars.widget_values[row_id][model] = value;
});
$table.on('click', '.btn-deletecriterio', function (ev) {
    var self = this;
    ev.preventDefault();
    bootbox.confirm("¿Desea eliminar este criterio ? <br>Tenga en cuenta que esta acción no puede ser revertida.", function (r) {
        if (r) {
            var criterio_id = self.hash.substr(1);
            delete app.vars.widget_values[criterio_id];
            $(self).closest("tr").remove();
        }
    });
});
$table.on('click', '.btn-addcriterio', function (ev) {
    ev.preventDefault();
    var randomid = generateRandomId();
    app.vars.widget_values[randomid] = {
        'is_enabled': true,
        'choices': _.clone(defaultChoiceSiNo, true)
    };
    drawTableRow(app.vars.widget_values[randomid], randomid);
});
$("body").on('click', '.btn-addchoice', function (ev) {
    ev.preventDefault();
    var criterio_id = $(this).closest('table').attr('data-criterio-id');
    app.vars.widget_values[criterio_id]['choices'].push({ 'label': '', 'value': '' });
    drawTableRow(app.vars.widget_values[criterio_id], criterio_id);
    $("#riesgocriteria_row_" + criterio_id).find(".choice_style").html(getChoicesStyle(app.vars.widget_values[criterio_id]));
    app.vars.widget_values[criterio_id]['choices_style'] = getChoicesStyle(app.vars.widget_values[criterio_id]);
    $(this).closest('.modal-body').html($("#riesgocriteria_row_" + criterio_id + " .modal-body").html());
});
$("body").on('click', '.btn-deletechoice', function (ev) {
    ev.preventDefault();
    var self = this;
    var criterio_id = $(this).closest('table').attr('data-criterio-id');
    var choice_id = $(this).closest('tr').attr('data-choice-id');
    bootbox.confirm("¿Desea eliminar esta opción de respuesta?", function (r) {
        if (r) {
            delete app.vars.widget_values[criterio_id]['choices'][choice_id];
            app.vars.widget_values[criterio_id]['choices'] = _.filter(app.vars.widget_values[criterio_id]['choices']);
            $(self).closest("tr").remove();
            $("#riesgocriteria_row_" + criterio_id).find(".choice_style").html(getChoicesStyle(app.vars.widget_values[criterio_id]));
            app.vars.widget_values[criterio_id]['choices_style'] = getChoicesStyle(app.vars.widget_values[criterio_id]);
        }
    });
});
$('body').on('change', '.riesgo-criterio-choices input', function () {
    var model = $(this).attr("data-choice-model");
    var criterio_id = $(this).closest('table').attr('data-criterio-id');
    var choice_id = $(this).closest('tr').attr('data-choice-id');
    app.vars.widget_values[criterio_id]['choices'][choice_id][model] = $(this).val();
    drawTableRow(app.vars.widget_values[criterio_id], criterio_id);
});
$(function () {
    drawTable();
    $table.children('tbody').sortable({
        'axis': 'y',
        'cursor': 'move',
        'handle': '.sorthandler',
        'items': '> tr'
    });
});

},{}]},{},[1]);
