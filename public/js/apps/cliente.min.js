function create_blockUI_loading_message(message) {
  return {
    message: '<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">' + message + '</h3>'
  }
}

function url_for2(e, params) {
  e = e.replace(':id_proyecto', app.vars.idproyecto)
  _.forEach(params, function(v, k) {
    e = e.replace(new RegExp(':' + k + '(?=(\\W|$))'), v)
  })

  return url_for(e)
}

jQuery('#collapse-button .switch').change(function() {
  jQuery('body').toggleClass('sidebar-collapse')
  window.dispatchEvent(new Event('resize'))
  $(window).trigger('resize')
  $3C.ajaxPost('sfGuardUserPreferences/updatePreference', {
    name: 'collapseMainMenu',
    user_id: _3Creatives.current_user.id,
    value: jQuery('body').hasClass('sidebar-collapse') ? 1 : 0,
    category: 'theme'
  })
})

jQuery('.nav-tabs, .nav-pills').not('.nav-stacked').each(function() {
  var $listItems = jQuery(this).children('li')
  var calcWithTabs = 100 / $listItems.length
  $listItems.each(function(n, k) {
    jQuery(this).width(calcWithTabs + '%')
  })
})

$(function() {
  $('textarea, input').on('focus', function() {
    $('.open .dropdown-toggle').parent().removeClass('open')
  })

  $('#main-menu li.dropdown.active li.active').each(function() {
    $(this).closest('li.dropdown.active').addClass('open')
  })

  if (typeof CKEDITOR !== 'undefined') {
    CKEDITOR.on('instanceReady', function(evt) {
      var editor = evt.editor
      editor.on('focus', function(e) {
        $('.open .dropdown-toggle').parent().removeClass('open')
        $('.ui-timepicker-list').hide()
      })
    })
  }

  $(document).ajaxError(function(ev, jqxhr) {
    console.log(jqxhr)
    $.unblockUI()
    if (typeof $.pnotify != 'undefined') {
      $.pnotify({
        title: 'Error',
        text: 'Ha ocurrido un error en el servidor al intentar realizar esta operaci√≥n.',
        type: 'error'
      })
    }
  })

  bootbox.alertError = function(text, header) {
    return bootbox.dialog(text, [ { label: 'OK', class: 'btn-danger' } ], {
      header: '<span class="icon-warning-sign"></span>' + (header || ''),
      classes: 'bootbox-error',
      onEscape: true
    })
  }
})
