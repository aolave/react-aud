(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';

var $table = $('#table-riesgoslist');
var riesgo_item_template = _.template($('#riesgo-item-template').html());
var riesgo_modal_template = _.template($('#riesgo-modal-template').html());
var calcular_riesgo_inherente = function calcular_riesgo_inherente(item) {
    var pr = item.probabilidad;
    var im = item.impacto;
    var impr = parseInt(pr) + parseInt(im);
    if (pr == "" || im == "") {
        return 0;
    } else if (impr == 10 || impr == 8) {
        return 5;
    } else if (impr == 6) {
        return 3;
    } else {
        return 1;
    }
};
var label_from_choices = function label_from_choices(value, choices) {
    return choices[value];
};
var processRiesgoItem = function processRiesgoItem(item) {
    item.riesgo_inherente = calcular_riesgo_inherente(item);
    item.label_inherente = label_from_choices(item.riesgo_inherente, { 1: 'Bajo', 3: 'Medio', 5: 'Alto' });
    item.label_control = label_from_choices(item.control_valoracion, { 1: 'Debil', 3: 'Moderado', 5: 'Fuerte' });
    item.label_efectividad = label_from_choices(item.control_efectividad, { 1: 'Inefectivo', 3: 'Con deficiencias', 5: 'Efectivo' });
    item.label_residual = label_from_choices(item.riesgo_residual, { 1: 'Bajo', 3: 'Medio', 5: 'Alto' });
    return item;
};
var showItemModal = function showItemModal(riesgo_id) {
    $("#modal-riesgoitem").modal('show');
    $("#modal-riesgoitem .modal-body").html('');
    var riesgo = _.findWhere(app.vars.riesgoslist, { 'id': riesgo_id });
    var template = riesgo_modal_template({ riesgo: riesgo });
    var $modalbody = $("#modal-riesgoitem .modal-body");
    $modalbody.block().html(template);
    $modalbody.find(':input').each(function () {
        var field = $(this).attr('data-model');
        if (field) {
            $(this).val(riesgo[field]);
        }
    });
    $('#modal-riesgoitem').find('.calculated_model').each(function () {
        var model = $(this).attr('data-model');
        $(this).html(riesgo[model]);
    });
    $modalbody.find('.fastselect').each(function () {
        var options = {};
        options.choiceItemClass = $(this).attr('data-fastselect-choiceItemClass');
        $(this).fastselect(options);
    });
    $modalbody.unblock();
};
$table.children('tbody').on('click', '.btn-editriesgo', function (ev) {
    ev.preventDefault();
    showItemModal($(this).closest('tr').attr('data-riesgo-id'));
});
$table.children('tbody').on('dblclick', 'tr', function (ev) {
    showItemModal($(this).attr('data-riesgo-id'));
});
$('#modal-riesgoitem').on('change', ':input[data-model]', function () {
    var riesgo_id = $('#modal-riesgoitem').find('.riesgo_id').val();
    var riesgo = _.findWhere(app.vars.riesgoslist, { 'id': riesgo_id });
    var model = $(this).attr('data-model');
    riesgo[model] = $(this).val();
    riesgo = processRiesgoItem(riesgo);
    $('#modal-riesgoitem').find('.calculated_model').each(function () {
        var model = $(this).attr('data-model');
        $(this).html(riesgo[model]);
    });
    var tr = riesgo_item_template({ riesgo: riesgo });
    $("#riesgo-row-" + riesgo_id).html(tr);
});
var drawTable = function drawTable() {
    var $tbody = $table.children('tbody');
    $tbody.html('');
    _.forEach(app.vars.riesgoslist, function (item) {
        item = processRiesgoItem(item);
        var $tr = riesgo_item_template({ 'riesgo': item });
        $tbody.append("<tr id=\"riesgo-row-" + item.id + "\" data-riesgo-id=\"" + item.id + "\">" + $tr + "</tr>");
    });
};
$(function () {
    drawTable();
});

},{}]},{},[1]);
