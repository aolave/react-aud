(function(){var e,t,n;e=function(){var e;return e=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n;return n=(e+Math.random()*16)%16|0,e=Math.floor(e/16),(t==="x"?n:n&3|8).toString(16)})},t=function(e){var t;return t=$("#subtasksrow-"+e).css("display"),t==="none"?$("#subtasksrow-"+e).css("display","table-row"):$("#subtasksrow-"+e).css("display","none")},window.addSubtask=function(t,r){var i,s,o,u,a,f,l,c,h;u=$(t).data("recordid"),r?h=r.local_id:h=e(),c="<option value=''> - Responsable - </option>",a=app.vars.usuarios_asignables;for(s=0,o=a.length;s<o;s++)l=a[s],c+="<option value='"+l.id+"'>"+l.first_name+" "+l.last_name+" ("+l.sigla+")</option>";return f='<tr class="subtaskrow subtaskrow-'+u+'" data-recordid="'+h+'" data-parentid="'+u+'">\n  <td style="width:40px"><input type="checkbox" title="¿Realizada?"class=" subtask-done"> </td>\n  <td><input type="text" placeholder="Descripción de la subtarea" required="required" style=\'margin-bottom: 0px;\' class="input-xxlarge subtask-description"></td>\n  <td><select class="raw-select  subtask-usuario_asignado">'+c+"</select></td>\n  <td style=\"width:40px\"><a href='#' class='deletesubtask'><span title=\"Borrar subtarea\" style='color: red' class='icon icon-moon-cancel'></span></a></td>\n</tr>",i=$(f).appendTo($(t).closest(".subtasksrow").find("tbody")),r&&(i.find(".subtask-description").val(r.description),i.find(".subtask-usuario_asignado").val(r.id_usuario_asignado),r.is_done&&(i.find(".subtask-done").attr("checked","checked"),i.addClass("subtask-done ui-state-disabled"))),n(u),i},n=function(e){return $("#btn-toggle-subtasks-"+e+" .badge").html($("tr.subtaskrow-"+e+" .subtask-description").filter(function(){return $.trim($(this).val()).length>0}).length)},$("#sf_admin_list_table-usuario_tarea_admin").on("click",".btn-toggle-subtasks",function(e){return e.preventDefault(),t($(this).data("recordid"))}),$("#sf_admin_list_table-usuario_tarea_admin").on("click",".addsubtask",function(e){return e.preventDefault(),addSubtask(this)}),$("#sf_admin_list_table-usuario_tarea_admin").on("change",".subtaskrow :input",function(){var e,t,n;return e=$(this).closest("tr"),e.find(".subtask-description").val().trim()===""?($.pnotify({type:"error",text:"Ingrese la descripción de la subtarea"}),e.find(".subtask-description").addClass("error"),!1):(n=e.data("recordid"),t=e.data("parentid"),$3C.ajaxPost("usuario_tarea/"+t+"/subtask",{local_id:n,values:{description:e.find(".subtask-description").val(),id_usuario_asignado:e.find(".subtask-usuario_asignado").val(),is_done:e.find(".subtask-done").attr("checked")?"1":"0"}}))}),$("#sf_admin_list_table-usuario_tarea_admin").on("keyup",".subtask-description",function(e){var t;if(event.which===13||event.keyCode===13)return t=addSubtask($(this).closest(".subtasksrow").find(".addsubtask")),t.find(".subtask-description").focus()}),$("#sf_admin_list_table-usuario_tarea_admin").on("change",".subtask-done",function(e){return this.checked?$(this).closest("tr").addClass("subtask-done ui-state-disabled"):$(this).closest("tr").removeClass("subtask-done  ui-state-disabled")}),$("#sf_admin_list_table-usuario_tarea_admin").on("click",".deletesubtask",function(e){var t;return e.preventDefault(),t=this,bootbox.confirm("¿Esta seguro de querer borrar esta subtarea?",function(e){var r,i,s;if(e)return $.blockUI(),r=$(t).closest("tr"),s=r.data("recordid"),i=r.data("parentid"),$3C.ajaxDelete("usuario_tarea/"+i+"/subtask",{local_id:s},function(){return r.remove(),n(i),$.unblockUI(),$.pnotify("Subtarea borrada!")})})})}).call(this);