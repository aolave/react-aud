!function u(n,i,s){function c(a,t){if(!i[a]){if(!n[a]){var e="function"==typeof require&&require;if(!t&&e){return e(a,!0)}if(m){return m(a,!0)}var r=new Error("Cannot find module '"+a+"'");throw r.code="MODULE_NOT_FOUND",r}var o=i[a]={exports:{}};n[a][0].call(o.exports,function(t){return c(n[a][1][t]||t)},o,o.exports,u,n,i,s)}return i[a].exports}for(var m="function"==typeof require&&require,t=0;t<s.length;t++){c(s[t])}return c}({1:[function(t,a,e){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),(r=e.MuestreoType||(e.MuestreoType={})).Mas="mas",r.Mum="mum";var o=(n.formatNumber=function(t,a){return void 0===a&&(a=0),isNaN(t)?"0":accounting.formatNumber(t,a)},n.prototype.configurar_wizard=function(){var a=this;$("#pane-"+this.type+"-evaluacion .btn-next").on("click",function(t){t.preventDefault(),0<$("#table-muestreo-"+a.type+"-evaluacion .muestra-v-real input").filter(function(){return""==$(this).val()}).length?bootbox.alert("Debe ingresar el Valor según Auditoría de <u>TODOS</u> los documentos de la muestra para continuar."):$(this.hash).tab("show")}),$("#mainpane-"+this.type).find(".btn-next, .btn-back").not("#pane-"+this.type+"-evaluacion .btn-next").on("click",function(t){t.preventDefault(),$(this.hash).tab("show")})},n.prototype.completar_cache_muestras=function(t){var a=this;_.forEach(t,function(t){void 0!==a.cache_muestras[t.cod]&&""!==a.cache_muestras[t.cod]||(a.cache_muestras[t.cod]=t.r)})},n.prototype.calcular_valor_error_en_evaluacion=function(t){t.find(".muestra-v-diff, .muestra-v-diff-p").html("");var a=t.find(".muestra-cod input:hidden").val();if(""!==t.find(".muestra-v-real input").val()){var e=+t.find(".muestra-v input:hidden").val(),r=+t.find(".muestra-v-real input").autoNumeric("get");if(!isNaN(r)){var o=e-r,u=0!=e?100*o/e:0;t.find(".muestra-v-diff").html(n.formatNumber(o)).data("valor",o),t.find(".muestra-v-diff-p").html(Math.floor(u)+"%"),this.cache_muestras[a]=r}}else{this.cache_muestras[a]=""}},n.prototype.guardar_cambios_muestras=function(){var t=url_for("proyecto_muestreo/"+app.vars.ID_MUESTREO+"/config"),o=[];$("#table-muestreo-"+this.type+"-evaluacion tbody tr").each(function(t){var a=$(this).find(".muestra-cod input").val(),e=_.find(app.vars.muestras,{cod:a}).v,r=$(this).find(".muestra-v-real input").autoNumeric("get");o.push({cod:a,v:e,r:r})}),$.post(t,{muestras:o,t:this.type},$.noop,"json")},n);function n(t){this.cache_muestras={},this.guardar_cambios_muestreo=function(t,a){void 0===a&&(a=!0);var e=this,r=url_for("proyecto_muestreo/"+app.vars.ID_MUESTREO+"/config"),o={};if(1<t.length){o={fields:[],t:this.type},t.each(function(){o.fields.push({field:$(this).prop("name").substr(7),value:$(this).val()})})}else{if(1!=t.length){return}o={field:t.prop("name").substr(7),value:t.val(),t:this.type}}$.post(r,o,function(){a&&e.guardar_cambios_muestras()})},this.type=t,this.configurar_wizard()}e.BaseMuestreo=o},{}],2:[function(t,a,e){"use strict";var r,o=(r=function(t,a){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a){a.hasOwnProperty(e)&&(t[e]=a[e])}})(t,a)},function(t,a){function e(){this.constructor=t}r(t,a),t.prototype=null===a?Object.create(a):(e.prototype=a.prototype,new e)});Object.defineProperty(e,"__esModule",{value:!0});var u,N=t("./_proyecto_muestreo_base"),n=(u=N.BaseMuestreo,o(i,u),i.prototype.gamma_inv=function(t,a){return jStat.gamma.inv(t,a,1)},i.prototype.roundup2=function(t){var a=Math.round(100*t)/100;return a<t&&(a+=.01),a},i.prototype.calcular_factor_confianza=function(t,a){var e=this.gamma_inv(1-t,1);if(0==a){return this.roundup2(e)}for(var r=0,o=0;1e-6<Math.abs(r-e)&&o<=1e3;){r=e,e=this.gamma_inv(1-t,1+a*r),o++}return this.roundup2(e)},i.prototype.calcular_tamano_muestra=function(){var t=Math.abs($("#cg2-m").data("valor")),a=+$("#cg-z2 select").val(),e=Math.floor(100-a);$("#cg-z2--inverted").html(e+"%");var r=t*+$("#cg-e2 select").val()/100;$("#cg-e2--v").html(N.BaseMuestreo.formatNumber(r)),$("#cg-e2--v2").html(N.BaseMuestreo.formatNumber(r)).data("valor",r);var o=this.roundup2(this.gamma_inv(a/100,1));$("#cg2-1").html(""+N.BaseMuestreo.formatNumber(o,2)).data("valor",o),$("#mum-config_cg2_1").val(o);var u=Math.round(t*o/r);$("#cg2-3").html(""+N.BaseMuestreo.formatNumber(u)),$("#mum-config_cg2_3").val(u);var n=Math.floor(t/u);return $("#cg2-4").html(""+N.BaseMuestreo.formatNumber(n)).data("valor",n),$("#mum-config_cg2_4").val(n),u},i.prototype.generar_tabla_muestra=function(t){void 0===t&&(t=[]);var a=$("#table-muestreo-"+this.type+"-evaluacion"),e=$("#muestreo-evaluacion-row-template").html();a.find("tbody").html("");var r=this.calcular_tamano_muestra(),o=[];if(void 0===app.vars.muestreo_config.ficha_tecnica_mum_date&&t.length!=r){o=_.clone(app.vars.muestras,!0),o=_.filter(o,function(t){return 0<t.v});var u=Math.floor($("#cg2-4").data("valor")),n=_.filter(o,function(t){return t.v>=u});if(n.length>r){o=_.take(_.sortBy(n,"v"),r)}else{var i=_.filter(o,function(t){return t.v<u}),s=0;i.forEach(function(t){s+=t.v});var c=r-n.length,m=s/c,l=Math.floor(Math.random()*m)+1,f=_.shuffle(i);i=[];var v=0,p=0;for(var h in f){if(c<=v){break}l+v*m<=(p+=(b=f[h]).v)&&(i.push(b),v++)}o=_.union(n,i)}for(o=_.sortBy(o,"cod"),h=0;h<o.length;h++){var d=_.find(t,{cod:o[h].cod});d&&(o[h].r=d.r)}}else{o=_.clone(t)}var g=0;for(h=0;h<o.length;h++){var b;(b=o[h]).r&&""+b.r!=""||!this.cache_muestras[b.cod]||(b.r=this.cache_muestras[b.cod]);var y=_.template(e)({item:b,k:h,type:this.type}),M=$(y).appendTo(a.find("tbody"));M.find(".muestra-v-real input").autoNumeric("init",{decimalCharacter:",",minimumValue:-9999999999999,maximumValue:9999999999999,digitGroupSeparator:".",unformatOnSubmit:!0}),g+=Math.floor(b.v),b.r&&this.calcular_valor_error_en_evaluacion(M)}$(".total-v").html(N.BaseMuestreo.formatNumber(g)).data("valor",g),this.calcular_totales_en_evaluacion()},i.prototype.calcular_totales_en_evaluacion=function(){var t=this,a=$("#mainpane-"+this.type),e=0;$("#"+this.type+"-total-v-real").html(function(){return $("#table-muestreo-"+t.type+"-evaluacion").find(".muestra-v-real input").each(function(){var t=+$(this).autoNumeric("get");isNaN(t)||(e+=t)}),N.BaseMuestreo.formatNumber(e)});var m=0,l=$("#muestreo-evaluacionerror-row-template").html(),f=Math.floor($("#cg2-4").data("valor")),r=+$("#cg-z2 select").val(),o=Math.floor(100-r),u=this.roundup2(this.gamma_inv(r/100,1)),n=0,v=0,p=[];$("#table-mum-muestraserradas").removeClass("hidden"),$("#table-mum-muestraserradas tbody").html(""),$("#table-muestreo-"+this.type+"-evaluacion").find(".muestra-v-diff").each(function(){var t=+$(this).data("valor");if(!isNaN(t)){if(m+=t,0==t){return!0}var a=$(this).closest("tr"),e=a.find(".muestra-cod input").val(),r=a.find(".muestra-v input").val(),o=a.find(".muestra-v-real input").autoNumeric("get"),u=(r-o)/r,n=f<r?r-o:u*f;v+=n;var i={cod:e,v:r,r:o,error:r-o,contaminacion:u,intervalo:f,error_proyectado:n},s=_.template(l)(i),c=$(s).appendTo($("#table-mum-muestraserradas tbody"));f<r?c.addClass("g2"):p.push({v:r,r:o,contaminacion:u,error_proyectado:n})}}),p=_.sortBy(p,"error_proyectado").reverse();var i=0;for(var s in p){var c=t.roundup2(t.gamma_inv(1-o/100,1+parseInt(s)+1));c-=t.roundup2(t.gamma_inv(1-o/100,1+parseInt(s))),c=Math.round(100*c)/100,n+=p[s].error_proyectado*c,i+=p[s].error_proyectado}var h=+$("#"+this.type+"-total-v").data("valor"),d=0!=h?100*m/h:0;$("#"+this.type+"-total-v-real-diff-p").html(Math.floor(d)+"%"),$(".mum-total-error-proyectado").html(N.BaseMuestreo.formatNumber(v)),0==v&&$("#table-mum-muestraserradas").addClass("hidden");var g=f*u;$("#mum-precision-basica").html(N.BaseMuestreo.formatNumber(g)),n-=i,$("#mum-tolerancia-incremental").html(N.BaseMuestreo.formatNumber(n)),$("#mum-tolerancia").html(N.BaseMuestreo.formatNumber(g+n));var b=g+v+n;$("#mum-cota-superior").html(N.BaseMuestreo.formatNumber(b));var y=Math.floor($("#cg-e2--v2").data("valor"));$("#mum-conclusion-diff").html(N.BaseMuestreo.formatNumber(y-b)),a.find(".total-v-diff").html(N.BaseMuestreo.formatNumber(m)),$("#mum-config_total_error_proyectado").val(v),$("#mum-config_tolerancia").val(g+n),$("#mum-config_cota_superior").val(b),$("#mum-config_e2__v2").val($("#cg-e2--v2").data("valor")),t.guardar_cambios_muestreo($("#mum-hidden_config_values input"),!1)},i);function i(){return u.call(this,N.MuestreoType.Mum)||this}$(function(){var t=new n;$(document).ajaxSend(function(){$("#fichatecnicaform").addClass("loadingblocked").block({message:"Guardando...",css:{color:"white"}})}),$(document).ajaxStop(function(){$("#fichatecnicaform").removeClass("loadingblocked").unblock()}),$("#table-muestreo-mum").on("change",".col-numeric input, .col-numeric select",function(){t.generar_tabla_muestra(),t.guardar_cambios_muestreo($(this))});var a=[];_.has(app.vars.muestreo_config,"muestras.mum")&&(a=app.vars.muestreo_config.muestras.mum),_.has(app.vars.muestreo_config,"muestras.mas")&&t.completar_cache_muestras(app.vars.muestreo_config.muestras.mas),t.generar_tabla_muestra(a),$("#table-muestreo-mum-evaluacion").on("change","input",function(){t.calcular_valor_error_en_evaluacion($(this).closest("tr")),t.calcular_totales_en_evaluacion(),t.guardar_cambios_muestras()}),$("#mum-conclusion-custom").on("change",function(){t.guardar_cambios_muestreo($(this),!1)}),$("#tab-mum-conclusion").on("click",function(t){if(0<$("#table-muestreo-mum-evaluacion .muestra-v-real input").filter(function(){return""==$(this).val()}).length){return t.preventDefault(),t.stopPropagation(),bootbox.alert("Debe ingresar el Valor según Auditoría de <u>TODAS</u> las operaciones de la muestra para continuar."),$("#tab-mum-evaluacion").tab("show"),!1}})})},{"./_proyecto_muestreo_base":1}]},{},[2]);
//# sourceMappingURL=proyecto_muestreo_mum.min.js.map
