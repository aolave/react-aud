{"version":3,"sources":["proyecto_new.coffee","proyecto_new.js"],"names":["display_form_row","set_replicable_projects","el","$","hide","addClass","removeClass","find","remove","closest","validate","each","this","rules","show","length","on","checked","val","parent","removeAttr","ev","preventDefault","hasClass","attr","change","html","trigger","v","$3C","ajaxGet","id_cliente","res","response","concat","id","name","ano_auditado","UsuarioGerente","first_name","last_name","sigla","prepend","validator","addMethod","form","errorList","push","message","element","document","getElementById","is","_","str","trim","call"],"mappings":"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","file":"proyecto_new.min.js","sourcesContent":["\r\n# -------------------------------------------------\r\n# Functions\r\n# -------------------------------------------------\r\n\r\ndisplay_form_row = (el)->\r\n  # Ocultar todo\r\n  $('.hideable').hide().addClass('hide').removeClass('error')\r\n  $('.hideable').find('.errors').remove()\r\n\r\n  # Quitar obligatoriedad\r\n  $('.hideable').closest('form').validate()\r\n  $('.hideable').find(':input').each( -> $(this).rules('remove', 'required') )\r\n\r\n  return unless el # Retornar si no se indican los campos a mostrar.\r\n\r\n  # Mostrar el campo indicado.\r\n  $(el).show().removeClass('hide')\r\n\r\n  # Volver obligatorio\r\n  $(el).find(':input').each( -> $(this).rules('add', 'required') ) if $(el).find(':input').length > 0\r\n  return\r\n\r\n# -------------------------------------------------\r\n# Event listeners\r\n# -------------------------------------------------\r\n$('body').on 'change', '.sf_admin_form_field_source :radio', ->\r\n  $(\"#button-style-inline li\").removeClass(\"active\");\r\n  checked = $('.sf_admin_form_field_source :radio:checked').val()\r\n  $(this).parent(\"li\").addClass(\"active\");\r\n  switch checked\r\n    when 'n'\r\n      display_form_row '.sf_admin_form_field_id_master_data'\r\n    when 'c'\r\n      display_form_row '.sf_admin_form_field_id_parent'\r\n    when 'r'\r\n      display_form_row '.sf_admin_form_field_id_parent_replication'\r\n\r\n\r\n\r\n$('#proyecto_admin-quickform-modal').on 'change', '.hideable', ->\r\n  $('#proyecto_admin-quickform-modal .hideable.hide :checked').removeAttr 'checked'\r\n\r\n\r\n$('body').on 'click', '#btn-toggle-newcliente', (ev)->\r\n  ev.preventDefault()\r\n  if $('.cliente_row').hasClass('hide')\r\n    $('.cliente_row').removeClass('hide')\r\n    $('.cliente_row:first').parent().show()\r\n    $('#proyecto_id_cliente').attr('disabled', 'disabled')\r\n  else\r\n    $('.cliente_row').addClass('hide')\r\n    $('.cliente_row:first').parent().hide()\r\n    $('#proyecto_id_cliente').removeAttr('disabled')\r\n  $('#proyecto_id_cliente').change()\r\n\r\n\r\n\r\nset_replicable_projects = (html)->\r\n  $('.sf_admin_form_field_id_parent_replication .controls').html(html)\r\n\r\n$ ->\r\n  $('.sf_admin_form_field_source :radio:first').trigger 'change'\r\n\r\n  $('body').on 'change','#proyecto_id_cliente', ->\r\n    v = $(this).val()\r\n    if v isnt ''\r\n      set_replicable_projects('<span class=\"ajax-loader-snake\"></span> Espere... Buscando proyectos a replicar...')\r\n      $3C.ajaxGet('proyecto/findLastByCliente/action', {'id_cliente' : v }, (res)->\r\n        if res.response\r\n          html = \"\"\"\r\n          <table class=\"table\">\r\n            <thead><tr><th style=\"width:80px\"></th><th>Proyecto</th><th>Año auditado</th><th>Líder</th></tr></thead>\r\n            <tbody>\r\n              <tr>\r\n                <td><input name=\"proyecto[id_parent_replication]\" type=\"radio\" value=\"#{res.response.id}\"  id=\"proyecto_id_parent_replication_#{res.response.id}\"></td>\r\n                <td><label for=\"proyecto_id_parent_replication_1\">#{res.response.name}</label></td>\r\n                <td>#{res.response.ano_auditado}</td>\r\n                <td>#{res.response.UsuarioGerente.first_name} #{res.response.UsuarioGerente.last_name} (#{res.response.UsuarioGerente.sigla})</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n          \"\"\"\r\n          set_replicable_projects(html)\r\n          $('.sf_admin_form_field_id_parent_replication').find(':input').each( -> $(this).rules('add', 'required') ) if $('.sf_admin_form_field_source :radio:checked').val() == 'r'\r\n        else\r\n          set_replicable_projects('<div class=\"alert alert-block alert-error _a-center\">0 proyectos</div>')\r\n      )\r\n    else\r\n      set_replicable_projects('<div class=\"alert alert-block alert-error _a-center\">Seleccione un cliente primero</div>')\r\n\r\n  $('#proyecto_id_cliente').change()\r\n\r\n  $('.radio_list.form-inline').attr('id', 'button-style-inline')\r\n\r\n  $(\".sf_admin_form_field_source .radio_list.form-inline li\").addClass(\"btn\")\r\n  $(\".sf_admin_form_field_source .radio_list.form-inline li:first-child\").prepend(\"<span class='icon-moon-document-alt-fill'></span>\")\r\n  $(\".sf_admin_form_field_source .radio_list.form-inline li:nth-child(2), .radio_list.form-inline li:last-child\").prepend(\"<span class='icon-moon-copy-3'></span>\")\r\n\r\n$.validator.addMethod 'globalReplication', (form)->\r\n if $('.sf_admin_form_field_source :radio:checked').val() isnt 'r'\r\n    $('.sf_admin_form_field_id_cliente').removeClass('error').find('.errors').remove()\r\n    return true\r\n\r\n if $('.sf_admin_form_field_id_parent_replication .controls :checked').length is 0\r\n    @errorList.push message: 'Debe seleccionar un cliente con un proyecto a replicar.', element: document.getElementById('proyecto_id_cliente')\r\n\r\n$.validator.addMethod 'globalCliente', (form)->\r\n  if $('#proyecto_id_cliente').is(':disabled')\r\n    if _.str.trim($('#proyecto_cliente_name').val()) == ''\r\n      @errorList.push message: 'Debe ingresar el nombre del nuevo cliente.', element: document.getElementById('proyecto_cliente_name')\r\n    if _.str.trim($('#proyecto_cliente_nit').val()) == ''\r\n      @errorList.push message: 'Debe ingresar el numero de identificacion del nuevo cliente.', element: document.getElementById('proyecto_cliente_nit')\r\n  else\r\n    if not $('#proyecto_id_cliente').val()\r\n      @errorList.push message: 'Debe seleccionar un cliente o dar clic en el boton \"Nuevo Cliente\" e ingresar los datos del nuevo cliente.', element: document.getElementById('proyecto_id_cliente')\r\n","(function() {\n  // -------------------------------------------------\n  // Functions\n  // -------------------------------------------------\n  var display_form_row, set_replicable_projects;\n\n  display_form_row = function(el) {\n    // Ocultar todo\n    $('.hideable').hide().addClass('hide').removeClass('error');\n    $('.hideable').find('.errors').remove();\n    // Quitar obligatoriedad\n    $('.hideable').closest('form').validate();\n    $('.hideable').find(':input').each(function() {\n      return $(this).rules('remove', 'required');\n    });\n    if (!el) { // Retornar si no se indican los campos a mostrar.\n      return;\n    }\n    \n    // Mostrar el campo indicado.\n    $(el).show().removeClass('hide');\n    if ($(el).find(':input').length > 0) {\n      // Volver obligatorio\n      $(el).find(':input').each(function() {\n        return $(this).rules('add', 'required');\n      });\n    }\n  };\n\n  // -------------------------------------------------\n  // Event listeners\n  // -------------------------------------------------\n  $('body').on('change', '.sf_admin_form_field_source :radio', function() {\n    var checked;\n    $(\"#button-style-inline li\").removeClass(\"active\");\n    checked = $('.sf_admin_form_field_source :radio:checked').val();\n    $(this).parent(\"li\").addClass(\"active\");\n    switch (checked) {\n      case 'n':\n        return display_form_row('.sf_admin_form_field_id_master_data');\n      case 'c':\n        return display_form_row('.sf_admin_form_field_id_parent');\n      case 'r':\n        return display_form_row('.sf_admin_form_field_id_parent_replication');\n    }\n  });\n\n  $('#proyecto_admin-quickform-modal').on('change', '.hideable', function() {\n    return $('#proyecto_admin-quickform-modal .hideable.hide :checked').removeAttr('checked');\n  });\n\n  $('body').on('click', '#btn-toggle-newcliente', function(ev) {\n    ev.preventDefault();\n    if ($('.cliente_row').hasClass('hide')) {\n      $('.cliente_row').removeClass('hide');\n      $('.cliente_row:first').parent().show();\n      $('#proyecto_id_cliente').attr('disabled', 'disabled');\n    } else {\n      $('.cliente_row').addClass('hide');\n      $('.cliente_row:first').parent().hide();\n      $('#proyecto_id_cliente').removeAttr('disabled');\n    }\n    return $('#proyecto_id_cliente').change();\n  });\n\n  set_replicable_projects = function(html) {\n    return $('.sf_admin_form_field_id_parent_replication .controls').html(html);\n  };\n\n  $(function() {\n    $('.sf_admin_form_field_source :radio:first').trigger('change');\n    $('body').on('change', '#proyecto_id_cliente', function() {\n      var v;\n      v = $(this).val();\n      if (v !== '') {\n        set_replicable_projects('<span class=\"ajax-loader-snake\"></span> Espere... Buscando proyectos a replicar...');\n        return $3C.ajaxGet('proyecto/findLastByCliente/action', {\n          'id_cliente': v\n        }, function(res) {\n          var html;\n          if (res.response) {\n            html = `<table class=\"table\">\\n  <thead><tr><th style=\"width:80px\"></th><th>Proyecto</th><th>Año auditado</th><th>Líder</th></tr></thead>\\n  <tbody>\\n    <tr>\\n      <td><input name=\"proyecto[id_parent_replication]\" type=\"radio\" value=\"${res.response.id}\"  id=\"proyecto_id_parent_replication_${res.response.id}\"></td>\\n      <td><label for=\"proyecto_id_parent_replication_1\">${res.response.name}</label></td>\\n      <td>${res.response.ano_auditado}</td>\\n      <td>${res.response.UsuarioGerente.first_name} ${res.response.UsuarioGerente.last_name} (${res.response.UsuarioGerente.sigla})</td>\\n    </tr>\\n  </tbody>\\n</table>`;\n            set_replicable_projects(html);\n            if ($('.sf_admin_form_field_source :radio:checked').val() === 'r') {\n              return $('.sf_admin_form_field_id_parent_replication').find(':input').each(function() {\n                return $(this).rules('add', 'required');\n              });\n            }\n          } else {\n            return set_replicable_projects('<div class=\"alert alert-block alert-error _a-center\">0 proyectos</div>');\n          }\n        });\n      } else {\n        return set_replicable_projects('<div class=\"alert alert-block alert-error _a-center\">Seleccione un cliente primero</div>');\n      }\n    });\n    $('#proyecto_id_cliente').change();\n    $('.radio_list.form-inline').attr('id', 'button-style-inline');\n    $(\".sf_admin_form_field_source .radio_list.form-inline li\").addClass(\"btn\");\n    $(\".sf_admin_form_field_source .radio_list.form-inline li:first-child\").prepend(\"<span class='icon-moon-document-alt-fill'></span>\");\n    return $(\".sf_admin_form_field_source .radio_list.form-inline li:nth-child(2), .radio_list.form-inline li:last-child\").prepend(\"<span class='icon-moon-copy-3'></span>\");\n  });\n\n  $.validator.addMethod('globalReplication', function(form) {\n    if ($('.sf_admin_form_field_source :radio:checked').val() !== 'r') {\n      $('.sf_admin_form_field_id_cliente').removeClass('error').find('.errors').remove();\n      return true;\n    }\n    if ($('.sf_admin_form_field_id_parent_replication .controls :checked').length === 0) {\n      return this.errorList.push({\n        message: 'Debe seleccionar un cliente con un proyecto a replicar.',\n        element: document.getElementById('proyecto_id_cliente')\n      });\n    }\n  });\n\n  $.validator.addMethod('globalCliente', function(form) {\n    if ($('#proyecto_id_cliente').is(':disabled')) {\n      if (_.str.trim($('#proyecto_cliente_name').val()) === '') {\n        this.errorList.push({\n          message: 'Debe ingresar el nombre del nuevo cliente.',\n          element: document.getElementById('proyecto_cliente_name')\n        });\n      }\n      if (_.str.trim($('#proyecto_cliente_nit').val()) === '') {\n        return this.errorList.push({\n          message: 'Debe ingresar el numero de identificacion del nuevo cliente.',\n          element: document.getElementById('proyecto_cliente_nit')\n        });\n      }\n    } else {\n      if (!$('#proyecto_id_cliente').val()) {\n        return this.errorList.push({\n          message: 'Debe seleccionar un cliente o dar clic en el boton \"Nuevo Cliente\" e ingresar los datos del nuevo cliente.',\n          element: document.getElementById('proyecto_id_cliente')\n        });\n      }\n    }\n  });\n\n}).call(this);\n"]}