{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"React\"","webpack:///external \"ReactDOM\"","webpack:///./src/proyecto__plan_auditoria/index.tsx","webpack:///./src/proyecto__plan_auditoria/App.tsx","webpack:///./src/proyecto__plan_auditoria/AppBars.tsx","webpack:///./src/proyecto__plan_auditoria/AppFilters.tsx","webpack:///./src/proyecto__plan_auditoria/ModalPasoAssign.tsx","webpack:///./src/proyecto__plan_auditoria/PlanAuditoriaContext.ts","webpack:///./src/proyecto__plan_auditoria/ModalVisitasManage.tsx","webpack:///./src/proyecto__plan_auditoria/AppTree.tsx","webpack:///./src/proyecto__plan_auditoria/AppTreeItemActions.tsx","webpack:///./src/proyecto__plan_auditoria/ModalPasoNew.tsx","webpack:///./src/proyecto__plan_auditoria/ModalPasoCopyFrom.tsx","webpack:///./src/proyecto__plan_auditoria/utils.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","React","ReactDOM","$","unblockUI","render","document","getElementById","App","props","updateTree","tree","cb","setState","updateVisitas","visitas","updateFilters","newfilters","state","filters","assign","_","each","filter","post","url_for","app","vars","idproyecto","plan_auditoria","settings","Component","contextValue","this","appClasses","size","Provider","className","AppTopBar","AppBottomBar","VisibilityLinkActions","useContext","Fragment","href","onClick","ev","preventDefault","blockUI","setTimeout","ProyectoPlanAuditoriaUtils","changeOpenToAll","AppActionCreateFase","context","prompt","bootbox","header","content","str","trim","create_blockUI_loading_message","fase_name","done","res","hasErrors","fase","response","record","id","id_master_data_fase","code","descripcion","position","index","sortIndex","open","items","modal","fail","pnotify","type","text","addClass","PureComponent","contextType","AppTopBarActions","style","data-toggle","is_editable","proyecto","isOpen","textAlign","user_has_role_permission","AppActionVisitasManage","ModalPasoMassAssign","target","scrollboxRef","createRef","$stickyBox","current","stickyBoxTop","offset","top","scroll","scrollTop","removeClass","ref","AppFilters","AppFilterMessage","visita","maxWidth","onChange","setFilter","map","status","equipo","asignado","user","user_id","fullname","renderVisitasFilterChoices","renderStatusFilterChoices","renderUsersFilterChoices","reject","marginRight","marginLeft","MasterDataTreeContext","createContext","ignore_assigned","updateFilter","TreeItemVisita","item","alias","getVisitaById","id_visita","getUserById","htmlFor","checked","selected","disabled","sigla","TreeItemFase","useState","collapsed","setCollapsed","countPendingForAssign","assigned","total","subitem","_assigned","_checked","_total","hasPending","title","hasUncheckableItems","delay","parent","HojaTrabajoTree","Consumer","Filters","some","found","onSelectUser","onClickToContinueToStep2","step","alert","onClose","onSubmit","pasos","pasosChecked","location","reload","fases","Subfases","subfase","MasterDataPaso","paso","MasterDataPasoHasProyectoVisita","paso_visita","visita_alias","id_proyecto_visita","id_usuario_asignado","parents","tree_tmp","pop","find","setItemsChecked","fixIncompletedCheckedItem","findPasosChecked","refreshItemsChecked","isItemCheckable","union","refreshItems","checkParent","checkableItems","_item","uncheckedCount","checkChildren","equipoChoices","description","rol","label","circular","color","placeholder","defaultValue","selection","fluid","options","trigger","on","closeIcon","Header","Content","Group","attached","widths","active","completed","icon","renderStepContent","onClickAction","ModalVisitasManage","VisitaManageItem","onClickDelete","event","warningConfirm","answer","sf_method","onClickEdit","visita_name","message","_visita","findWhere","sumaria_periodo_actual","Item","display","floated","onSortEnd","ids","sortable","substr","sort","visitaIndex","findIndex","onClickNew","paso_materialidad","_pasoFound","paso_visitas","handle","axis","update","divided","listRef","toggle","makeSortable","revert","forceHelperSize","containment","helper","cloneItem","clone","remove","start","ui","stop","success","positions","v","k","rubro","editable","itemClasses","lpad","toUpperCase","TreeItemFaseActions","sortBy","parseInt","TreeItemSubfase","fetchingRiesgos","loadSumarias","loadRiesgos","checkSortable","fetchingSumarias","hasFilters","sumarias","ejecucion_fase_id","getJSON","export_options","fase_id","totales","rubro_id","rubroIndex","riesgosLoaded","riesgos","paso_id","pasoIndex","$sortableList","id_proyecto_paso_estado","pasosElements","matchesPasoToFilters","TreeItemPaso","getIndexChar","TreeItemSubfaseActions","TreeItemPasoSubsumaria","prefix","String","fromCharCode","Math","floor","riesgosChunk","take","riesgosContent","riesgo","join","pasoLiClassnames","tipo","toLowerCase","hallazgosCount","paso_hallazgos","riesgosCount","countRiesgos","TreeItemPasoActions","TreeItemPasoPeriodoVisitaList","TreeItemPasoDefaultVisitaList","aserciones","marginTop","minWidth","width","asercion","objetivo","objetivos","id_master_data_objetivo","basic","TreeItemPasoSubsumariaVisita","accounting","formatMoney","shortVisitaAlias","getTotal","onContextMenu","currentTarget","click","linkurl","DropdownItemAssignUser","DropdownItemDeletePasoVisita","paso_estado","paso_estados","linkUrl","compact","inline","Menu","getDropdownItems","backgroundColor","wordInitials","onClickRename","getPasoVisitas","fontSize","visitaName","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre","replace","from","RegExp","match","AppTree","input","paso_tipo","MasterDataPasoHasObjetivo","parseTree","defaultOpen","element","openDefault","default_open","minHeight","onClickAdd","id_parent","ModalPasoNew","ModalPasoCopyFrom","ModalPasoEdit","include","ModalPasoAssoc","id_asignado","paso_visita_id","id_master_data_paso_has_proyecto_visita","paso_id_usuario","onClickItem","equipoOptions","dimmer","clearable","Actions","DualListBoxIcons","moveLeft","moveAllLeft","moveRight","moveAllRight","moveDown","moveUp","ModalPasoStep1","relaxed","centered","columns","Column","onSelect","version","ribbon","ModalPasoStep2","e","onContinue","Field","required","Input","maxLength","negative","onCancel","positive","ModalPasoStep3","forEach","availableLabel","selectedLabel","icons","ModalPasoStep4Default","ModalPasoStep4Periodo","help","option","nextStep","prevState","prevStep","selectPasoTipo","pasoTipo","assignPasoName","paso_name","_assignFormDataValue","assignAserciones","assignVisitas","periodos","assignPeriodos","submit","form","createElement","method","action","appendChild","formData","body","step4Title","_getStepContent","onChangeName","valueName","onChangeAserciones","valueAserciones","paso_objetivos","asercionId","pluck","asercionesoChoices","id_paso","codes","ModalStep1","updateQueryUrlParams","param","params","queryString","search","getQueryUrlParams","query","setQueryUrlParams","USED_PASO_CODES","onChecked","countPending","contains","isChecked","setChecked","used_coded","ModalStep2MaterData","isLoading","selectedPasos","onChangeCheckedPaso","postParams","item_type","parent_id","rubroId","_loadMasterData","masterData","parseTreeToItems","inverted","renderTree","sourceSelected","pasosSelected","onSelectSource","onSelectPasos","closeOnDimmerClick","getStepContent","renderModal"],"mappings":"4BACE,SAASA,EAAqBC,GAQ7B,IAPA,IAMIC,EAAUC,EANVC,EAAWH,EAAK,GAChBI,EAAcJ,EAAK,GACnBK,EAAiBL,EAAK,GAIHM,EAAI,EAAGC,EAAW,GACpCD,EAAIH,EAASK,OAAQF,IACzBJ,EAAUC,EAASG,GAChBG,OAAOC,UAAUC,eAAeC,KAAKC,EAAiBX,IAAYW,EAAgBX,IACpFK,EAASO,KAAKD,EAAgBX,GAAS,IAExCW,EAAgBX,GAAW,EAE5B,IAAID,KAAYG,EACZK,OAAOC,UAAUC,eAAeC,KAAKR,EAAaH,KACpDc,EAAQd,GAAYG,EAAYH,IAKlC,IAFGe,GAAqBA,EAAoBhB,GAEtCO,EAASC,QACdD,EAASU,OAATV,GAOD,OAHAW,EAAgBJ,KAAKK,MAAMD,EAAiBb,GAAkB,IAGvDe,IAER,SAASA,IAER,IADA,IAAIC,EACIf,EAAI,EAAGA,EAAIY,EAAgBV,OAAQF,IAAK,CAG/C,IAFA,IAAIgB,EAAiBJ,EAAgBZ,GACjCiB,GAAY,EACRC,EAAI,EAAGA,EAAIF,EAAed,OAAQgB,IAAK,CAC9C,IAAIC,EAAQH,EAAeE,GACG,IAA3BX,EAAgBY,KAAcF,GAAY,GAE3CA,IACFL,EAAgBQ,OAAOpB,IAAK,GAC5Be,EAASM,EAAoBA,EAAoBC,EAAIN,EAAe,KAItE,OAAOD,EAIR,IAAIQ,EAAmB,GAKnBhB,EAAkB,CACrBiB,EAAG,GAGAZ,EAAkB,GAGtB,SAASS,EAAoB1B,GAG5B,GAAG4B,EAAiB5B,GACnB,OAAO4B,EAAiB5B,GAAU8B,QAGnC,IAAIC,EAASH,EAAiB5B,GAAY,CACzCK,EAAGL,EACHgC,GAAG,EACHF,QAAS,IAUV,OANAhB,EAAQd,GAAUW,KAAKoB,EAAOD,QAASC,EAAQA,EAAOD,QAASJ,GAG/DK,EAAOC,GAAI,EAGJD,EAAOD,QAKfJ,EAAoBO,EAAInB,EAGxBY,EAAoBQ,EAAIN,EAGxBF,EAAoBS,EAAI,SAASL,EAASM,EAAMC,GAC3CX,EAAoBY,EAAER,EAASM,IAClC5B,OAAO+B,eAAeT,EAASM,EAAM,CAAEI,YAAY,EAAMC,IAAKJ,KAKhEX,EAAoBgB,EAAI,SAASZ,GACX,oBAAXa,QAA0BA,OAAOC,aAC1CpC,OAAO+B,eAAeT,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DrC,OAAO+B,eAAeT,EAAS,aAAc,CAAEe,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKzC,OAAO0C,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBzC,OAAO+B,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBS,EAAEc,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAStB,GAChC,IAAIM,EAASN,GAAUA,EAAOiB,WAC7B,WAAwB,OAAOjB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAL,EAAoBS,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRX,EAAoBY,EAAI,SAASgB,EAAQC,GAAY,OAAO/C,OAAOC,UAAUC,eAAeC,KAAK2C,EAAQC,IAGzG7B,EAAoB8B,EAAI,GAExB,IAAIC,EAAaC,OAAgC,wBAAIA,OAAgC,yBAAK,GACtFC,EAAmBF,EAAW5C,KAAKuC,KAAKK,GAC5CA,EAAW5C,KAAOf,EAClB2D,EAAaA,EAAWG,QACxB,IAAI,IAAIvD,EAAI,EAAGA,EAAIoD,EAAWlD,OAAQF,IAAKP,EAAqB2D,EAAWpD,IAC3E,IAAIU,EAAsB4C,EAM1B,OAFA1C,EAAgBJ,KAAK,CAAC,IAAI,IAEnBM,I,kBCvJTY,EAAOD,QAAU+B,O,kBCAjB9B,EAAOD,QAAUgC,U,iCCAjB,I,EAAA,SACA,G,EAAA,S,2BAEAC,EAAEC,aAEF,IAAAC,QAAO,oBAAC,UAAD,MAASC,SAASC,eAAe,U,mGCLxC,WAEA,WACA,SACA,YAEA,U,81BAUqBC,E,YACnB,WAAYC,GAAS,a,4FAAA,UACnB,wBAAMA,KASRC,WAAa,SAACC,EAAWC,GACvB,EAAKC,SAAS,WACZ,MAAO,CAAEF,SACRC,IAGL,EAAAE,cAAgB,SAACC,EAAcH,GAC7B,EAAKC,SAAS,WACZ,MAAO,CAAEE,YACRH,IAGL,EAAAI,cAAgB,SAACC,GACf,EAAKJ,SACH,SAACK,GACC,IAAIC,EAAyB,OAAfF,EAAsB,GAAKrE,OAAOwE,OAAO,GAAIF,EAAMC,QAASF,GAQ1E,OANAI,EAAEC,KAAKH,EAAS,SAAClC,EAAesC,GAChB,KAAVtC,UACKkC,EAAQI,KAIZ,CAAEJ,YAEX,WACE,IAAIA,EAAe,GACnBE,EAAEC,KAAK,EAAKJ,MAAMC,QAAS,SAAClC,EAAOM,GAC7BN,GAAmB,KAAVA,IACXkC,EAAQ5B,GAAON,KAInBkB,EAAEqB,KAAKC,QAAQ,YAAcC,IAAIC,KAAKC,WAAa,2BAA4B,CAAET,eAxCrF,EAAKD,MAAQ,CACXP,KAAM,KACNI,QAASW,IAAIC,KAAKE,eAAed,QACjCI,QAASvE,OAAOwE,OAAO,GAAIM,IAAIC,KAAKE,eAAeC,SAASX,UAN3C,E,sPADU,EAAAY,W,uCAkD7B,IAAMC,EAAe,CACnBrB,KAAMsB,KAAKf,MAAMP,KACjBI,QAASkB,KAAKf,MAAMH,QACpBI,QAASc,KAAKf,MAAMC,QACpBT,WAAYuB,KAAKvB,WACjBM,cAAeiB,KAAKjB,cACpBF,cAAemB,KAAKnB,eAGhBoB,GAAa,aAAG,WAAYb,EAAEc,KAAKF,KAAKf,MAAMC,SAAW,EAAI,cAAgB,MAEnF,OACE,oBAAC,UAAqBiB,SAAtB,CAA+BnD,MAAO+C,GACpC,2BAAKK,UAAWH,GACd,oBAAC,EAAAI,UAAD,MACA,oBAAC,UAAD,MACA,oBAAC,EAAAC,aAAD,a,iKClFV,I,EAAA,OAEA,G,EAAA,Q,2BACA,SACA,QACA,SACA,S,kqCAIA,IAAMC,EAAwB,WAAK,OACJ,IAAAC,YAAW,WAAhC9B,EADyB,EACzBA,KAAMD,EADmB,EACnBA,WAkBd,OACE,oBAAC,EAAAgC,SAAD,KACE,yBAAGC,KAAK,IAAIN,UAAU,YAAYO,QAlBhB,SAACC,GACrBA,EAAGC,iBACH3C,EAAE4C,UACFC,WAAW,WACT,EAAAC,2BAA2BC,gBAAgBvC,GAAM,GACjDD,EAAWC,GACXR,EAAEC,aACD,OAWD,iBADF,IAKE,yBAAGuC,KAAK,IAAIN,UAAU,cAAcO,QAZhB,SAACC,GACvBA,EAAGC,iBACH,EAAAG,2BAA2BC,gBAAgBvC,GAAM,GACjDD,EAAWC,KAST,mBAOAwC,E,YAAN,qC,sCAGEP,QAAU,SAACC,GACTA,EAAGC,iBAD4B,MAGF,EAAKM,QAA1BzC,EAHuB,EAGvBA,KAAMD,EAHiB,EAGjBA,WAER2C,EAASC,QAAQD,OACrB,CAAEE,OAAQ,aAAcC,QAAS,4DACjC,WACA,QACA,SAAC1E,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GA8BrB,OA1BAqB,EAAE4C,QAAQY,+BAA+B,qCACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,sBAAsD,CAAEgC,UAAW9E,IAC9E+E,KAAK,SAACC,GACL,IAAKA,EAAIC,UAAW,CAClB,IAAMC,EAAOF,EAAIG,SAASC,OAC1BvD,EAAK1D,KAAK,CACRkH,GAAIH,EAAKI,oBACTC,KAAML,EAAKK,KACXC,YAAaN,EAAKM,YAClBC,SAAUP,EAAKO,SACfC,MAAO7D,EAAKhE,OACZ8H,UAAW9D,EAAKhE,OAChB+H,MAAM,EACNC,MAAO,KAETjE,EAAWC,GACX0C,EAAOuB,MAAM,QAGfzE,EAAEC,cAEHyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,gDACjC7E,EAAEC,eAGC,GAET,IAEFD,EAAE,kBAAkB8E,SAAS,4BA/CjC,E,WAAkC,EAAAC,e,oCAmD9B,OACE,yBAAGvC,KAAK,IAAIC,QAASX,KAAKW,SAA1B,kB,KAnDG,EAAAuC,YAAc,U,IA0DjBC,E,wFAAyB,EAAAF,e,oCAK3B,GAAa,OADIjD,KAAKmB,QAAdzC,KAEN,OACE,2BAAK0B,UAAU,aAAagD,MAAO,CAAEd,SAAU,aAC7C,yBAAGlC,UAAU,kDAAkDiD,cAAY,WAAW3C,KAAK,KACzF,2BAAKN,UAAU,mCAMvB,IAAMkD,EAAc7D,IAAIC,KAAKE,eAAe2D,SAASC,OAErD,OACE,2BAAKpD,UAAU,aAAagD,MAAO,CAAEd,SAAU,aAC7C,yBAAGlC,UAAU,kDAAkDiD,cAAY,WAAW3C,KAAK,KAA3F,YAGA,0BAAIN,UAAU,2BAA2BgD,MAAO,CAAEK,UAAW,SAC1DH,GACDI,yBAAyB,gBACvB,8BACE,oBAACxC,EAAD,OAGHoC,GACDI,yBAAyB,gBACvB,8BACE,oBAAC,EAAAC,uBAAD,OAGHL,GACDI,yBAAyB,yBACvB,8BACE,oBAAC,EAAAE,oBAAD,OAGJ,8BACE,yBAAGlD,KAAMlB,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAA+DkE,OAAO,UAAtF,4B,KAzCH,EAAAX,YAAc,U,IAmDV7C,E,YAAb,qC,sCACEyD,cAAe,IAAAC,aADjB,E,WAA+B,EAAAd,e,+CAI3B,IAAMe,EAAa9F,EAAE8B,KAAK8D,aAAaG,SACjCC,EAAeF,EAAWG,SAASC,IACzClG,EAAEL,QAAQwG,OAAO,WACPnG,EAAE8B,MAAMsE,aACPJ,EACPF,EAAWhB,SAAS,SAEpBgB,EAAWO,YAAY,a,+BAM3B,OACE,2BAAKnE,UAAU,2BAA2BoE,IAAKxE,KAAK8D,cAClD,2BAAK1D,UAAU,WACb,2BAAKA,UAAU,oBACb,oBAACG,EAAD,OAEF,2BAAKH,UAAU,oBACb,oBAAC,EAAAqE,WAAD,OAEF,2BAAKrE,UAAU,mBACb,oBAAC+C,EAAD,QAGJ,oBAAC,EAAAuB,iBAAD,W,uBAMKpE,E,wFAAqB,EAAAR,W,oCAE9B,OACE,2BAAKM,UAAU,aACb,oBAACG,EAAD,W,gJCjMR,WAEA,UAEA,WACA,Q,81BAIakE,E,8ZAAmB,EAAA3E,W,wCAGpBR,EAA0CtC,GAAa,MACnBgD,KAAKmB,QAAzCzC,EADuD,EACvDA,KAAMK,EADiD,EACjDA,cAAeN,EADkC,EAClCA,WAC7BM,E,sHAAc,CAAD,GAAIO,EAAStC,IAE1BkB,EAAE4C,UACFC,WAAW,WACT,EAAAC,2BAA2BC,gBAAgBvC,GAAM,GACjDD,EAAWC,GACXR,EAAEC,aACD,O,mDAGqB,WAChBe,EAAYc,KAAKmB,QAAjBjC,QACFJ,EAA0CW,IAAIC,KAAKE,eAAed,QAMxE,OACE,8BACEsB,WAAW,aAAG,0BAA2BlB,EAAQyF,OAAS,SAAW,MACrEzC,GAAG,6BACHkB,MAAO,CAAEwB,SAAU,KACnBC,SATa,SAACjE,GAChB,EAAKkE,UAAU,SAAWlE,EAAGiD,OAAe7G,QAS1CA,MAAOkC,EAAQyF,QAAU,IAEzB,8BAAQ3H,MAAM,IAAd,cACCoC,EAAE2F,IAAIjG,EAAS,SAAC6F,GACf,OACE,8BAAQrH,IAAKqH,EAAOzC,GAAIlF,MAAO2H,EAAOzC,IACnCyC,EAAOpI,W,kDAQK,WACf2C,EAAYc,KAAKmB,QAAjBjC,QAOR,OACE,8BACEkB,WAAW,aAAG,0BAA2BlB,EAAQ8F,OAAS,SAAW,MACrE9C,GAAG,6BACH2C,SAVa,SAACjE,GAChB,EAAKkE,UAAU,SAAWlE,EAAGiD,OAAe7G,QAU1CA,MAAOkC,EAAQ8F,QAAU,IAEzB,8BAAQhI,MAAM,IAAd,cACCoC,EAAE2F,IAVU,CAAE,cAAe,WAAY,aAAc,aAAc,WAAY,kBAUjE,SAACC,EAAQ1H,GACxB,OACE,8BAAQA,IAAKA,EAAM,EAAGN,MAAOM,EAAM,GAChC0H,Q,iDAQW,WACd9F,EAAYc,KAAKmB,QAAjBjC,QACF+F,EAA8DxF,IAAIC,KAAKE,eAAeqF,OAM5F,OACE,8BACE7E,WAAW,aAAG,0BAA2BlB,EAAQgG,SAAW,SAAW,MACvEhD,GAAG,+BACHkB,MAAO,CAAEwB,SAAU,KACnBC,SATa,SAACjE,GAChB,EAAKkE,UAAU,WAAalE,EAAGiD,OAAe7G,QAS5CA,MAAOkC,EAAQgG,UAAY,IAE3B,8BAAQlI,MAAM,IAAd,kBACCoC,EAAE2F,IAAIE,EAAQ,SAACE,GACd,OACE,8BAAQ7H,IAAK6H,EAAKjD,GAAIlF,MAAOmI,EAAKC,SAC/BD,EAAKE,e,+BAShB,OACE,2BAAKnD,GAAG,sBAAsB9B,UAAU,cACtC,4BAAMA,UAAU,MAAhB,iBACCJ,KAAKsF,6BACLtF,KAAKuF,4BACLvF,KAAKwF,iC,+CAvGL,EAAAtC,YAAc,U,mBA6GS,WAAK,OACA,IAAA1C,YAAW,WAAtCtB,EAD2B,EAC3BA,QAASH,EADkB,EAClBA,cAIjB,KAFmBK,EAAEqG,OAAOvG,EAAS,SAAClC,GAAD,MAAqB,KAAVA,IAAiBA,IAAOtC,OAAS,GAG/E,OAAO,KAST,OACE,2BAAKwH,GAAG,eAAe9B,UAAU,yBAC/B,4BAAMA,UAAU,iBAAiBgD,MAAO,CAAEsC,YAAa,KADzD,6EAGE,yBAAGhF,KAAK,IAAIN,UAAU,eAAegD,MAAO,CAAEuC,WAAY,IAAMhF,QAVpD,SAACC,GACfA,EAAGC,iBAEH9B,EAAc,QAOZ,qB,+GC1IN,WAEA,WACA,YACA,YACA,YAEA,UAEA,Q,4uCAuBA,IAAM6G,GAAwB,IAAAC,eAAyC,CACrEnH,KAAM,GACND,WAAY,KACZS,QAAS,CAAE4G,iBAAiB,GAC5BC,aAAc,OAmEVC,EAAiB,SAAC,GAAiD,IAA/CC,EAA+C,EAA/CA,KAClBtB,EAASvF,EAAEc,KAAK+F,EAAKC,OAAS,CAAE3J,KAAM0J,EAAKC,OAAU,EAAAlF,2BAA2BmF,cAAcF,EAAKG,WACnGjB,EAAO,EAAAnE,2BAA2BqF,YAAYJ,EAAKb,SAFc,GAIvC,IAAA5E,YAAWoF,GAAnCnH,EAJ+D,EAI/DA,WAAYS,EAJmD,EAInDA,QAOpB,OACE,0BAAI5B,IAAK2I,EAAK/D,GAAI9B,WAAW,aAAG,0BAA2B+E,EAAO,WAAa,eAC7E,6BAAOmB,QAAO,iCAA4BL,EAAK/D,KAC7C,6BACEY,KAAK,WACLZ,GAAE,iCAA4B+D,EAAK/D,IACnCqE,QAASN,EAAKO,SACdpG,UAAU,WACVqG,SAAUvH,EAAQ4G,mBAAqBG,EAAKb,QAC5CP,SAdiB,WACvBoB,EAAKO,UAAYP,EAAKO,SACtB/H,EAAWwH,MAcP,4BAAM7F,UAAU,aAAauE,EAASA,EAAOpI,KAAO,KACpD,4BAAM6D,WAAW,aAAG,gBAAiB+E,EAAO,sBAAwB,KAAMA,EAAOA,EAAKuB,MAAQ,OAMhGC,EAAe,SAAfA,EAAgB,GAA2C,IAAzCV,EAAyC,EAAzCA,KAAyC,KAC3B,IAAAW,WAAS,GADkB,GACvDC,EADuD,KAC5CC,EAD4C,QAQ/B,IAAAtG,YAAWoF,GAAnCnH,EARuD,EAQvDA,WAAYS,EAR2C,EAQ3CA,QAR2C,EA7FnC,SAAxB6H,EAAyBd,GAC7B,IAAIe,EAAW,EACbC,EAAQ,EACRV,EAAU,EAeZ,MAbiB,QAAbN,EAAKnD,MACPmE,EAAQ7H,EAAEc,KAAK+F,EAAKvD,OACpBsE,EAAW5H,EAAEc,KAAKd,EAAEqG,OAAOQ,EAAKvD,MAAsC,CAAE0C,QAAS,QACjFmB,EAAUnH,EAAEc,KAAKd,EAAEE,OAAO2G,EAAKvD,MAAsC,CAAE8D,UAAU,MAEjFpH,EAAEC,KAAK4G,EAAKvD,MAAO,SAACwE,GAAW,MACqCH,EAAsBG,GAAtEC,EADW,EACrBH,SAA8BI,EADT,EACAb,QAA0Bc,EAD1B,EACmBJ,MAEhDD,GAAYG,EACZZ,GAAWa,EACXH,GAASI,IAGN,CAAEL,WAAUT,UAASU,SAkGSF,CAAsBd,GAAnDe,EAvBuD,EAuBvDA,SAAUT,EAvB6C,EAuB7CA,QAASU,EAvBoC,EAuBpCA,MACrBK,EAAaL,EAAQ,GAAKD,EAAWC,EAE3C,OACE,0BAAI3J,IAAK2I,EAAK/D,GAAI9B,WAAW,aAAG,mBAAoB6F,EAAKnD,OACvD,2BAAK1C,UAAU,yBACb,yBAAGM,KAAK,IAAIC,QA1BF,SAACC,GACfA,EAAGC,iBACHiG,GAAcD,KAyBR,4BAAMzG,UAAU,aAAa6F,EAAK5D,cAEpC,6BACES,KAAK,WACLyD,QAASN,EAAKO,SACde,MAAO,oBACPnH,UAAU,WACVqG,SAAyC,GAA/BrH,EAAEc,KAAK+F,EAAKvD,OACtBmC,SA5BiB,WACvBoB,EAAKO,UAAYP,EAAKO,SACtB/H,EAAWwH,GAEP/G,EAAQ4G,iBAAmB0B,EAAoBvB,IACjD/H,EAAE2E,QAAQ,CACR0E,MAAO,cACPxE,KAAM,wGACN0E,MAAO,SAuBNlB,EAAU,GACT,8BAAQnG,UAAU,6BAA6BmH,MAAM,oCAArD,IACIhB,EADJ,KAKF,4BACEnG,WAAW,aAAG,sBAAuBkH,EAAa,kBAAoB,iBACtEC,MAAM,qFAELP,EAJH,MAIgBC,IAGlB,0BAAI7G,WAAW,aAAG,uBAAwByG,EAAY,OAAS,OAC5DzH,EAAE2F,IAAIkB,EAAKvD,MAAgB,SAACwE,GAE3B,OADAA,EAAQQ,OAASzB,EACM,cAAhBiB,EAAQpE,KACb,oBAACkD,EAAD,CAAgB1I,IAAK4J,EAAQhF,GAAI+D,KAAMiB,IAEvC,oBAACP,EAAD,CAAcrJ,IAAK4J,EAAQhF,GAAI+D,KAAMiB,SAQ3CS,EAAkB,WACtB,OACE,oBAAC/B,EAAsBgC,SAAvB,KACG,gBAAGlJ,EAAH,EAAGA,KAAH,OACC,0BAAI0B,UAAU,6DACXhB,EAAE2F,IAAIrG,EAAM,SAACqD,GACZ,OAAO,oBAAC4E,EAAD,CAAcrJ,IAAG,oBAAeyE,EAAKe,KAApB,YAA4Bf,EAAKG,IAAM+D,KAAMlE,UAQ3E8F,EAAU,WACd,OACE,oBAACjC,EAAsBgC,SAAvB,KACG,gBAAG1I,EAAH,EAAGA,QAAS6G,EAAZ,EAAYA,aAAZ,OACC,2BAAK3F,UAAU,cACb,2BAAKA,UAAU,WACb,iCACE,6BACE0C,KAAK,WACLyD,QAASrH,EAAQ4G,gBACjBjB,SAAU,SAACjE,GAAD,OAAQmF,EAAa,CAAED,gBAAiBlF,EAAGiD,OAAO0C,aAJhE,mCAeNiB,EAAsB,SAAtBA,EAAuBvB,GAC3B,GAAiB,QAAbA,EAAKnD,KACP,OAAO1D,EAAE0I,KAAK7B,EAAKvD,MAAO,SAACwE,GAAD,OAAgC,MAAnBA,EAAQ9B,UAE/C,IAAI2C,GAAQ,EAOZ,OANA3I,EAAEC,KAAK4G,EAAKvD,MAAO,SAACwE,GAClB,GAAIM,EAAoBN,GAEtB,OADAa,GAAQ,GACD,IAGJA,GAwBEnE,E,YACX,WAAYpF,GAAS,a,4FAAA,UACnB,wBAAMA,KAiBRwJ,aAAe,SAACpH,EAA0B1G,GACxC,EAAK0E,SAAS,CAAEwG,QAASlL,EAAK8C,SAGhC,EAAAiL,yBAA2B,WACpB,EAAKhJ,MAAMmG,QAKhB,EAAKxG,SAAS,CAAEsJ,KAAM,IAJpB7G,QAAQ8G,MAAM,8CAoNlB,EAAAC,QAAU,WACR,EAAKxJ,SAAS,CAAE6D,MAAM,KAGxB,EAAA4F,SAAW,WACTnK,EAAE4C,QAAQY,+BAA+B,8CACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKE,eAAe2D,SAASrB,GAA9C,sBAAsE,CAClFkD,QAAS,EAAKnG,MAAMmG,QACpBkD,MAAO,EAAKrJ,MAAMsJ,eACjB3G,KAAK,WACN4G,SAASC,YAnPX,EAAKxJ,MAAQ,CACXwD,MAAM,EACNyF,KAAM,EACN9C,QAAS,KACT1G,KAAM,KACNQ,QAAS,CAAE4G,iBAAiB,GAC5ByC,aAAc,IATG,E,sPADkB,EAAAzI,W,kDAlNhB,IAACpB,EAgOtBsB,KAAKpB,SAAS,CACZF,MAjOoBA,EAiOGe,IAAIC,KAAKE,eAAe8I,MAhOpCtJ,EAAE2F,IAAIrG,EAAM,SAACqD,GAC1B,MAAO,CACLG,GAAIH,EAAKG,GACTG,YAAaN,EAAKM,YAClBS,KAAM,QACN0D,UAAU,EACVkB,OAAQ,KACRhF,MAAOtD,EAAE2F,IAAIhD,EAAK4G,SAAU,SAACC,GAC3B,MAAO,CACL1G,GAAI0G,EAAQ1G,GACZG,YAAauG,EAAQvG,YACrBS,KAAM,WACN0D,UAAU,EACVkB,OAAQ,KACRhF,MAAOtD,EAAE2F,IAAI6D,EAAQC,eAAgB,SAACC,GACpC,MAAO,CACL5G,GAAI4G,EAAK5G,GACTG,YAAayG,EAAKzG,YAClBS,KAAM,OACN0D,UAAU,EACVkB,OAAQ,KACRhF,MAAOtD,EAAE2F,IAAI+D,EAAKC,gCAAiC,SAACC,GAClD,MAAO,CACL9G,GAAI8G,EAAY9G,GAChBY,KAAM,aACNoD,MAAO8C,EAAYC,aACnB7C,UAAW4C,EAAYE,mBACvB9D,QAAS4D,EAAYG,oBACrBzB,OAAQ,KACRlB,UAAU,mB,iCAoNfP,GAAS,WAClBjG,KAAKpB,SAAS,SAACK,GAMb,IALA,IAAIP,EAAO/D,OAAOwE,OAAO,GAAIF,EAAMP,MAE/B0K,EAAU,GACVnF,EAAUgC,EAEPhC,EAAQyD,QACb0B,EAAQpO,KAAKiJ,EAAQyD,QACrBzD,EAAUA,EAAQyD,OAIpB,IADA,IAAI2B,EAAW3K,EACR0K,EAAQ1O,OAAS,GACtBuJ,EAAUmF,EAAQE,MAElBD,EADYjK,EAAEmK,KAAKF,EAAU,CAAEnH,GAAI+B,EAAQ/B,KAC1BQ,MAGnB,IAAIqF,EAAQ3I,EAAEmK,KAAKF,EAAU,CAAEnH,GAAI+D,EAAK/D,KAWxC,OAVA6F,EAAMvB,SAAWP,EAAKO,SAElBuB,EAAMrF,OACR,EAAK8G,gBAAgBzB,EAAMrF,MAAOqF,EAAMvB,UAG1C,EAAKiD,0BAA0B/K,GAIxB,CAAEA,OAAM6J,aAFM,EAAKmB,iBAAiBhL,Q,mCAMlCY,GAAW,WACtBU,KAAKpB,SACH,SAACK,GAGC,MAAO,CAAEC,QAFKvE,OAAOwE,OAAO,GAAIF,EAAMC,QAASI,KAIjD,WACE,IAAIZ,EAAO/D,OAAOwE,OAAO,GAAI,EAAKF,MAAMP,MACxC,EAAKiL,sBACL,EAAKF,0BAA0B/K,GAC/B,EAAKE,SAAS,CAAEF,a,sCAKNgE,GAAqC,WAAvB6D,IAAuB,yDACnDnH,EAAEC,KAAKqD,EAAO,SAACuD,GACbA,EAAKO,SAAWD,GAAW,EAAKqD,gBAAgB3D,GAC5CA,EAAKvD,OACP,EAAK8G,gBAAgBvD,EAAKvD,MAAO6D,O,uCAKtB7D,GAA4B,WACvC6F,EAAyB,GAW7B,OAVAnJ,EAAEC,KAAKqD,EAAO,SAACuD,GACI,cAAbA,EAAKnD,KACHmD,EAAKO,UACP+B,EAAavN,KAAKiL,EAAK/D,IAGzBqG,EAAenJ,EAAEyK,MAAMtB,EAAc,EAAKmB,iBAAiBzD,EAAKvD,UAI7D6F,I,sCAGOtC,GACd,MAAiB,cAAbA,EAAKnD,OAAwBmD,EAAKb,UAAWpF,KAAKf,MAAMC,QAAQ4G,kB,4CAOnD,YACI,SAAfgE,EAAgBpH,GACpBtD,EAAEC,KAAKqD,EAAO,SAACuD,GACI,cAAbA,EAAKnD,KACPmD,EAAKO,SAAWP,EAAKO,UAAY,EAAKoD,gBAAgB3D,GAC7CA,EAAKvD,OACdoH,EAAa7D,EAAKvD,SAKxBoH,CAAa9J,KAAKf,MAAMP,Q,gDAGAgE,GAAU,WAW5BqH,EAAc,SAAdA,EAAe9D,GACnB,IAAM+D,EAAiB5K,EAAEE,OAAO2G,EAAKvD,MAAO,SAACuH,GAC3C,OAAO,EAAKL,gBAAgBK,KAGxBC,EAAiB9K,EAAEc,KAAKd,EAAEE,OAAO0K,EAAgB,CAAExD,UAAU,KACnEP,EAAKO,SAAWpH,EAAEc,KAAK+F,EAAKvD,OAAS,GAAKtD,EAAEc,KAAK8J,GAAkB,GAAuB,GAAlBE,EAEpEjE,EAAKyB,QACPqC,EAAY9D,EAAKyB,UAnBC,SAAhByC,EAAiBzH,GACrBtD,EAAEC,KAAKqD,EAAO,SAACuD,GACRA,EAAKvD,MAGRyH,EAAclE,EAAKvD,OAFnBqH,EAAY9D,EAAKyB,UAoBvByC,CAAczH,K,0CAGC,WAGf,OAFiB1C,KAAKf,MAAdiJ,MAGN,KAAK,EACH,IAAMkC,EAAqBhL,EAAE2F,IAAItF,IAAIC,KAAKE,eAAeqF,OAAQ,SAASgB,GACxE,MAAO,CACL3I,IAAK2I,EAAKb,QACVrC,KAAMkD,EAAKZ,SACXrI,MAAOiJ,EAAKb,QACZiF,YAAapE,EAAKqE,IAAI/N,KACtBgO,MAAO,CAAEhJ,QAAS0E,EAAKS,MAAO8D,UAAU,EAAMC,MAAO,YAIzD,OACE,2BAAKrK,UAAU,gCACb,0BAAIA,UAAU,sBAAd,uEACA,2BAAKA,UAAU,2CACb,oBAAC,UAAD,CACEsK,YAAY,wBACZC,aAAc3K,KAAKf,MAAMmG,QACzBwF,WAAS,EACTC,OAAK,EACLC,QAASV,EACTvF,SAAU7E,KAAKgI,gBAGnB,2BAAK5H,UAAU,eACb,8BAAQA,UAAU,6BAA6BO,QAASX,KAAKiI,0BAA7D,eAMR,KAAK,EACH,IAAM9C,EAAO,EAAAnE,2BAA2BqF,YAAYrG,KAAKf,MAAMmG,SACzDjE,EAAU,CACdzC,KAAMsB,KAAKf,MAAMP,KACjBQ,QAASc,KAAKf,MAAMC,QACpBT,WAAYuB,KAAKvB,WAAWlB,KAAKyC,MACjC+F,aAAc/F,KAAK+F,aAAaxI,KAAKyC,OAGvC,OACE,2BAAKI,UAAU,gCACb,0BAAIA,UAAU,sBAAd,8DAEE,8BAAQA,UAAU,iBACf+E,EAAKE,SADR,KACoBF,EAAKuB,MADzB,MAIF,oBAACd,EAAsBzF,SAAvB,CAAgCnD,MAAOmE,GACrC,oBAAC0G,EAAD,MACA,oBAACF,EAAD,OAGF,2BAAKvH,UAAU,eACb,8BAAQA,UAAU,OAAOO,QAAS,kBAAM,EAAK/B,SAAS,CAAEsJ,KAAM,MAA9D,UAGA,oBAAC,UAAD,CACE6C,QACE,8BACE3K,UAAU,6BACVO,QAASX,KAAKqI,SACd5B,SAA4C,GAAlCzG,KAAKf,MAAMsJ,aAAa7N,QAHpC,WAQF6G,QAAQ,2EACRkF,SAAUzG,KAAKf,MAAMsJ,aAAa7N,OAAS,EAC3CsQ,GAAG,QACH5K,UAAU,uB,+BAsBlB,WACI8H,EAASlI,KAAKf,MAAdiJ,KAOR,OACE,oBAAC,EAAAzH,SAAD,KACE,yBAAGC,KAAK,IAAIC,QAPQ,SAACC,GACvBA,EAAGC,iBACH,EAAKjC,SAAS,CAAE6D,MAAM,MAKpB,wBAICzC,KAAKf,MAAMwD,MACV,oBAAC,UAAD,CAAOA,MAAI,EAACrC,UAAU,gCAAgC6K,WAAS,EAAC7C,QAASpI,KAAKoI,SAC5E,oBAAC,UAAM8C,OAAP,CAAc3J,QAAQ,0CACtB,oBAAC,UAAM4J,QAAP,KACE,2BAAK/K,UAAU,WACb,oBAAC,UAAKgL,MAAN,CAAYC,SAAS,MAAMnL,KAAK,QAAQoL,OAAQ,GAC9C,oBAAC,UAAD,CAAMC,OAAgB,GAARrD,EAAWsD,UAAWtD,EAAO,EAAGuD,KAAMvD,EAAO,EAAI,QAAU,KAAMX,MAAM,eACrF,oBAAC,UAAD,CAAMgE,OAAgB,GAARrD,EAAWX,MAAM,eAIlCvH,KAAK0L,4B,2JCliBpB,I,GASe,EATf,KASe7F,eAAwC,CACrDnH,KAAM,KACNQ,QAAS,KACTT,WAAY,SAACvE,KACb6E,cAAe,SAAC7E,O,oJCblB,WACA,WAEA,WACA,Y,ytCAQayJ,E,YAAb,qC,sCACE1E,MAAiC,CAC/BwD,MAAM,GAGR,EAAAkJ,cAAgB,SAAC/K,GACfA,EAAGC,iBACH,EAAKjC,SAAS,CAAE6D,MAAM,KAP1B,E,WAA4C,EAAAQ,e,oCAUpC,WACJ,OACE,oBAAC,EAAAxC,SAAD,KACE,yBAAGC,KAAK,IAAIC,QAASX,KAAK2L,eAA1B,uBAGC3L,KAAKf,MAAMwD,MAAQ,oBAACmJ,EAAD,CAAoBxD,QAAS,kBAAM,EAAKxJ,SAAS,CAAE6D,MAAM,Y,oCAM/EoJ,E,YAAN,qC,sCAGEC,cAAgB,SAACC,GACfA,EAAMlL,iBADkC,IAEhC8D,EAAW,EAAKnG,MAAhBmG,OAFgC,EAGP,EAAKxD,QAAhCrC,EAHkC,EAGlCA,QAASD,EAHyB,EAGzBA,cAEfwC,QAAQ2K,eACN,4DACA,KACA,sBACA,SAACC,GACMA,IAIL/N,EAAE4C,QAAQY,+BAA+B,yBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAAuDgF,EAAOzC,KAAO,CAAEgK,UAAW,WAC7FtK,KAAK,WACJ9C,EAAUM,EAAEqG,OAAO3G,EAAS,CAAEoD,GAAIyC,EAAOzC,KACzCrD,EAAcC,GACdZ,EAAEC,cAEHyE,KAAK,kBAAM1E,EAAEC,kBAKtB,EAAAgO,YAAc,SAACJ,GACbA,EAAMlL,iBADgC,IAG9B8D,EAAW,EAAKnG,MAAhBmG,OAH8B,EAIL,EAAKxD,QAAhCrC,EAJgC,EAIhCA,QAASD,EAJuB,EAIvBA,cAETuC,EAASC,QAAQD,OACrB,CACEE,OAAQ,sBAAF,OAAwBqD,EAAOpI,MACrCgF,QAAS,oFAEX,WACA,aACA,SAAC1E,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GA8BrB,OA1BAqB,EAAE4C,QAAQY,+BAA+B,2BACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAAuDgF,EAAOzC,KAAO,CAAEkK,YAAavP,IAC/F+E,KAAK,SAACC,GACL,GAAKA,EAAIC,UAWP5D,EAAEC,YACFkD,QAAQ8G,MAAR,8IAEyDtG,EAAIwK,QAF7D,eAZkB,CAClB,IAAMC,EAAelN,EAAEmN,UAAUzN,EAAS,CAAEoD,GAAIyC,EAAOzC,KACvDoK,EAAQ/P,KAAOsF,EAAIG,SAASC,OAAO1F,KACnC+P,EAAQhK,SAAWT,EAAIG,SAASC,OAAOK,SACvCgK,EAAQE,uBAAyB3K,EAAIG,SAASC,OAAOuK,uBAErD3N,EAAcC,GACdsC,EAAOuB,MAAM,QAEbzE,EAAEC,eASLyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,kEACjC7E,EAAEC,eAGC,GAETwG,EAAOpI,MAET2B,EAAE,kBAAkB8E,SAAS,4BA7EjC,E,WAA+B,EAAAC,e,oCAgFvB,IACI0B,EAAW3E,KAAKxB,MAAhBmG,OACFrB,EAAc7D,IAAIC,KAAKE,eAAe2D,SAASC,OAErD,OACE,oBAAC,UAAKiJ,KAAN,CAAWvK,GAAE,oBAAeyC,EAAOzC,IAAM9B,UAAU,mBACjD,4BAAMA,UAAU,2BAChB,oBAAC,UAAK+K,QAAN,CAAc/H,MAAO,CAAEsJ,QAAS,iBAAmB/H,EAAOpI,MACzD+G,GACC,oBAAC,UAAK6H,QAAN,CAAcwB,QAAQ,SACnBjJ,yBAAyB,gBACxB,oBAAC,EAAAjD,SAAD,KACE,8BAAQL,UAAU,0CAA0CO,QAASX,KAAKmM,aAA1E,kBAGA,8BAAQ/L,UAAU,2CAA2CO,QAASX,KAAK8L,eAA3E,mB,KA9FP,EAAA5I,YAAc,U,IA0GV0I,E,YAAb,qC,sCAaEgB,UAAY,WAAK,MACoB,EAAKzL,QAAhCrC,EADO,EACPA,QAASD,EADF,EACEA,cAEbgO,EAAO3O,EAAE,sBAA8B4O,SAAS,WACpDD,EAAMA,EAAI9H,IAAI,SAAS7C,GACrB,OAAOA,EAAG6K,OAAO,MAGnB7O,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAA6D,CAAEqN,KAAMH,IAEnFzN,EAAEC,KAAKwN,EAAK,SAAC3K,EAAIK,GACf,IAAM0K,EAAc7N,EAAE8N,UAAUpO,EAAS,CAAEoD,OAC3CpD,EAAQmO,GAAa3K,SAAWC,EAAQ,IAG1C1D,EAAcC,IAGhB,EAAAqO,WAAa,SAACvM,GACZA,EAAGC,iBAD+B,MAGmB,EAAKM,QAAlDrC,EAH0B,EAG1BA,QAASD,EAHiB,EAGjBA,cAAeH,EAHE,EAGFA,KAAMD,EAHJ,EAGIA,WAEhC2C,EAASC,QAAQD,OACrB,CAAEE,OAAQ,eAAgBC,QAAS,8DACnC,WACA,QACA,SAAC1E,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GAuDrB,OAnDAqB,EAAE4C,QAAQY,+BAA+B,sBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAA+D,CAAEyM,YAAavP,IACzF+E,KAAK,SAACC,GACL,GAAKA,EAAIC,UAoCP5D,EAAEC,YACFkD,QAAQ8G,MAAR,yIAEyDtG,EAAIwK,QAF7D,eArCkB,CAClB,IAAM1H,EAAS9C,EAAIG,SAASC,OAC5BnD,EAAQ9D,KAAK,CACXkH,GAAIyC,EAAOuE,mBACXA,mBAAoBvE,EAAOuE,mBAC3B3M,KAAMoI,EAAOpI,KACb+F,SAAUqC,EAAOrC,SACjBkK,uBAAwB7H,EAAO6H,yBAEjC3N,EAAcC,GACdsC,EAAOuB,MAAM,QAGb,IAAMyK,EAAoBvL,EAAIG,SAASoL,kBACnCC,GAAa,EACjBjO,EAAEC,KAAKX,EAAM,SAACqD,GAaZ,GAZA3C,EAAEC,KAAK0C,EAAKW,MAAO,SAACkG,GAQlB,GAPAxJ,EAAEC,KAAKuJ,EAAQlG,MAAO,SAACoG,GACrB,GAAIA,EAAK5G,IAAMkL,EAAkBlL,GAG/B,OAFA4G,EAAKwE,aAAeF,EAAkBrE,gCACtCsE,GAAa,GACN,IAGPA,EACF,OAAO,IAGPA,EACF,OAAO,IAGX5O,EAAWC,GAEXR,EAAEC,eASLyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,6DACjC7E,EAAEC,eAGC,GAET,IAEFD,EAAE,kBAAkB8E,SAAS,4BApGjC,E,WAAwC,EAAAC,e,+CAIlC/E,EAAE,sBAA8B4O,SAAS,CACzCS,OAAQ,gBACR7K,MAAO,mBACP8K,KAAM,IACN9C,YAAa,uBACb+C,OAAQzN,KAAK4M,c,+BA8FX,IACI9N,EAAYkB,KAAKmB,QAAjBrC,QAEFwE,EAAc7D,IAAIC,KAAKE,eAAe2D,SAASC,OAErD,OACE,oBAAC,UAAD,CAAOf,MAAI,EAACwI,WAAS,EAAC7K,UAAU,WAAWgI,QAASpI,KAAKxB,MAAM4J,QAASlI,KAAK,SAC3E,oBAAC,UAAMgL,OAAP,CAAc3J,QAAQ,8BACtB,oBAAC,UAAM4J,QAAP,KACG/L,EAAEc,KAAKpB,GAAW,EACjB,oBAAC,EAAA2B,SAAD,KACE,yBAAGL,UAAU,oBAAb,wCACA,oBAAC,UAAD,CAAMsN,SAAO,EAACxL,GAAG,qBACd9C,EAAE2F,IAAIjG,EAAS,SAAC6F,GACf,OAAO,oBAACkH,EAAD,CAAkBvO,IAAKqH,EAAOzC,GAAIyC,OAAQA,QAKvD,2BAAKvE,UAAU,qBACb,4BAAMA,UAAU,sBADlB,iDAIF,2BAAKA,UAAU,aACZkD,GACDI,yBAAyB,kBACvB,yBAAGhD,KAAK,IAAIN,UAAU,cAAcgD,MAAO,CAAEsC,YAAa,GAAK/E,QAASX,KAAKmN,YAA7E,gBAIF,8BAAQrK,KAAK,SAAS1C,UAAU,iBAAiBO,QAASX,KAAKxB,MAAM4J,SAArE,iB,4BApIH,EAAAlF,YAAc,W,mGC5IvB,WAEA,YACA,YAEA,WAEA,UACA,QACA,S,ytCAUMyD,E,YAAN,qC,sCAGEgH,SAAU,IAAA5J,aAMV,EAAA6J,OAAS,SAAChN,GACRA,EAAGC,iBAD2B,MAGD,EAAKM,QAA1BzC,EAHsB,EAGtBA,KAAMD,EAHgB,EAGhBA,WACNwH,EAAS,EAAKzH,MAAdyH,KAERvH,EAAKuH,EAAK1D,OAAOE,MAAQwD,EAAKxD,KAC9BhE,EAAWC,IAhBf,E,WAA2B,EAAAuE,e,+CAMvBjD,KAAK6N,iB,qCAaK,WACV,IAAKpO,IAAIC,KAAKE,eAAe2D,SAASC,SAAWE,yBAAyB,qBACxE,OAAO,EAGT,IAAM3B,EAAO/B,KAAKxB,MAAMyH,KACtB/H,EAAE8B,KAAK2N,QAAQ1J,SAAiB6I,SAAS,CACzCS,OAAQ,mCACR7K,MAAO,cACPgI,YAAa,uBACb8C,KAAM,IACNM,OAAQ,MACRC,iBAAiB,EACjBC,YAAa,SACbC,OAAQ,SAACrN,EAAoBqF,GAC3B,IAAMiI,EAAYjI,EAAKkI,QAGvB,OAFAjQ,EAAEgQ,GAAW3E,KAAK,4BAA4B6E,SAEvCF,GAETG,MAAO,SAASzN,EAAoB0N,GAChCpQ,EAAE8B,MAAc8M,SAAS,oBAC3B5O,EAAEoQ,EAAGrI,MAAMjD,SAAS,sBAEtBuL,KAAM,SAAS3N,EAAoB0N,GACjCpQ,EAAEoQ,EAAGrI,MAAM1B,YAAY,sBAEzBkJ,OAAQ,SAAC7M,EAAoB0N,GAC3B,IAAI5L,EAASxE,EAAE,EAAKyP,QAAQ1J,SAAiB6I,SAAS,WAEtD5O,EAAE,+CAA+CqG,YAAY,oBAE7D7B,EAAQA,EAAMqC,IAAI,SAASkB,GACzB,OAAOA,EAAK8G,OAAO,KAGrB7O,EAAE4C,QAAQY,+BAA+B,0BACzCxD,EAAEqB,KAAKC,QAAQ,YAAcC,IAAIC,KAAKC,WAAa,2BAA4B,CAAEqN,KAAMtK,IAASd,KAAK,SAACC,GACpG,GAAmB,GAAfA,EAAI2M,QAAc,CACpB,IAAMC,EAAqC,GAC3C/L,EAAMrD,KAAK,SAACqP,EAAWC,GACrBF,EAAUC,GAAKC,IAHG,MAMS,EAAKxN,QAA1BzC,EANY,EAMZA,KAAMD,EANM,EAMNA,WAEdC,EAAKqD,EAAKQ,OAAOG,MAAQtD,EAAE2F,IAAIrG,EAAKqD,EAAKQ,OAAOG,MAAO,SAACkM,GAGtD,OAFAA,EAAMtM,SAAW,IAAMmM,EAAUG,EAAM1M,IAAM,GAC7C0M,EAAMpM,UAAYiM,EAAUG,EAAM1M,IAC3B0M,IAGTnQ,EAAWC,GACXR,EAAEC,oB,+BAON,IACI8H,EAASjG,KAAKxB,MAAdyH,KAEF4I,EAAWpP,IAAIC,KAAKE,eAAe2D,SAASC,OAE5CsL,GAAc,aAAG,yBAA0B7I,EAAKvD,MAAMhI,OAAS,EAAI,aAAe,aAExF,OACE,0BAAI0F,UAAW0O,EAAa5M,GAAE,cAAS+D,EAAK/D,KAC1C,2BAAK9B,UAAU,yBACb,4BAAMA,UAAU,wCAChB,yBAAGA,UAAU,aAAaO,QAASX,KAAK4N,OAAQlN,KAAK,KACnD,4BAAMN,UAAU,kBAAkBhB,EAAEoC,IAAIuN,KAAK9I,EAAKzD,UAAY,EAAG,EAAG,MADtE,IACoFpD,EAAEoC,IAAIC,KAAKwE,EAAK5D,YAAY2M,gBAE/GH,GAAY,oBAAC,EAAAI,oBAAD,CAAqBhJ,KAAMA,IACxC,2BAAK7F,UAAU,cAEjB,0BAAIA,UAAU,qCAAqCoE,IAAKxE,KAAK2N,SAC1D1H,EAAKxD,MACJrD,EAAE2F,IAAI3F,EAAE8P,OAAOjJ,EAAKvD,MAAO,SAACwE,GAAD,OAAaiI,SAASjI,EAAQ5E,YAAY,SAACsG,GAEpE,OADAA,EAAQlB,OAASzB,EACV,oBAACmJ,EAAD,CAAiB9R,IAAKsL,EAAQ1G,GAAI+D,KAAM2C,Y,KAnGpD,EAAA1F,YAAc,U,IA2GjBkM,E,YAAN,qC,sCAIEC,iBAAkB,EAClB,EAAA1B,SAAU,IAAA5J,aAUV,EAAA6J,OAAS,SAAChN,GACRA,EAAGC,iBAD2B,IAGtBoF,EAAS,EAAKzH,MAAdyH,KAHsB,EAID,EAAK9E,QAA1BzC,EAJsB,EAItBA,KAAMD,EAJgB,EAIhBA,WAEdC,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMuD,EAAK1D,OAAOE,MAAQwD,EAAKxD,KACvDhE,EAAWC,IAtBf,E,WAA8B,EAAAuE,e,+CA0B1BjD,KAAKsP,eACLtP,KAAKuP,cACLvP,KAAK6N,iB,2CAIL7N,KAAKsP,eACLtP,KAAKwP,kB,qCAIL,IAAIJ,EAAgBK,iBAApB,CADU,IAKFxJ,EAASjG,KAAKxB,MAAdyH,KALE,EAMmBjG,KAAKmB,QAA1BzC,EANE,EAMFA,KAAMD,EANJ,EAMIA,WACRiR,EAAatQ,EAAEc,KAAKF,KAAKmB,QAAQjC,SAAW,EAE5B,OAAlB+G,EAAK0J,UAAqB1J,EAAKyB,OAAOxF,IAAMzC,IAAIC,KAAKE,eAAeC,SAAS+P,mBAAsBF,IACrGN,EAAgBK,kBAAmB,EAEnCvR,EAAE2R,QAAQrQ,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,sBAAsD,CACrEmQ,eAAgB,CAAEhN,KAAM,WAAYiN,QAAS9J,EAAKyB,OAAOxF,MACxDN,KAAK,SAACC,GACPzC,EAAEC,KAAKwC,EAAIG,SAAU,SAACgO,EAASC,GAC7B,IAAMC,EAAa9Q,EAAE8N,UAAUxO,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAO,CAAER,GAAI+N,IACpEvR,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMwN,GAAYP,SAAWK,IAEvDvR,EAAWC,S,oCAMf,IAAIsB,KAAKqP,gBAAT,CAIArP,KAAKqP,iBAAkB,EALd,IAODpJ,EAASjG,KAAKxB,MAAdyH,KAPC,EAQoBjG,KAAKmB,QAA1BzC,EARC,EAQDA,KAAMD,EARL,EAQKA,WAEVC,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMuD,EAAK1D,OAAO4N,eAI9CjS,EAAE2R,QAAQrQ,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,sBAAsD,CACrEmQ,eAAgB,CAAEhN,KAAM,UAAWmN,SAAUhK,EAAK/D,MACjDN,KAAK,SAACC,GACPzC,EAAEC,KAAKwC,EAAIG,SAAU,SAACoO,EAASC,GAC7B,IAAMC,EAAYlR,EAAE8N,UAAUxO,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMuD,EAAK1D,OAAOG,MAAO,CAAER,GAAImO,IACrF3R,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMuD,EAAK1D,OAAOG,MAAM4N,GAAWF,QAAUA,IAGvE1R,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMuD,EAAK1D,OAAO4N,eAAgB,EAE1D1R,EAAWC,Q,qCAIH,WACV,IAAKe,IAAIC,KAAKE,eAAe2D,SAASC,SAAWE,yBAAyB,qBACxE,OAAO,EAGT,IAAMkL,EAAQ5O,KAAKxB,MAAMyH,KAEjB/G,EAAYc,KAAKmB,QAAjBjC,QACFqR,EAAqBrS,EAAE8B,KAAK2N,QAAQ1J,SAC1CsM,EAAczD,SAAS,CACrBS,OAAQ,mDACR7K,MAAO,wBACPgI,YAAa,uBACb8C,KAAM,IACNM,OAAQ,MACRG,OAAQ,QACRxH,SAAUrH,EAAEc,KAAKhB,GAAW,EAC5B8O,YAAa,SACbK,MAAO,SAACzN,EAAoB0N,GAC1BpQ,EAAEoQ,EAAGrI,MAAMjD,SAAS,sBAEtBuL,KAAM,SAAS3N,EAAoB0N,GACjCpQ,EAAEoQ,EAAGrI,MAAM1B,YAAY,sBAEzBkJ,OAAQ,SAAC7M,EAAoB0N,GAC3B,IAAI5L,EAAQ6N,EAAczD,SAAS,WAEnC5O,EAAE,2CAA2CqG,YAAY,oBAEzD7B,EAAQA,EAAMqC,IAAI,SAASkB,GACzB,OAAOA,EAAK8G,OAAO,KAGrB7O,EAAE4C,QAAQY,+BAA+B,0BACzCxD,EAAEqB,KAAKC,QAAQ,YAAcC,IAAIC,KAAKC,WAAa,0BAA2B,CAAEqN,KAAMtK,IAASd,KAAK,SAACC,GACnG,GAAmB,GAAfA,EAAI2M,QAAc,CACpB,IAAMC,EAAqC,GAC3C/L,EAAMrD,KAAK,SAACqP,EAAWC,GACrBF,EAAUC,GAAKC,IAHG,MAMS,EAAKxN,QAA1BzC,EANY,EAMZA,KAAMD,EANM,EAMNA,WAEdC,EAAKkQ,EAAMlH,OAAOnF,OAAOG,MAAMkM,EAAMrM,OAAOG,MAAQtD,EAAE2F,IACpDrG,EAAKkQ,EAAMlH,OAAOnF,OAAOG,MAAMkM,EAAMrM,OAAOG,MAC5C,SAACoG,GAGC,OAFAA,EAAKxG,SAAW,IAAMmM,EAAU3F,EAAK5G,IAAM,GAC3C4G,EAAKtG,UAAYiM,EAAU3F,EAAK5G,IACzB4G,IAIXrK,EAAWW,EAAE+O,MAAMzP,GAAM,IACzBR,EAAEC,oB,sCAQV,IAAKsB,IAAIC,KAAKE,eAAe2D,SAASC,SAAWE,yBAAyB,qBACxE,OAAO,EAFE,IAKHxE,EAAYc,KAAKmB,QAAjBjC,QACJE,EAAEc,KAAKhB,GACPhB,EAAE8B,KAAK2N,QAAQ1J,SAAiB6I,SAAS,SAAU,WAAW,GAE9D5O,EAAE8B,KAAK2N,QAAQ1J,SAAiB6I,SAAS,SAAU,WAAW,K,2CAI/C7G,EAAgB/G,GACnC,OAAuB,GAAnBE,EAAEc,KAAKhB,IAIJE,EAAE0I,KAAK7B,EAAKqH,aAAc,SAACtE,GAChC,SAAI9J,EAAQyF,QAAUqE,EAAYE,oBAAsBhK,EAAQyF,aAI5DzF,EAAQ8F,QAAUgE,EAAYwH,yBAA2BtR,EAAQ8F,YAIjE9F,EAAQgG,UAAY8D,EAAYG,qBAAuBjK,EAAQgG,e,+BAQjE,WACIe,EAASjG,KAAKxB,MAAdyH,KACFyJ,EAAatQ,EAAEc,KAAKF,KAAKmB,QAAQjC,SAAW,EAC5C2P,EAAWpP,IAAIC,KAAKE,eAAe2D,SAASC,OAE5CiN,EAAgBrR,EAAE2F,IAAI3F,EAAE8P,OAAOjJ,EAAKvD,MAAO,SAACuD,GAAD,OAAUkJ,SAASlJ,EAAK3D,YAAY,SAACwG,GAGpF,OAFAA,EAAKpB,OAASzB,EAEV,EAAKyK,qBAAqB5H,EAAM,EAAK3H,QAAQjC,SACxC,oBAACyR,EAAD,CAAcrT,IAAKwL,EAAK5G,GAAI+D,KAAM6C,IAGpC,OAGHgG,GAAc,aAClB,4BACkC,GAAlC1P,EAAEE,OAAOmR,GAAe/V,OAAc,WAAa,YACnDgV,EAAa,cAAgB,IAG/B,OACE,0BAAItP,UAAW0O,EAAa5M,GAAE,kBAAa+D,EAAK/D,KAC9C,2BAAK9B,UAAU,yBACb,4BAAMA,UAAU,2CAChB,yBAAGA,UAAU,aAAaO,QAASX,KAAK4N,OAAQlN,KAAK,KACnD,4BAAMN,UAAU,kBAAkBgP,EAAgBwB,aAAa3K,EAAKzD,WAAWwM,eADjF,IACwG5P,EAAEoC,IAAIC,KAAKwE,EAAK5D,cAEvHwM,GAAY,oBAAC,EAAAgC,uBAAD,CAAwB5K,KAAMA,IAC3C,2BAAK7F,UAAU,cAEjB,0BAAIA,UAAU,oCAAoCoE,IAAKxE,KAAK2N,SACzD1H,EAAKxD,MACJ,oBAAC,EAAAhC,SAAD,KACGhB,IAAIC,KAAKE,eAAeC,SAAS+P,mBAAqB3J,EAAKyB,OAAOxF,KAClEwN,GAAc,oBAACoB,EAAD,CAAwBlC,MAAO3I,IAC7CwK,Q,oCApNOlO,GAClB,IAAIwO,EAAS,GAIb,OAHIxO,EAAQ,KACVwO,EAASC,OAAOC,aAAmBC,KAAKC,MAAM5O,EAAQ,IAAM,EAA/B,KAExBwO,EAASC,OAAOC,aAAa,GAAK1O,EAAQ,Q,KAX5C,EAAAkN,kBAAmB,EACnB,EAAAvM,YAAc,U,IAkOjByN,E,wFAAqB,EAAA1N,e,0CAGb,IACFgD,EAASjG,KAAKxB,MAAdyH,KAER,GAAqB,OAAjBA,EAAKmK,QACP,OAAO,2BAAKhQ,UAAU,iCACjB,GAA6B,IAAzBhB,EAAEc,KAAK+F,EAAKmK,SACrB,OAAO,EAEP,IAAMgB,EAAehS,EAAEiS,KAAKpL,EAAKmK,QAAS,IACpCkB,EACJ,+BACGlS,EAAE2F,IAAIqM,EAAc,SAACG,GAAD,OAAYA,EAAOnP,OAAMoP,KAAK,MAElDpS,EAAEc,KAAK+F,EAAKmK,SAAWhR,EAAEc,KAAKkR,IAA9B,aAAqDhS,EAAEc,KAAK+F,EAAKmK,SAAWhR,EAAEc,KAAKkR,GAAnF,YAIL,OACE,oBAAC,UAAD,CAAO9P,OAAO,UAAUC,QAAS+P,EAAgBpR,KAAK,OAAO6K,QAAS,gCAAO3L,EAAEc,KAAK+F,EAAKmK,c,+BAKzF,IACInK,EAASjG,KAAKxB,MAAdyH,KAEFwL,GAAmB,aACvB,sCADuB,oBAEVxL,EAAK7D,MAFK,qBAGT6D,EAAKyL,MAAQ,WAAWC,gBAGlC9C,EAAWpP,IAAIC,KAAKE,eAAe2D,SAASC,OAC5CoO,EAAiBnS,IAAIC,KAAKE,eAAeiS,eAAe5L,EAAK/D,KAAO,EACpE4P,EAAe9R,KAAK+R,eAE1B,OACE,0BAAI3R,UAAWqR,EAAkBvP,GAAE,eAAU+D,EAAK/D,KAChD,2BAAK9B,UAAU,yBACb,4BAAMA,UAAU,uCAChB,yBAAGM,KAAMlB,QAAQ,aAAD,OAAcC,IAAIC,KAAKC,WAAvB,8BAAuDsG,EAAK/D,KAAO9B,UAAU,aAC3F,4BAAMA,UAAU,kBAAkBhB,EAAEoC,IAAIuN,KAAK9I,EAAKzD,UAAY,EAAG,EAAG,MADtE,IACoFyD,EAAK5D,aAGxFwM,GAAY,oBAAC,EAAAmD,oBAAD,CAAqB/L,KAAMA,IAExC,2BAAK7F,UAAU,yCACb,2BAAKA,UAAU,aACC,WAAb6F,EAAKyL,KACJ,oBAACO,EAAD,CAA+BnJ,KAAM7C,IAErC,oBAACiM,EAAD,CAA+BpJ,KAAM7C,KAIzC,2BAAK7F,UAAU,qBACf,2BAAKA,UAAU,aACb,2BAAKA,UAAU,UACb,8BAAQA,UAAU,SAAlB,YAGF,gCAAO0R,IAGT,2BAAK1R,UAAU,aACb,2BAAKA,UAAU,UACb,8BAAQA,UAAU,SAAlB,cAEF,gCAAOwR,IAGT,2BAAKxR,UAAU,qBAEf,2BACEA,UAAW6F,EAAKkM,WAAWzX,OAAS,EAAI,YAAc,GACtD0I,MAAO,CAAEsJ,QAAS,eAAgBhH,YAAa,GAAI0M,WAAY,EAAGC,SAAU,IAAKC,MAAO,MAEvFrM,EAAKkM,WAAWzX,OAAS,EACxB,oBAAC,EAAA+F,SAAD,KACE,2BAAKL,UAAU,UACb,8BAAQA,UAAU,SAAlB,eAEF,0BAAIA,UAAU,YACXhB,EAAE2F,IAAIkB,EAAKkM,WAAY,SAACI,GACvB,IAAMC,EAA6BpT,EAAEmK,KAAK9J,IAAIC,KAAKE,eAAe6S,UAAW,CAC3EvQ,GAAIqQ,EAASG,0BAEf,OACE,0BAAIpV,IAAKiV,EAASG,wBAAyBtS,UAAU,mCACnD,oBAAC,UAAD,CACEuS,OAAK,EACLzS,KAAK,OACLqB,QAASiR,EAASnI,YAClB/I,OAAM,oBAAekR,EAASjW,MAC9BwO,QAAS,gCAAOyH,EAASpQ,aAQrC,uCAIN,2BAAKhC,UAAU,mB,KA5GhB,EAAA8C,YAAc,U,IAmHjB4N,E,wFAA+B,EAAA7N,e,oCAE7B,IACI2L,EAAU5O,KAAKxB,MAAfoQ,MACA9P,EAAYkB,KAAKmB,QAAjBrC,QAER,OACE,0BAAIsB,UAAU,iCACZ,2BAAKA,UAAU,yBACb,4BAAMA,UAAU,WAChB,yBACEM,KAAMlB,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,8BAAsDiP,EAAM1M,GAA5D,cACb9B,UAAU,aAFZ,kBAMA,2BAAKA,UAAU,uBACb,2BAAKA,UAAU,aACZhB,EAAE2F,IAAIjG,EAAS,SAAC6F,GACf,OAAO,oBAACiO,EAAD,CAA8BtV,IAAG,UAAKsR,EAAM1M,GAAX,YAAiByC,EAAOzC,IAAM0M,MAAOA,EAAOjK,OAAQA,QAIlG,2BAAKvE,UAAU,mB,KAtBhB,EAAA8C,YAAc,U,IA6BjB0P,E,wFAAqC,EAAA3P,e,sCAGjC,MACoBjD,KAAKxB,MAAvBoQ,EADF,EACEA,MAAOjK,EADT,EACSA,OACTgL,EAAW3P,KAAKmB,QAAQzC,KAAKkQ,EAAMlH,OAAOnF,OAAOG,MAAMkM,EAAMrM,OAAOoN,SAE1E,OAAiB,OAAbA,EACK,2BAAKvP,UAAU,sCAEW,IAAxBuP,EAAShL,EAAOzC,KAA+C,OAAxByN,EAAShL,EAAOzC,IACzD,IAEF2Q,WAAWC,YAAYnD,EAAShL,EAAOzC,O,+BAG1C,IACIyC,EAAW3E,KAAKxB,MAAhBmG,OAER,OACE,2BAAKvE,UAAU,UACb,yBAAGA,UAAU,yBAAyB2S,EAAiBpO,EAAOpI,OAC9D,+BACE,2BAAK6D,UAAU,oBAAoBJ,KAAKgT,kB,KAtBzC,EAAA9P,YAAc,U,IA6BjB+O,E,YAAN,qC,sCAGEgB,cAAgB,SAACrS,GACfA,EAAGC,iBACH3C,EAAE0C,EAAGsS,eAAe3J,KAAK,mBAAmB4J,SALhD,E,WAA4C,EAAAlQ,e,4CAQzB+F,GAAgB,IACvBF,EAAS9I,KAAKxB,MAAdsK,KACFsK,EAAU5T,QAAQ,YAAD,OACTC,IAAIC,KAAKC,WADA,8BACgCmJ,EAAK5G,GADrC,sBACqD8G,EAAYE,qBAGlF5F,EAAc7D,IAAIC,KAAKE,eAAe2D,SAASC,OAkBrD,OAfE,oBAAC,EAAA/C,SAAD,KACE,oBAAC,UAASgM,KAAV,CAAenP,IAAI,QACjB,yBAAGoD,KAAM0S,GAAT,yBAED9P,GACDI,yBAAyB,CAAE,0BACzB,oBAAC,EAAA2P,uBAAD,CAAwB/V,IAAI,aAAa0L,YAAaA,EAAaF,KAAMA,IAE1ExF,GACDI,yBAAyB,sBACvB,oBAAC,EAAA4P,6BAAD,CAA8BhW,IAAI,SAAS0L,YAAaA,EAAaF,KAAMA,O,+BAQ7E,WACIA,EAAS9I,KAAKxB,MAAdsK,KACFwE,EAAelO,EAAE8P,OAAOpG,EAAKwE,aAAc,SAACrH,GAAD,OAAUkJ,SAASlJ,EAAK3D,YAEzE,OACE,oBAAC,EAAA7B,SAAD,KACGrB,EAAE2F,IAAIuI,EAAc,SAACtE,EAAazG,GACjC,IAAMgR,EAAkCnU,EAAEmN,UAAU9M,IAAIC,KAAKE,eAAe4T,aAAc,CACxFhD,wBAAyBxH,EAAYwH,0BAEjCrL,EAAO,EAAAnE,2BAA2BqF,YAAY2C,EAAYG,qBAC1DsK,EAAUjU,QAAQ,YAAD,OACTC,IAAIC,KAAKC,WADA,8BACgCmJ,EAAK5G,GADrC,sBACqD8G,EAAY9G,KAGxF,MAAO,CACL,2BAAK9B,UAAU,SAAS9C,IAAG,iBAAY0L,EAAY9G,KACjD,2BAAK9B,UAAU,SAAS6S,cAAe,EAAKA,eAC1C,yBAAG7S,UAAU,wCAAwCM,KAAM+S,GACxDV,EAAiB/J,EAAYC,eAEhC,oBAAC,UAAD,CAAUyK,SAAO,EAACC,QAAM,EAAClI,KAAM,CAAElP,KAAM,WAAY2D,KAAM,SAAWE,UAAU,eAC5E,oBAAC,UAASwT,KAAV,KAAgB,EAAKC,iBAAiB7K,MAG1C,yBAAG5I,UAAU,wCAAwC9C,IAAK0L,EAAY9G,GAAIxB,KAAM+S,IAChF,+BACE,2BAAKlM,MAAOpC,EAAO,eAAH,OAAkBA,EAAK5I,MAAS,cAAe6G,MAAO,CAAEsJ,QAAS,iBAC9EvH,EAAOA,EAAKuB,MAAQ,GADvB,KAGA,2BAAKtG,UAAU,sBAAsBgD,MAAO,CAAE0Q,gBAAiBP,EAAY9I,QACzE,4BAAMlD,MAAK,kBAAagM,EAAYhX,OAASwX,EAAaR,EAAYhX,UAI5EgG,GAAS+K,EAAa5S,OAAS,EAAI,KACjC,2BAAK0F,UAAU,mBAAmB9C,IAAG,kBAAa0L,EAAY9G,c,KAtEnE,EAAAgB,YAAc,U,IA+EjBgP,E,YAAN,qC,sCA0EE8B,cAAgB,SAAChL,GAAoB,MACA,EAAK7H,QAAhCrC,EAD2B,EAC3BA,QAASD,EADkB,EAClBA,cAEX8F,EAAyBvF,EAAEmK,KAAKzK,EAAS,CAAEoK,mBAAoBF,EAAYE,qBAE3E9H,EAASC,QAAQD,OACrB,CACEE,OAAQ,sBAAF,OAAwBqD,EAAOpI,MACrCgF,QAAS,oFAEX,WACA,aACA,SAAC1E,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GA2BrB,OAvBAqB,EAAE4C,QAAQY,+BAA+B,2BACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAAuDgF,EAAOzC,KAAO,CAAEkK,YAAavP,IAC/F+E,KAAK,SAACC,GACAA,EAAIC,WAQP5D,EAAEC,YACFkD,QAAQ8G,MAAR,8IAEyDtG,EAAIwK,QAF7D,aARA1H,EAAOpI,KAAOsF,EAAIG,SAASC,OAAO1F,KAElCsC,EAAcC,GACdsC,EAAOuB,MAAM,QAEbzE,EAAEC,eASLyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,kEACjC7E,EAAEC,eAGC,GAETwG,EAAOpI,MAET2B,EAAE,kBAAkB8E,SAAS,4BAG/B,EAAAiQ,cAAgB,SAACrS,GACfA,EAAGC,iBACH3C,EAAE0C,EAAGsS,eAAe3J,KAAK,mBAAmB4J,SA3HhD,E,WAA4C,EAAAlQ,e,yCAG5BmD,GAAiB,IACrBtH,EAAYkB,KAAKmB,QAAjBrC,QAER,OAAOM,EAAEmN,UAAUzN,EAAS,CAAEoD,GAAIkE,M,uCAGtB,WACJ0C,EAAS9I,KAAKxB,MAAdsK,KAEJwE,EAAelO,EAAE2F,IAAI+D,EAAKwE,aAAc,SAACrH,GAC3C,IAAMtB,EAAS,EAAKwB,cAAcF,EAAKiD,oBACvC,OAAKvE,GAGLsB,EAAK3D,UAAYqC,EAAOrC,SACjB2D,GAHE,OAQX,OAFAqH,EAAelO,EAAEE,OAAOgO,GAEjBlO,EAAE8P,OAAO5B,EAAc,c,uCAGftE,GAAgB,WACvBF,EAAS9I,KAAKxB,MAAdsK,KAEFxF,EAAc7D,IAAIC,KAAKE,eAAe2D,SAASC,OAI/C4P,EAAU5T,QAAQ,YAAD,OACTC,IAAIC,KAAKC,WADA,8BACgCmJ,EAAK5G,GADrC,sBACqD8G,EAAYE,qBAqCxF,MAlCiB,gBAAbJ,EAAK4I,KAEL,oBAAC,EAAAjR,SAAD,KACE,oBAAC,UAASgM,KAAV,KACE,yBAAG/L,KAAM0S,GAAT,yBAED9P,GACDI,yBAAyB,sBACvB,oBAAC,EAAA2P,uBAAD,CAAwBrK,YAAaA,EAAaF,KAAMA,KAM5D,oBAAC,EAAArI,SAAD,KACE,oBAAC,UAASgM,KAAV,KACE,yBAAG/L,KAAM0S,GAAT,yBAED9P,GACDI,yBAAyB,gBACvB,oBAAC,UAAS+I,KAAV,CAAe9L,QAAS,kBAAM,EAAKqT,cAAchL,KAAjD,kBAED1F,GACDI,yBAAyB,sBACvB,oBAAC,EAAA2P,uBAAD,CAAwBrK,YAAaA,EAAaF,KAAMA,IAEzDxF,GACDI,yBAAyB,sBACvB,oBAAC,EAAA4P,6BAAD,CAA8BtK,YAAaA,EAAaF,KAAMA,O,+BA6DlE,WACIA,EAAS9I,KAAKxB,MAAdsK,KACFwE,EAAetN,KAAKiU,iBAE1B,OACE,oBAAC,EAAAxT,SAAD,KACGrB,EAAE2F,IAAIuI,EAAc,SAACtE,EAAazG,GACjC,IAAMgR,EAAkCnU,EAAEmN,UAAU9M,IAAIC,KAAKE,eAAe4T,aAAc,CACxFhD,wBAAyBxH,EAAYwH,0BAEjCrL,EAAO,EAAAnE,2BAA2BqF,YAAY2C,EAAYG,qBAC1DsK,EAAUjU,QAAQ,YAAD,OACTC,IAAIC,KAAKC,WADA,8BACgCmJ,EAAK5G,GADrC,sBACqD8G,EAAYE,qBAGxF,MAAO,CACL,2BAAK9I,UAAU,SAAS9C,IAAG,iBAAY0L,EAAY9G,KACjD,2BAAK9B,UAAU,SAAS6S,cAAe,EAAKA,eAC1C,yBAAG7S,UAAU,wCAAwCM,KAAM+S,GACxDV,EAAiB,EAAK5M,cAAc6C,EAAYE,oBAAoB3M,OAEvE,oBAAC,UAAD,CAAUmX,SAAO,EAACC,QAAM,EAAClI,KAAM,CAAElP,KAAM,WAAY2D,KAAM,SAAWE,UAAU,eAC5E,oBAAC,UAASwT,KAAV,KAAgB,EAAKC,iBAAiB7K,MAI1C,+BACE,2BACEzB,MAAOpC,EAAO,eAAH,OAAkBA,EAAK5I,MAAS,cAC3C6G,MAAO,CAAEsJ,QAAS,eAAgB4F,MAAO,GAAI4B,SAAU,KAEtD/O,EAAOA,EAAKuB,MAAQ,GAJvB,KAMA,2BAAKtG,UAAU,sBAAsBgD,MAAO,CAAE0Q,gBAAiBP,EAAY9I,QACxE6C,EAAa5S,QAAU,EACtB,4BAAM6M,MAAK,kBAAagM,EAAYhX,OAASwX,EAAaR,EAAYhX,OAEtEgX,EAAYhX,QAKpBgG,GAAS+K,EAAa5S,OAAS,EAAI,KACjC,2BAAK0F,UAAU,mBAAmB9C,IAAG,kBAAa0L,EAAY9G,c,KAxKnE,EAAAgB,YAAc,UAiLvB,IAyCM6P,EAAmB,SAACoB,GAoBxB,OAJA/U,EAAEC,KAfoB,CACpB+U,MAAO,MACPC,QAAS,MACTC,MAAO,MACPC,MAAO,MACPC,KAAM,MACNC,MAAO,MACPC,MAAO,MACPC,OAAQ,MACRC,WAAY,OACZC,QAAS,MACTC,UAAW,MACXC,UAAW,OAGS,SAACC,EAASC,GAC9Bd,EAAaA,EAAWa,QAAQ,IAAIE,OAAOD,EAAM,MAAOD,KAGnDb,GAGHJ,EAAe,SAACvS,GAAD,OAAiBA,EAAI2T,MAAM,SAAS3D,KAAK,IAAIxC,eAuD7CoG,E,YAArB,qC,sCAEEzH,SAAU,IAAA5J,aAFZ,E,WAAqC,EAAAjE,W,+CAIlB,MACqBE,KAAKmB,QAAnCzC,EADS,EACTA,KAAMD,EADG,EACHA,WAAYS,EADT,EACSA,QAEX,OAATR,GACFR,EAAE2R,QAAQrQ,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,sBAAsD,CACrEmQ,eAAgB,CAAEhN,KAAM,UACvBlB,KAAK,SAACC,GACPpC,IAAIC,KAAKE,eAAe8I,MAAQ7G,EAAIG,SACpC,IAAM0N,EAAatQ,EAAEc,KAAKhB,GAAW,EACrCR,EApIU,SAAC2W,GAAuD,IAA3C3F,EAA2C,wDACxE,OAAOtQ,EAAE2F,IAAIsQ,EAAO,SAACtT,EAAWQ,GAC9B,MAAO,CACLL,GAAIH,EAAKG,GACTE,KAAML,EAAKK,KACXC,YAAaN,EAAKM,YAClBC,SAAUP,EAAKO,SACfC,QACAC,UAAWD,EACXE,KAAMiN,EACNhN,MAAOtD,EAAE2F,IAAIhD,EAAK4G,SAAU,SAACC,EAAcrG,GACzC,MAAO,CACLL,GAAI0G,EAAQ1G,GACZE,KAAMwG,EAAQxG,KACdC,YAAauG,EAAQvG,YACrBC,SAAUsG,EAAQtG,SAClBC,QACAC,UAAWD,EACXE,KAAMiN,EACNC,SAAU,KACVQ,eAAe,EACfzN,MAAOtD,EAAE2F,IAAI6D,EAAQC,eAAgB,SAACC,EAAWvG,GAC/C,MAAO,CACLL,GAAI4G,EAAK5G,GACTE,KAAM0G,EAAK1G,KACXC,YAAayG,EAAKzG,YAClBC,SAAUwG,EAAKxG,SACfoP,KAAM5I,EAAKwM,UACXhI,aAAcxE,EAAKC,gCACnBoJ,WAAYrJ,EAAKyM,0BACjBnF,QAAS,KACT7N,QACAC,UAAWD,WAoGViT,CAAU3T,EAAIG,SAAU0N,GAC1BA,GAnEO,SAAChR,EAAW+W,GAC9B,IAAI1N,GAAQ,EAEZ,OAAQ0N,EAAYC,SAClB,IAAK,OAEHhX,EADcU,EAAE8N,UAAUxO,EAAM,CAAEwD,GAAIuT,EAAYzY,SACtCyF,MAAO,EACnB,MACF,IAAK,QACHsF,GAAQ,EACR3I,EAAEC,KAAKX,EAAM,SAACqD,GAWZ,GAVA3C,EAAEC,KAAK0C,EAAKW,MAAO,SAACkG,GAClB,GAAIA,EAAQ1G,IAAMuT,EAAYzY,MAK5B,OAJA+K,GAAQ,EACRhG,EAAKU,MAAO,EACZmG,EAAQnG,MAAO,GAER,IAIPsF,EACF,OAAO,IAGX,MACF,IAAK,OACHA,GAAQ,EACR3I,EAAEC,KAAKX,EAAM,SAACqD,GAiBZ,GAhBA3C,EAAEC,KAAK0C,EAAKW,MAAO,SAACkG,GAWlB,GAVAxJ,EAAEC,KAAKuJ,EAAQlG,MAAO,SAACoG,GACrB,GAAIA,EAAK5G,IAAMuT,EAAYzY,MAKzB,OAJA+K,GAAQ,EACRhG,EAAKU,MAAO,EACZmG,EAAQnG,MAAO,GAER,IAIPsF,EACF,OAAO,IAIPA,EACF,OAAO,KAsBP4N,CAAYjX,EAAMe,IAAIC,KAAKE,eAAeC,SAAS+V,cAErDnX,EAAWC,KAIfsB,KAAK6N,iB,qCAGK,WACV,IAAKpO,IAAIC,KAAKE,eAAe2D,SAASC,SAAWE,yBAAyB,qBACxE,OAAO,EAGPxF,EAAE8B,KAAK2N,QAAQ1J,SAAiB6I,SAAS,CACzCS,OAAQ,gCACR7K,MAAO,WACPgI,YAAa,uBACb8C,KAAM,IACNM,OAAQ,MACRC,iBAAiB,EACjBC,YAAa,SACbC,OAAQ,SAACrN,EAAoBqF,GAC3B,IAAMiI,EAAYjI,EAAKkI,QAGvB,OAFAjQ,EAAEgQ,GAAW3E,KAAK,6BAA6B6E,SAExCF,GAETG,MAAO,SAASzN,EAAoB0N,GAChCpQ,EAAE8B,MAAc8M,SAAS,oBAC3B5O,EAAEoQ,EAAGrI,MAAMjD,SAAS,sBAEtBuL,KAAM,SAAS3N,EAAoB0N,GACjCpQ,EAAEoQ,EAAGrI,MAAM1B,YAAY,sBAEzBkJ,OAAQ,SAAC7M,EAAoB0N,GAC3B,IAAI5L,EAASxE,EAAE,EAAKyP,QAAQ1J,SAAiB6I,SAAS,WAEtDpK,EAAQA,EAAMqC,IAAI,SAASkB,GACzB,OAAOA,EAAK8G,OAAO,KAGrB7O,EAAE4C,QAAQY,+BAA+B,0BACzCxD,EAAEqB,KAAKC,QAAQ,YAAcC,IAAIC,KAAKC,WAAa,2BAA4B,CAAEqN,KAAMtK,IAASd,KAAK,SAACC,GACpG,GAAmB,GAAfA,EAAI2M,QAAc,CACpB,IAAMC,EAAqC,GAC3C/L,EAAMrD,KAAK,SAACqP,EAAWC,GACrBF,EAAUC,GAAKC,IAHG,MAMS,EAAKxN,QAA1BzC,EANY,EAMZA,MAQRD,EAdoB,EAMNA,YAEEW,EAAE2F,IAAIrG,EAAM,SAACqD,GAG3B,OAFAA,EAAKO,SAAW,IAAMmM,EAAU1M,EAAKG,IAAM,GAC3CH,EAAKS,UAAYiM,EAAU1M,EAAKG,IACzBH,KAIT7D,EAAEC,oB,+BAON,IACIO,EAASsB,KAAKmB,QAAdzC,KAER,OACE,oBAAC,EAAA+B,SAAD,KACY,OAAT/B,GACC,2BAAK0B,UAAU,mBAAmBgD,MAAO,CAAEyS,UAAW,MACpD,2BAAKzV,UAAU,6BACb,2BAAKA,UAAU,gCAAf,+BAEF,+BAGJ,0BACEA,UAAU,yFACV8B,GAAG,wBACHsC,IAAKxE,KAAK2N,SAEA,OAATjP,GACCU,EAAE2F,IAAI3F,EAAE8P,OAAOxQ,EAAM,SAACwI,GAAD,OAAuBiI,SAASjI,EAAQ5E,YAAY,SAACP,GACxE,OAAO,oBAAC4E,EAAD,CAAcrJ,IAAKyE,EAAKG,GAAI+D,KAAMlE,Y,iBApG9C,EAAAmB,YAAc,W,sNC74BvB,WACA,WAEA,SACA,SACA,YACA,W,ytCAIa+L,E,YAAb,qC,sCAGE9C,YAAc,SAACvL,GACbA,EAAGC,iBADkC,IAG7BoF,EAAS,EAAKzH,MAAdyH,KAH6B,EAIR,EAAK9E,QAA1BzC,EAJ6B,EAI7BA,KAAMD,EAJuB,EAIvBA,WAER2C,EAASC,QAAQD,OACrB,CACEE,OAAQ,iBACRC,QAAS,kFAEX,WACA,aACA,SAAC1E,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GA2BrB,OAvBAqB,EAAE4C,QAAQY,+BAA+B,yBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAAqDsG,EAAK/D,KAAO,CAAEP,UAAW9E,IACzF+E,KAAK,SAACC,GACAA,EAAIC,WAQP5D,EAAEC,YACFkD,QAAQ8G,MAAR,4IAEyDtG,EAAIwK,QAF7D,aARA3N,EAAKuH,EAAK1D,OAAOF,YAAcxF,EAE/B4B,EAAWC,GACX0C,EAAOuB,MAAM,QAEbzE,EAAEC,eASLyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,gEACjC7E,EAAEC,eAGC,GAET8H,EAAK5D,aAEPnE,EAAE,kBAAkB8E,SAAS,4BAG/B,EAAA8I,cAAgB,SAAClL,GACfA,EAAGC,iBADoC,IAG/BoF,EAAS,EAAKzH,MAAdyH,KAER,GAAIA,EAAK/D,IAAMzC,IAAIC,KAAKE,eAAeC,SAAS+P,kBAAhD,CALuC,MAYZ,EAAKzO,QAA1BzC,EAZiC,EAYjCA,KAAMD,EAZ2B,EAY3BA,WAEZ4C,QAAQ2K,eAAR,wEACmE/F,EAAK5D,YADxE,eAEE,KACA,oBACA,SAAC4J,GACMA,IAIL/N,EAAE4C,QAAQY,+BAA+B,uBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAAqDsG,EAAK/D,KAAO,CAAEgK,UAAW,WACzFtK,KAAK,WACJlD,EAAOU,EAAEqG,OAAO/G,EAAM,CAAEwD,GAAI+D,EAAK/D,KACjCzD,EAAWC,GACXR,EAAEC,cAEHyE,KAAK,kBAAM1E,EAAEC,sBAxBlBkD,QAAQ8G,MACN,iHA4BN,EAAA2N,WAAa,SAAClV,GACZA,EAAGC,iBADiC,IAG5BoF,EAAS,EAAKzH,MAAdyH,KAH4B,EAIP,EAAK9E,QAA1BzC,EAJ4B,EAI5BA,KAAMD,EAJsB,EAItBA,WAER2C,EAASC,QAAQD,OACrB,CACEE,OAAQ,cACRC,QAAS,sCAAF,OAAwC0E,EAAK5D,YAA7C,yEAET,WACA,QACA,SAACxF,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GA4CrB,OAxCAqB,EAAE4C,QAAQY,+BAA+B,qBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,sBAAsD,CAClEoW,UAAW9P,EAAK/D,GAChBP,UAAW9E,IAEV+E,KAAK,SAACC,GACL,GAAKA,EAAIC,UAsBP5D,EAAEC,YACFkD,QAAQ8G,MAAR,wIAEyDtG,EAAIwK,QAF7D,eAvBkB,CAClB,IAAMzD,EAAU/G,EAAIG,SAASC,OAE7BvD,EAAKuH,EAAK1D,OAAOG,MAAM1H,KAAK,CAC1BkH,GAAI0G,EAAQzG,oBACZC,KAAMwG,EAAQxG,KACdC,YAAauG,EAAQvG,YACrBC,SAAUsG,EAAQtG,SAClBC,MAAO7D,EAAKuH,EAAK1D,OAAOG,MAAMhI,OAC9B8H,UAAW9D,EAAKuH,EAAK1D,OAAOG,MAAMhI,OAClC+H,MAAM,EACNkN,SAAU,KACVjN,MAAO,KAGThE,EAAKuH,EAAK1D,OAAOE,MAAO,EAExBhE,EAAWC,GACX0C,EAAOuB,MAAM,QAEbzE,EAAEC,eASLyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,4DACjC7E,EAAEC,eAGC,GAET,IAEFD,EAAE,kBAAkB8E,SAAS,4BApJjC,E,WAAyC,EAAAC,e,oCAwJrC,OACE,2BAAK7C,UAAU,kCACb,2BAAKA,UAAU,6BACb,yBAAGA,UAAU,+BAA+BiD,cAAY,WAAW3C,KAAK,KACtE,4BAAMN,UAAU,wBAGlB,0BAAIA,UAAU,4BACXsD,yBAAyB,cACxB,8BACE,yBAAGhD,KAAK,IAAIC,QAASX,KAAKmM,aAA1B,WAKHzI,yBAAyB,mBACxB,8BACE,yBAAGhD,KAAK,IAAIC,QAASX,KAAK8V,YAA1B,gBAKHpS,yBAAyB,gBACxB,oBAAC,EAAAjD,SAAD,KACE,0BAAIL,UAAU,YACd,8BACE,yBAAGM,KAAK,IAAIC,QAASX,KAAK8L,eAA1B,qB,6BAjLT,EAAA5I,YAAc,U,IA8LV2N,E,YAAb,qC,sCAGE1E,YAAc,SAACvL,GACbA,EAAGC,iBADkC,IAG7BoF,EAAS,EAAKzH,MAAdyH,KAH6B,EAIR,EAAK9E,QAA1BzC,EAJ6B,EAI7BA,KAAMD,EAJuB,EAIvBA,WAER2C,EAASC,QAAQD,OACrB,CACEE,OAAQ,kBACRC,QAAS,iFAEX,WACA,aACA,SAAC1E,GACC,GAAKA,GAAsB,IAAjBuC,EAAEoC,IAAIC,KAAK5E,GA2BrB,OAvBAqB,EAAE4C,QAAQY,+BAA+B,0BACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAAqDsG,EAAK/D,KAAO,CAAEP,UAAW9E,IACzF+E,KAAK,SAACC,GACAA,EAAIC,WAQP5D,EAAEC,YACFkD,QAAQ8G,MAAR,6IAEyDtG,EAAIwK,QAF7D,aARA3N,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAMuD,EAAK1D,OAAOF,YAAcxF,EAExD4B,EAAWC,GACX0C,EAAOuB,MAAM,QAEbzE,EAAEC,eASLyE,KAAK,WACJ1E,EAAE2E,QAAQ,CAAEC,KAAM,QAASC,KAAM,iEACjC7E,EAAEC,eAGC,GAET8H,EAAK5D,aAEPnE,EAAE,kBAAkB8E,SAAS,4BAG/B,EAAA8I,cAAgB,SAAClL,GACfA,EAAGC,iBADoC,IAG/BoF,EAAS,EAAKzH,MAAdyH,KAH+B,EAIZ,EAAK9E,QAA1BzC,EAJiC,EAIjCA,KAAMD,EAJ2B,EAI3BA,WAEZ4C,QAAQ2K,eAAR,yEACoE/F,EAAK5D,YADzE,eAEE,KACA,qBACA,SAAC4J,GACMA,IAIL/N,EAAE4C,QAAQY,+BAA+B,wBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAAqDsG,EAAK/D,KAAO,CAAEgK,UAAW,WACzFtK,KAAK,WACJlD,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAQtD,EAAEqG,OAAO/G,EAAKuH,EAAKyB,OAAOnF,OAAOG,MAAO,CAAER,GAAI+D,EAAK/D,KACnFzD,EAAWC,GACXR,EAAEC,cAEHyE,KAAK,kBAAM1E,EAAEC,kBAzExB,E,WAA4C,EAAA8E,e,oCA8EpC,IACIgD,EAASjG,KAAKxB,MAAdyH,KAER,OACE,2BAAK7F,UAAU,kCACb,2BAAKA,UAAU,6BACb,yBAAGA,UAAU,+BAA+BiD,cAAY,WAAW3C,KAAK,KACtE,4BAAMN,UAAU,wBAGlB,0BAAIA,UAAU,4BACXsD,yBAAyB,cACxB,8BACE,yBAAGhD,KAAK,IAAIC,QAASX,KAAKmM,aAA1B,WAKHzI,yBAAyB,gBACxB,oBAAC,EAAAjD,SAAD,KACE,8BACE,oBAAC,EAAAuV,aAAD,CAAcpH,MAAO3I,KAEvB,8BACE,oBAAC,EAAAgQ,kBAAD,CAAmBrH,MAAO3I,MAI/BvC,yBAAyB,gBACxB,oBAAC,EAAAjD,SAAD,KACE,0BAAIL,UAAU,YACd,8BACE,yBAAGM,KAAK,IAAIC,QAASX,KAAK8L,eAA1B,qB,gCA7GT,EAAA5I,YAAc,U,IA0HV8O,E,YAAb,qC,sCAGElG,cAAgB,SAAClL,GACfA,EAAGC,iBADoC,IAG/BoF,EAAS,EAAKzH,MAAdyH,KAH+B,EAIZ,EAAK9E,QAA1BzC,EAJiC,EAIjCA,KAAMD,EAJ2B,EAI3BA,WAEZ4C,QAAQ2K,eAAR,wEACmE/F,EAAK5D,YADxE,eAEE,KACA,oBACA,SAAC4J,GACMA,IAIL/N,EAAE4C,QAAQY,+BAA+B,uBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAAqDsG,EAAK/D,KAAO,CAAEgK,UAAW,WACzFtK,KAAK,WACJlD,EAAKuH,EAAKyB,OAAOA,OAAOnF,OAAOG,MAAMuD,EAAKyB,OAAOnF,OAAOG,MAAQtD,EAAEqG,OAChE/G,EAAKuH,EAAKyB,OAAOA,OAAOnF,OAAOG,MAAMuD,EAAKyB,OAAOnF,OAAOG,MACxD,CAAER,GAAI+D,EAAK/D,KAEbzD,EAAWC,GACXR,EAAEC,cAEHyE,KAAK,kBAAM1E,EAAEC,kBA5BxB,E,WAAyC,EAAA8E,e,oCAiCjC,IACIgD,EAASjG,KAAKxB,MAAdyH,KACR,OACE,2BAAK7F,UAAU,kCACb,2BAAKA,UAAU,6BACb,yBAAGA,UAAU,+BAA+BiD,cAAY,WAAW3C,KAAK,KACtE,4BAAMN,UAAU,wBAGlB,0BAAIA,UAAU,4BACXsD,yBAAyB,cACxB,oBAAC,EAAAjD,SAAD,KACE,8BACE,oBAAC,EAAAyV,cAAD,CAAepN,KAAM7C,MAErB7G,EAAE+W,QAAQ,CAAE,UAAW,gBAAkBlQ,EAAKyL,OAC9C,8BACE,oBAAC,EAAA0E,eAAD,CAAgBtN,KAAM7C,OAK5B7G,EAAE+W,QAAQ,CAAE,KAAM,OAASlQ,EAAK7D,OAClCsB,yBAAyB,gBACvB,oBAAC,EAAAjD,SAAD,KACE,0BAAIL,UAAU,YACd,8BACE,yBAAGM,KAAK,IAAIC,QAASX,KAAK8L,eAA1B,qB,6BA3DT,EAAA5I,YAAc,U,IAwEVmQ,E,YAMX,WAAY7U,GAA2C,wBACrD,wBAAMA,KAQRqG,SAAW,SAACjE,EAA0B1G,GACpC,EAAK0E,SAAS,CAAEyX,YAAanc,EAAK8C,SAGpC,EAAAqL,SAAW,WAAK,MACgB,EAAK7J,MAA3BsK,EADM,EACNA,KAAME,EADA,EACAA,YADA,EAEe,EAAK7H,QAA1BzC,EAFM,EAENA,KAAMD,EAFA,EAEAA,WAER6X,EAAiBtN,EAAYuN,wCAEnCrY,EAAE4C,QAAQY,+BAA+B,sBACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAAuD2W,EAAvD,aAAkF,CAC9FE,gBAAiB,EAAKvX,MAAMoX,cAE3BzU,KAAK,SAACC,GACAA,EAAIC,YACPpD,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOE,MAAO,EAC/D/D,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOG,MAAMoG,EAAKvG,OAAO+K,aACxEzL,EAAIG,SAASsL,aAEf7O,EAAWC,IAEbR,EAAEC,cAEHyE,KAAK,kBAAM1E,EAAEC,cAEhB,EAAKS,SAAS,CAAE4E,QAAQ,KAG1B,EAAAiT,YAAc,WACZ,EAAK7X,SAAS,CAAE4E,QAAQ,IACxBzC,WAAW,kBAAM7C,EAAE,0CAA0CqG,YAAY,YAAY,KArCrF,EAAKtF,MAAQ,CACXuE,QAAQ,EACR6S,YAAa7X,EAAMwK,YAAYG,qBALoB,E,WANb,EAAAlG,e,oCAiDpC,aAC0BjD,KAAKxB,MAA3BsK,EADJ,EACIA,KAAME,EADV,EACUA,YACNlK,EAAYkB,KAAKmB,QAAjBrC,QACF6F,EAAyBvF,EAAEmK,KAAKzK,EAAS,CAAEoK,mBAAoBF,EAAYE,qBAE3EwN,EAAqBtX,EAAE2F,IAAItF,IAAIC,KAAKE,eAAeqF,OAAQ,SAASgB,GACxE,MAAO,CACL3I,IAAK2I,EAAKb,QACVrC,KAAMkD,EAAK1J,KACXS,MAAOiJ,EAAKb,QACZiF,YAAapE,EAAKqE,IAAI/N,KACtBgO,MAAO,CAAEhJ,QAAS0E,EAAKS,MAAO8D,UAAU,EAAMC,MAAO,YAIzD,OACE,oBAAC,EAAAhK,SAAD,KACE,oBAAC,UAASgM,KAAV,CAAe9L,QAASX,KAAKyW,aAA7B,mBACCzW,KAAKf,MAAMuE,QACV,oBAAC,UAAD,CACEf,MAAI,EACJvC,KAAK,OACLyW,OAAO,WACPvW,UAAU,0BACVgI,QAAS,kBAAM,EAAKxJ,SAAS,CAAE4E,QAAQ,KACvCyH,WAAS,GAET,oBAAC,UAAMC,OAAP,CAAc3J,QAAQ,oBACtB,oBAAC,UAAM4J,QAAP,KACE,sCACE,+BACE,4CADF,IAC2BrC,EAAKpB,OAAOrF,aAEvC,+BACE,2CADF,IAC0ByG,EAAKzG,aAEjB,WAAbyG,EAAK4I,KACJ,+BACE,8CADF,IAC6B1I,EAAYC,cAGzC,+BACE,6CADF,IAC4BtE,EAAOpI,OAKvC,2BAAK6D,UAAU,WACb,2BAAKA,UAAU,SACb,6BAAOkG,QAAQ,IAAf,iDACA,+BACA,oBAAC,UAAD,CACEoE,YAAY,wBACZC,aAAc3B,EAAYG,oBAC1ByB,WAAS,EACTgM,WAAS,EACT/L,OAAK,EACLC,QAAS4L,EACT7R,SAAU7E,KAAK6E,cAKvB,oBAAC,UAAMgS,QAAP,KACE,8BAAQzW,UAAU,qBAAqBO,QAAS,kBAAM,EAAK/B,SAAS,CAAE4E,QAAQ,MAA9E,YAGA,8BAAQpD,UAAU,oBAAoBO,QAASX,KAAKqI,UAApD,kB,gCAhHL,EAAAnF,YAAc,U,IA2HVoQ,E,YAAb,qC,sCAGExH,cAAgB,WAAK,MACW,EAAKtN,MAA3BsK,EADW,EACXA,KAAME,EADK,EACLA,YADK,EAEmB,EAAK7H,QAAnCzC,EAFW,EAEXA,KAAMD,EAFK,EAELA,WAAYK,EAFP,EAEOA,QAEpB6F,EAAyBvF,EAAEmK,KAAKzK,EAAS,CAAEoK,mBAAoBF,EAAYE,qBAEjF7H,QAAQ2K,eAAR,gEAC2DrH,EAAOpI,KADlE,wCACsGuM,EAAKzG,YAD3G,eAEE,KACA,yBACA,SAAC4J,GACC,GAAKA,EAAL,CAIA,IAAMqK,EAAiBtN,EAAYuN,wCACnCrY,EAAE4C,QAAQY,+BAA+B,qCACzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,+BAAuD2W,EAAvD,gBAAqF,CACjGpK,UAAW,WAEVtK,KAAK,SAACC,GACLnD,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOE,MAAO,EAC/D/D,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOG,MAAMoG,EAAKvG,OAAO+K,aACxEzL,EAAIG,SAASsL,aAEf7O,EAAWC,GACXR,EAAEC,cAEHyE,KAAK,kBAAM1E,EAAEC,kBA/BxB,E,WAAkD,EAAA8E,e,oCAqC9C,OACE,oBAAC,UAASwJ,KAAV,CAAenP,IAAI,SAASqD,QAASX,KAAK8L,eAA1C,0B,sCArCG,EAAA5I,YAAc,W,yIC/gBvB,WAEA,WACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,YACA,YAEA,YACA,W,qtCAIA,IAAM4T,EAAmB,CACvBC,SAAU,yBAAG3W,UAAU,oBACvB4W,YAAa,yBAAG5W,UAAU,2BAC1B6W,UAAW,yBAAG7W,UAAU,qBACxB8W,aAAc,yBAAG9W,UAAU,4BAC3B+W,SAAU,yBAAG/W,UAAU,oBACvBgX,OAAQ,yBAAGhX,UAAU,mBAOjBiX,E,wFAAuB,EAAAvX,W,oCACrB,WACJ,OACE,2BAAKM,UAAU,+BACb,0BAAIA,UAAU,sBAAd,+CACA,oBAAC,UAAD,CAAMkX,SAAO,EAACC,UAAQ,EAACC,QAAS,EAAG/T,UAAU,UAC3C,oBAAC,UAAKgU,OAAN,KACE,oBAAC,UAAD,CAAShU,UAAU,SAAS8T,UAAQ,EAACnX,UAAU,YAAYO,QAAS,kBAAM,EAAKnC,MAAMkZ,SAAS,aAC5F,oBAAC,UAAD,CAAMnb,KAAK,UAAU2D,KAAK,QAC1B,2BAAKE,UAAU,kBAAf,mBAEE,oBAAC,UAAD,CACEF,KAAK,OACL6K,QAAS,oBAAC,UAAD,CAAMN,MAAM,OAAOvK,KAAK,QAAQ3D,KAAK,oBAC9C+E,OAAO,+BACPC,QAAO,iWAQf,oBAAC,UAAKkW,OAAN,KACE,oBAAC,UAAD,CACEhU,UAAU,SACVgD,SAAsD,KAA5ChH,IAAIC,KAAKE,eAAe2D,SAASoU,QAC3CvX,UAAU,YACVO,QAAS,WACP,GAAgD,KAA5ClB,IAAIC,KAAKE,eAAe2D,SAASoU,QAKnC,OAAO,EAAKnZ,MAAMkZ,SAAS,WAJ3BrW,QAAQ8G,MACN,kHAON,oBAAC,UAAD,CAAM5L,KAAK,6BAA6B2D,KAAK,QAC7C,2BAAKE,UAAU,kBAAf,YAEE,oBAAC,UAAD,CACEF,KAAK,OACL6K,QAAS,oBAAC,UAAD,CAAMN,MAAM,OAAOvK,KAAK,QAAQ3D,KAAK,oBAC9C+E,OAAO,uBACPC,QAAO,4iBAUf,oBAAC,UAAKkW,OAAN,KACE,oBAAC,UAAD,CAAShU,UAAU,SAASgD,UAAQ,EAACrG,UAAU,wBAC7C,oBAAC,UAAD,CAAOqK,MAAM,SAASmN,OAAO,QAAQ1X,KAAK,UAA1C,gBAGA,2BAAKE,UAAU,aACf,oBAAC,UAAD,CAAM7D,KAAK,yBAAyB2D,KAAK,QACzC,2BAAKE,UAAU,kBAAf,eAIN,oC,KAiBFyX,E,YAAN,qC,sCACEhT,SAAW,SAACiT,GACV,EAAKtZ,MAAMqG,SAASiT,EAAEjU,OAAO7G,QAG/B,EAAAqL,SAAW,SAACzH,GACVA,EAAGC,iBACH,EAAKrC,MAAMuZ,cAPf,E,WAA6B,EAAAjY,W,oCAWzB,OACE,2BAAKM,UAAU,+BACb,oBAAC,UAAD,CAAMiI,SAAUrI,KAAKqI,UACnB,oBAAC,UAAD,CAAMkP,UAAQ,EAAC9T,UAAU,UACvB,oBAAC,UAAKgU,OAAN,CAAanF,MAAO,IAClB,oBAAC,UAAK0F,MAAN,CAAYC,UAAQ,EAAC1N,MAAM,+BAC3B,oBAAC,UAAK2N,MAAN,CACEpV,KAAK,OACLvG,KAAK,YACLmO,YAAY,kBACZC,aAAc3K,KAAKxB,MAAMxB,MACzB6H,SAAU7E,KAAK6E,SACfsT,UAAW,IACXF,UAAQ,MAId,+BACA,oBAAC,UAAD,CAAQG,UAAQ,EAAC7W,QAAQ,SAASZ,QAASX,KAAKxB,MAAM6Z,SAAUvV,KAAK,WACrE,oBAAC,UAAD,CAAQwV,UAAQ,EAAC/W,QAAQ,YAAYoL,QAAQ,gB,KAYjD4L,E,YACJ,WAAY/Z,GAAgC,wBAC1C,wBAAMA,KAORqG,SAAW,SAAC2B,GACV,EAAK5H,SAAS,CAAE5B,MAAOwJ,IACvB,EAAKhI,MAAMqG,SAAS2B,IAGtB,EAAA6B,SAAW,SAACzH,GACVA,EAAGC,iBACH,EAAKrC,MAAMuZ,cAZX,EAAK9Y,MAAQ,CACXjC,MAAO,EAAKwB,MAAMxB,OAJsB,E,WADjB,EAAA8C,W,oCAoBzB,IAAIgL,EAA8C,GAKlD,OAJA1L,EAAEoZ,QAAQ/Y,IAAIC,KAAKE,eAAe6S,UAAW,SAASxM,GACpD6E,EAAQ9P,KAAK,CAAEgC,MAAOiJ,EAAK/D,GAAIqI,MAAOtE,EAAK1J,SAI3C,2BAAK6D,UAAU,+BACb,oBAAC,UAAD,CAAMiI,SAAUrI,KAAKqI,UACnB,oBAAC,UAAD,CAAMkP,UAAQ,EAAC9T,UAAU,UACvB,oBAAC,UAAKgU,OAAN,CAAanF,MAAO,IAClB,oBAAC,UAAK0F,MAAN,CAAYzN,MAAM,qDADpB,IAC0E,+BACxE,oBAAC,UAAD,CACEhO,KAAK,aACLuO,QAASA,EACT2N,eAAe,cACfC,cAAc,YACdlS,SAAUxG,KAAKf,MAAMjC,MACrB2b,MAAO7B,EACPjS,SAAU7E,KAAK6E,aAIrB,+BACA,oBAAC,UAAD,CAAQuT,UAAQ,EAAC7W,QAAQ,SAASZ,QAASX,KAAKxB,MAAM6Z,SAAUvV,KAAK,WACrE,oBAAC,UAAD,CAAQwV,UAAQ,EAAC/W,QAAQ,YAAYoL,QAAQ,gB,KAYjDiM,E,YACJ,WAAYpa,GAAgC,wBAC1C,wBAAMA,KAORqG,SAAW,SAAC2B,GACV,EAAK5H,SAAS,CAAE5B,MAAOwJ,IACvB,EAAKhI,MAAMqG,SAAS2B,IAGtB,EAAA6B,SAAW,SAACzH,GACVA,EAAGC,iBACH,EAAKrC,MAAMuZ,cAZX,EAAK9Y,MAAQ,CACXjC,MAAO,EAAKwB,MAAMxB,OAJsB,E,WADV,EAAA8C,W,oCAoBhC,IAAIgL,EAA8C,GAKlD,OAJA1L,EAAEoZ,QAAQ/Y,IAAIC,KAAKE,eAAed,QAAS,SAASmH,GAClD6E,EAAQ9P,KAAK,CAAEgC,MAAOiJ,EAAK/D,GAAIqI,MAAOtE,EAAK1J,SAI3C,2BAAK6D,UAAU,+BACb,oBAAC,UAAD,CAAMiI,SAAUrI,KAAKqI,UACnB,oBAAC,UAAD,CAAMkP,UAAQ,EAAC9T,UAAU,UACvB,oBAAC,UAAKgU,OAAN,CAAanF,MAAO,IAClB,oBAAC,UAAK0F,MAAN,CAAYzN,MAAM,kDADpB,IACuE,+BACrE,oBAAC,UAAD,CACEhO,KAAK,UACLuO,QAASA,EACT2N,eAAe,cACfC,cAAc,YACdlS,SAAUxG,KAAKf,MAAMjC,MACrB2b,MAAO7B,EACPjS,SAAU7E,KAAK6E,aAIrB,+BACA,oBAAC,UAAD,CAAQuT,UAAQ,EAAC7W,QAAQ,SAASZ,QAASX,KAAKxB,MAAM6Z,SAAUvV,KAAK,WACrE,oBAAC,UAAD,CAAQwV,UAAQ,EAAC/W,QAAQ,aAAaoL,QAAQ,gB,KAUlDkM,E,YACJ,WAAYra,GAAgC,wBAC1C,wBAAMA,KAORqG,SAAW,SAACiT,EAAD,GAAsC,IAAhB9a,EAAgB,EAAhBA,MAC/B,EAAK4B,SAAS,CAAE5B,UAChB,EAAKwB,MAAMqG,SAAS7H,IAGtB,EAAAqL,SAAW,SAACzH,GACVA,EAAGC,iBACH,EAAKrC,MAAMuZ,cAZX,EAAK9Y,MAAQ,CACXjC,MAAO,EAAKwB,MAAMxB,OAJsB,E,WADV,EAAA8C,W,oCAmB5B,WAUJ,OACE,2BAAKM,UAAU,+BACb,oBAAC,UAAD,CAAMiI,SAAUrI,KAAKqI,UACnB,oBAAC,UAAD,CAAMkP,UAAQ,EAAC9T,UAAU,UACvB,oBAAC,UAAKgU,OAAN,CAAanF,MAAO,IAClB,oBAAC,UAAK0F,MAAN,CAAYzN,MAAM,2CACjBnL,EAAE2F,IAfqD,CAChE,CAAE/H,MAAO,IAAK+F,KAAM,UAAW+V,KAAM,8BACrC,CAAE9b,MAAO,IAAK+F,KAAM,YAAa+V,KAAM,+BACvC,CAAE9b,MAAO,IAAK+F,KAAM,aAAc+V,KAAM,iCACxC,CAAE9b,MAAO,IAAK+F,KAAM,gBAAiB+V,KAAM,uCAC3C,CAAE9b,MAAO,IAAK+F,KAAM,YAAa+V,KAAM,0BACvC,CAAE9b,MAAO,KAAM+F,KAAM,QAAS+V,KAAM,eASZ,SAACC,EAAQpK,GACvB,OACE,oBAAC,UAAKqJ,MAAN,CAAY5X,UAAU,iBACpB,oBAAC,UAAD,CACEmK,MACE,iCACGwO,EAAOhW,KADV,IACgB,4BAAM3C,UAAU,oBAAoB2Y,EAAOD,OAG7Dvc,KAAK,UACLS,MAAO+b,EAAO/b,MACduJ,QAAS,EAAKtH,MAAMjC,OAAS+b,EAAO/b,MACpC6H,SAAU,EAAKA,gBAO3B,+BACA,oBAAC,UAAD,CAAQuT,UAAQ,EAAC7W,QAAQ,SAASZ,QAASX,KAAKxB,MAAM6Z,SAAUvV,KAAK,WACrE,oBAAC,UAAD,CAAQwV,UAAQ,EAAC/W,QAAQ,aAAaoL,QAAQ,gB,KAmB3CqJ,E,YACX,WAAYxX,GAAwB,wBAClC,wBAAMA,KAaRwa,SAAW,WACT,EAAKpa,SAAS,SAACqa,GAAD,MAAgB,CAC5B/Q,KAAM+Q,EAAU/Q,KAAO,MAI3B,EAAAgR,SAAW,WACT,EAAKta,SAAS,SAACqa,GAAD,MAAgB,CAC5B/Q,KAAM+Q,EAAU/Q,KAAO,MAI3B,EAAAiR,eAAiB,SAACC,GAChB,EAAKxa,SAAS,CAAEsJ,KAAM,EAAGkR,cAW3B,EAAAC,eAAiB,SAACC,GAChB,EAAKC,qBAAqB,CAAED,eAG9B,EAAAE,iBAAmB,SAACrH,GAClB,EAAKoH,qBAAqB,CAAEpH,gBAG9B,EAAAsH,cAAgB,SAAC3a,GACf,EAAKya,qBAAqB,CAAEza,UAAS4a,SAAU,QAGjD,EAAAC,eAAiB,SAACD,GAChB,EAAKH,qBAAqB,CAAEza,QAAS,KAAM4a,cAG7C,EAAAE,OAAS,WACP1b,EAAE4C,QAAQY,+BAA+B,iBAEzC,IAAImY,EAAOxb,SAASyb,cAAc,QAClCD,EAAKE,OAAS,OACdF,EAAKG,OAASxa,QAAQ,YAAD,OACPC,IAAIC,KAAKE,eAAe2D,SAASrB,GAD1B,6BACiD,EAAK1D,MAAMoQ,MAAM1M,GADlE,oBAIrB,IAAImT,EAAQhX,SAASyb,cAAc,SACnCzE,EAAM9Y,KAAO,OACb8Y,EAAMrY,MAAQ,EAAKiC,MAAMma,SACzB/D,EAAMvS,KAAO,SACb+W,EAAKI,YAAY5E,GAEjBjW,EAAEoZ,QAAQ,EAAKvZ,MAAMib,SAAU,SAASld,EAAOM,GAC7C,IAAI+X,EAAQhX,SAASyb,cAAc,SACnCzE,EAAM9Y,KAAN,eAAqBe,EAArB,KACA+X,EAAMrY,MAAQA,EACdqY,EAAMvS,KAAO,SACb+W,EAAKI,YAAY5E,KAGnBhX,SAAS8b,KAAKF,YAAYJ,GAE1BA,EAAKD,UAGP,EAAAxR,QAAU,WACR,EAAKxJ,SAAS,CAAE4E,QAAQ,KAhFxB,EAAKvE,MAAQ,CACXiJ,KAAM,EACNkR,SAAU,KACV5V,QAAQ,EACR0W,SAAU,CACRZ,UAAW,GACXnH,WAAY,KATkB,E,WADJ,EAAArS,W,gDA+BX5F,GACnB8F,KAAKpB,SAAS,SAACqa,GAAa,IACpBiB,EAAajB,EAAbiB,SAEN,MAAO,CAAEA,SADTA,EAAWvf,OAAOwE,OAAO,GAAI+a,EAAUhgB,Q,sCAqD3BgO,GACd,OAAQA,GACN,KAAK,EACH,OAAO,oBAACmP,EAAD,CAAgBK,SAAU1X,KAAKmZ,iBACxC,KAAK,EACH,OACE,oBAACtB,EAAD,CACE7a,MAAOgD,KAAKf,MAAMib,SAASZ,UAC3BjB,SAAUrY,KAAKkZ,SACfrU,SAAU7E,KAAKqZ,eACftB,WAAY/X,KAAKgZ,WAGvB,KAAK,EACH,OACE,oBAACT,EAAD,CACEvb,MAAOgD,KAAKf,MAAMib,SAAS/H,WAC3BkG,SAAUrY,KAAKkZ,SACfrU,SAAU7E,KAAKwZ,iBACfzB,WAAY/X,KAAKgZ,WAGvB,KAAK,EACH,OAAQhZ,KAAKf,MAAMma,UACjB,IAAK,UACH,OACE,oBAACR,EAAD,CACE5b,MAAOgD,KAAKf,MAAMib,SAASpb,QAC3BuZ,SAAUrY,KAAKkZ,SACfrU,SAAU7E,KAAKyZ,cACf1B,WAAY/X,KAAK4Z,SAGvB,IAAK,UACH,OACE,oBAACf,EAAD,CACE7b,MAAOgD,KAAKf,MAAMib,SAASR,SAC3BrB,SAAUrY,KAAKkZ,SACfrU,SAAU7E,KAAK2Z,eACf5B,WAAY/X,KAAK4Z,a,+BAOzB,aAC+B5Z,KAAKf,MAAhCiJ,EADJ,EACIA,KAAMkR,EADV,EACUA,SAAU5V,EADpB,EACoBA,OAEpB4W,EAAa,IACblS,EAAO,IACTkS,EAAyB,WAAZhB,EAAwB,cAAgB,cALnD,IAQIxK,EAAU5O,KAAKxB,MAAfoQ,MAER,OACE,oBAAC,EAAAnO,SAAD,KACE,yBAAGC,KAAK,IAAIC,QAAS,kBAAM,EAAK/B,SAAS,CAAE4E,QAAQ,MAAnD,cAGCA,GACC,oBAAC,UAAD,CAAOf,MAAI,EAACrC,UAAU,4BAA4BgI,QAASpI,KAAKoI,QAAS6C,WAAS,GAChF,oBAAC,UAAMC,OAAP,CAAc3J,QAAQ,eACtB,oBAAC,UAAM4J,QAAP,KACE,6BACE,4CADF,IAC2ByD,EAAMvM,aAEjC,oBAAC,UAAK+I,MAAN,CAAYC,SAAS,MAAMnL,KAAK,QAAQoL,OAAQ,GAC9C,oBAAC,UAAD,CAAMC,OAAgB,GAARrD,EAAWsD,UAAWtD,EAAO,EAAGuD,KAAMvD,EAAO,EAAI,QAAU,IAAKX,MAAM,YACpF,oBAAC,UAAD,CAAMgE,OAAgB,GAARrD,EAAWsD,UAAWtD,EAAO,EAAGuD,KAAMvD,EAAO,EAAI,QAAU,IAAKX,MAAM,cACpF,oBAAC,UAAD,CAAMgE,OAAgB,GAARrD,EAAWsD,UAAWtD,EAAO,EAAGuD,KAAMvD,EAAO,EAAI,QAAU,IAAKX,MAAM,kBACpF,oBAAC,UAAD,CAAMgE,OAAgB,GAARrD,EAAWX,MAAO6S,EAAY3O,KAAK,OAElDzL,KAAKqa,gBAAgBnS,U,0BAevBgO,E,YAGX,WAAY1X,GAAyB,wBACnC,wBAAMA,KASR8b,aAAe,SAAC1Z,GACd,EAAKhC,SAAS,CAAE2b,UAAY3Z,EAAGiD,OAAe7G,SAGhD,EAAAwd,mBAAqB,SAACrI,GACpB,EAAKvT,SAAS,CAAE6b,gBAAiBtI,KAGnC,EAAA9J,SAAW,WACT,GAAwC,IAApCjJ,EAAEoC,IAAIC,KAAK,EAAKxC,MAAMsb,WAA1B,CADc,MAMe,EAAKpZ,QAA1BzC,EANM,EAMNA,KAAMD,EANA,EAMAA,WACNqK,EAAS,EAAKtK,MAAdsK,KAER5K,EAAE4C,QAAQY,+BAA+B,0BAEzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,6BAAqDmJ,EAAK5G,KAAO,CAC7EoX,UAAW,EAAKra,MAAMsb,UACtBG,eAAgB,EAAKzb,MAAMwb,kBAC1B7Y,KAAK,SAACC,GACFA,EAAIC,YACPpD,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOE,MAAO,EAC/D/D,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOG,MAAMoG,EAAKvG,OAAOF,YAAc,EAAKpD,MAAMsb,UACnG7b,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOG,MAAMoG,EAAKvG,OAAO4P,WAAa/S,EAAE2F,IACvF,EAAK9F,MAAMwb,gBACX,SAACE,GACC,MAAO,CAAEjI,wBAAyBiI,KAGtClc,EAAWC,GACXR,EAAEC,YAEF,EAAKS,SAAS,CAAE4E,QAAQ,YAzB1BnC,QAAQ8G,MAAM,oCAjBhB,EAAKlJ,MAAQ,CACXuE,QAAQ,EACR+W,UAAW/b,EAAMsK,KAAKzG,YACtBoY,gBAAiBrb,EAAEwb,MAAMpc,EAAMsK,KAAKqJ,WAAY,4BANf,E,WAHJ,EAAAlP,e,oCAqD3B,WACI6F,EAAS9I,KAAKxB,MAAdsK,KAEJ+R,EAAyD,GAK7D,OAJAzb,EAAEoZ,QAAQ/Y,IAAIC,KAAKE,eAAe6S,UAAW,SAASxM,GACpD4U,EAAmB7f,KAAK,CAAEgC,MAAOiJ,EAAK/D,GAAIqI,MAAOtE,EAAK1J,SAItD,oBAAC,EAAAkE,SAAD,KACE,yBAAGC,KAAK,IAAIC,QAAS,kBAAM,EAAK/B,SAAS,CAAE4E,QAAQ,MAAnD,eAGCxD,KAAKf,MAAMuE,QACV,oBAAC,UAAD,CAAOf,MAAI,EAACrC,UAAU,0BAA0BgI,QAAS,kBAAM,EAAKxJ,SAAS,CAAE4E,QAAQ,KAAUyH,WAAS,GACxG,oBAAC,UAAMC,OAAP,CAAc3J,QAAQ,gBACtB,oBAAC,UAAM4J,QAAP,KACE,6BACE,+BACE,4CADF,IAC2BrC,EAAKpB,OAAOrF,aAEvC,+BACE,2CADF,IAC0ByG,EAAKzG,cAIjC,2BAAKjC,UAAU,WACb,2BAAKA,UAAU,kBACb,6BAAOkG,QAAQ,kBAAf,mBACA,6BACExD,KAAK,OACLZ,GAAG,iBACH+V,UAAQ,EACRjb,MAAOgD,KAAKf,MAAMsb,UAClB1V,SAAU7E,KAAKsa,aACf5P,YAAY,qBAIhB,2BAAKtK,UAAU,SACb,6BAAOkG,QAAQ,IAAf,oDACA,+BACA,oBAAC,UAAD,CACE/J,KAAK,aACLuO,QAAS+P,EACTpC,eAAe,cACfC,cAAc,YACdlS,SAAUxG,KAAKf,MAAMwb,gBACrB9B,MAAO7B,EACPjS,SAAU7E,KAAKwa,wBAKvB,oBAAC,UAAM3D,QAAP,KACE,8BAAQzW,UAAU,qBAAqBO,QAAS,kBAAM,EAAK/B,SAAS,CAAE4E,QAAQ,MAA9E,YAGA,8BAAQpD,UAAU,oBAAoBO,QAASX,KAAKqI,UAApD,kB,uBA9GL,EAAAnF,YAAc,U,IA8HVkT,E,YAGX,WAAY5X,GAAyB,wBACnC,wBAAMA,KAQRqG,SAAW,SAAC/F,GACV,EAAKF,SAAS,CAAEE,aAGlB,EAAAuJ,SAAW,WAAK,MACe,EAAKlH,QAA1BzC,EADM,EACNA,KAAMD,EADA,EACAA,WACNqK,EAAS,EAAKtK,MAAdsK,KAER5K,EAAE4C,QAAQY,+BAA+B,0BAEzCxD,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKC,WAAtB,gCAAgE,CAC5Emb,QAAShS,EAAK5G,GACdoL,aAAc,EAAKrO,MAAMH,UACxB8C,KAAK,SAACC,GACFA,EAAIC,YACPpD,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOE,MAAO,EAC/D/D,EAAKoK,EAAKpB,OAAOA,OAAOnF,OAAOG,MAAMoG,EAAKpB,OAAOnF,OAAOG,MAAMoG,EAAKvG,OAAO+K,aACxEzL,EAAIG,SAASsL,aACf7O,EAAWC,GACXR,EAAEC,YAEF,EAAKS,SAAS,CAAE4E,QAAQ,QA3B5B,EAAKvE,MAAQ,CACXuE,QAAQ,EACR1E,QAASM,EAAEwb,MAAMpc,EAAMsK,KAAKwE,aAAc,uBALT,E,WAHH,EAAArK,e,oCAsC5B,WACI6F,EAAS9I,KAAKxB,MAAdsK,KAEAhK,EAAYkB,KAAKmB,QAAjBrC,QAEFgM,EAA8C,GAKpD,OAJA1L,EAAEoZ,QAAQ1Z,EAAS,SAASmH,GAC1B6E,EAAQ9P,KAAK,CAAEgC,MAAOiJ,EAAK/D,GAAIqI,MAAOtE,EAAK1J,SAI3C,oBAAC,EAAAkE,SAAD,KACE,yBAAGC,KAAK,IAAIC,QAAS,kBAAM,EAAK/B,SAAS,CAAE4E,QAAQ,MAAnD,mBAGCxD,KAAKf,MAAMuE,QACV,oBAAC,UAAD,CAAOf,MAAI,EAACrC,UAAU,0BAA0BgI,QAAS,kBAAM,EAAKxJ,SAAS,CAAE4E,QAAQ,KAAUyH,WAAS,GACxG,oBAAC,UAAMC,OAAP,CAAc3J,QAAQ,gBACtB,oBAAC,UAAM4J,QAAP,KACE,+BACE,+BACE,4CADF,IAC2BrC,EAAKpB,OAAOrF,aAEvC,+BACE,2CADF,IAC0ByG,EAAKzG,cAIjC,2BAAKjC,UAAU,WACb,2BAAKA,UAAU,SACb,6BAAOkG,QAAQ,IAAf,iDACA,+BACA,oBAAC,UAAD,CACE/J,KAAK,aACLuO,QAASA,EACT2N,eAAe,cACfC,cAAc,YACdlS,SAAUxG,KAAKf,MAAMH,QACrB6Z,MAAO7B,EACPjS,SAAU7E,KAAK6E,cAKvB,oBAAC,UAAMgS,QAAP,KACE,8BAAQzW,UAAU,qBAAqBO,QAAS,kBAAM,EAAK/B,SAAS,CAAE4E,QAAQ,MAA9E,YAGA,8BAAQpD,UAAU,oBAAoBO,QAASX,KAAKqI,UAApD,kB,wBArFL,EAAAnF,YAAc,W,6GCroBvB,WAEA,WACA,YACA,YACA,YACA,YAEA,U,umDAIA,IA+C2BxE,EACrBqc,EAhDAC,EAAa,SAAC,GAAyE,IAAvEtD,EAAuE,EAAvEA,SACpB,OACE,2BAAKtX,UAAU,+BACb,0BAAIA,UAAU,sBAAd,gEACA,oBAAC,UAAD,CAAMkX,SAAO,EAACC,UAAQ,EAACC,QAAS,EAAG/T,UAAU,UAC3C,oBAAC,UAAKgU,OAAN,KACE,2BAAKrX,UAAU,sDAAsDO,QAAS,kBAAM+W,EAAS,gBAC3F,2BAAKtX,UAAU,oBAAf,2BAGJ,oBAAC,UAAKqX,OAAN,KACE,2BAAKrX,UAAU,sDAAsDO,QAAS,kBAAM+W,EAAS,aAC3F,2BAAKtX,UAAU,oBAAf,4BA0EN6a,EAAuB,SAACC,EAAele,GAC3C,IAAIme,EA3BoB,WACxB,IAAIC,EAAc5S,SAAS6S,OAAOtd,MAAM,GACtCod,EAAc,GAOhB,OALAC,EAAYpG,QAAQ,qBAAsB,SAAS5V,EAAG9B,EAAKN,GAEzD,OADAme,EAAO7d,GAAON,EACPoC,IAGF+b,EAkBMG,GAETH,EAAOD,IAAUle,IACnBme,EAAOD,GAASle,EAlBM,SAACme,GACzB,IACE7d,EACAN,EAFEue,EAAQ,GAIZ,IAAKje,KAAO6d,EACLA,EAAOtgB,eAAeyC,KAC3BN,EAAQme,EAAO7d,GACfie,EAAMvgB,KAAKsC,EAAM,IAAMN,IAGzBwL,SAAS6S,OAASE,EAAM/J,KAAK,KAQ3BgK,CAAkBL,KAIhBM,GAhDqB/c,EAgDee,IAAIC,KAAKE,eAAe8I,MA/C5DqS,EAAkB,GACtB3b,EAAEC,KAAKX,EAAM,SAACqD,GACZ3C,EAAEC,KAAK0C,EAAK4G,SAAU,SAACC,GACrBxJ,EAAEC,KAAKuJ,EAAQC,eAAgB,SAACC,GAC9BiS,EAAM/f,KAAK8N,EAAK1G,YAKf2Y,GAqDHpU,EAAe,SAAfA,EAAgB,GAA0C,IAAxCV,EAAwC,EAAxCA,KAAM,EAAkC,EAAlCyV,UAAkC,KAC1B,IAAA9U,WAAS,GADiB,GACtDC,EADsD,KAC3CC,EAD2C,KAyBxDQ,EAjBe,SAAfqU,EAAgB1V,GACpB,IAAIqB,GAAa,EAajB,OAXIrB,EAAKvD,MACPtD,EAAEC,KAAK4G,EAAKvD,MAAO,SAASwE,GAE1B,GADAI,EAAaA,GAAcqU,EAAazU,GAEtC,OAAO,IAGFjB,EAAK7D,OAAShD,EAAEwc,SAASH,EAAiBxV,EAAK7D,QACxDkF,GAAa,GAGRA,EAGUqU,CAAa1V,GAEhC,OACE,0BAAI3I,IAAK2I,EAAK/D,GAAI9B,WAAW,aAAG,mBAAoB6F,EAAKnD,OACvD,2BAAK1C,UAAU,yBACb,yBAAGM,KAAK,IAAIC,QA3BF,SAACC,GACfA,EAAGC,iBACHiG,GAAcD,KA0BR,4BAAMzG,UAAU,aAAa6F,EAAK5D,cAEnCiF,GACC,oBAAC,UAAD,CACEyD,QACE,4BAAM3K,UAAU,kCACd,4BAAMA,UAAU,oBAGpBmB,QAAQ,4EACRyJ,GAAG,QACH5K,UAAU,mBAIhB,0BAAIA,WAAW,aAAG,uBAAwByG,EAAY,OAAS,OAC5DzH,EAAE2F,IAAIkB,EAAKvD,MAAgB,SAACwE,GAE3B,OADAA,EAAQQ,OAASzB,EACM,QAAhBiB,EAAQpE,KACb,oBAAC6N,EAAD,CACErT,IAAK4J,EAAQhF,GACb+D,KAAMiB,EACNwU,UAAW,SAACnV,GAAD,OAAsB,EAAUW,EAASX,MAGtD,oBAACI,EAAD,CAAcrJ,IAAK4J,EAAQhF,GAAI+D,KAAMiB,EAASwU,UAAW,SAQ/D/K,EAAe,SAAC,GAA6F,IAA3F1K,EAA2F,EAA3FA,KAAMyV,EAAqF,EAArFA,UAAqF,KACjF,IAAA9U,WAAS,GADwE,GAC3GiV,EAD2G,KAChGC,EADgG,KAE3GC,EAAa3c,EAAEwc,SAASH,EAAiBxV,EAAK7D,MAM9C0M,GAAc,aAClB,wBACAiN,IAAeF,EAAY,oBAAsB,KACjDA,EAAY,WAAa,MAG3B,OACE,0BAAIve,IAAK2I,EAAK/D,GAAI9B,UAAW0O,GAC3B,2BAAK1O,UAAU,yBACb,6BAAOkG,QAAO,oBAAeL,EAAK/D,KAChC,6BACEY,KAAK,WACLZ,GAAE,oBAAe+D,EAAK/D,IACtB9B,UAAU,WACVmG,QAASsV,EACThX,SApBe,SAACjE,GACxBkb,EAAYlb,EAAGiD,OAAe0C,SAC9BmV,EAAW9a,EAAGiD,OAAe0C,YAoBvB,4BAAMnG,UAAU,aACb6F,EAAK5D,YACL0Z,GACC,4BAAM3b,UAAU,wBAAwBgD,MAAO,CAAEuC,WAAY,IAA7D,iBAqBRqW,E,YAAN,qC,sCAGE/c,MAAkC,CAChCgd,WAAW,EACXC,cAAe,IAiBjB,EAAAC,oBAAsB,SAAClW,EAA2B4V,GAAsB,IAChEK,EAAkB,EAAKjd,MAAvBid,cACFL,EACI5V,EAAK/D,MAAMga,GACfA,EAAclhB,KAAKiL,EAAK/D,IAG1Bga,EAAgB9c,EAAEqG,OAAOyW,EAAe,SAASxG,GAC/C,OAAOA,GAAWzP,EAAK/D,KAI3B,EAAKtD,SAAS,CAAEsd,kBAChB,EAAK1d,MAAMkZ,SAASwE,IAGtB,EAAA7T,SAAW,WACTnK,EAAE4C,QAAQY,+BAA+B,yBAEzC,IAAI0a,EAAa,CACfC,UAAW,OACXC,UAAW,EAAK9d,MAAM+d,QACtB7Z,MAAO,EAAKzD,MAAMid,eAEpBhe,EAAEqB,KAAKC,QAAQ,YAAD,OAAaC,IAAIC,KAAKE,eAAe2D,SAASrB,GAA9C,eAA+Dka,GAC1Exa,KAAK,SAACC,GACAA,EAAIC,YACPmZ,EAAqB,QAAS,EAAKzc,MAAM+d,SACzC/T,SAASC,YAGZ7F,KAAK,WACJ1E,EAAEC,eAtDV,E,WAAkC,EAAA2B,W,+CAS9BE,KAAKwc,oB,wCAGQ,WACyB,MAAlCR,EAAoBS,aACtBzc,KAAKpB,SAAS,CAAEqd,WAAW,IAC3B/d,EAAE2R,QAAQrQ,QAAQ,YAAD,OAAaC,IAAIC,KAAKE,eAAe2D,SAASrB,GAA9C,uBAAsEN,KAAK,SAACC,GAC3Fma,EAAoBS,WA3NH,SAAC/d,GAwBxB,OAvBeU,EAAE2F,IAAIrG,EAAM,SAACqD,GAC1B,MAAO,CACLG,GAAIH,EAAKG,GACTG,YAAaN,EAAKM,YAClBS,KAAM,QACNJ,MAAOtD,EAAE2F,IAAIhD,EAAK4G,SAAU,SAACC,GAC3B,MAAO,CACL1G,GAAI0G,EAAQ1G,GACZG,YAAauG,EAAQvG,YACrBS,KAAM,WACNJ,MAAOtD,EAAE2F,IAAI6D,EAAQC,eAAgB,SAACC,GACpC,MAAO,CACL5G,GAAI4G,EAAK5G,GACTG,YAAayG,EAAKzG,YAClBD,KAAM0G,EAAK1G,KACXU,KAAM,gBA2MqB4Z,CAAiB7a,EAAIG,UACtD,EAAKpD,SAAS,CAAEqd,WAAW,S,mCAyCvB,WACR,OACE,0BAAI7b,UAAU,6DACXhB,EAAE2F,IAAIiX,EAAoBS,WAAY,SAAC1a,GACtC,OACE,oBAAC4E,EAAD,CAAcrJ,IAAG,oBAAeyE,EAAKe,KAApB,YAA4Bf,EAAKG,IAAM+D,KAAMlE,EAAM2Z,UAAW,EAAKS,2B,+BAQ5F,OACE,2BAAK/b,UAAU,yDACb,0BAAIA,UAAU,sBAAd,iEACCJ,KAAKf,MAAMgd,UACV,2BAAK7b,UAAU,aAAagD,MAAO,CAAEyS,UAAW,MAC9C,oBAAC,UAAD,CAAQtK,QAAM,EAACoR,UAAQ,GACrB,oBAAC,UAAD,CAAQA,UAAQ,EAACpb,QAAQ,wBAI7B,+BACGvB,KAAK4c,aACN,2BAAKxc,UAAU,eACb,oBAAC,UAAD,CACE2K,QACE,8BACEpK,QAASX,KAAKqI,SACdjI,UAAU,6BACVqG,SAA6C,GAAnCzG,KAAKf,MAAMid,cAAcxhB,QAHrC,WAQF6G,QAAQ,iDACRD,OAAO,iCACPmF,SAAUzG,KAAKf,MAAMid,cAAcxhB,OAAS,EAC5C0F,UAAU,eACV4K,GAAG,WAGP,2BAAK5K,UAAU,mB,KApGlB,EAAAqc,WAAkB,K,IAuHdxG,E,YAAb,qC,sCACEhX,MAAgC,CAC9BuE,QAAQ,EACR0E,KAAM,EACN2U,eAAgB,aAChBC,cAAe,IAGjB,EAAA1U,QAAU,WACR,EAAKxJ,SAAS,CAAE4E,QAAQ,KAG1B,EAAAuZ,eAAiB,SAACF,GAChB,EAAKje,SAAS,CAAEsJ,KAAM,EAAG2U,oBAG3B,EAAAG,cAAgB,SAACF,GACf,EAAKle,SAAS,CAAEke,mBAjBpB,E,WAAuC,EAAAhd,W,4CAqBnC,OAAQE,KAAKf,MAAMiJ,MACjB,KAAK,EACH,OAAO,oBAAC8S,EAAD,CAAYtD,SAAU1X,KAAK+c,iBACpC,KAAK,EACH,OAAQ/c,KAAKf,MAAM4d,gBACjB,IAAK,aACH,OAAO,oBAACb,EAAD,CAAqBO,QAASvc,KAAKxB,MAAMoQ,MAAM1M,GAAIwV,SAAU1X,KAAKgd,oB,oCAKxE,IACDpO,EAAU5O,KAAKxB,MAAfoQ,MAEJiO,EAAiB,GACrB,OAAQ7c,KAAKf,MAAM4d,gBACjB,IAAK,aACHA,EAAiB,sBAIrB,OACE,oBAAC,UAAD,CAAOpa,MAAI,EAACrC,UAAU,8BAA8BgI,QAASpI,KAAKoI,QAAS6C,WAAS,EAACgS,oBAAoB,GACvG,oBAAC,UAAM/R,OAAP,CAAc3J,QAAO,+BAA0Bsb,KAC/C,oBAAC,UAAM1R,QAAP,KACE,6BACE,4CADF,IAC2ByD,EAAMvM,aAGhCrC,KAAKkd,qB,+BAMR,WACJ,MAAgD,KAA5Czd,IAAIC,KAAKE,eAAe2D,SAASoU,QAEjC,oBAAC,UAAD,CACErW,OAAO,uBACPC,QAAQ,gEACRwJ,QAAS,yBAAG3K,UAAU,8BAAb,gCACTkC,SAAS,cACTpC,KAAK,QACLE,UAAU,kBAKZ,oBAAC,EAAAK,SAAD,KACE,yBACEC,KAAK,IACLC,QAAS,SAACC,GACRA,EAAGC,iBACH,EAAKjC,SAAS,CAAE4E,QAAQ,MAJ5B,gCAUCxD,KAAKf,MAAMuE,QAAUxD,KAAKmd,mB,4DClb/B,IAAWnc,E,oHAAjB,SAAiBA,GACC,EAAAqF,YAAhB,SAA4BnE,GAC1B,OAAOzC,IAAIC,KAAKE,eAAeqF,OAAO/C,IAGxB,EAAAiE,cAAhB,SAA8BjE,GAC5B,OAAO9C,EAAEmK,KAAK9J,IAAIC,KAAKE,eAAed,QAAS,CAAEoD,QAGnC,EAAAjB,gBAAhB,SAAgBA,EAAgBvC,EAAW1B,GACzCoC,EAAEC,KAAKX,EAAM,SAACuH,QACa,IAAdA,EAAKxD,OACdwD,EAAKxD,KAAOzF,QAGY,IAAfiJ,EAAKvD,OACdzB,EAAgBgF,EAAKvD,MAAO1F,MAhBpC,CAAiBgE,IAA0B,6BAA1BA,EAA0B","file":"proyecto__plan_auditoria.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonpwebpackLibs\"] = window[\"webpackJsonpwebpackLibs\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([222,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = React;","module.exports = ReactDOM;","import { render } from 'react-dom'\r\nimport App from './App'\r\n\r\n$.unblockUI()\r\n\r\nrender(<App />, document.getElementById('root'))\r\n","import { Component } from 'react'\r\n\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\nimport { AppTopBar, AppBottomBar } from './AppBars'\r\nimport AppTree from './AppTree'\r\n\r\nimport cx from 'classnames'\r\n\r\ndeclare var app: any\r\n\r\ntype AppState = {\r\n  tree: any\r\n  filters: any\r\n  visitas: any\r\n}\r\n\r\nexport default class App extends Component<{}, AppState> {\r\n  constructor(props: {}) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      tree: null,\r\n      visitas: app.vars.plan_auditoria.visitas,\r\n      filters: Object.assign({}, app.vars.plan_auditoria.settings.filters)\r\n    }\r\n  }\r\n\r\n  updateTree = (tree: any, cb?: () => void) => {\r\n    this.setState(() => {\r\n      return { tree }\r\n    }, cb)\r\n  }\r\n\r\n  updateVisitas = (visitas: any, cb?: () => void) => {\r\n    this.setState(() => {\r\n      return { visitas }\r\n    }, cb)\r\n  }\r\n\r\n  updateFilters = (newfilters: any) => {\r\n    this.setState(\r\n      (state: AppState) => {\r\n        let filters = newfilters === null ? {} : Object.assign({}, state.filters, newfilters)\r\n\r\n        _.each(filters, (value: string, filter) => {\r\n          if (value === '') {\r\n            delete filters[filter]\r\n          }\r\n        })\r\n\r\n        return { filters }\r\n      },\r\n      () => {\r\n        let filters: any = {}\r\n        _.each(this.state.filters, (value, key) => {\r\n          if (value && value !== '') {\r\n            filters[key] = value\r\n          }\r\n        })\r\n\r\n        $.post(url_for('proyecto/' + app.vars.idproyecto + '/master_data/setfilters'), { filters })\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const contextValue = {\r\n      tree: this.state.tree,\r\n      visitas: this.state.visitas,\r\n      filters: this.state.filters,\r\n      updateTree: this.updateTree,\r\n      updateFilters: this.updateFilters,\r\n      updateVisitas: this.updateVisitas\r\n    }\r\n\r\n    const appClasses = cx('app-body', _.size(this.state.filters) > 0 ? 'has-filters' : null)\r\n\r\n    return (\r\n      <PlanAuditoriaContext.Provider value={contextValue}>\r\n        <div className={appClasses}>\r\n          <AppTopBar />\r\n          <AppTree />\r\n          <AppBottomBar />\r\n        </div>\r\n      </PlanAuditoriaContext.Provider>\r\n    )\r\n  }\r\n}\r\n","import { Component, Fragment, SyntheticEvent, useContext, PureComponent, createRef } from 'react'\r\n\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\nimport { AppFilters, AppFilterMessage } from './AppFilters'\r\nimport { ProyectoPlanAuditoriaUtils } from './utils'\r\nimport { ModalPasoMassAssign } from './ModalPasoAssign'\r\nimport { AppActionVisitasManage } from './ModalVisitasManage'\r\n\r\ndeclare var app: any\r\n\r\nconst VisibilityLinkActions = () => {\r\n  const { tree, updateTree } = useContext(PlanAuditoriaContext)\r\n\r\n  const onClickExpand = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    $.blockUI()\r\n    setTimeout(() => {\r\n      ProyectoPlanAuditoriaUtils.changeOpenToAll(tree, true)\r\n      updateTree(tree)\r\n      $.unblockUI()\r\n    }, 100)\r\n  }\r\n\r\n  const onClickCollapse = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    ProyectoPlanAuditoriaUtils.changeOpenToAll(tree, false)\r\n    updateTree(tree)\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <a href='#' className='expandall' onClick={onClickExpand}>\r\n        Expandir todo\r\n      </a>\r\n      |\r\n      <a href='#' className='collapseall' onClick={onClickCollapse}>\r\n        Contraer todo\r\n      </a>\r\n    </Fragment>\r\n  )\r\n}\r\n\r\nclass AppActionCreateFase extends PureComponent {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onClick = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { tree, updateTree } = this.context\r\n\r\n    const prompt = bootbox.prompt(\r\n      { header: 'Nueva Fase', content: '<div>Escriba el nombre de la fase que desea crear.</div>' },\r\n      'Cancelar',\r\n      'Crear',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Creando Fase... Por Favor Espere'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/fase`), { fase_name: r })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              const fase = res.response.record\r\n              tree.push({\r\n                id: fase.id_master_data_fase,\r\n                code: fase.code,\r\n                descripcion: fase.descripcion,\r\n                position: fase.position,\r\n                index: tree.length,\r\n                sortIndex: tree.length,\r\n                open: true,\r\n                items: []\r\n              })\r\n              updateTree(tree)\r\n              prompt.modal('hide')\r\n            }\r\n\r\n            $.unblockUI()\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error ocurrió al intentar crear la fase.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      ''\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <a href='#' onClick={this.onClick}>\r\n        Crear Fase\r\n      </a>\r\n    )\r\n  }\r\n}\r\n\r\nclass AppTopBarActions extends PureComponent {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  render() {\r\n    const { tree } = this.context\r\n    if (tree === null) {\r\n      return (\r\n        <div className='pull-right' style={{ position: 'relative' }}>\r\n          <a className='btn btn-mini dropdown-toggle btn-new pull-right' data-toggle='dropdown' href='#'>\r\n            <div className='ui mini active inline loader' />\r\n          </a>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    const is_editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    return (\r\n      <div className='pull-right' style={{ position: 'relative' }}>\r\n        <a className='btn btn-mini dropdown-toggle btn-new pull-right' data-toggle='dropdown' href='#'>\r\n          Opciones\r\n        </a>\r\n        <ul className='dropdown-menu pull-right' style={{ textAlign: 'left' }}>\r\n          {is_editable &&\r\n          user_has_role_permission('fase_create') && (\r\n            <li>\r\n              <AppActionCreateFase />\r\n            </li>\r\n          )}\r\n          {is_editable &&\r\n          user_has_role_permission('visita_edit') && (\r\n            <li>\r\n              <AppActionVisitasManage />\r\n            </li>\r\n          )}\r\n          {is_editable &&\r\n          user_has_role_permission('paso_asignar_usuario') && (\r\n            <li>\r\n              <ModalPasoMassAssign />\r\n            </li>\r\n          )}\r\n          <li>\r\n            <a href={url_for(`proyecto/${app.vars.idproyecto}/master_data?sf_format=pdf`)} target='_blank'>\r\n              Exportar como PDF\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class AppTopBar extends PureComponent {\r\n  scrollboxRef = createRef<HTMLDivElement>()\r\n\r\n  componentDidMount() {\r\n    const $stickyBox = $(this.scrollboxRef.current)\r\n    const stickyBoxTop = $stickyBox.offset().top\r\n    $(window).scroll(function() {\r\n      var y = $(this).scrollTop()\r\n      if (y >= stickyBoxTop) {\r\n        $stickyBox.addClass('fixed')\r\n      } else {\r\n        $stickyBox.removeClass('fixed')\r\n      }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className='topbar sticky-scroll-box' ref={this.scrollboxRef}>\r\n        <div className='ui grid'>\r\n          <div className='five wide column'>\r\n            <VisibilityLinkActions />\r\n          </div>\r\n          <div className='nine wide column'>\r\n            <AppFilters />\r\n          </div>\r\n          <div className='two wide column'>\r\n            <AppTopBarActions />\r\n          </div>\r\n        </div>\r\n        <AppFilterMessage />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class AppBottomBar extends Component {\r\n  render() {\r\n    return (\r\n      <div className='bottombar'>\r\n        <VisibilityLinkActions />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { Component, SyntheticEvent, useContext } from 'react'\r\n\r\nimport cx from 'classnames'\r\n\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\nimport { ProyectoPlanAuditoriaUtils } from './utils'\r\n\r\ndeclare var app: any\r\n\r\nexport class AppFilters extends Component {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  setFilter(filter: 'visita' | 'status' | 'asignado', value: string) {\r\n    const { tree, updateFilters, updateTree } = this.context\r\n    updateFilters({ [filter]: value })\r\n\r\n    $.blockUI()\r\n    setTimeout(() => {\r\n      ProyectoPlanAuditoriaUtils.changeOpenToAll(tree, true)\r\n      updateTree(tree)\r\n      $.unblockUI()\r\n    }, 100)\r\n  }\r\n\r\n  renderVisitasFilterChoices() {\r\n    const { filters } = this.context\r\n    const visitas: { id: string; name: string }[] = app.vars.plan_auditoria.visitas\r\n\r\n    const onChange = (ev: SyntheticEvent) => {\r\n      this.setFilter('visita', (ev.target as any).value)\r\n    }\r\n\r\n    return (\r\n      <select\r\n        className={cx('raw-select input-medium', filters.visita ? 'active' : null)}\r\n        id='master_data_filters_visita'\r\n        style={{ maxWidth: 150 }}\r\n        onChange={onChange}\r\n        value={filters.visita || ''}\r\n      >\r\n        <option value=''>- Visita -</option>\r\n        {_.map(visitas, (visita) => {\r\n          return (\r\n            <option key={visita.id} value={visita.id}>\r\n              {visita.name}\r\n            </option>\r\n          )\r\n        })}\r\n      </select>\r\n    )\r\n  }\r\n\r\n  renderStatusFilterChoices() {\r\n    const { filters } = this.context\r\n    const onChange = (ev: SyntheticEvent) => {\r\n      this.setFilter('status', (ev.target as any).value)\r\n    }\r\n\r\n    const statuses = [ 'Sin asignar', 'Asignado', 'En proceso', 'Completado', 'Revisado', 'Notas Revisión' ]\r\n\r\n    return (\r\n      <select\r\n        className={cx('raw-select input-medium', filters.status ? 'active' : null)}\r\n        id='master_data_filters_status'\r\n        onChange={onChange}\r\n        value={filters.status || ''}\r\n      >\r\n        <option value=''>- Estado -</option>\r\n        {_.map(statuses, (status, key) => {\r\n          return (\r\n            <option key={key + 1} value={key + 1}>\r\n              {status}\r\n            </option>\r\n          )\r\n        })}\r\n      </select>\r\n    )\r\n  }\r\n\r\n  renderUsersFilterChoices() {\r\n    const { filters } = this.context\r\n    const equipo: { id: string; fullname: string; user_id: string }[] = app.vars.plan_auditoria.equipo\r\n\r\n    const onChange = (ev: SyntheticEvent) => {\r\n      this.setFilter('asignado', (ev.target as any).value)\r\n    }\r\n\r\n    return (\r\n      <select\r\n        className={cx('raw-select input-medium', filters.asignado ? 'active' : null)}\r\n        id='master_data_filters_asignado'\r\n        style={{ maxWidth: 150 }}\r\n        onChange={onChange}\r\n        value={filters.asignado || ''}\r\n      >\r\n        <option value=''>- Asignado a -</option>\r\n        {_.map(equipo, (user) => {\r\n          return (\r\n            <option key={user.id} value={user.user_id}>\r\n              {user.fullname}\r\n            </option>\r\n          )\r\n        })}\r\n      </select>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id='master_data_filters' className='pull-right'>\r\n        <span className='lb'>Filtrar por: </span>\r\n        {this.renderVisitasFilterChoices()}\r\n        {this.renderStatusFilterChoices()}\r\n        {this.renderUsersFilterChoices()}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport const AppFilterMessage = () => {\r\n  const { filters, updateFilters } = useContext(PlanAuditoriaContext)\r\n\r\n  const hasFilters = _.reject(filters, (value) => value === '' || !value).length > 0\r\n\r\n  if (!hasFilters) {\r\n    return null\r\n  }\r\n\r\n  const onReset = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    updateFilters(null)\r\n  }\r\n\r\n  return (\r\n    <div id='filteralerts' className='alert-2 alert-primary'>\r\n      <span className='icon-info-sign' style={{ marginRight: 3 }} />\r\n      NOTA: La visibilidad de los pasos está afectada por los filtros aplicados.\r\n      <a href='#' className='resetfilters' style={{ marginLeft: 10 }} onClick={onReset}>\r\n        Quitar filtros\r\n      </a>\r\n    </div>\r\n  )\r\n}\r\n","import { Component, useState, SyntheticEvent, createContext, useContext, Fragment } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport Dropdown from 'semantic-ui-react/dist/commonjs/modules/Dropdown/Dropdown'\r\nimport Step from 'semantic-ui-react/dist/commonjs/elements/Step/Step'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\n\r\nimport cx from 'classnames'\r\n\r\nimport { ProyectoPlanAuditoriaUtils } from './utils'\r\n\r\ndeclare var app: any\r\n\r\ntype HojaTrabajoTreeItem = {\r\n  id: string\r\n  descripcion: string\r\n  type: string\r\n  selected: boolean\r\n  items: HojaTrabajoTreeItem[] | HojaTrabajoTreeItemVisita[]\r\n  parent: HojaTrabajoTreeItem\r\n}\r\n\r\ntype HojaTrabajoTreeItemVisita = {\r\n  id: string\r\n  type: string\r\n  alias: string\r\n  id_visita: string\r\n  user_id: string\r\n  selected: boolean\r\n  parent: HojaTrabajoTreeItem\r\n}\r\n\r\nconst MasterDataTreeContext = createContext<MasterDataTreeContextType>({\r\n  tree: [],\r\n  updateTree: null,\r\n  filters: { ignore_assigned: false },\r\n  updateFilter: null\r\n})\r\n\r\nconst countPendingForAssign = (item: HojaTrabajoTreeItem) => {\r\n  let assigned = 0,\r\n    total = 0,\r\n    checked = 0\r\n\r\n  if (item.type == 'paso') {\r\n    total = _.size(item.items as HojaTrabajoTreeItemVisita[])\r\n    assigned = _.size(_.reject(item.items as HojaTrabajoTreeItemVisita[], { user_id: null }))\r\n    checked = _.size(_.filter(item.items as HojaTrabajoTreeItemVisita[], { selected: true }))\r\n  } else {\r\n    _.each(item.items, (subitem) => {\r\n      const { assigned: _assigned, checked: _checked, total: _total } = countPendingForAssign(subitem)\r\n\r\n      assigned += _assigned\r\n      checked += _checked\r\n      total += _total\r\n    })\r\n  }\r\n  return { assigned, checked, total }\r\n}\r\n\r\nconst parseTreeToItems = (tree: any[]) => {\r\n  const retval = _.map(tree, (fase): HojaTrabajoTreeItem => {\r\n    return {\r\n      id: fase.id,\r\n      descripcion: fase.descripcion,\r\n      type: 'phase',\r\n      selected: false,\r\n      parent: null,\r\n      items: _.map(fase.Subfases, (subfase: any): HojaTrabajoTreeItem => {\r\n        return {\r\n          id: subfase.id,\r\n          descripcion: subfase.descripcion,\r\n          type: 'subphase',\r\n          selected: false,\r\n          parent: null,\r\n          items: _.map(subfase.MasterDataPaso, (paso: any): HojaTrabajoTreeItem => {\r\n            return {\r\n              id: paso.id,\r\n              descripcion: paso.descripcion,\r\n              type: 'paso',\r\n              selected: false,\r\n              parent: null,\r\n              items: _.map(paso.MasterDataPasoHasProyectoVisita, (paso_visita: any): HojaTrabajoTreeItemVisita => {\r\n                return {\r\n                  id: paso_visita.id,\r\n                  type: 'pasovisita',\r\n                  alias: paso_visita.visita_alias,\r\n                  id_visita: paso_visita.id_proyecto_visita,\r\n                  user_id: paso_visita.id_usuario_asignado,\r\n                  parent: null,\r\n                  selected: false\r\n                }\r\n              })\r\n            }\r\n          })\r\n        }\r\n      })\r\n    }\r\n  })\r\n\r\n  return retval\r\n}\r\n\r\nconst TreeItemVisita = ({ item }: { item: HojaTrabajoTreeItemVisita }) => {\r\n  const visita = _.size(item.alias) ? { name: item.alias } : ProyectoPlanAuditoriaUtils.getVisitaById(item.id_visita)\r\n  const user = ProyectoPlanAuditoriaUtils.getUserById(item.user_id)\r\n\r\n  const { updateTree, filters } = useContext(MasterDataTreeContext)\r\n\r\n  const onToggleCheckbox = () => {\r\n    item.selected = !item.selected\r\n    updateTree(item)\r\n  }\r\n\r\n  return (\r\n    <li key={item.id} className={cx('methodology-item visita', user ? 'assigned' : 'unassigned')}>\r\n      <label htmlFor={`massassign-paso-visita-${item.id}`}>\r\n        <input\r\n          type='checkbox'\r\n          id={`massassign-paso-visita-${item.id}`}\r\n          checked={item.selected}\r\n          className='checkbox'\r\n          disabled={filters.ignore_assigned && !!item.user_id}\r\n          onChange={onToggleCheckbox}\r\n        />\r\n        <span className='item-name'>{visita ? visita.name : '-'}</span>\r\n        <span className={cx('user-assigned', user ? 'label label-success' : '')}>{user ? user.sigla : ''}</span>\r\n      </label>\r\n    </li>\r\n  )\r\n}\r\n\r\nconst TreeItemFase = ({ item }: { item: HojaTrabajoTreeItem }) => {\r\n  const [ collapsed, setCollapsed ] = useState(true)\r\n\r\n  const onClick = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    setCollapsed(!collapsed)\r\n  }\r\n\r\n  const { updateTree, filters } = useContext(MasterDataTreeContext)\r\n\r\n  const onToggleCheckbox = () => {\r\n    item.selected = !item.selected\r\n    updateTree(item)\r\n\r\n    if (filters.ignore_assigned && hasUncheckableItems(item)) {\r\n      $.pnotify({\r\n        title: 'Advertencia',\r\n        text: 'Este elemento contiene pasos/visitas que no pueden ser seleccionados debido que ya fueron asignados. ',\r\n        delay: 1000 * 2\r\n      })\r\n    }\r\n  }\r\n\r\n  const { assigned, checked, total } = countPendingForAssign(item)\r\n  const hasPending = total > 0 && assigned < total\r\n\r\n  return (\r\n    <li key={item.id} className={cx('methodology-item', item.type)}>\r\n      <div className='methodology-item-head'>\r\n        <a href='#' onClick={onClick}>\r\n          <span className='item-name'>{item.descripcion}</span>\r\n        </a>\r\n        <input\r\n          type='checkbox'\r\n          checked={item.selected}\r\n          title={'Seleccionar todos'}\r\n          className='checkbox'\r\n          disabled={_.size(item.items as any[]) == 0}\r\n          onChange={onToggleCheckbox}\r\n        />\r\n\r\n        {checked > 0 && (\r\n          <strong className='checked-counter pull-right' title='# Hojas de Trabajo seleccionadas'>\r\n            ({checked})\r\n          </strong>\r\n        )}\r\n\r\n        <span\r\n          className={cx('badge badge-counter', hasPending ? 'badge-important' : 'badge-success')}\r\n          title='# Hojas de trabajo con usuario responsable asignado / # Hojas de trabajo en total'\r\n        >\r\n          {assigned} / {total}\r\n        </span>\r\n      </div>\r\n      <ul className={cx('methodology collapse', collapsed ? 'hide' : 'in')}>\r\n        {_.map(item.items as any[], (subitem) => {\r\n          subitem.parent = item\r\n          return subitem.type == 'pasovisita' ? (\r\n            <TreeItemVisita key={subitem.id} item={subitem} />\r\n          ) : (\r\n            <TreeItemFase key={subitem.id} item={subitem} />\r\n          )\r\n        })}\r\n      </ul>\r\n    </li>\r\n  )\r\n}\r\n\r\nconst HojaTrabajoTree = () => {\r\n  return (\r\n    <MasterDataTreeContext.Consumer>\r\n      {({ tree }) => (\r\n        <ul className='methodology checkbox-list methodology-all nav nav-stacked'>\r\n          {_.map(tree, (fase: HojaTrabajoTreeItem) => {\r\n            return <TreeItemFase key={`tree-item-${fase.type}-${fase.id}`} item={fase} />\r\n          })}\r\n        </ul>\r\n      )}\r\n    </MasterDataTreeContext.Consumer>\r\n  )\r\n}\r\n\r\nconst Filters = () => {\r\n  return (\r\n    <MasterDataTreeContext.Consumer>\r\n      {({ filters, updateFilter }) => (\r\n        <div className='filtersbar'>\r\n          <div className='filters'>\r\n            <label>\r\n              <input\r\n                type='checkbox'\r\n                checked={filters.ignore_assigned}\r\n                onChange={(ev) => updateFilter({ ignore_assigned: ev.target.checked })}\r\n              />\r\n              Excluir pasos ya asignados\r\n            </label>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </MasterDataTreeContext.Consumer>\r\n  )\r\n}\r\n\r\nconst hasUncheckableItems = (item: HojaTrabajoTreeItem) => {\r\n  if (item.type == 'paso') {\r\n    return _.some(item.items, (subitem) => subitem.user_id != null)\r\n  } else {\r\n    let found = false\r\n    _.each(item.items, (subitem) => {\r\n      if (hasUncheckableItems(subitem)) {\r\n        found = true\r\n        return true\r\n      }\r\n    })\r\n    return found\r\n  }\r\n}\r\n\r\ntype MasterDataTreeContextType = {\r\n  tree: HojaTrabajoTreeItem[]\r\n  filters: HojaTrabajoFilters\r\n  updateTree: (item: any) => void\r\n  updateFilter: (filter: any) => void\r\n}\r\n\r\ntype ModalPasoMassAssignState = {\r\n  open: boolean\r\n  step: number\r\n  user_id: string\r\n  tree: HojaTrabajoTreeItem[]\r\n  filters: HojaTrabajoFilters\r\n  pasosChecked: string[]\r\n}\r\n\r\ntype HojaTrabajoFilters = {\r\n  ignore_assigned: boolean\r\n}\r\n\r\nexport class ModalPasoMassAssign extends Component<{}, ModalPasoMassAssignState> {\r\n  constructor(props: {}) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      open: false,\r\n      step: 1,\r\n      user_id: null,\r\n      tree: null,\r\n      filters: { ignore_assigned: false },\r\n      pasosChecked: []\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    this.setState({\r\n      tree: parseTreeToItems(app.vars.plan_auditoria.fases)\r\n    })\r\n  }\r\n\r\n  onSelectUser = (ev: React.SyntheticEvent, data: any) => {\r\n    this.setState({ user_id: data.value })\r\n  }\r\n\r\n  onClickToContinueToStep2 = () => {\r\n    if (!this.state.user_id) {\r\n      bootbox.alert('Seleccione un usuario antes de continuar.')\r\n      return\r\n    }\r\n\r\n    this.setState({ step: 2 })\r\n  }\r\n\r\n  updateTree(item: any) {\r\n    this.setState((state) => {\r\n      let tree = Object.assign({}, state.tree)\r\n\r\n      let parents = []\r\n      let current = item\r\n\r\n      while (current.parent) {\r\n        parents.push(current.parent)\r\n        current = current.parent\r\n      }\r\n\r\n      let tree_tmp = tree\r\n      while (parents.length > 0) {\r\n        current = parents.pop()\r\n        let _item = _.find(tree_tmp, { id: current.id })\r\n        tree_tmp = _item.items as HojaTrabajoTreeItem[]\r\n      }\r\n\r\n      let found = _.find(tree_tmp, { id: item.id })\r\n      found.selected = item.selected\r\n\r\n      if (found.items) {\r\n        this.setItemsChecked(found.items, found.selected)\r\n      }\r\n\r\n      this.fixIncompletedCheckedItem(tree)\r\n\r\n      const pasosChecked = this.findPasosChecked(tree)\r\n\r\n      return { tree, pasosChecked }\r\n    })\r\n  }\r\n\r\n  updateFilter(filter: any) {\r\n    this.setState(\r\n      (state) => {\r\n        let filters = Object.assign({}, state.filters, filter)\r\n\r\n        return { filters }\r\n      },\r\n      () => {\r\n        let tree = Object.assign({}, this.state.tree)\r\n        this.refreshItemsChecked()\r\n        this.fixIncompletedCheckedItem(tree)\r\n        this.setState({ tree })\r\n      }\r\n    )\r\n  }\r\n\r\n  setItemsChecked(items: any[], checked: boolean = true) {\r\n    _.each(items, (item) => {\r\n      item.selected = checked && this.isItemCheckable(item)\r\n      if (item.items) {\r\n        this.setItemsChecked(item.items, checked)\r\n      }\r\n    })\r\n  }\r\n\r\n  findPasosChecked(items: HojaTrabajoTreeItem[]) {\r\n    let pasosChecked: string[] = []\r\n    _.each(items, (item) => {\r\n      if (item.type == 'pasovisita') {\r\n        if (item.selected) {\r\n          pasosChecked.push(item.id)\r\n        }\r\n      } else {\r\n        pasosChecked = _.union(pasosChecked, this.findPasosChecked(item.items as HojaTrabajoTreeItem[]))\r\n      }\r\n    })\r\n\r\n    return pasosChecked\r\n  }\r\n\r\n  isItemCheckable(item: any) {\r\n    if (item.type == 'pasovisita' && item.user_id && this.state.filters.ignore_assigned) {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  refreshItemsChecked() {\r\n    const refreshItems = (items: any[]) => {\r\n      _.each(items, (item) => {\r\n        if (item.type == 'pasovisita') {\r\n          item.selected = item.selected && this.isItemCheckable(item)\r\n        } else if (item.items) {\r\n          refreshItems(item.items)\r\n        }\r\n      })\r\n    }\r\n\r\n    refreshItems(this.state.tree)\r\n  }\r\n\r\n  fixIncompletedCheckedItem(items: any) {\r\n    const checkChildren = (items: any) => {\r\n      _.each(items, (item) => {\r\n        if (!item.items) {\r\n          checkParent(item.parent)\r\n        } else {\r\n          checkChildren(item.items)\r\n        }\r\n      })\r\n    }\r\n\r\n    const checkParent = (item: any) => {\r\n      const checkableItems = _.filter(item.items, (_item: HojaTrabajoTreeItem) => {\r\n        return this.isItemCheckable(_item)\r\n      })\r\n\r\n      const uncheckedCount = _.size(_.filter(checkableItems, { selected: false }))\r\n      item.selected = _.size(item.items) > 0 && _.size(checkableItems) > 0 && uncheckedCount == 0\r\n\r\n      if (item.parent) {\r\n        checkParent(item.parent)\r\n      }\r\n    }\r\n\r\n    checkChildren(items)\r\n  }\r\n\r\n  renderStepContent() {\r\n    const { step } = this.state\r\n\r\n    switch (step) {\r\n      case 1:\r\n        const equipoChoices: any = _.map(app.vars.plan_auditoria.equipo, function(item: any) {\r\n          return {\r\n            key: item.user_id,\r\n            text: item.fullname,\r\n            value: item.user_id,\r\n            description: item.rol.name,\r\n            label: { content: item.sigla, circular: true, color: 'green' }\r\n          }\r\n        })\r\n\r\n        return (\r\n          <div className='step-content  step-content-1'>\r\n            <h4 className='ui centered header'>Seleccione el usuario al cual desea realizar la asignación de pasos</h4>\r\n            <div className='ui field centered user-dropdown-wrapper'>\r\n              <Dropdown\r\n                placeholder='Seleccione el usuario'\r\n                defaultValue={this.state.user_id}\r\n                selection\r\n                fluid\r\n                options={equipoChoices}\r\n                onChange={this.onSelectUser}\r\n              />\r\n            </div>\r\n            <div className='btn-actions'>\r\n              <button className='btn btn-primary pull-right' onClick={this.onClickToContinueToStep2}>\r\n                Continuar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )\r\n      case 2:\r\n        const user = ProyectoPlanAuditoriaUtils.getUserById(this.state.user_id)\r\n        const context = {\r\n          tree: this.state.tree,\r\n          filters: this.state.filters,\r\n          updateTree: this.updateTree.bind(this),\r\n          updateFilter: this.updateFilter.bind(this)\r\n        }\r\n\r\n        return (\r\n          <div className='step-content  step-content-2'>\r\n            <h4 className='ui centered header'>\r\n              Seleccione los pasos los cuales desea asignarle al usuario:\r\n              <strong className='selected-user'>\r\n                {user.fullname} ({user.sigla})\r\n              </strong>\r\n            </h4>\r\n            <MasterDataTreeContext.Provider value={context}>\r\n              <Filters />\r\n              <HojaTrabajoTree />\r\n            </MasterDataTreeContext.Provider>\r\n\r\n            <div className='btn-actions'>\r\n              <button className='btn ' onClick={() => this.setState({ step: 1 })}>\r\n                Volver\r\n              </button>\r\n              <Popup\r\n                trigger={\r\n                  <button\r\n                    className='btn btn-primary pull-right'\r\n                    onClick={this.onSubmit}\r\n                    disabled={this.state.pasosChecked.length == 0}\r\n                  >\r\n                    Guardar\r\n                  </button>\r\n                }\r\n                content='Seleccione por lo menos un paso al cual asignarle el usuario responsable'\r\n                disabled={this.state.pasosChecked.length > 0}\r\n                on='hover'\r\n                className='disabled-text'\r\n              />\r\n            </div>\r\n          </div>\r\n        )\r\n    }\r\n  }\r\n\r\n  onClose = () => {\r\n    this.setState({ open: false })\r\n  }\r\n\r\n  onSubmit = () => {\r\n    $.blockUI(create_blockUI_loading_message('Guardando los cambios... Por Favor Espere'))\r\n    $.post(url_for(`proyecto/${app.vars.plan_auditoria.proyecto.id}/mass_assign_user`), {\r\n      user_id: this.state.user_id,\r\n      pasos: this.state.pasosChecked\r\n    }).done(() => {\r\n      location.reload()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { step } = this.state\r\n\r\n    const onClickMenuItem = (ev: SyntheticEvent) => {\r\n      ev.preventDefault()\r\n      this.setState({ open: true })\r\n    }\r\n\r\n    return (\r\n      <Fragment>\r\n        <a href='#' onClick={onClickMenuItem}>\r\n          Asignar Responsables\r\n        </a>\r\n\r\n        {this.state.open && (\r\n          <Modal open className='modal-ab modal-pasomassassign' closeIcon onClose={this.onClose}>\r\n            <Modal.Header content='Asignación masiva de usuarios a pasos' />\r\n            <Modal.Content>\r\n              <div className='stepbar'>\r\n                <Step.Group attached='top' size='small' widths={2}>\r\n                  <Step active={step == 1} completed={step > 1} icon={step > 1 ? 'check' : null} title='1. Usuario' />\r\n                  <Step active={step == 2} title='2. Pasos' />\r\n                </Step.Group>\r\n              </div>\r\n\r\n              {this.renderStepContent()}\r\n            </Modal.Content>\r\n          </Modal>\r\n        )}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","import { createContext } from 'react'\r\n\r\ntype PlanAuditoriaContextType = {\r\n  tree: any\r\n  filters: any\r\n  updateTree: (data: any, cb?: () => void) => void\r\n  updateFilters: (data: any) => void\r\n}\r\n\r\nexport default createContext<PlanAuditoriaContextType>({\r\n  tree: null,\r\n  filters: null,\r\n  updateTree: (data) => {},\r\n  updateFilters: (data) => {}\r\n})\r\n","import { PureComponent, Fragment, SyntheticEvent } from 'react'\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport List from 'semantic-ui-react/dist/commonjs/elements/List/List'\r\n\r\ndeclare var app: any\r\n\r\ntype ModalVisitasManageState = {\r\n  open: boolean\r\n}\r\n\r\nexport class AppActionVisitasManage extends PureComponent<{}, ModalVisitasManageState> {\r\n  state: ModalVisitasManageState = {\r\n    open: false\r\n  }\r\n\r\n  onClickAction = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ open: true })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <a href='#' onClick={this.onClickAction}>\r\n          Administrar Visitas\r\n        </a>\r\n        {this.state.open && <ModalVisitasManage onClose={() => this.setState({ open: false })} />}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nclass VisitaManageItem extends PureComponent<{ visita: ProyectoVisita }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onClickDelete = (event: SyntheticEvent) => {\r\n    event.preventDefault()\r\n    const { visita } = this.props\r\n    let { visitas, updateVisitas } = this.context\r\n\r\n    bootbox.warningConfirm(\r\n      '¿Esta seguro de querer eliminar por completo esta visita?',\r\n      'No',\r\n      'Sí, Eliminar visita',\r\n      (answer) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Visita...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/visita/${visita.id}`), { sf_method: 'delete' })\r\n          .done(() => {\r\n            visitas = _.reject(visitas, { id: visita.id })\r\n            updateVisitas(visitas)\r\n            $.unblockUI()\r\n          })\r\n          .fail(() => $.unblockUI())\r\n      }\r\n    )\r\n  }\r\n\r\n  onClickEdit = (event: SyntheticEvent) => {\r\n    event.preventDefault()\r\n\r\n    const { visita } = this.props\r\n    let { visitas, updateVisitas } = this.context\r\n\r\n    const prompt = bootbox.prompt(\r\n      {\r\n        header: `Renombrar Visita - ${visita.name}`,\r\n        content: '<div>Escriba el nuevo nombre que desea asignarle a la visita seleccionada.</div>'\r\n      },\r\n      'Cancelar',\r\n      'Actualizar',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Actualizando Visita...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/visita/${visita.id}`), { visita_name: r })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              const _visita: any = _.findWhere(visitas, { id: visita.id })\r\n              _visita.name = res.response.record.name\r\n              _visita.position = res.response.record.position\r\n              _visita.sumaria_periodo_actual = res.response.record.sumaria_periodo_actual\r\n\r\n              updateVisitas(visitas)\r\n              prompt.modal('hide')\r\n\r\n              $.unblockUI()\r\n            } else {\r\n              $.unblockUI()\r\n              bootbox.alert(\r\n                `<p>El siguiente ocurrió al intentar actualizar la visita:</p>\r\n                <div class=\"alert alert-error alert-block _a-center\">${res.message}</div>`\r\n              )\r\n            }\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error inesperado ocurrió al intentar actualizar la visita.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      visita.name\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n    const is_editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    return (\r\n      <List.Item id={`visita-li-${visita.id}`} className='visita-listitem'>\r\n        <span className='sort-handler drag-icon' />\r\n        <List.Content style={{ display: 'inline-block' }}>{visita.name}</List.Content>\r\n        {is_editable && (\r\n          <List.Content floated='right'>\r\n            {user_has_role_permission('visita_edit') && (\r\n              <Fragment>\r\n                <button className='ui tertiary button compact mini btnedit' onClick={this.onClickEdit}>\r\n                  Cambiar nombre\r\n                </button>\r\n                <button className='ui tertiary button negative compact mini' onClick={this.onClickDelete}>\r\n                  Eliminar\r\n                </button>\r\n              </Fragment>\r\n            )}\r\n          </List.Content>\r\n        )}\r\n      </List.Item>\r\n    )\r\n  }\r\n}\r\n\r\nexport class ModalVisitasManage extends PureComponent<{ onClose?: () => void }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  componentDidMount() {\r\n    ;($('#visitas-adminlist') as any).sortable({\r\n      handle: '.sort-handler',\r\n      items: '.visita-listitem',\r\n      axis: 'y',\r\n      placeholder: 'sortable_placeholder',\r\n      update: this.onSortEnd\r\n    })\r\n  }\r\n\r\n  onSortEnd = () => {\r\n    const { visitas, updateVisitas } = this.context\r\n\r\n    let ids = ($('#visitas-adminlist') as any).sortable('toArray')\r\n    ids = ids.map(function(id: string) {\r\n      return id.substr(10)\r\n    })\r\n\r\n    $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/visita/sort`), { sort: ids })\r\n\r\n    _.each(ids, (id, index: number) => {\r\n      const visitaIndex = _.findIndex(visitas, { id })\r\n      visitas[visitaIndex].position = index + 1\r\n    })\r\n\r\n    updateVisitas(visitas)\r\n  }\r\n\r\n  onClickNew = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { visitas, updateVisitas, tree, updateTree } = this.context\r\n\r\n    const prompt = bootbox.prompt(\r\n      { header: 'Nueva Visita', content: '<div>Escriba el nombre de la visita que desea crear.</div>' },\r\n      'Cancelar',\r\n      'Crear',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Creando Visita...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/create-visita`), { visita_name: r })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              const visita = res.response.record\r\n              visitas.push({\r\n                id: visita.id_proyecto_visita,\r\n                id_proyecto_visita: visita.id_proyecto_visita,\r\n                name: visita.name,\r\n                position: visita.position,\r\n                sumaria_periodo_actual: visita.sumaria_periodo_actual\r\n              })\r\n              updateVisitas(visitas)\r\n              prompt.modal('hide')\r\n\r\n              // Actualiza las visitas asociadas al paso de Materialidad\r\n              const paso_materialidad = res.response.paso_materialidad\r\n              let _pasoFound = false\r\n              _.each(tree, (fase) => {\r\n                _.each(fase.items, (subfase) => {\r\n                  _.each(subfase.items, (paso) => {\r\n                    if (paso.id == paso_materialidad.id) {\r\n                      paso.paso_visitas = paso_materialidad.MasterDataPasoHasProyectoVisita\r\n                      _pasoFound = true\r\n                      return false\r\n                    }\r\n                  })\r\n                  if (_pasoFound) {\r\n                    return false\r\n                  }\r\n                })\r\n                if (_pasoFound) {\r\n                  return false\r\n                }\r\n              })\r\n              updateTree(tree)\r\n\r\n              $.unblockUI()\r\n            } else {\r\n              $.unblockUI()\r\n              bootbox.alert(\r\n                `<p>El siguiente ocurrió al intentar crear la visita:</p>\r\n                <div class=\"alert alert-error alert-block _a-center\">${res.message}</div>`\r\n              )\r\n            }\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error inesperado ocurrió al intentar crear la visita.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      ''\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  render() {\r\n    const { visitas } = this.context\r\n\r\n    const is_editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    return (\r\n      <Modal open closeIcon className='modal-ab' onClose={this.props.onClose} size='small'>\r\n        <Modal.Header content='Administración de Visitas' />\r\n        <Modal.Content>\r\n          {_.size(visitas) > 0 ? (\r\n            <Fragment>\r\n              <p className='description-text'>Listado de visitas de este proyecto:</p>\r\n              <List divided id='visitas-adminlist'>\r\n                {_.map(visitas, (visita: ProyectoVisita) => {\r\n                  return <VisitaManageItem key={visita.id} visita={visita} />\r\n                })}\r\n              </List>\r\n            </Fragment>\r\n          ) : (\r\n            <div className='alert alert-block'>\r\n              <span className='icon-warning-sign' /> Aun no hay visitas creadas en este proyecto.\r\n            </div>\r\n          )}\r\n          <div className='_a-center'>\r\n            {is_editable &&\r\n            user_has_role_permission('visita_create') && (\r\n              <a href='#' className='btn btn-new' style={{ marginRight: 5 }} onClick={this.onClickNew}>\r\n                Nueva Visita\r\n              </a>\r\n            )}\r\n            <button type='button' className='btn btn-danger' onClick={this.props.onClose}>\r\n              Cerrar\r\n            </button>\r\n          </div>\r\n        </Modal.Content>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n","/// <reference path=\"./AppTree.d.ts\" />\r\n\r\nimport { Component, SyntheticEvent, Fragment, PureComponent, createRef } from 'react'\r\n\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Dropdown from 'semantic-ui-react/dist/commonjs/modules/Dropdown/Dropdown'\r\n\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\n\r\nimport cx from 'classnames'\r\nimport { ProyectoPlanAuditoriaUtils } from './utils'\r\nimport {\r\n  TreeItemFaseActions,\r\n  TreeItemSubfaseActions,\r\n  TreeItemPasoActions,\r\n  DropdownItemAssignUser,\r\n  DropdownItemDeletePasoVisita\r\n} from './AppTreeItemActions'\r\n\r\ndeclare var app: any\r\n\r\nclass TreeItemFase extends PureComponent<{ item: ItemFase }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  listRef = createRef<HTMLUListElement>()\r\n\r\n  componentDidMount() {\r\n    this.makeSortable()\r\n  }\r\n\r\n  toggle = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { tree, updateTree } = this.context\r\n    const { item } = this.props\r\n\r\n    tree[item.index].open = !item.open\r\n    updateTree(tree)\r\n  }\r\n\r\n  makeSortable() {\r\n    if (!app.vars.plan_auditoria.proyecto.isOpen || !user_has_role_permission('hoja_trabajo_edit')) {\r\n      return false\r\n    }\r\n\r\n    const fase = this.props.item\r\n    ;($(this.listRef.current) as any).sortable({\r\n      handle: '.handle-dragdrop.subphase-handle',\r\n      items: 'li.subphase',\r\n      placeholder: 'sortable_placeholder',\r\n      axis: 'y',\r\n      revert: '100',\r\n      forceHelperSize: false,\r\n      containment: 'parent',\r\n      helper: (ev: SyntheticEvent, item: any) => {\r\n        const cloneItem = item.clone()\r\n        $(cloneItem).find('ul.methodology-paso-list').remove()\r\n\r\n        return cloneItem\r\n      },\r\n      start: function(ev: SyntheticEvent, ui: any) {\r\n        ;($(this) as any).sortable('refreshPositions')\r\n        $(ui.item).addClass('sortable_dragging')\r\n      },\r\n      stop: function(ev: SyntheticEvent, ui: any) {\r\n        $(ui.item).removeClass('sortable_dragging')\r\n      },\r\n      update: (ev: SyntheticEvent, ui: any) => {\r\n        var items = ($(this.listRef.current) as any).sortable('toArray')\r\n\r\n        $('.methodology-item.subphase.sortable-enabled').removeClass('sortable-enabled')\r\n\r\n        items = items.map(function(item: string) {\r\n          return item.substr(8)\r\n        })\r\n\r\n        $.blockUI(create_blockUI_loading_message('Guardando los cambios'))\r\n        $.post(url_for('proyecto/' + app.vars.idproyecto + '/master_data/rubro/sort'), { sort: items }).done((res) => {\r\n          if (res.success == 1) {\r\n            const positions: { [s: string]: number } = {}\r\n            items.each((v: string, k: number) => {\r\n              positions[v] = k\r\n            })\r\n\r\n            const { tree, updateTree } = this.context\r\n\r\n            tree[fase.index].items = _.map(tree[fase.index].items, (rubro: ItemSubfase) => {\r\n              rubro.position = '' + (positions[rubro.id] + 1)\r\n              rubro.sortIndex = positions[rubro.id]\r\n              return rubro\r\n            })\r\n\r\n            updateTree(tree)\r\n            $.unblockUI()\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n\r\n    const editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    const itemClasses = cx('methodology-item phase', item.items.length > 0 ? 'has-rubros' : 'no-rubros')\r\n\r\n    return (\r\n      <li className={itemClasses} id={`fase${item.id}`}>\r\n        <div className='methodology-item-head'>\r\n          <span className='handle handle-dragdrop phase-handle' />\r\n          <a className='phase-name' onClick={this.toggle} href='#'>\r\n            <span className='fase-iteration'>{_.str.lpad(item.sortIndex + 1, 2, '0')}</span>-{_.str.trim(item.descripcion.toUpperCase())}\r\n          </a>\r\n          {editable && <TreeItemFaseActions item={item} />}\r\n          <div className='clearfix' />\r\n        </div>\r\n        <ul className='methodology methodology-rubro-list' ref={this.listRef}>\r\n          {item.open &&\r\n            _.map(_.sortBy(item.items, (subitem) => parseInt(subitem.position)), (subfase: ItemSubfase) => {\r\n              subfase.parent = item\r\n              return <TreeItemSubfase key={subfase.id} item={subfase} />\r\n            })}\r\n        </ul>\r\n      </li>\r\n    )\r\n  }\r\n}\r\n\r\nclass TreeItemSubfase extends PureComponent<{ item: ItemSubfase }> {\r\n  static fetchingSumarias = false\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  fetchingRiesgos = false\r\n  listRef = createRef<HTMLUListElement>()\r\n\r\n  static getIndexChar(index: number) {\r\n    let prefix = ''\r\n    if (index > 25) {\r\n      prefix = String.fromCharCode(97 + (Math.floor(index / 25) - 1))\r\n    }\r\n    return prefix + String.fromCharCode(97 + index % 26)\r\n  }\r\n\r\n  toggle = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n    const { tree, updateTree } = this.context\r\n\r\n    tree[item.parent.index].items[item.index].open = !item.open\r\n    updateTree(tree)\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.loadSumarias()\r\n    this.loadRiesgos()\r\n    this.makeSortable()\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.loadSumarias()\r\n    this.checkSortable()\r\n  }\r\n\r\n  loadSumarias() {\r\n    if (TreeItemSubfase.fetchingSumarias) {\r\n      return\r\n    }\r\n\r\n    const { item } = this.props\r\n    const { tree, updateTree } = this.context\r\n    const hasFilters = _.size(this.context.filters) > 0\r\n\r\n    if (item.sumarias === null && item.parent.id == app.vars.plan_auditoria.settings.ejecucion_fase_id && !hasFilters) {\r\n      TreeItemSubfase.fetchingSumarias = true\r\n\r\n      $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/master_data_tree`), {\r\n        export_options: { type: 'sumarias', fase_id: item.parent.id }\r\n      }).done((res) => {\r\n        _.each(res.response, (totales, rubro_id: string) => {\r\n          const rubroIndex = _.findIndex(tree[item.parent.index].items, { id: rubro_id })\r\n          tree[item.parent.index].items[rubroIndex].sumarias = totales\r\n        })\r\n        updateTree(tree)\r\n      })\r\n    }\r\n  }\r\n\r\n  loadRiesgos() {\r\n    if (this.fetchingRiesgos) {\r\n      return\r\n    }\r\n\r\n    this.fetchingRiesgos = true\r\n\r\n    const { item } = this.props\r\n    const { tree, updateTree } = this.context\r\n\r\n    if (tree[item.parent.index].items[item.index].riesgosLoaded) {\r\n      return\r\n    }\r\n\r\n    $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/master_data_tree`), {\r\n      export_options: { type: 'riesgos', rubro_id: item.id }\r\n    }).done((res) => {\r\n      _.each(res.response, (riesgos, paso_id: string) => {\r\n        const pasoIndex = _.findIndex(tree[item.parent.index].items[item.index].items, { id: paso_id })\r\n        tree[item.parent.index].items[item.index].items[pasoIndex].riesgos = riesgos\r\n      })\r\n\r\n      tree[item.parent.index].items[item.index].riesgosLoaded = true\r\n\r\n      updateTree(tree)\r\n    })\r\n  }\r\n\r\n  makeSortable() {\r\n    if (!app.vars.plan_auditoria.proyecto.isOpen || !user_has_role_permission('hoja_trabajo_edit')) {\r\n      return false\r\n    }\r\n\r\n    const rubro = this.props.item\r\n\r\n    const { filters } = this.context\r\n    const $sortableList: any = $(this.listRef.current)\r\n    $sortableList.sortable({\r\n      handle: '.handle-dragdrop.paso-handle, .sortable-enabled ',\r\n      items: 'li.paso.paso-sortable',\r\n      placeholder: 'sortable_placeholder',\r\n      axis: 'y',\r\n      revert: '100',\r\n      helper: 'clone',\r\n      disabled: _.size(filters) > 0,\r\n      containment: 'parent',\r\n      start: (ev: SyntheticEvent, ui: any) => {\r\n        $(ui.item).addClass('sortable_dragging')\r\n      },\r\n      stop: function(ev: SyntheticEvent, ui: any) {\r\n        $(ui.item).removeClass('sortable_dragging')\r\n      },\r\n      update: (ev: SyntheticEvent, ui: any) => {\r\n        var items = $sortableList.sortable('toArray')\r\n\r\n        $('.methodology-item.paso.sortable-enabled').removeClass('sortable-enabled')\r\n\r\n        items = items.map(function(item: string) {\r\n          return item.substr(5)\r\n        })\r\n\r\n        $.blockUI(create_blockUI_loading_message('Guardando los cambios'))\r\n        $.post(url_for('proyecto/' + app.vars.idproyecto + '/master_data/paso/sort'), { sort: items }).done((res) => {\r\n          if (res.success == 1) {\r\n            const positions: { [s: string]: number } = {}\r\n            items.each((v: string, k: number) => {\r\n              positions[v] = k\r\n            })\r\n\r\n            const { tree, updateTree } = this.context\r\n\r\n            tree[rubro.parent.index].items[rubro.index].items = _.map(\r\n              tree[rubro.parent.index].items[rubro.index].items,\r\n              (paso: ItemPaso) => {\r\n                paso.position = '' + (positions[paso.id] + 1)\r\n                paso.sortIndex = positions[paso.id]\r\n                return paso\r\n              }\r\n            )\r\n\r\n            updateTree(_.clone(tree, true))\r\n            $.unblockUI()\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  checkSortable() {\r\n    if (!app.vars.plan_auditoria.proyecto.isOpen || !user_has_role_permission('hoja_trabajo_edit')) {\r\n      return false\r\n    }\r\n\r\n    const { filters } = this.context\r\n    if (_.size(filters)) {\r\n      ;($(this.listRef.current) as any).sortable('option', 'disable', true)\r\n    } else {\r\n      ;($(this.listRef.current) as any).sortable('option', 'disable', false)\r\n    }\r\n  }\r\n\r\n  matchesPasoToFilters(item: ItemPaso, filters: any) {\r\n    if (_.size(filters) == 0) {\r\n      return true\r\n    }\r\n\r\n    return _.some(item.paso_visitas, (paso_visita) => {\r\n      if (filters.visita && paso_visita.id_proyecto_visita == filters.visita) {\r\n        return true\r\n      }\r\n\r\n      if (filters.status && paso_visita.id_proyecto_paso_estado == filters.status) {\r\n        return true\r\n      }\r\n\r\n      if (filters.asignado && paso_visita.id_usuario_asignado == filters.asignado) {\r\n        return true\r\n      }\r\n\r\n      return false\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n    const hasFilters = _.size(this.context.filters) > 0\r\n    const editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    const pasosElements = _.map(_.sortBy(item.items, (item) => parseInt(item.position)), (paso: ItemPaso) => {\r\n      paso.parent = item\r\n\r\n      if (this.matchesPasoToFilters(paso, this.context.filters)) {\r\n        return <TreeItemPaso key={paso.id} item={paso} />\r\n      }\r\n\r\n      return null\r\n    })\r\n\r\n    const itemClasses = cx(\r\n      'methodology-item subphase',\r\n      _.filter(pasosElements).length == 0 ? 'no-pasos' : 'has-pasos',\r\n      hasFilters ? 'has-filters' : ''\r\n    )\r\n\r\n    return (\r\n      <li className={itemClasses} id={`subphase${item.id}`}>\r\n        <div className='methodology-item-head'>\r\n          <span className='handle handle-dragdrop subphase-handle' />\r\n          <a className='phase-name' onClick={this.toggle} href='#'>\r\n            <span className='fase-iteration'>{TreeItemSubfase.getIndexChar(item.sortIndex).toUpperCase()}</span>-{_.str.trim(item.descripcion)}\r\n          </a>\r\n          {editable && <TreeItemSubfaseActions item={item} />}\r\n          <div className='clearfix' />\r\n        </div>\r\n        <ul className='methodology methodology-paso-list' ref={this.listRef}>\r\n          {item.open && (\r\n            <Fragment>\r\n              {app.vars.plan_auditoria.settings.ejecucion_fase_id == item.parent.id &&\r\n              !hasFilters && <TreeItemPasoSubsumaria rubro={item} />}\r\n              {pasosElements}\r\n            </Fragment>\r\n          )}\r\n        </ul>\r\n      </li>\r\n    )\r\n  }\r\n}\r\n\r\nclass TreeItemPaso extends PureComponent<{ item: ItemPaso }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  countRiesgos() {\r\n    const { item } = this.props\r\n\r\n    if (item.riesgos === null) {\r\n      return <div className='ui mini active inline loader' />\r\n    } else if (_.size(item.riesgos) === 0) {\r\n      return 0\r\n    } else {\r\n      const riesgosChunk = _.take(item.riesgos, 30)\r\n      const riesgosContent = (\r\n        <div>\r\n          {_.map(riesgosChunk, (riesgo) => riesgo.code).join(', ')}\r\n\r\n          {_.size(item.riesgos) > _.size(riesgosChunk) && ` y ${_.size(item.riesgos) - _.size(riesgosChunk)} más...`}\r\n        </div>\r\n      )\r\n\r\n      return (\r\n        <Popup header='Riesgos' content={riesgosContent} size='mini' trigger={<span>{_.size(item.riesgos)}</span>} />\r\n      )\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n\r\n    const pasoLiClassnames = cx(\r\n      'methodology-item paso paso-sortable',\r\n      `paso-code-${item.code}`,\r\n      `paso-tipo-${(item.tipo || 'default').toLowerCase()}`\r\n    )\r\n\r\n    const editable = app.vars.plan_auditoria.proyecto.isOpen\r\n    const hallazgosCount = app.vars.plan_auditoria.paso_hallazgos[item.id] || 0\r\n    const riesgosCount = this.countRiesgos()\r\n\r\n    return (\r\n      <li className={pasoLiClassnames} id={`paso-${item.id}`}>\r\n        <div className='methodology-item-head'>\r\n          <span className='handle handle-dragdrop paso-handle' />\r\n          <a href={url_for(`proyecto//${app.vars.idproyecto}/hoja-trabajo/paso/${item.id}`)} className='paso-name'>\r\n            <span className='paso-iteration'>{_.str.lpad(item.sortIndex + 1, 3, '0')}</span>-{item.descripcion}\r\n          </a>\r\n\r\n          {editable && <TreeItemPasoActions item={item} />}\r\n\r\n          <div className='pull-right sf_admin_td_actions valign'>\r\n            <div className='section-a'>\r\n              {item.tipo == 'PERIODO' ? (\r\n                <TreeItemPasoPeriodoVisitaList paso={item} />\r\n              ) : (\r\n                <TreeItemPasoDefaultVisitaList paso={item} />\r\n              )}\r\n            </div>\r\n\r\n            <div className='divider-vertical' />\r\n            <div className='section-a'>\r\n              <div className='header'>\r\n                <strong className='title'>Riesgos</strong>\r\n              </div>\r\n\r\n              <span>{riesgosCount}</span>\r\n            </div>\r\n\r\n            <div className='section-a'>\r\n              <div className='header'>\r\n                <strong className='title'>Hallazgos</strong>\r\n              </div>\r\n              <span>{hallazgosCount}</span>\r\n            </div>\r\n\r\n            <div className='divider-vertical' />\r\n\r\n            <div\r\n              className={item.aserciones.length > 0 ? 'section-a' : ''}\r\n              style={{ display: 'inline-block', marginRight: 10, marginTop: -5, minWidth: 250, width: 250 }}\r\n            >\r\n              {item.aserciones.length > 0 ? (\r\n                <Fragment>\r\n                  <div className='header'>\r\n                    <strong className='title'>Aserciones</strong>\r\n                  </div>\r\n                  <ul className='unstyled'>\r\n                    {_.map(item.aserciones, (asercion) => {\r\n                      const objetivo: ProyectoObjetivo = _.find(app.vars.plan_auditoria.objetivos, {\r\n                        id: asercion.id_master_data_objetivo\r\n                      })\r\n                      return (\r\n                        <li key={asercion.id_master_data_objetivo} className='label label-info objetivo-sigla'>\r\n                          <Popup\r\n                            basic\r\n                            size='mini'\r\n                            content={objetivo.description}\r\n                            header={`Aserción: ${objetivo.name}`}\r\n                            trigger={<span>{objetivo.code}</span>}\r\n                          />\r\n                        </li>\r\n                      )\r\n                    })}\r\n                  </ul>\r\n                </Fragment>\r\n              ) : (\r\n                <span>&nbsp;</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className='clearfix' />\r\n        </div>\r\n      </li>\r\n    )\r\n  }\r\n}\r\n\r\nclass TreeItemPasoSubsumaria extends PureComponent<{ rubro: ItemSubfase }> {\r\n  static contextType = PlanAuditoriaContext\r\n  render() {\r\n    const { rubro } = this.props\r\n    const { visitas } = this.context\r\n\r\n    return (\r\n      <li className='methodology-item paso sumaria'>\r\n        <div className='methodology-item-head'>\r\n          <span className='handle' />\r\n          <a\r\n            href={url_for(`proyecto/${app.vars.idproyecto}/master_data/rubro/${rubro.id}/sumarias`)}\r\n            className='paso-name'\r\n          >\r\n            000-Subsumaria\r\n          </a>\r\n          <div className='sf_admin_td_actions'>\r\n            <div className='section-a'>\r\n              {_.map(visitas, (visita: ProyectoVisita) => {\r\n                return <TreeItemPasoSubsumariaVisita key={`${rubro.id}-${visita.id}`} rubro={rubro} visita={visita} />\r\n              })}\r\n            </div>\r\n          </div>\r\n          <div className='clearfix' />\r\n        </div>\r\n      </li>\r\n    )\r\n  }\r\n}\r\n\r\nclass TreeItemPasoSubsumariaVisita extends PureComponent<{ rubro: ItemSubfase; visita: ProyectoVisita }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  getTotal() {\r\n    const { rubro, visita } = this.props\r\n    const sumarias = this.context.tree[rubro.parent.index].items[rubro.index].sumarias\r\n\r\n    if (sumarias === null) {\r\n      return <div className='ui mini active inline loader' />\r\n    }\r\n    if (typeof sumarias[visita.id] === 'undefined' || sumarias[visita.id] === null) {\r\n      return '-'\r\n    }\r\n    return accounting.formatMoney(sumarias[visita.id])\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n\r\n    return (\r\n      <div className='visita'>\r\n        <a className='title pasovisita-name'>{shortVisitaAlias(visita.name)}</a>\r\n        <div>\r\n          <div className='subsumaria-total'>{this.getTotal()}</div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass TreeItemPasoPeriodoVisitaList extends PureComponent<{ paso: ItemPaso }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onContextMenu = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    $(ev.currentTarget).find('i.dropdown.icon').click()\r\n  }\r\n\r\n  getDropdownItems(paso_visita: any) {\r\n    const { paso } = this.props\r\n    const linkurl = url_for(\r\n      `proyecto/${app.vars.idproyecto}/hoja-trabajo/paso/${paso.id}?id_visita=${paso_visita.id_proyecto_visita}`\r\n    )\r\n\r\n    const is_editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    const dropdownitems = (\r\n      <Fragment>\r\n        <Dropdown.Item key='link'>\r\n          <a href={linkurl}>Ir a Hoja de Trabajo</a>\r\n        </Dropdown.Item>\r\n        {is_editable &&\r\n        user_has_role_permission([ 'paso_asignar_usuario' ]) && (\r\n          <DropdownItemAssignUser key='assignuser' paso_visita={paso_visita} paso={paso} />\r\n        )}\r\n        {is_editable &&\r\n        user_has_role_permission('hoja_trabajo_edit') && (\r\n          <DropdownItemDeletePasoVisita key='delete' paso_visita={paso_visita} paso={paso} />\r\n        )}\r\n      </Fragment>\r\n    )\r\n\r\n    return dropdownitems\r\n  }\r\n\r\n  render() {\r\n    const { paso } = this.props\r\n    const paso_visitas = _.sortBy(paso.paso_visitas, (item) => parseInt(item.position))\r\n\r\n    return (\r\n      <Fragment>\r\n        {_.map(paso_visitas, (paso_visita, index) => {\r\n          const paso_estado: ProyectoPasoEstado = _.findWhere(app.vars.plan_auditoria.paso_estados, {\r\n            id_proyecto_paso_estado: paso_visita.id_proyecto_paso_estado\r\n          })\r\n          const user = ProyectoPlanAuditoriaUtils.getUserById(paso_visita.id_usuario_asignado)\r\n          const linkUrl = url_for(\r\n            `proyecto/${app.vars.idproyecto}/hoja-trabajo/paso/${paso.id}?id_visita=${paso_visita.id}`\r\n          )\r\n\r\n          return [\r\n            <div className='visita' key={`visita-${paso_visita.id}`}>\r\n              <div className='header' onContextMenu={this.onContextMenu}>\r\n                <a className='title pasovisita-name has-contextmenu' href={linkUrl}>\r\n                  {shortVisitaAlias(paso_visita.visita_alias)}\r\n                </a>\r\n                <Dropdown compact inline icon={{ name: 'dropdown', size: 'small' }} className='contextmenu'>\r\n                  <Dropdown.Menu>{this.getDropdownItems(paso_visita)}</Dropdown.Menu>\r\n                </Dropdown>\r\n              </div>\r\n              <a className='title pasovisita-name has-contextmenu' key={paso_visita.id} href={linkUrl} />\r\n              <div>\r\n                <div title={user ? `Asignado a: ${user.name}` : 'Sin Asignar'} style={{ display: 'inline-block' }}>\r\n                  {user ? user.sigla : ''}&nbsp;\r\n                </div>\r\n                <div className='label visita-status' style={{ backgroundColor: paso_estado.color }}>\r\n                  <span title={`Estado: ${paso_estado.name}`}>{wordInitials(paso_estado.name)}</span>\r\n                </div>\r\n              </div>\r\n            </div>,\r\n            index == paso_visitas.length - 1 ? null : (\r\n              <div className='divider-vertical' key={`divider-${paso_visita.id}`} />\r\n            )\r\n          ]\r\n        })}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nclass TreeItemPasoDefaultVisitaList extends PureComponent<{ paso: ItemPaso }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  getVisitaById(id_visita: string): ProyectoVisita {\r\n    const { visitas } = this.context\r\n\r\n    return _.findWhere(visitas, { id: id_visita })\r\n  }\r\n\r\n  getPasoVisitas() {\r\n    const { paso } = this.props\r\n\r\n    let paso_visitas = _.map(paso.paso_visitas, (item) => {\r\n      const visita = this.getVisitaById(item.id_proyecto_visita)\r\n      if (!visita) {\r\n        return null\r\n      }\r\n      item.position = +visita.position\r\n      return item\r\n    })\r\n\r\n    paso_visitas = _.filter(paso_visitas)\r\n\r\n    return _.sortBy(paso_visitas, 'position')\r\n  }\r\n\r\n  getDropdownItems(paso_visita: any) {\r\n    const { paso } = this.props\r\n\r\n    const is_editable = app.vars.plan_auditoria.proyecto.isOpen\r\n\r\n    let dropdownitems\r\n\r\n    const linkurl = url_for(\r\n      `proyecto/${app.vars.idproyecto}/hoja-trabajo/paso/${paso.id}?id_visita=${paso_visita.id_proyecto_visita}`\r\n    )\r\n\r\n    if (paso.tipo == 'MATERIALIDAD') {\r\n      dropdownitems = (\r\n        <Fragment>\r\n          <Dropdown.Item>\r\n            <a href={linkurl}>Ir a Hoja de Trabajo</a>\r\n          </Dropdown.Item>\r\n          {is_editable &&\r\n          user_has_role_permission('hoja_trabajo_edit') && (\r\n            <DropdownItemAssignUser paso_visita={paso_visita} paso={paso} />\r\n          )}\r\n        </Fragment>\r\n      )\r\n    } else {\r\n      dropdownitems = (\r\n        <Fragment>\r\n          <Dropdown.Item>\r\n            <a href={linkurl}>Ir a Hoja de Trabajo</a>\r\n          </Dropdown.Item>\r\n          {is_editable &&\r\n          user_has_role_permission('visita_edit') && (\r\n            <Dropdown.Item onClick={() => this.onClickRename(paso_visita)}>Cambiar nombre</Dropdown.Item>\r\n          )}\r\n          {is_editable &&\r\n          user_has_role_permission('hoja_trabajo_edit') && (\r\n            <DropdownItemAssignUser paso_visita={paso_visita} paso={paso} />\r\n          )}\r\n          {is_editable &&\r\n          user_has_role_permission('hoja_trabajo_edit') && (\r\n            <DropdownItemDeletePasoVisita paso_visita={paso_visita} paso={paso} />\r\n          )}\r\n        </Fragment>\r\n      )\r\n    }\r\n\r\n    return dropdownitems\r\n  }\r\n\r\n  onClickRename = (paso_visita: any) => {\r\n    const { visitas, updateVisitas } = this.context\r\n\r\n    const visita: ProyectoVisita = _.find(visitas, { id_proyecto_visita: paso_visita.id_proyecto_visita })\r\n\r\n    const prompt = bootbox.prompt(\r\n      {\r\n        header: `Renombrar Visita - ${visita.name}`,\r\n        content: '<div>Escriba el nuevo nombre que desea asignarle a la visita seleccionada.</div>'\r\n      },\r\n      'Cancelar',\r\n      'Actualizar',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Actualizando Visita...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/visita/${visita.id}`), { visita_name: r })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              visita.name = res.response.record.name\r\n\r\n              updateVisitas(visitas)\r\n              prompt.modal('hide')\r\n\r\n              $.unblockUI()\r\n            } else {\r\n              $.unblockUI()\r\n              bootbox.alert(\r\n                `<p>El siguiente ocurrió al intentar actualizar la visita:</p>\r\n                <div class=\"alert alert-error alert-block _a-center\">${res.message}</div>`\r\n              )\r\n            }\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error inesperado ocurrió al intentar actualizar la visita.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      visita.name\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  onContextMenu = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    $(ev.currentTarget).find('i.dropdown.icon').click()\r\n  }\r\n\r\n  render() {\r\n    const { paso } = this.props\r\n    const paso_visitas = this.getPasoVisitas()\r\n\r\n    return (\r\n      <Fragment>\r\n        {_.map(paso_visitas, (paso_visita, index) => {\r\n          const paso_estado: ProyectoPasoEstado = _.findWhere(app.vars.plan_auditoria.paso_estados, {\r\n            id_proyecto_paso_estado: paso_visita.id_proyecto_paso_estado\r\n          })\r\n          const user = ProyectoPlanAuditoriaUtils.getUserById(paso_visita.id_usuario_asignado)\r\n          const linkUrl = url_for(\r\n            `proyecto/${app.vars.idproyecto}/hoja-trabajo/paso/${paso.id}?id_visita=${paso_visita.id_proyecto_visita}`\r\n          )\r\n\r\n          return [\r\n            <div className='visita' key={`visita-${paso_visita.id}`}>\r\n              <div className='header' onContextMenu={this.onContextMenu}>\r\n                <a className='title pasovisita-name has-contextmenu' href={linkUrl}>\r\n                  {shortVisitaAlias(this.getVisitaById(paso_visita.id_proyecto_visita).name)}\r\n                </a>\r\n                <Dropdown compact inline icon={{ name: 'dropdown', size: 'small' }} className='contextmenu'>\r\n                  <Dropdown.Menu>{this.getDropdownItems(paso_visita)}</Dropdown.Menu>\r\n                </Dropdown>\r\n              </div>\r\n\r\n              <div>\r\n                <div\r\n                  title={user ? `Asignado a: ${user.name}` : 'Sin Asignar'}\r\n                  style={{ display: 'inline-block', width: 30, fontSize: 10 }}\r\n                >\r\n                  {user ? user.sigla : ''}&nbsp;\r\n                </div>\r\n                <div className='label visita-status' style={{ backgroundColor: paso_estado.color }}>\r\n                  {paso_visitas.length >= 6 ? (\r\n                    <span title={`Estado: ${paso_estado.name}`}>{wordInitials(paso_estado.name)}</span>\r\n                  ) : (\r\n                    paso_estado.name\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>,\r\n            index == paso_visitas.length - 1 ? null : (\r\n              <div className='divider-vertical' key={`divider-${paso_visita.id}`} />\r\n            )\r\n          ]\r\n        })}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nconst parseTree = (input: any, hasFilters: boolean = false): ItemFase[] => {\r\n  return _.map(input, (fase: any, index: number) => {\r\n    return {\r\n      id: fase.id,\r\n      code: fase.code,\r\n      descripcion: fase.descripcion,\r\n      position: fase.position,\r\n      index,\r\n      sortIndex: index,\r\n      open: hasFilters,\r\n      items: _.map(fase.Subfases, (subfase: any, index: number) => {\r\n        return {\r\n          id: subfase.id,\r\n          code: subfase.code,\r\n          descripcion: subfase.descripcion,\r\n          position: subfase.position,\r\n          index,\r\n          sortIndex: index,\r\n          open: hasFilters,\r\n          sumarias: null,\r\n          riesgosLoaded: false,\r\n          items: _.map(subfase.MasterDataPaso, (paso: any, index: number) => {\r\n            return {\r\n              id: paso.id,\r\n              code: paso.code,\r\n              descripcion: paso.descripcion,\r\n              position: paso.position,\r\n              tipo: paso.paso_tipo,\r\n              paso_visitas: paso.MasterDataPasoHasProyectoVisita,\r\n              aserciones: paso.MasterDataPasoHasObjetivo,\r\n              riesgos: null,\r\n              index,\r\n              sortIndex: index\r\n            }\r\n          })\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nconst shortVisitaAlias = (visitaName: string) => {\r\n  const replace_pairs = {\r\n    Enero: 'Ene',\r\n    Febrero: 'Feb',\r\n    Marzo: 'Mar',\r\n    Abril: 'Abr',\r\n    Mayo: 'May',\r\n    Junio: 'Jun',\r\n    Julio: 'Jul',\r\n    Agosto: 'Ago',\r\n    Septiembre: 'Sept',\r\n    Octubre: 'Oct',\r\n    Noviembre: 'Nov',\r\n    Diciembre: 'Dic'\r\n  }\r\n\r\n  _.each(replace_pairs, (replace, from) => {\r\n    visitaName = visitaName.replace(new RegExp(from, 'ig'), replace)\r\n  })\r\n\r\n  return visitaName\r\n}\r\n\r\nconst wordInitials = (str: string) => str.match(/\\b\\w/g).join('').toUpperCase()\r\n\r\nconst openDefault = (tree: any, defaultOpen: { element: 'fase' | 'rubro' | 'paso'; value: string }) => {\r\n  let found = false\r\n\r\n  switch (defaultOpen.element) {\r\n    case 'fase':\r\n      const index = _.findIndex(tree, { id: defaultOpen.value })\r\n      tree[index].open = true\r\n      break\r\n    case 'rubro':\r\n      found = false\r\n      _.each(tree, (fase) => {\r\n        _.each(fase.items, (subfase) => {\r\n          if (subfase.id == defaultOpen.value) {\r\n            found = true\r\n            fase.open = true\r\n            subfase.open = true\r\n\r\n            return false\r\n          }\r\n        })\r\n\r\n        if (found) {\r\n          return false\r\n        }\r\n      })\r\n      break\r\n    case 'paso':\r\n      found = false\r\n      _.each(tree, (fase) => {\r\n        _.each(fase.items, (subfase) => {\r\n          _.each(subfase.items, (paso) => {\r\n            if (paso.id == defaultOpen.value) {\r\n              found = true\r\n              fase.open = true\r\n              subfase.open = true\r\n\r\n              return false\r\n            }\r\n          })\r\n\r\n          if (found) {\r\n            return false\r\n          }\r\n        })\r\n\r\n        if (found) {\r\n          return false\r\n        }\r\n      })\r\n      break\r\n  }\r\n}\r\n\r\nexport default class AppTree extends Component {\r\n  static contextType = PlanAuditoriaContext\r\n  listRef = createRef<HTMLUListElement>()\r\n\r\n  componentDidMount() {\r\n    let { tree, updateTree, filters } = this.context\r\n\r\n    if (tree === null) {\r\n      $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/master_data_tree`), {\r\n        export_options: { type: 'base' }\r\n      }).done((res) => {\r\n        app.vars.plan_auditoria.fases = res.response\r\n        const hasFilters = _.size(filters) > 0\r\n        tree = parseTree(res.response, hasFilters)\r\n        if (!hasFilters) {\r\n          openDefault(tree, app.vars.plan_auditoria.settings.default_open)\r\n        }\r\n        updateTree(tree)\r\n      })\r\n    }\r\n\r\n    this.makeSortable()\r\n  }\r\n\r\n  makeSortable() {\r\n    if (!app.vars.plan_auditoria.proyecto.isOpen || !user_has_role_permission('hoja_trabajo_edit')) {\r\n      return false\r\n    }\r\n\r\n    ;($(this.listRef.current) as any).sortable({\r\n      handle: '.handle-dragdrop.phase-handle',\r\n      items: 'li.phase',\r\n      placeholder: 'sortable_placeholder',\r\n      axis: 'y',\r\n      revert: '100',\r\n      forceHelperSize: false,\r\n      containment: 'parent',\r\n      helper: (ev: SyntheticEvent, item: any) => {\r\n        const cloneItem = item.clone()\r\n        $(cloneItem).find('ul.methodology-rubro-list').remove()\r\n\r\n        return cloneItem\r\n      },\r\n      start: function(ev: SyntheticEvent, ui: any) {\r\n        ;($(this) as any).sortable('refreshPositions')\r\n        $(ui.item).addClass('sortable_dragging')\r\n      },\r\n      stop: function(ev: SyntheticEvent, ui: any) {\r\n        $(ui.item).removeClass('sortable_dragging')\r\n      },\r\n      update: (ev: SyntheticEvent, ui: any) => {\r\n        let items = ($(this.listRef.current) as any).sortable('toArray')\r\n\r\n        items = items.map(function(item: string) {\r\n          return item.substr(4)\r\n        })\r\n\r\n        $.blockUI(create_blockUI_loading_message('Guardando los cambios'))\r\n        $.post(url_for('proyecto/' + app.vars.idproyecto + '/master_data/rubro/sort'), { sort: items }).done((res) => {\r\n          if (res.success == 1) {\r\n            const positions: { [s: string]: number } = {}\r\n            items.each((v: string, k: number) => {\r\n              positions[v] = k\r\n            })\r\n\r\n            const { tree, updateTree } = this.context\r\n\r\n            const newtree = _.map(tree, (fase: ItemSubfase) => {\r\n              fase.position = '' + (positions[fase.id] + 1)\r\n              fase.sortIndex = positions[fase.id]\r\n              return fase\r\n            })\r\n\r\n            updateTree(newtree)\r\n            $.unblockUI()\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { tree } = this.context\r\n\r\n    return (\r\n      <Fragment>\r\n        {tree === null && (\r\n          <div className='ui basic segment' style={{ minHeight: 200 }}>\r\n            <div className='ui active inverted dimmer'>\r\n              <div className='ui text loader elastic olive'>Cargando Plan de Auditoría</div>\r\n            </div>\r\n            <p />\r\n          </div>\r\n        )}\r\n        <ul\r\n          className='methodology methodology-all methodology-sortable nav nav-stacked sf_admin_list_records'\r\n          id='methodology-accordion'\r\n          ref={this.listRef}\r\n        >\r\n          {tree !== null &&\r\n            _.map(_.sortBy(tree, (subitem: ItemFase) => parseInt(subitem.position)), (fase: ItemFase) => {\r\n              return <TreeItemFase key={fase.id} item={fase} />\r\n            })}\r\n        </ul>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","/// <reference path=\"./AppTree.d.ts\" />\r\n\r\nimport { PureComponent, Fragment } from 'react'\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\n\r\nimport { ModalPasoNew, ModalPasoEdit, ModalPasoAssoc } from './ModalPasoNew'\r\nimport { ModalPasoCopyFrom } from './ModalPasoCopyFrom'\r\nimport Dropdown from 'semantic-ui-react/dist/commonjs/modules/Dropdown/Dropdown'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\n\r\ndeclare var app: any\r\n\r\nexport class TreeItemFaseActions extends PureComponent<{ item: ItemFase }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onClickEdit = (ev: React.MouseEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n    const { tree, updateTree } = this.context\r\n\r\n    const prompt = bootbox.prompt(\r\n      {\r\n        header: `Renombrar Fase`,\r\n        content: '<div>Escriba el nuevo nombre que desea asignarle a la fase seleccionada.</div>'\r\n      },\r\n      'Cancelar',\r\n      'Actualizar',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Actualizando Fase...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/fase/${item.id}`), { fase_name: r })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              tree[item.index].descripcion = r\r\n\r\n              updateTree(tree)\r\n              prompt.modal('hide')\r\n\r\n              $.unblockUI()\r\n            } else {\r\n              $.unblockUI()\r\n              bootbox.alert(\r\n                `<p>El siguiente ocurrió al intentar actualizar la fase:</p>\r\n                <div class=\"alert alert-error alert-block _a-center\">${res.message}</div>`\r\n              )\r\n            }\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error inesperado ocurrió al intentar actualizar la fase.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      item.descripcion\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  onClickDelete = (ev: React.MouseEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n\r\n    if (item.id == app.vars.plan_auditoria.settings.ejecucion_fase_id) {\r\n      bootbox.alert(\r\n        'Esta fase NO es posible eliminarla, debido a que ha sido marcada como la fase de ejecución de este proyecto.'\r\n      )\r\n      return\r\n    }\r\n\r\n    let { tree, updateTree } = this.context\r\n\r\n    bootbox.warningConfirm(\r\n      `¿Esta seguro de querer eliminar por completo la fase \"<strong>${item.descripcion}</strong>\"?`,\r\n      'No',\r\n      'Sí, Eliminar fase',\r\n      (answer) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Fase...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/fase/${item.id}`), { sf_method: 'delete' })\r\n          .done(() => {\r\n            tree = _.reject(tree, { id: item.id })\r\n            updateTree(tree)\r\n            $.unblockUI()\r\n          })\r\n          .fail(() => $.unblockUI())\r\n      }\r\n    )\r\n  }\r\n\r\n  onClickAdd = (ev: React.MouseEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n    const { tree, updateTree } = this.context\r\n\r\n    const prompt = bootbox.prompt(\r\n      {\r\n        header: `Crear Rubro`,\r\n        content: `<blockquote><strong>Fase: </strong>${item.descripcion} </blockquote> <div>Escriba el nuevo nombre del rubro a crear.</div>`\r\n      },\r\n      'Cancelar',\r\n      'Crear',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Creando Rubro...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/fase`), {\r\n          id_parent: item.id,\r\n          fase_name: r\r\n        })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              const subfase = res.response.record\r\n\r\n              tree[item.index].items.push({\r\n                id: subfase.id_master_data_fase,\r\n                code: subfase.code,\r\n                descripcion: subfase.descripcion,\r\n                position: subfase.position,\r\n                index: tree[item.index].items.length,\r\n                sortIndex: tree[item.index].items.length,\r\n                open: false,\r\n                sumarias: null,\r\n                items: []\r\n              })\r\n\r\n              tree[item.index].open = true\r\n\r\n              updateTree(tree)\r\n              prompt.modal('hide')\r\n\r\n              $.unblockUI()\r\n            } else {\r\n              $.unblockUI()\r\n              bootbox.alert(\r\n                `<p>El siguiente ocurrió al intentar crear el rubro:</p>\r\n                <div class=\"alert alert-error alert-block _a-center\">${res.message}</div>`\r\n              )\r\n            }\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error inesperado ocurrió al intentar crear el rubro.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      ''\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className='pull-right sf_admin_td_actions'>\r\n        <div className='btn-group dropdown-modern'>\r\n          <a className='btn btn-mini dropdown-toggle' data-toggle='dropdown' href='#'>\r\n            <span className='icon-tc-ellipsis-v' />\r\n          </a>\r\n\r\n          <ul className='dropdown-menu pull-right'>\r\n            {user_has_role_permission('fase_edit') && (\r\n              <li>\r\n                <a href='#' onClick={this.onClickEdit}>\r\n                  Editar\r\n                </a>\r\n              </li>\r\n            )}\r\n            {user_has_role_permission('subfase_create') && (\r\n              <li>\r\n                <a href='#' onClick={this.onClickAdd}>\r\n                  Crear Rubro\r\n                </a>\r\n              </li>\r\n            )}\r\n            {user_has_role_permission('fase_delete') && (\r\n              <Fragment>\r\n                <li className='divider' />\r\n                <li>\r\n                  <a href='#' onClick={this.onClickDelete}>\r\n                    Eliminar\r\n                  </a>\r\n                </li>\r\n              </Fragment>\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class TreeItemSubfaseActions extends PureComponent<{ item: ItemSubfase }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onClickEdit = (ev: React.MouseEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n    const { tree, updateTree } = this.context\r\n\r\n    const prompt = bootbox.prompt(\r\n      {\r\n        header: `Renombrar Rubro`,\r\n        content: '<div>Escriba el nuevo nombre que desea asignarle al rubro seleccionado.</div>'\r\n      },\r\n      'Cancelar',\r\n      'Actualizar',\r\n      (r: string) => {\r\n        if (!r || _.str.trim(r) == '') {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Actualizando Rubro...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/fase/${item.id}`), { fase_name: r })\r\n          .done((res) => {\r\n            if (!res.hasErrors) {\r\n              tree[item.parent.index].items[item.index].descripcion = r\r\n\r\n              updateTree(tree)\r\n              prompt.modal('hide')\r\n\r\n              $.unblockUI()\r\n            } else {\r\n              $.unblockUI()\r\n              bootbox.alert(\r\n                `<p>El siguiente ocurrió al intentar actualizar el rubro:</p>\r\n                <div class=\"alert alert-error alert-block _a-center\">${res.message}</div>`\r\n              )\r\n            }\r\n          })\r\n          .fail(() => {\r\n            $.pnotify({ type: 'error', text: 'Un error inesperado ocurrió al intentar actualizar el rubro.' })\r\n            $.unblockUI()\r\n          })\r\n\r\n        return false\r\n      },\r\n      item.descripcion\r\n    )\r\n    $('.bootbox.modal').addClass('bootbox-prompt modal-ab')\r\n  }\r\n\r\n  onClickDelete = (ev: React.MouseEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n    let { tree, updateTree } = this.context\r\n\r\n    bootbox.warningConfirm(\r\n      `¿Esta seguro de querer eliminar por completo el rubro \"<strong>${item.descripcion}</strong>\"?`,\r\n      'No',\r\n      'Sí, Eliminar rubro',\r\n      (answer) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Rubro...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/fase/${item.id}`), { sf_method: 'delete' })\r\n          .done(() => {\r\n            tree[item.parent.index].items = _.reject(tree[item.parent.index].items, { id: item.id })\r\n            updateTree(tree)\r\n            $.unblockUI()\r\n          })\r\n          .fail(() => $.unblockUI())\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n\r\n    return (\r\n      <div className='pull-right sf_admin_td_actions'>\r\n        <div className='btn-group dropdown-modern'>\r\n          <a className='btn btn-mini dropdown-toggle' data-toggle='dropdown' href='#'>\r\n            <span className='icon-tc-ellipsis-v' />\r\n          </a>\r\n\r\n          <ul className='dropdown-menu pull-right'>\r\n            {user_has_role_permission('fase_edit') && (\r\n              <li>\r\n                <a href='#' onClick={this.onClickEdit}>\r\n                  Editar\r\n                </a>\r\n              </li>\r\n            )}\r\n            {user_has_role_permission('paso_create') && (\r\n              <Fragment>\r\n                <li>\r\n                  <ModalPasoNew rubro={item} />\r\n                </li>\r\n                <li>\r\n                  <ModalPasoCopyFrom rubro={item} />\r\n                </li>\r\n              </Fragment>\r\n            )}\r\n            {user_has_role_permission('fase_delete') && (\r\n              <Fragment>\r\n                <li className='divider' />\r\n                <li>\r\n                  <a href='#' onClick={this.onClickDelete}>\r\n                    Eliminar\r\n                  </a>\r\n                </li>\r\n              </Fragment>\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class TreeItemPasoActions extends PureComponent<{ item: ItemPaso }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onClickDelete = (ev: React.MouseEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const { item } = this.props\r\n    let { tree, updateTree } = this.context\r\n\r\n    bootbox.warningConfirm(\r\n      `¿Esta seguro de querer eliminar por completo el paso \"<strong>${item.descripcion}</strong>\"?`,\r\n      'No',\r\n      'Sí, Eliminar paso',\r\n      (answer) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Paso...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/paso/${item.id}`), { sf_method: 'delete' })\r\n          .done(() => {\r\n            tree[item.parent.parent.index].items[item.parent.index].items = _.reject(\r\n              tree[item.parent.parent.index].items[item.parent.index].items,\r\n              { id: item.id }\r\n            )\r\n            updateTree(tree)\r\n            $.unblockUI()\r\n          })\r\n          .fail(() => $.unblockUI())\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n    return (\r\n      <div className='pull-right sf_admin_td_actions'>\r\n        <div className='btn-group dropdown-modern'>\r\n          <a className='btn btn-mini dropdown-toggle' data-toggle='dropdown' href='#'>\r\n            <span className='icon-tc-ellipsis-v' />\r\n          </a>\r\n\r\n          <ul className='dropdown-menu pull-right'>\r\n            {user_has_role_permission('paso_edit') && (\r\n              <Fragment>\r\n                <li>\r\n                  <ModalPasoEdit paso={item} />\r\n                </li>\r\n                {!_.include([ 'PERIODO', 'MATERIALIDAD' ], item.tipo) && (\r\n                  <li>\r\n                    <ModalPasoAssoc paso={item} />\r\n                  </li>\r\n                )}\r\n              </Fragment>\r\n            )}\r\n            {!_.include([ '14', '2A9' ], item.code) &&\r\n            user_has_role_permission('paso_delete') && (\r\n              <Fragment>\r\n                <li className='divider' />\r\n                <li>\r\n                  <a href='#' onClick={this.onClickDelete}>\r\n                    Eliminar\r\n                  </a>\r\n                </li>\r\n              </Fragment>\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class DropdownItemAssignUser extends PureComponent<\r\n  { paso_visita: any; paso: ItemPaso },\r\n  { isOpen: boolean; id_asignado: string }\r\n> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  constructor(props: { paso_visita: any; paso: ItemPaso }) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      id_asignado: props.paso_visita.id_usuario_asignado\r\n    }\r\n  }\r\n\r\n  onChange = (ev: React.SyntheticEvent, data: any) => {\r\n    this.setState({ id_asignado: data.value })\r\n  }\r\n\r\n  onSubmit = () => {\r\n    const { paso, paso_visita } = this.props\r\n    const { tree, updateTree } = this.context\r\n\r\n    const paso_visita_id = paso_visita.id_master_data_paso_has_proyecto_visita\r\n\r\n    $.blockUI(create_blockUI_loading_message('Guardando cambios'))\r\n    $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/visita/${paso_visita_id}/asignar`), {\r\n      paso_id_usuario: this.state.id_asignado\r\n    })\r\n      .done((res) => {\r\n        if (!res.hasErrors) {\r\n          tree[paso.parent.parent.index].items[paso.parent.index].open = true\r\n          tree[paso.parent.parent.index].items[paso.parent.index].items[paso.index].paso_visitas =\r\n            res.response.paso_visitas\r\n\r\n          updateTree(tree)\r\n        }\r\n        $.unblockUI()\r\n      })\r\n      .fail(() => $.unblockUI())\r\n\r\n    this.setState({ isOpen: false })\r\n  }\r\n\r\n  onClickItem = () => {\r\n    this.setState({ isOpen: true })\r\n    setTimeout(() => $('.ui.dropdown.contextmenu .menu.visible').removeClass('visible'), 30)\r\n  }\r\n\r\n  render() {\r\n    const { paso, paso_visita } = this.props\r\n    const { visitas } = this.context\r\n    const visita: ProyectoVisita = _.find(visitas, { id_proyecto_visita: paso_visita.id_proyecto_visita })\r\n\r\n    const equipoOptions: any = _.map(app.vars.plan_auditoria.equipo, function(item: ProyectoEquipo) {\r\n      return {\r\n        key: item.user_id,\r\n        text: item.name,\r\n        value: item.user_id,\r\n        description: item.rol.name,\r\n        label: { content: item.sigla, circular: true, color: 'green' }\r\n      }\r\n    })\r\n\r\n    return (\r\n      <Fragment>\r\n        <Dropdown.Item onClick={this.onClickItem}>Asignar usuario</Dropdown.Item>\r\n        {this.state.isOpen && (\r\n          <Modal\r\n            open\r\n            size='tiny'\r\n            dimmer='inverted'\r\n            className='modal-ab modal-pasouser'\r\n            onClose={() => this.setState({ isOpen: false })}\r\n            closeIcon\r\n          >\r\n            <Modal.Header content='Asignar usuario' />\r\n            <Modal.Content>\r\n              <blockquote>\r\n                <div>\r\n                  <strong>Rubro:</strong> {paso.parent.descripcion}\r\n                </div>\r\n                <div>\r\n                  <strong>Paso:</strong> {paso.descripcion}\r\n                </div>\r\n                {paso.tipo == 'PERIODO' ? (\r\n                  <div>\r\n                    <strong>Periodo:</strong> {paso_visita.visita_alias}\r\n                  </div>\r\n                ) : (\r\n                  <div>\r\n                    <strong>Visita:</strong> {visita.name}\r\n                  </div>\r\n                )}\r\n              </blockquote>\r\n\r\n              <div className='ui form'>\r\n                <div className='field'>\r\n                  <label htmlFor=''>Asocie las visitas relacionadas con este paso</label>\r\n                  <br />\r\n                  <Dropdown\r\n                    placeholder='Seleccione el usuario'\r\n                    defaultValue={paso_visita.id_usuario_asignado}\r\n                    selection\r\n                    clearable\r\n                    fluid\r\n                    options={equipoOptions}\r\n                    onChange={this.onChange}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </Modal.Content>\r\n            <Modal.Actions>\r\n              <button className='ui button negative' onClick={() => this.setState({ isOpen: false })}>\r\n                Cancelar\r\n              </button>\r\n              <button className='ui button primary' onClick={this.onSubmit}>\r\n                Aceptar\r\n              </button>\r\n            </Modal.Actions>\r\n          </Modal>\r\n        )}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport class DropdownItemDeletePasoVisita extends PureComponent<{ paso_visita: any; paso: ItemPaso }> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  onClickDelete = () => {\r\n    const { paso, paso_visita } = this.props\r\n    const { tree, updateTree, visitas } = this.context\r\n\r\n    const visita: ProyectoVisita = _.find(visitas, { id_proyecto_visita: paso_visita.id_proyecto_visita })\r\n\r\n    bootbox.warningConfirm(\r\n      `¿Está seguro de querer desvincular la visita <strong>\"${visita.name}\"</strong> del paso <strong>\"${paso.descripcion}\"</strong>?`,\r\n      'No',\r\n      'Sí, Desvincular visita',\r\n      (answer) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        const paso_visita_id = paso_visita.id_master_data_paso_has_proyecto_visita\r\n        $.blockUI(create_blockUI_loading_message('Desvinculando Visita del Paso...'))\r\n        $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/visita/${paso_visita_id}/desasociar`), {\r\n          sf_method: 'delete'\r\n        })\r\n          .done((res) => {\r\n            tree[paso.parent.parent.index].items[paso.parent.index].open = true\r\n            tree[paso.parent.parent.index].items[paso.parent.index].items[paso.index].paso_visitas =\r\n              res.response.paso_visitas\r\n\r\n            updateTree(tree)\r\n            $.unblockUI()\r\n          })\r\n          .fail(() => $.unblockUI())\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Dropdown.Item key='delete' onClick={this.onClickDelete}>\r\n        Desvincular visita\r\n      </Dropdown.Item>\r\n    )\r\n  }\r\n}\r\n","import { Component, SyntheticEvent, Fragment, PureComponent } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport Step from 'semantic-ui-react/dist/commonjs/elements/Step/Step'\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label/Label'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport Grid from 'semantic-ui-react/dist/commonjs/collections/Grid/Grid'\r\nimport Form from 'semantic-ui-react/dist/commonjs/collections/Form/Form'\r\nimport Segment from 'semantic-ui-react/dist/commonjs/elements/Segment/Segment'\r\nimport Radio from 'semantic-ui-react/dist/commonjs/addons/Radio/Radio'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\n\r\nimport DualListBox from 'react-dual-listbox'\r\nimport PlanAuditoriaContext from './PlanAuditoriaContext'\r\n\r\ndeclare var app: any\r\n\r\nconst DualListBoxIcons = {\r\n  moveLeft: <i className='icon angle left' />,\r\n  moveAllLeft: <i className='icon angle double left' />,\r\n  moveRight: <i className='icon angle right' />,\r\n  moveAllRight: <i className='icon angle double right' />,\r\n  moveDown: <i className='icon angle down' />,\r\n  moveUp: <i className='icon angle up' />\r\n}\r\n\r\n// ******************** STEP 1 *********************************\r\n/**\r\n *\r\n */\r\nclass ModalPasoStep1 extends Component<{ onSelect: (pasoTipo: ProyectoPasoTipo) => void }> {\r\n  render() {\r\n    return (\r\n      <div className='step-content step-content-1'>\r\n        <h4 className='ui centered header'>¿Qué tipo de paso de auditoría desea crear?</h4>\r\n        <Grid relaxed centered columns={4} textAlign='center'>\r\n          <Grid.Column>\r\n            <Segment textAlign='center' centered className='paso-tipo' onClick={() => this.props.onSelect('DEFAULT')}>\r\n              <Icon name='list ul' size='big' />\r\n              <div className='paso-tipo-name'>\r\n                Lista de Chequeo\r\n                <Popup\r\n                  size='tiny'\r\n                  trigger={<Icon color='blue' size='small' name='question circle' />}\r\n                  header='Paso - Tipo Lista de Chequeo'\r\n                  content={`Relación de instrucciones o actividades definidas como guía detallada\r\n                  para ser ejecutadas por el auditor permitiendo una revisión efectiva,\r\n                  por lo general contienen el paso a paso de un programa de trabajo para realizar pruebas sustantivas\r\n                  (prueba de detalle, revisiones analíticas, etc).`}\r\n                />\r\n              </div>\r\n            </Segment>\r\n          </Grid.Column>\r\n          <Grid.Column>\r\n            <Segment\r\n              textAlign='center'\r\n              disabled={app.vars.plan_auditoria.proyecto.version == '1'}\r\n              className='paso-tipo'\r\n              onClick={() => {\r\n                if (app.vars.plan_auditoria.proyecto.version == '1') {\r\n                  bootbox.alert(\r\n                    'Esta opción solo está disponible para los proyectos actualizados con la nueva versión de la Hoja de Trabajo.'\r\n                  )\r\n                } else {\r\n                  return this.props.onSelect('PERIODO')\r\n                }\r\n              }}\r\n            >\r\n              <Icon name='calendar alternate outline' size='big' />\r\n              <div className='paso-tipo-name'>\r\n                Impuestos\r\n                <Popup\r\n                  size='tiny'\r\n                  trigger={<Icon color='blue' size='small' name='question circle' />}\r\n                  header='Paso - Tipo Impuesto'\r\n                  content={`Programa de trabajo para la revisión periódica de impuestos por parte del auditor,\r\n                  es requerido crear un paso de impuestos por cada impuesto a verificar.\r\n                  La principal diferencia con un paso de lista de chequeo consiste que los impuestos\r\n                  se vinculan a periodos de vencimientos y las listas de chequeo se vinculan a\r\n                  visitas fuerte de auditoria (planeación,prefinal, final, etc.)\r\n                  por tanto, para pasos de impuestos no es requerido subir cifras en sumarias.`}\r\n                />\r\n              </div>\r\n            </Segment>\r\n          </Grid.Column>\r\n          <Grid.Column>\r\n            <Segment textAlign='center' disabled className='paso-tipo comingsoon'>\r\n              <Label color='orange' ribbon='right' size='medium'>\r\n                Próximamente\r\n              </Label>\r\n              <div className='clearfix' />\r\n              <Icon name='file alternate outline' size='big' />\r\n              <div className='paso-tipo-name'>Formatos</div>\r\n            </Segment>\r\n          </Grid.Column>\r\n        </Grid>\r\n        <br />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ndeclare type ModalPasoStepDefaultProps = {\r\n  value: any\r\n  onChange: (value: any) => void\r\n  onContinue: () => void\r\n  onCancel: () => void\r\n}\r\n\r\n// ******************** STEP 2 *********************************\r\n/**\r\n *\r\n */\r\nclass ModalPasoStep2 extends Component<ModalPasoStepDefaultProps> {\r\n  onChange = (e: any) => {\r\n    this.props.onChange(e.target.value)\r\n  }\r\n\r\n  onSubmit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onContinue()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className='step-content step-content-2'>\r\n        <Form onSubmit={this.onSubmit}>\r\n          <Grid centered textAlign='center'>\r\n            <Grid.Column width={10}>\r\n              <Form.Field required label='Ingrese el nombre del paso' />\r\n              <Form.Input\r\n                type='text'\r\n                name='paso_name'\r\n                placeholder='Nombre del paso'\r\n                defaultValue={this.props.value}\r\n                onChange={this.onChange}\r\n                maxLength={255}\r\n                required\r\n              />\r\n            </Grid.Column>\r\n          </Grid>\r\n          <br />\r\n          <Button negative content='Volver' onClick={this.props.onCancel} type='button' />\r\n          <Button positive content='Continuar' floated='right' />\r\n        </Form>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n// ******************** STEP 3 *********************************\r\n\r\n/**\r\n *\r\n */\r\nclass ModalPasoStep3 extends Component<ModalPasoStepDefaultProps, { value: string[] }> {\r\n  constructor(props: ModalPasoStepDefaultProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: this.props.value\r\n    }\r\n  }\r\n\r\n  onChange = (selected: string[]) => {\r\n    this.setState({ value: selected })\r\n    this.props.onChange(selected)\r\n  }\r\n\r\n  onSubmit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onContinue()\r\n  }\r\n\r\n  render() {\r\n    let options: { value: string; label: string }[] = []\r\n    _.forEach(app.vars.plan_auditoria.objetivos, function(item: ProyectoObjetivo) {\r\n      options.push({ value: item.id, label: item.name })\r\n    })\r\n\r\n    return (\r\n      <div className='step-content step-content-3'>\r\n        <Form onSubmit={this.onSubmit}>\r\n          <Grid centered textAlign='center'>\r\n            <Grid.Column width={10}>\r\n              <Form.Field label='Asocie las aserciones a relacionar con este paso' /> <br />\r\n              <DualListBox\r\n                name='aserciones'\r\n                options={options}\r\n                availableLabel='Por asociar'\r\n                selectedLabel='Asociadas'\r\n                selected={this.state.value}\r\n                icons={DualListBoxIcons}\r\n                onChange={this.onChange}\r\n              />\r\n            </Grid.Column>\r\n          </Grid>\r\n          <br />\r\n          <Button negative content='Volver' onClick={this.props.onCancel} type='button' />\r\n          <Button positive content='Continuar' floated='right' />\r\n        </Form>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n// ******************** STEP 4 *********************************\r\n\r\n/**\r\n *\r\n */\r\nclass ModalPasoStep4Default extends Component<ModalPasoStepDefaultProps, { value: string[] }> {\r\n  constructor(props: ModalPasoStepDefaultProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: this.props.value\r\n    }\r\n  }\r\n\r\n  onChange = (selected: string[]) => {\r\n    this.setState({ value: selected })\r\n    this.props.onChange(selected)\r\n  }\r\n\r\n  onSubmit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onContinue()\r\n  }\r\n\r\n  render() {\r\n    let options: { value: string; label: string }[] = []\r\n    _.forEach(app.vars.plan_auditoria.visitas, function(item: ProyectoVisita) {\r\n      options.push({ value: item.id, label: item.name })\r\n    })\r\n\r\n    return (\r\n      <div className='step-content step-content-4'>\r\n        <Form onSubmit={this.onSubmit}>\r\n          <Grid centered textAlign='center'>\r\n            <Grid.Column width={10}>\r\n              <Form.Field label='Asocie las visitas a relacionar con este paso' /> <br />\r\n              <DualListBox\r\n                name='visitas'\r\n                options={options}\r\n                availableLabel='Por asociar'\r\n                selectedLabel='Asociadas'\r\n                selected={this.state.value}\r\n                icons={DualListBoxIcons}\r\n                onChange={this.onChange}\r\n              />\r\n            </Grid.Column>\r\n          </Grid>\r\n          <br />\r\n          <Button negative content='Volver' onClick={this.props.onCancel} type='button' />\r\n          <Button positive content='Crear Paso' floated='right' />\r\n        </Form>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass ModalPasoStep4Periodo extends Component<ModalPasoStepDefaultProps, { value: string }> {\r\n  constructor(props: ModalPasoStepDefaultProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: this.props.value\r\n    }\r\n  }\r\n\r\n  onChange = (e: SyntheticEvent, { value }: any) => {\r\n    this.setState({ value })\r\n    this.props.onChange(value)\r\n  }\r\n\r\n  onSubmit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onContinue()\r\n  }\r\n\r\n  render() {\r\n    const options: { text: string; value: string; help?: string }[] = [\r\n      { value: '1', text: 'Mensual', help: 'Enero, Febrero, Marzo, ...' },\r\n      { value: '2', text: 'Bimestral', help: 'Bimestre 1, Bimestre 2, ...' },\r\n      { value: '3', text: 'Trimestral', help: 'Trimestre 1, Trimestre 2, ...' },\r\n      { value: '4', text: 'Cuatrimestral', help: 'Cuatrimestre 1, Cuatrimestre 2, ...' },\r\n      { value: '6', text: 'Semestral', help: 'Semestre 1, Semestre 2' },\r\n      { value: '12', text: 'Anual', help: 'Año actual' }\r\n    ]\r\n\r\n    return (\r\n      <div className='step-content step-content-4'>\r\n        <Form onSubmit={this.onSubmit}>\r\n          <Grid centered textAlign='center'>\r\n            <Grid.Column width={10}>\r\n              <Form.Field label='Indique la periodicidad para este paso' />\r\n              {_.map(options, (option, k) => {\r\n                return (\r\n                  <Form.Field className='field-periodo'>\r\n                    <Radio\r\n                      label={\r\n                        <label>\r\n                          {option.text} <span className='help help-inline'>{option.help}</span>\r\n                        </label>\r\n                      }\r\n                      name='periodo'\r\n                      value={option.value}\r\n                      checked={this.state.value == option.value}\r\n                      onChange={this.onChange}\r\n                    />\r\n                  </Form.Field>\r\n                )\r\n              })}\r\n            </Grid.Column>\r\n          </Grid>\r\n          <br />\r\n          <Button negative content='Volver' onClick={this.props.onCancel} type='button' />\r\n          <Button positive content='Crear Paso' floated='right' />\r\n        </Form>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n// ******************** PASO NEW *********************************\r\ndeclare type ModalPasoNewProps = {\r\n  rubro: ItemSubfase\r\n}\r\n\r\ndeclare type ModalPasoNewState = {\r\n  step: number\r\n  isOpen: boolean\r\n  pasoTipo: ProyectoPasoTipo | null\r\n  formData: any\r\n}\r\n\r\nexport class ModalPasoNew extends Component<ModalPasoNewProps, ModalPasoNewState> {\r\n  constructor(props: ModalPasoNewProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      step: 1,\r\n      pasoTipo: null,\r\n      isOpen: false,\r\n      formData: {\r\n        paso_name: '',\r\n        aserciones: []\r\n      }\r\n    }\r\n  }\r\n\r\n  nextStep = () => {\r\n    this.setState((prevState) => ({\r\n      step: prevState.step + 1\r\n    }))\r\n  }\r\n\r\n  prevStep = () => {\r\n    this.setState((prevState) => ({\r\n      step: prevState.step - 1\r\n    }))\r\n  }\r\n\r\n  selectPasoTipo = (pasoTipo: ProyectoPasoTipo) => {\r\n    this.setState({ step: 2, pasoTipo })\r\n  }\r\n\r\n  _assignFormDataValue(data: any) {\r\n    this.setState((prevState) => {\r\n      let { formData } = prevState\r\n      formData = Object.assign({}, formData, data)\r\n      return { formData }\r\n    })\r\n  }\r\n\r\n  assignPasoName = (paso_name: string) => {\r\n    this._assignFormDataValue({ paso_name })\r\n  }\r\n\r\n  assignAserciones = (aserciones: string[]) => {\r\n    this._assignFormDataValue({ aserciones })\r\n  }\r\n\r\n  assignVisitas = (visitas: string[]) => {\r\n    this._assignFormDataValue({ visitas, periodos: null })\r\n  }\r\n\r\n  assignPeriodos = (periodos: string[]) => {\r\n    this._assignFormDataValue({ visitas: null, periodos })\r\n  }\r\n\r\n  submit = () => {\r\n    $.blockUI(create_blockUI_loading_message('Creando Paso'))\r\n\r\n    let form = document.createElement('form')\r\n    form.method = 'POST'\r\n    form.action = url_for(\r\n      `proyecto/${app.vars.plan_auditoria.proyecto.id}/master_data/fase/${this.props.rubro.id}/paso/newcreate`\r\n    )\r\n\r\n    let input = document.createElement('input')\r\n    input.name = 'tipo'\r\n    input.value = this.state.pasoTipo\r\n    input.type = 'hidden'\r\n    form.appendChild(input)\r\n\r\n    _.forEach(this.state.formData, function(value, key) {\r\n      let input = document.createElement('input')\r\n      input.name = `data[${key}]`\r\n      input.value = value\r\n      input.type = 'hidden'\r\n      form.appendChild(input)\r\n    })\r\n\r\n    document.body.appendChild(form)\r\n\r\n    form.submit()\r\n  }\r\n\r\n  onClose = () => {\r\n    this.setState({ isOpen: false })\r\n  }\r\n\r\n  _getStepContent(step: number) {\r\n    switch (step) {\r\n      case 1:\r\n        return <ModalPasoStep1 onSelect={this.selectPasoTipo} />\r\n      case 2:\r\n        return (\r\n          <ModalPasoStep2\r\n            value={this.state.formData.paso_name}\r\n            onCancel={this.prevStep}\r\n            onChange={this.assignPasoName}\r\n            onContinue={this.nextStep}\r\n          />\r\n        )\r\n      case 3:\r\n        return (\r\n          <ModalPasoStep3\r\n            value={this.state.formData.aserciones}\r\n            onCancel={this.prevStep}\r\n            onChange={this.assignAserciones}\r\n            onContinue={this.nextStep}\r\n          />\r\n        )\r\n      case 4:\r\n        switch (this.state.pasoTipo) {\r\n          case 'DEFAULT':\r\n            return (\r\n              <ModalPasoStep4Default\r\n                value={this.state.formData.visitas}\r\n                onCancel={this.prevStep}\r\n                onChange={this.assignVisitas}\r\n                onContinue={this.submit}\r\n              />\r\n            )\r\n          case 'PERIODO':\r\n            return (\r\n              <ModalPasoStep4Periodo\r\n                value={this.state.formData.periodos}\r\n                onCancel={this.prevStep}\r\n                onChange={this.assignPeriodos}\r\n                onContinue={this.submit}\r\n              />\r\n            )\r\n        }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { step, pasoTipo, isOpen } = this.state\r\n\r\n    let step4Title = ' '\r\n    if (step > 1) {\r\n      step4Title = pasoTipo == 'PERIODO' ? '4. Periodos' : '4. Visitas'\r\n    }\r\n\r\n    const { rubro } = this.props\r\n\r\n    return (\r\n      <Fragment>\r\n        <a href='#' onClick={() => this.setState({ isOpen: true })}>\r\n          Crear Paso\r\n        </a>\r\n        {isOpen && (\r\n          <Modal open className='modal-ab modal-pasocreate' onClose={this.onClose} closeIcon>\r\n            <Modal.Header content='Crear paso' />\r\n            <Modal.Content>\r\n              <p>\r\n                <strong>Rubro:</strong> {rubro.descripcion}\r\n              </p>\r\n              <Step.Group attached='top' size='small' widths={4}>\r\n                <Step active={step == 1} completed={step > 1} icon={step > 1 ? 'check' : ' '} title='1. Tipo' />\r\n                <Step active={step == 2} completed={step > 2} icon={step > 2 ? 'check' : ' '} title='2. Nombre' />\r\n                <Step active={step == 3} completed={step > 3} icon={step > 3 ? 'check' : ' '} title='3. Aserciones' />\r\n                <Step active={step == 4} title={step4Title} icon=' ' />\r\n              </Step.Group>\r\n              {this._getStepContent(step)}\r\n            </Modal.Content>\r\n          </Modal>\r\n        )}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype ModalPasoEditState = {\r\n  isOpen: boolean\r\n  valueName: string\r\n  valueAserciones: string[]\r\n}\r\n\r\nexport class ModalPasoEdit extends PureComponent<{ paso: ItemPaso }, ModalPasoEditState> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  constructor(props: { paso: ItemPaso }) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      valueName: props.paso.descripcion,\r\n      valueAserciones: _.pluck(props.paso.aserciones, 'id_master_data_objetivo')\r\n    }\r\n  }\r\n\r\n  onChangeName = (ev: React.ChangeEvent) => {\r\n    this.setState({ valueName: (ev.target as any).value })\r\n  }\r\n\r\n  onChangeAserciones = (aserciones: string[]) => {\r\n    this.setState({ valueAserciones: aserciones })\r\n  }\r\n\r\n  onSubmit = () => {\r\n    if (_.str.trim(this.state.valueName) == '') {\r\n      bootbox.alert('Indique un nombre para el paso.')\r\n      return\r\n    }\r\n\r\n    const { tree, updateTree } = this.context\r\n    const { paso } = this.props\r\n\r\n    $.blockUI(create_blockUI_loading_message('Guardando los cambios'))\r\n\r\n    $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/paso/${paso.id}`), {\r\n      paso_name: this.state.valueName,\r\n      paso_objetivos: this.state.valueAserciones\r\n    }).done((res) => {\r\n      if (!res.hasErrors) {\r\n        tree[paso.parent.parent.index].items[paso.parent.index].open = true\r\n        tree[paso.parent.parent.index].items[paso.parent.index].items[paso.index].descripcion = this.state.valueName\r\n        tree[paso.parent.parent.index].items[paso.parent.index].items[paso.index].aserciones = _.map(\r\n          this.state.valueAserciones,\r\n          (asercionId) => {\r\n            return { id_master_data_objetivo: asercionId }\r\n          }\r\n        )\r\n        updateTree(tree)\r\n        $.unblockUI()\r\n\r\n        this.setState({ isOpen: false })\r\n      }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { paso } = this.props\r\n\r\n    let asercionesoChoices: { value: string; label: string }[] = []\r\n    _.forEach(app.vars.plan_auditoria.objetivos, function(item: ProyectoObjetivo) {\r\n      asercionesoChoices.push({ value: item.id, label: item.name })\r\n    })\r\n\r\n    return (\r\n      <Fragment>\r\n        <a href='#' onClick={() => this.setState({ isOpen: true })}>\r\n          Editar Paso\r\n        </a>\r\n        {this.state.isOpen && (\r\n          <Modal open className='modal-ab modal-pasoedit' onClose={() => this.setState({ isOpen: false })} closeIcon>\r\n            <Modal.Header content='Editar paso' />\r\n            <Modal.Content>\r\n              <p>\r\n                <div>\r\n                  <strong>Rubro:</strong> {paso.parent.descripcion}\r\n                </div>\r\n                <div>\r\n                  <strong>Paso:</strong> {paso.descripcion}\r\n                </div>\r\n              </p>\r\n\r\n              <div className='ui form'>\r\n                <div className='field required'>\r\n                  <label htmlFor='paso_edit_name'>Nombre del Paso</label>\r\n                  <input\r\n                    type='text'\r\n                    id='paso_edit_name'\r\n                    required\r\n                    value={this.state.valueName}\r\n                    onChange={this.onChangeName}\r\n                    placeholder='Nombre del Paso'\r\n                  />\r\n                </div>\r\n\r\n                <div className='field'>\r\n                  <label htmlFor=''>Asocie las aserciones relacionadas con este paso</label>\r\n                  <br />\r\n                  <DualListBox\r\n                    name='aserciones'\r\n                    options={asercionesoChoices}\r\n                    availableLabel='Por asociar'\r\n                    selectedLabel='Asociadas'\r\n                    selected={this.state.valueAserciones}\r\n                    icons={DualListBoxIcons}\r\n                    onChange={this.onChangeAserciones}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </Modal.Content>\r\n            <Modal.Actions>\r\n              <button className='ui button negative' onClick={() => this.setState({ isOpen: false })}>\r\n                Cancelar\r\n              </button>\r\n              <button className='ui button primary' onClick={this.onSubmit}>\r\n                Aceptar\r\n              </button>\r\n            </Modal.Actions>\r\n          </Modal>\r\n        )}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype ModalPasoAssocState = {\r\n  isOpen: boolean\r\n  visitas: string[]\r\n}\r\n\r\nexport class ModalPasoAssoc extends PureComponent<{ paso: ItemPaso }, ModalPasoAssocState> {\r\n  static contextType = PlanAuditoriaContext\r\n\r\n  constructor(props: { paso: ItemPaso }) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      visitas: _.pluck(props.paso.paso_visitas, 'id_proyecto_visita')\r\n    }\r\n  }\r\n\r\n  onChange = (visitas: string[]) => {\r\n    this.setState({ visitas })\r\n  }\r\n\r\n  onSubmit = () => {\r\n    const { tree, updateTree } = this.context\r\n    const { paso } = this.props\r\n\r\n    $.blockUI(create_blockUI_loading_message('Guardando los cambios'))\r\n\r\n    $.post(url_for(`proyecto/${app.vars.idproyecto}/master_data/asociar-visita`), {\r\n      id_paso: paso.id,\r\n      paso_visitas: this.state.visitas\r\n    }).done((res) => {\r\n      if (!res.hasErrors) {\r\n        tree[paso.parent.parent.index].items[paso.parent.index].open = true\r\n        tree[paso.parent.parent.index].items[paso.parent.index].items[paso.index].paso_visitas =\r\n          res.response.paso_visitas\r\n        updateTree(tree)\r\n        $.unblockUI()\r\n\r\n        this.setState({ isOpen: false })\r\n      }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { paso } = this.props\r\n\r\n    const { visitas } = this.context\r\n\r\n    const options: { value: string; label: string }[] = []\r\n    _.forEach(visitas, function(item: ProyectoVisita) {\r\n      options.push({ value: item.id, label: item.name })\r\n    })\r\n\r\n    return (\r\n      <Fragment>\r\n        <a href='#' onClick={() => this.setState({ isOpen: true })}>\r\n          Asociar Visitas\r\n        </a>\r\n        {this.state.isOpen && (\r\n          <Modal open className='modal-ab modal-pasoedit' onClose={() => this.setState({ isOpen: false })} closeIcon>\r\n            <Modal.Header content='Editar paso' />\r\n            <Modal.Content>\r\n              <div>\r\n                <div>\r\n                  <strong>Rubro:</strong> {paso.parent.descripcion}\r\n                </div>\r\n                <div>\r\n                  <strong>Paso:</strong> {paso.descripcion}\r\n                </div>\r\n              </div>\r\n\r\n              <div className='ui form'>\r\n                <div className='field'>\r\n                  <label htmlFor=''>Asocie las visitas relacionadas con este paso</label>\r\n                  <br />\r\n                  <DualListBox\r\n                    name='aserciones'\r\n                    options={options}\r\n                    availableLabel='Por asociar'\r\n                    selectedLabel='Asociadas'\r\n                    selected={this.state.visitas}\r\n                    icons={DualListBoxIcons}\r\n                    onChange={this.onChange}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </Modal.Content>\r\n            <Modal.Actions>\r\n              <button className='ui button negative' onClick={() => this.setState({ isOpen: false })}>\r\n                Cancelar\r\n              </button>\r\n              <button className='ui button primary' onClick={this.onSubmit}>\r\n                Aceptar\r\n              </button>\r\n            </Modal.Actions>\r\n          </Modal>\r\n        )}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","import { Component, useState, SyntheticEvent, Fragment } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport Grid from 'semantic-ui-react/dist/commonjs/collections/Grid/Grid'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader/Loader'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer/Dimmer'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\n\r\nimport cx from 'classnames'\r\n\r\ndeclare var app: any\r\n\r\nconst ModalStep1 = ({ onSelect }: { onSelect: (value: 'MasterData' | 'Project') => void }) => {\r\n  return (\r\n    <div className='step-content step-content-1'>\r\n      <h4 className='ui centered header'>Seleccione el origen del paso de auditoría que desea copiar?</h4>\r\n      <Grid relaxed centered columns={4} textAlign='center'>\r\n        <Grid.Column>\r\n          <div className='ui segment center aligned paso-copysource clickable' onClick={() => onSelect('MasterData')}>\r\n            <div className='paso-source-name'>Desde Plan de Pruebas</div>\r\n          </div>\r\n        </Grid.Column>\r\n        <Grid.Column>\r\n          <div className='ui segment center aligned paso-copysource clickable' onClick={() => onSelect('Project')}>\r\n            <div className='paso-source-name'>Desde Otro Proyecto</div>\r\n          </div>\r\n        </Grid.Column>\r\n      </Grid>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst parseTreeToItems = (tree: any[]) => {\r\n  const retval = _.map(tree, (fase): HojaTrabajoTreeItem => {\r\n    return {\r\n      id: fase.id,\r\n      descripcion: fase.descripcion,\r\n      type: 'phase',\r\n      items: _.map(fase.Subfases, (subfase: any): HojaTrabajoTreeItem => {\r\n        return {\r\n          id: subfase.id,\r\n          descripcion: subfase.descripcion,\r\n          type: 'subphase',\r\n          items: _.map(subfase.MasterDataPaso, (paso: any): HojaTrabajoTreeItem => {\r\n            return {\r\n              id: paso.id,\r\n              descripcion: paso.descripcion,\r\n              code: paso.code,\r\n              type: 'paso'\r\n            }\r\n          })\r\n        }\r\n      })\r\n    }\r\n  })\r\n\r\n  return retval\r\n}\r\n\r\nconst extractPasosCodes = (tree: any[]) => {\r\n  let codes: string[] = []\r\n  _.each(tree, (fase): any => {\r\n    _.each(fase.Subfases, (subfase: any) => {\r\n      _.each(subfase.MasterDataPaso, (paso: any) => {\r\n        codes.push(paso.code)\r\n      })\r\n    })\r\n  })\r\n\r\n  return codes\r\n}\r\n\r\nconst getQueryUrlParams = (): any => {\r\n  let queryString = location.search.slice(1),\r\n    params: any = {}\r\n\r\n  queryString.replace(/([^=]*)=([^&]*)&*/g, function(_, key, value) {\r\n    params[key] = value\r\n    return _\r\n  })\r\n\r\n  return params\r\n}\r\n\r\nconst setQueryUrlParams = (params: any) => {\r\n  var query = [],\r\n    key,\r\n    value\r\n\r\n  for (key in params) {\r\n    if (!params.hasOwnProperty(key)) continue\r\n    value = params[key]\r\n    query.push(key + '=' + value)\r\n  }\r\n\r\n  location.search = query.join('&')\r\n}\r\n\r\nconst updateQueryUrlParams = (param: string, value: string) => {\r\n  var params = getQueryUrlParams()\r\n\r\n  if (params[param] != value) {\r\n    params[param] = value\r\n    setQueryUrlParams(params)\r\n  }\r\n}\r\n\r\nconst USED_PASO_CODES = extractPasosCodes(app.vars.plan_auditoria.fases)\r\n\r\ntype HojaTrabajoTreeItem = {\r\n  id: string\r\n  descripcion: string\r\n  type: string\r\n  code?: string\r\n  items?: HojaTrabajoTreeItem[]\r\n}\r\n\r\ntype TreeItemFaseProps = {\r\n  item: HojaTrabajoTreeItem\r\n  onChecked: (item: HojaTrabajoTreeItem, isChecked: boolean) => void\r\n}\r\n\r\nconst TreeItemFase = ({ item, onChecked }: TreeItemFaseProps) => {\r\n  const [ collapsed, setCollapsed ] = useState(true)\r\n\r\n  const onClick = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    setCollapsed(!collapsed)\r\n  }\r\n\r\n  const countPending = (item: HojaTrabajoTreeItem) => {\r\n    let hasPending = false\r\n\r\n    if (item.items) {\r\n      _.each(item.items, function(subitem) {\r\n        hasPending = hasPending || countPending(subitem)\r\n        if (hasPending) {\r\n          return true\r\n        }\r\n      })\r\n    } else if (item.code && !_.contains(USED_PASO_CODES, item.code)) {\r\n      hasPending = true\r\n    }\r\n\r\n    return hasPending\r\n  }\r\n\r\n  const hasPending = countPending(item)\r\n\r\n  return (\r\n    <li key={item.id} className={cx('methodology-item', item.type)}>\r\n      <div className='methodology-item-head'>\r\n        <a href='#' onClick={onClick}>\r\n          <span className='item-name'>{item.descripcion}</span>\r\n        </a>\r\n        {hasPending && (\r\n          <Popup\r\n            trigger={\r\n              <span className='pull-right ui-state-error-text'>\r\n                <span className='icon-info-sign' />\r\n              </span>\r\n            }\r\n            content='Este elemento contiene pasos que no se encuentran en su Plan de Auditoría'\r\n            on='hover'\r\n            className='disabled-text'\r\n          />\r\n        )}\r\n      </div>\r\n      <ul className={cx('methodology collapse', collapsed ? 'hide' : 'in')}>\r\n        {_.map(item.items as any[], (subitem) => {\r\n          subitem.parent = item\r\n          return subitem.type == 'paso' ? (\r\n            <TreeItemPaso\r\n              key={subitem.id}\r\n              item={subitem}\r\n              onChecked={(checked: boolean) => onChecked(subitem, checked)}\r\n            />\r\n          ) : (\r\n            <TreeItemFase key={subitem.id} item={subitem} onChecked={onChecked} />\r\n          )\r\n        })}\r\n      </ul>\r\n    </li>\r\n  )\r\n}\r\n\r\nconst TreeItemPaso = ({ item, onChecked }: { item: HojaTrabajoTreeItem; onChecked: (checked: boolean) => void }) => {\r\n  let [ isChecked, setChecked ] = useState(false)\r\n  const used_coded = _.contains(USED_PASO_CODES, item.code)\r\n  const onChangeCheckbox = (ev: SyntheticEvent) => {\r\n    setChecked((ev.target as any).checked)\r\n    onChecked((ev.target as any).checked)\r\n  }\r\n\r\n  const itemClasses = cx(\r\n    'methodology-item paso',\r\n    used_coded && !isChecked ? 'ui-state-disabled' : null,\r\n    isChecked ? 'selected' : null\r\n  )\r\n\r\n  return (\r\n    <li key={item.id} className={itemClasses}>\r\n      <div className='methodology-item-head'>\r\n        <label htmlFor={`tree-paso-${item.id}`}>\r\n          <input\r\n            type='checkbox'\r\n            id={`tree-paso-${item.id}`}\r\n            className='checkbox'\r\n            checked={isChecked}\r\n            onChange={onChangeCheckbox}\r\n          />\r\n          <span className='item-name'>\r\n            {item.descripcion}\r\n            {used_coded && (\r\n              <span className='label label-important' style={{ marginLeft: 5 }}>\r\n                Agregado\r\n              </span>\r\n            )}\r\n          </span>\r\n        </label>\r\n      </div>\r\n    </li>\r\n  )\r\n}\r\n\r\ntype ModalStep2MaterDataProps = {\r\n  onSelect: (values: string[]) => void\r\n  rubroId: string\r\n}\r\n\r\ntype ModalStep2MaterDataState = {\r\n  isLoading: boolean\r\n  selectedPasos: string[]\r\n}\r\n\r\nclass ModalStep2MaterData extends Component<ModalStep2MaterDataProps, ModalStep2MaterDataState> {\r\n  static masterData: any = null\r\n\r\n  state: ModalStep2MaterDataState = {\r\n    isLoading: false,\r\n    selectedPasos: []\r\n  }\r\n\r\n  componentDidMount() {\r\n    this._loadMasterData()\r\n  }\r\n\r\n  _loadMasterData() {\r\n    if (ModalStep2MaterData.masterData == null) {\r\n      this.setState({ isLoading: true })\r\n      $.getJSON(url_for(`proyecto/${app.vars.plan_auditoria.proyecto.id}/master_data_tree`)).done((res) => {\r\n        ModalStep2MaterData.masterData = parseTreeToItems(res.response)\r\n        this.setState({ isLoading: false })\r\n      })\r\n    }\r\n  }\r\n\r\n  onChangeCheckedPaso = (item: HojaTrabajoTreeItem, isChecked: boolean) => {\r\n    let { selectedPasos } = this.state\r\n    if (isChecked) {\r\n      if (!(item.id in selectedPasos)) {\r\n        selectedPasos.push(item.id)\r\n      }\r\n    } else {\r\n      selectedPasos = _.reject(selectedPasos, function(element) {\r\n        return element == item.id\r\n      })\r\n    }\r\n\r\n    this.setState({ selectedPasos })\r\n    this.props.onSelect(selectedPasos)\r\n  }\r\n\r\n  onSubmit = () => {\r\n    $.blockUI(create_blockUI_loading_message('Guardando cambios...'))\r\n\r\n    let postParams = {\r\n      item_type: 'paso',\r\n      parent_id: this.props.rubroId,\r\n      items: this.state.selectedPasos\r\n    }\r\n    $.post(url_for(`proyecto/${app.vars.plan_auditoria.proyecto.id}/copy_from`), postParams)\r\n      .done((res) => {\r\n        if (!res.hasErrors) {\r\n          updateQueryUrlParams('rubro', this.props.rubroId)\r\n          location.reload()\r\n        }\r\n      })\r\n      .fail(() => {\r\n        $.unblockUI()\r\n      })\r\n  }\r\n\r\n  renderTree() {\r\n    return (\r\n      <ul className='methodology checkbox-list methodology-all nav nav-stacked'>\r\n        {_.map(ModalStep2MaterData.masterData, (fase: HojaTrabajoTreeItem) => {\r\n          return (\r\n            <TreeItemFase key={`tree-item-${fase.type}-${fase.id}`} item={fase} onChecked={this.onChangeCheckedPaso} />\r\n          )\r\n        })}\r\n      </ul>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className='step-content step-content-2 step-content-2-masterdata'>\r\n        <h4 className='ui centered header'>Seleccione los pasos que desea copiar a su Plan de Auditoría?</h4>\r\n        {this.state.isLoading ? (\r\n          <div className='ui segment' style={{ minHeight: 200 }}>\r\n            <Dimmer active inverted>\r\n              <Loader inverted content='Cargando datos...' />\r\n            </Dimmer>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            {this.renderTree()}\r\n            <div className='btn-actions'>\r\n              <Popup\r\n                trigger={\r\n                  <button\r\n                    onClick={this.onSubmit}\r\n                    className='btn btn-primary pull-right'\r\n                    disabled={this.state.selectedPasos.length == 0}\r\n                  >\r\n                    Guardar\r\n                  </button>\r\n                }\r\n                content='Debe seleccionar por lo menos un paso a copiar'\r\n                header='Guardar | Opción deshabilitada'\r\n                disabled={this.state.selectedPasos.length > 0}\r\n                className='disable-text'\r\n                on='hover'\r\n              />\r\n            </div>\r\n            <div className='clearfix' />\r\n          </div>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype ModalPasoCopyFromProps = {\r\n  rubro: ItemSubfase\r\n}\r\n\r\ntype ModalPasoCopyFromState = {\r\n  isOpen: boolean\r\n  step: number\r\n  sourceSelected?: 'MasterData' | 'Project'\r\n  pasosSelected: string[]\r\n}\r\n\r\nexport class ModalPasoCopyFrom extends Component<ModalPasoCopyFromProps, ModalPasoCopyFromState> {\r\n  state: ModalPasoCopyFromState = {\r\n    isOpen: false,\r\n    step: 2,\r\n    sourceSelected: 'MasterData',\r\n    pasosSelected: []\r\n  }\r\n\r\n  onClose = () => {\r\n    this.setState({ isOpen: false })\r\n  }\r\n\r\n  onSelectSource = (sourceSelected: 'MasterData' | 'Project') => {\r\n    this.setState({ step: 2, sourceSelected })\r\n  }\r\n\r\n  onSelectPasos = (pasosSelected: string[]) => {\r\n    this.setState({ pasosSelected })\r\n  }\r\n\r\n  getStepContent() {\r\n    switch (this.state.step) {\r\n      case 1:\r\n        return <ModalStep1 onSelect={this.onSelectSource} />\r\n      case 2:\r\n        switch (this.state.sourceSelected) {\r\n          case 'MasterData':\r\n            return <ModalStep2MaterData rubroId={this.props.rubro.id} onSelect={this.onSelectPasos} />\r\n        }\r\n    }\r\n  }\r\n\r\n  renderModal() {\r\n    const { rubro } = this.props\r\n\r\n    let sourceSelected = ''\r\n    switch (this.state.sourceSelected) {\r\n      case 'MasterData':\r\n        sourceSelected = 'Biblioteca de Pasos'\r\n        break\r\n    }\r\n\r\n    return (\r\n      <Modal open className='modal-ab modal-pasocopyfrom' onClose={this.onClose} closeIcon closeOnDimmerClick={false}>\r\n        <Modal.Header content={`Copiar paso desde... ${sourceSelected}`} />\r\n        <Modal.Content>\r\n          <p>\r\n            <strong>Rubro:</strong> {rubro.descripcion}\r\n          </p>\r\n\r\n          {this.getStepContent()}\r\n        </Modal.Content>\r\n      </Modal>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    if (app.vars.plan_auditoria.proyecto.version == '1') {\r\n      return (\r\n        <Popup\r\n          header='Opción deshabilitada'\r\n          content='Esta opción no esta disponible para esta versión de proyectos'\r\n          trigger={<a className='disabled ui-state-disabled'>Copiar Paso desde Biblioteca</a>}\r\n          position='left center'\r\n          size='small'\r\n          className='disabled-text'\r\n        />\r\n      )\r\n    } else {\r\n      return (\r\n        <Fragment>\r\n          <a\r\n            href='#'\r\n            onClick={(ev) => {\r\n              ev.preventDefault()\r\n              this.setState({ isOpen: true })\r\n            }}\r\n          >\r\n            Copiar Paso desde Biblioteca\r\n          </a>\r\n\r\n          {this.state.isOpen && this.renderModal()}\r\n        </Fragment>\r\n      )\r\n    }\r\n  }\r\n}\r\n","declare var app: any\r\n\r\nexport namespace ProyectoPlanAuditoriaUtils {\r\n  export function getUserById(id: string) {\r\n    return app.vars.plan_auditoria.equipo[id]\r\n  }\r\n\r\n  export function getVisitaById(id: string): any {\r\n    return _.find(app.vars.plan_auditoria.visitas, { id })\r\n  }\r\n\r\n  export function changeOpenToAll(tree: any, value: boolean) {\r\n    _.each(tree, (item) => {\r\n      if (typeof item.open !== 'undefined') {\r\n        item.open = value\r\n      }\r\n\r\n      if (typeof item.items !== 'undefined') {\r\n        changeOpenToAll(item.items, value)\r\n      }\r\n    })\r\n  }\r\n}\r\n"],"sourceRoot":""}