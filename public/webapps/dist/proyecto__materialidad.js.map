{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"React\"","webpack:///./src/proyecto__hoja_trabajo/HojaTrabajoContext.ts","webpack:///./src/global/AuthorIconLog.tsx","webpack:///./src/global/StatusButtonAction.tsx","webpack:///./src/global/EditorPreview.tsx","webpack:///./src/proyecto__hoja_trabajo/utils.ts","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem__new.tsx","webpack:///./src/global/InputAutoNumeric.tsx","webpack:///./src/proyecto__hoja_trabajo/utils_hallazgo.ts","webpack:///./src/proyecto__hoja_trabajo/AppVisitaTab.tsx","webpack:///./src/proyecto__hoja_trabajo/Attachments.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/ajuste_modal.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_ajuste_context.ts","webpack:///./src/proyecto__hoja_trabajo/utils_ajuste.ts","webpack:///./src/global/Tooltip.tsx","webpack:///./src/proyecto__hoja_trabajo/utils_truncate.ts","webpack:///./src/proyecto__hoja_trabajo/sidebar/hallazgo_modal.tsx","webpack:///./src/proyecto__materialidad/MaterialidadUtils.ts","webpack:///./src/proyecto__materialidad/index.tsx","webpack:///./src/proyecto__materialidad/App.tsx","webpack:///external \"ReactDOM\"","webpack:///./src/global/ButtonEdit.tsx","webpack:///./src/proyecto__materialidad/TabPaneVisita.tsx","webpack:///./src/proyecto__hoja_trabajo/MenuSidebarVisita.tsx","webpack:///./src/proyecto__hoja_trabajo/TabPaneVisitaModals.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_ajuste.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/panel_header.tsx","webpack:///./src/global/ErrorHandler.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/ajuste_list.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_hallazgo.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/hallazgo_list.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/hallazgo_edit.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_revision.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/revision_list.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem__model_manager.ts","webpack:///./src/proyecto__materialidad/MaterialidadForm.tsx","webpack:///./src/proyecto__materialidad/MaterialidadObservacionesEditor.tsx","webpack:///./src/proyecto__materialidad/MaterialidadPercentTable.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","React","createContext","hoja_trabajo","update","AuthorIconLog","Component","classes","this","props","className","inline","size","iconComp","icon","color","_","log","iconColor","disabled","alertText","Group","corner","item","label","User","sigla","dateTime","Date","ts","format","trigger","position","pinned","Header","Content","map","k","AuthorIconLogEditable","state","isLoading","onClickEdit","ev","preventDefault","setState","style","inverted","active","disableEdit","compact","onClick","editText","content","defaultProps","AuthorIconLogDefaultWrapper","model","alertTextRevisado","fecha_completado","fecha_revision","UpdateLog","RevisionLog","CompletadoButtonAction","PureComponent","completado_disabled_text","disableText","primary","header","on","RevisadoButtonAction","showAlert","revisado_disabled_text","record","icon_revisado_alert","StatusButtonGroupActions","prepend","user_has_role_permission","completado","permission","revisado","append","wrapperClassName","hideLabel","str","dasherize","status","toLowerCase","CKEDITOR_OPTIONS","basic","height","toolbar","groups","items","autoParagraph","removePlugins","extraPlugins","EditorPreview","previewRef","createRef","handleEscape","e","getCode","Escape","CKEDITOR","dialog","getCurrent","onClose","onChange","evt","onSave","editor","_cachedEditor","autosave","autosaveId","setTimeout","AUTOSAVE_DELAY","isModalEditOpen","clearTimeout","$","isFunction","getEditor","isAutosaving","fetchAttachments","onCancel","clearInterval","onModalMount","sub","pool","attachments","ckeditor","onClickPreview","openOnClickPreview","onUpdateAttachment","onDeleteAttachment","adjunto","cb","isLoadingAttachments","cleanAttachmentFrom","setData","open","ckeditorComp","editable","required","trim","getData","bootbox","alert","nextProps","current","find","each","attr","ckeditorOptions","ckeditorUploadOptions","defaultUrl","app","vars","idproyecto","url","modelId","uploadUrl","url_for","imageUploadUrl","filebrowserUploadUrl","getJSON","model_id","done","res","response","self","assign","enterMode","ENTER_BR","openlink_modifier","onAttachmentUpload","replace","rs","JSON","parse","console","forEach","uploaded","insertHtml","fileName","error","hide","onUpload","ckeditor_comp","parseCkeditorOptions","fileUploadRequest","loader","fileLoader","unblockUI","blockUI","message","fileUploadResponse","fire","paste","dataValue","footer","AttachmentListPanel","onUpdateItem","onDeleteItem","classNames","closeIcon","closeOnDimmerClick","dimmer","closeOnEscape","onMount","renderEditor","Actions","leftActions","labelTitle","Fragment","dangerouslySetInnerHTML","__html","minHeight","ref","config","getCkeditorOptions","onInstanceReady","readOnly","renderFooter","preview","prefixPreview","previewStyle","renderModal","HojaTrabajoUtils","HojaTrabajoUpdateUtils","getAllVisitasAfter","visitaPivot","visitas","found","visita","id","updateVisita","new_data","hoja_trabajo_copy","mapValues","updateVisitas","visita_new_data","id_visita","findWhere","updateField","field","MenuItemNew","modalOpen","onCloseModal","then","isEditable","MenuItemModal","contentAs","buttonText","headerText","moduleParams","marginBottom","paddingTop","fontWeight","decimalPlaces","decimalCharacter","decimalCharacterAlternative","digitGroupSeparator","allowDecimalPadding","selectOnFocus","HallazgoUtils","formatName","match","AppVisitaDefaultTab","status_label","backgroundColor","status_color","underscored","title","getStatusLabel","PasoObjetivoPane","onChangeValue","objetivo","context","create_blockUI_loading_message","proyecto","paso","ajax","type","dataType","hoja_trabajo_new","contextType","PasoVisitaStatusActions","onClickCompletado","op","hasErrors","onClickRevisado","include","id_status","completadoDisabledText","additionals","revisiones","revisadoDisabledText","_visita","getRevisadoDisabledText","includes","fitted","PasoVisitaAssoc","newVisitaOpen","selectedVisitas","filter","icons","moveLeft","moveAllLeft","moveRight","moveAllRight","moveDown","moveUp","options","method","action","availableLabel","selectedLabel","selected","horizontal","Title","Field","placeholder","getModal","h","public_path","filepath","re","RegExp","AttachmentListItem","onRemove","attachment","id_proyecto","warningConfirm","onDelete","fail","pnotify","text","capitalize","onUpdate","completadoComp","revisadoComp","revisadoLink","display","minWidth","textAlign","marginRight","fecha_revisado","user_has_role","marginLeft","changeStatus","background","borderRadius","border","marginTop","borderRight","src","getFileIconUrl","filename","alt","padding","fontSize","maxWidth","whiteSpace","overflow","textOverflow","fontStyle","filesize_human","href","target","split","pop","file","extension","getFileExtension","file_icon","circular","divided","AjusteModal","onChangeAplicado","aplicado","isNewItem","onChangeDescripcion","descripcion","onAddItem","prevState","createAjusteEmpty","itemIndex","reject","_item","notify","blockingText","any","onCreate","_onCreate","onCreateAndCompletado","onCompletado","onRevisado","idx","reduce","acc","curr","num","debe","haber","changes","validateItems","MenuItemNewHeader","Consumer","cuentas","row","AjusteTableRow","canRemove","onClickDelete","esPlanillaDescuadrada","revisadoDisableText","rightActions","renderItemHeader","renderRows","colSpan","accounting","formatNumber","error_tolerable","GenericTooltip","renderActions","confirm","onSelectCuenta","cuenta","nombre_cuenta","notifyUpdate","onChangeCuenta","onChangeNombreCuenta","onBlurCuenta","getNombreCuenta","toUpperCase","onChangeInput","persist","getItemValue","renderItem","isHighlighted","onSelect","inputProps","spellCheck","onBlur","shouldItemRender","startsWith","renderMenu","zIndex","children","wrapperProps","wrapperStyle","normalize","contains","input","v","parseFloat","isNaN","cleanCuenta","cuenta_real","substr","texts","wide","iconSize","cleanSpacesFromHtml","html","keepImageTag","registerLocale","HallazgoModal","handlers","onEditorChange","attachHandler","closeModal","updateModel","onInputChange","onDateChange","onValueChange","handler","date","isValid","implementado","isEmpty","hallazgo","attach_disableText","overflowY","maxHeight","width","plan_accion","htmlFor","HallazgoResponsableInput","responsable","attrs","dateFormat","locale","fixedHeight","placeholderText","getDate","fecha_implementado","formatImplementadoChoice","mentionStyle","suggestions","list","borderBottom","event","newValue","newPlainTextValue","mentions","users","proyecto_equipo","user","user_id","MentionsInput","singleLine","allowSpaceInQuery","Mention","appendSpaceOnAdd","MaterialidadEnums","MaterialidadUtils","factores","niveles","calculateTotal","materialidad","factor","nivel","montos","nivel_field","getNivel","monto","valor","porc","getDefaulPorcMG","Math","abs","round","sendToServer","change","params","post","merge","render","document","getElementById","App","panes","handleClick","index","activeIndex","current_idvisita","location","hash","visita_current","is_current","tabWidth","isOpen","css","values","sortBy","HojaTrabajo","menuItem","Item","pane","Provider","code","renderActiveOnly","ReactDOM","buttonProps","TabPaneVisita","1","2","3","porc_error","factor_justificacion","Visita","Pane","actionItems","_ajustes","_muestreo","getCompletadoDisabledText","MenuSidebarVisita","panelOpen","openAsignarUsuarioModal","onItemOpen","closeAllPanel","HojaTrabajoAsignarVisitaModal","id_asignado","paso_id_usuario","id_paso","has_parent","id_parent","url_base","counters","image_path","fixed","vertical","Menu","actionItem","_onClick","isActionItemEnabled","link","renderAsignUserModal","HojaTrabajoHistoryModal","MenuItemAjuste","counter","ajustes","onOpen","modelManager","MenuItemHallazgo","HallazgoHojaTrabajoModelManager","getInstance","hallazgos","as","floating","muestreos","MenuItemRevision","RevisionHojaTrabajoModelManager","id_usuario_asignado","equipo","rol","is_assignable","equipoOptions","description","defaultValue","selection","clearable","fluid","parseAjustes","groupBy","_row","col","id_proyecto_visita","pick","onCreateItem","Promise","resolve","onMountPanel","onSaveItem","onClickDeleteItem","itemNew","fill","Array","isArray","AjusteList","es_proyecto_editable","BaseMenuElement","onToggle","renderContent","SidebarPanelHeader","DefaultErrorHandler","hasError","errorInfo","isLocalhost","host","errorMessage","MenuElementListPanel","AjusteListItem","isModalEdit","onCloseEdit","MenuElementListActions","actions","edit","callback","delete","StatusDivBlock","subitem","truncateText","AjusteModalEdit","isNumber","getJson","createItem","addItem","updateItem","saveItem","updatedItem","answer","deleteItem","HallazgoList","HallazgoListItem","isEqual","renderEstadoImplementacion","renderDescripcion","HallazgoModalEdit","parseItems","revision_text","revision","RevisionNewForm","onSubmit","isEditMode","onTextareaKeyDown","keyCode","ctrlKey","metaKey","onClickNew","alertError","minRows","maxRows","autoFocus","onKeyDown","RevisionList","porRevisarItems","revisadoItems","RevisionListItem","RevisionDisabledList","collapsed","toggle","isThreadOpen","onClickNewComment","onCancelNewComment","onClickChangeStatus","onAddComment","comment","aria-hidden","float","Creator","RevisionEditForm","lineHeight","empty","Comments","dividing","green","olive","comentario","RevisionComentarioForm","parentItem","cancelTimeout","url_for2","instance","paso_visita","item_id","hojaTrabajoContext","settings","currency","decimal","thousand","precision","MaterialidadFieldTotal","tooltip","formatMoney","MaterialidadForm","onChangeObservaciones","observaciones","onChangeAttachments","Attachments","updateContext","choices","unshift","promises","promise","all","changed","add","has","useNivel","row2_disabled_text","isFactorInvalid","row2","getPorcMG","onChangeMonto","minimumValue","maximumValue","onChangeNumericField","montoSeleccionado","getFactoresAsSelectChoices","selectOnNavigation","onSelectChoice","getNivelesAsSelectChoices","onChangeData","Set","MaterialidadObservacionesEditor","data_new","showLoading","ckeditorOptionsObs","idpaso","attachmentsList","MaterialidadPercentTable","floated","getMonto","BaseMenuItem","image","animation","duration","right","listRef","listHeight","calculateHeight","$list","innerHeight","top","data-toggle"],"mappings":"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","file":"proyecto__materialidad.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonpwebpackLibs\"] = window[\"webpackJsonpwebpackLibs\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([336,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = React;","import { createContext } from 'react'\r\n\r\nexport default createContext<HojaTrabajoContextType>({ hoja_trabajo: null, update: (data) => {} })\r\n","/// <reference path=\"../@types/global/AuthorIconLog.d.ts\" />\r\n\r\nimport { Component } from 'react'\r\nimport classnames from 'classnames'\r\n\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader/Loader'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer/Dimmer'\r\n\r\nexport class AuthorIconLog extends Component<AuthorIconLogProps, {}> {\r\n  render() {\r\n    let classes: string | string[] = [ 'author-icon-log' ]\r\n\r\n    if (this.props.className) {\r\n      classes.push(this.props.className)\r\n    }\r\n    if (this.props.inline) {\r\n      classes.push('inline')\r\n    }\r\n\r\n    classes = classnames(classes, this.props.size)\r\n\r\n    let icon = (\r\n      <Icon\r\n        name='user circle'\r\n        size={this.props.size}\r\n        color={_.size(this.props.log) == 0 ? null : this.props.iconColor}\r\n        disabled={_.size(this.props.log) == 0}\r\n      />\r\n    )\r\n    if (this.props.alertText) {\r\n      icon = (\r\n        <Icon.Group>\r\n          {icon}\r\n          <Icon corner='top right' color='red' name='warning circle' />\r\n        </Icon.Group>\r\n      )\r\n    }\r\n\r\n    let iconComp\r\n    if (!this.props.inline) {\r\n      iconComp = (\r\n        <div>\r\n          {this.props.label && <span className='lb'>{this.props.label}</span>}\r\n          {icon}\r\n        </div>\r\n      )\r\n    } else {\r\n      const item = this.props.log == null ? null : this.props.log[0]\r\n      iconComp = (\r\n        <div>\r\n          {this.props.label && <span className='lb'>{this.props.label}</span>}\r\n          {icon}\r\n          {this.props.alertText && (\r\n            <span className='alert-text'>\r\n              <Icon color='red' name='warning circle' /> {this.props.alertText}\r\n            </span>\r\n          )}\r\n          {item && (\r\n            <div className='content user-info'>\r\n              <div className='user-sigla'>{item.User.sigla}</div>\r\n              <time dateTime={Date.create(item.ts).format('{year}-{MM}-{dd}')}>\r\n                {Date.create(item.ts).format('{year}-{MM}-{dd}')}\r\n              </time>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className={classes}>\r\n        <Popup\r\n          trigger={iconComp}\r\n          position='bottom center'\r\n          className='author-icon-log-popup'\r\n          pinned\r\n          size={this.props.size}\r\n        >\r\n          <Popup.Header>\r\n            {this.props.name}\r\n            {this.props.alertText && (\r\n              <div className='alert-text'>\r\n                <Icon color='red' name='warning circle' /> {this.props.alertText}\r\n              </div>\r\n            )}\r\n          </Popup.Header>\r\n          <Popup.Content>\r\n            {this.props.log == null ? (\r\n              <div className='label'>Sin Especificar</div>\r\n            ) : (\r\n              <table className='table nowrap'>\r\n                <tbody>\r\n                  {this.props.log.map((item, k) => {\r\n                    return (\r\n                      <tr key={k}>\r\n                        <td>\r\n                          {icon} {item.User.name} ({item.User.sigla})\r\n                        </td>\r\n                        <td>\r\n                          <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                        </td>\r\n                      </tr>\r\n                    )\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </Popup.Content>\r\n        </Popup>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class AuthorIconLogEditable extends Component<AuthorIconLogEditableProps, AuthorIconLogEditableState> {\r\n  state = {\r\n    isLoading: false\r\n  }\r\n\r\n  static defaultProps = {\r\n    disableEdit: false\r\n  }\r\n\r\n  onClickEdit = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isLoading: true })\r\n    this.props.onClickEdit()\r\n  }\r\n\r\n  render() {\r\n    let classes: string | string[] = [ 'author-icon-log' ]\r\n\r\n    if (this.props.className) {\r\n      classes.push(this.props.className)\r\n    }\r\n\r\n    classes = classnames(classes, this.props.size)\r\n\r\n    const icon = (\r\n      <Icon\r\n        name='user circle'\r\n        size={this.props.size}\r\n        color={this.props.log == null ? null : this.props.iconColor}\r\n        disabled={this.props.log == null}\r\n      />\r\n    )\r\n\r\n    const iconComp = (\r\n      <div style={{ position: 'relative' }}>\r\n        <Dimmer inverted active={this.state.isLoading}>\r\n          <Loader inverted />\r\n        </Dimmer>\r\n        {this.props.label && <span className='lb'>{this.props.label}</span>}\r\n        {icon}\r\n        <Button\r\n          className='action edit'\r\n          disabled={this.props.disableEdit}\r\n          compact\r\n          size='mini'\r\n          color={this.props.iconColor}\r\n          onClick={this.onClickEdit}\r\n        >\r\n          {this.props.editText}\r\n        </Button>\r\n      </div>\r\n    )\r\n\r\n    return (\r\n      <div className={classes}>\r\n        <Popup trigger={iconComp} position='bottom center' pinned size={this.props.size}>\r\n          <Popup.Header content={this.props.name} />\r\n          <Popup.Content>\r\n            {this.props.log == null ? (\r\n              <div className='label'>Sin Especificar</div>\r\n            ) : (\r\n              <table className='table nowrap'>\r\n                <tbody>\r\n                  {this.props.log.map((item, k) => {\r\n                    return (\r\n                      <tr key={k}>\r\n                        <td>\r\n                          {icon} {item.User.name} ({item.User.sigla})\r\n                        </td>\r\n                        <td>\r\n                          <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                        </td>\r\n                      </tr>\r\n                    )\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </Popup.Content>\r\n        </Popup>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype AuthorIconLogDefaultWrapperProps = {\r\n  model: Partial<IAuthorLog>\r\n  size?: 'huge' | 'large' | 'small' | 'mini' | 'tiny'\r\n  className?: string\r\n}\r\n\r\nexport class AuthorIconLogDefaultWrapper extends Component<AuthorIconLogDefaultWrapperProps> {\r\n  render() {\r\n    const { model } = this.props\r\n\r\n    const alertTextRevisado =\r\n      model.fecha_completado &&\r\n      model.fecha_revision &&\r\n      Date.create(model.fecha_completado) > Date.create(model.fecha_revision)\r\n        ? 'Modificado despues de Revisado'\r\n        : null\r\n\r\n    return (\r\n      <div className={classnames('author-icon-log-wrapper', this.props.size, this.props.className)}>\r\n        <AuthorIconLog log={model.UpdateLog} name='Preparado por' label='P' iconColor='green' size={this.props.size} />\r\n        <AuthorIconLog\r\n          log={model.RevisionLog}\r\n          name='Revisado por'\r\n          label='R'\r\n          iconColor='olive'\r\n          size={this.props.size}\r\n          alertText={alertTextRevisado}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent } from 'react'\r\n\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\n\r\nimport cx from 'classnames'\r\n\r\ntype ButtonActionProps = {\r\n  onClick: () => void\r\n  disableText?: string\r\n  showAlert?: boolean\r\n  record?: {\r\n    fecha_completado?: string\r\n    fecha_revision?: string\r\n  }\r\n}\r\n\r\nexport class CompletadoButtonAction extends PureComponent<ButtonActionProps> {\r\n  render() {\r\n    const completado_disabled_text = this.props.disableText\r\n\r\n    return (\r\n      <Popup\r\n        trigger={\r\n          <div className='button-wrapper'>\r\n            <Button primary icon compact onClick={this.props.onClick} disabled={completado_disabled_text != null}>\r\n              {' '}\r\n              <i className='icon check' /> Completado\r\n            </Button>\r\n          </div>\r\n        }\r\n        content={completado_disabled_text}\r\n        header='Marcar como Completado | Opción deshabilitada'\r\n        disabled={completado_disabled_text == null}\r\n        className='disable-text'\r\n        on='hover'\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\nexport class RevisadoButtonAction extends PureComponent<ButtonActionProps> {\r\n  render() {\r\n    let revisado_disabled_text = this.props.disableText\r\n    if (\r\n      (revisado_disabled_text === null || typeof revisado_disabled_text === 'undefined') &&\r\n      this.props.record &&\r\n      !this.props.record.fecha_completado\r\n    ) {\r\n      revisado_disabled_text = 'Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO.'\r\n    }\r\n\r\n    let showAlert: boolean\r\n    if ((this.props.showAlert === null || typeof this.props.showAlert === 'undefined') && this.props.record) {\r\n      const record = this.props.record\r\n      showAlert =\r\n        record.fecha_completado &&\r\n        record.fecha_revision &&\r\n        Date.create(record.fecha_completado) > Date.create(record.fecha_revision)\r\n    } else {\r\n      showAlert = this.props.showAlert\r\n    }\r\n\r\n    const icon_revisado_alert = showAlert ? (\r\n      <Popup\r\n        trigger={<i className='icon warning circle red' />}\r\n        content={'Ha recibido modificaciones después de su última revisión.'}\r\n      />\r\n    ) : null\r\n\r\n    return (\r\n      <Popup\r\n        trigger={\r\n          <div className='button-wrapper'>\r\n            <Button color='olive' icon compact onClick={this.props.onClick} disabled={revisado_disabled_text != null}>\r\n              {' '}\r\n              <i className='icon check fitted' />\r\n              <i className='icon check' /> Revisado {icon_revisado_alert}\r\n            </Button>\r\n          </div>\r\n        }\r\n        content={revisado_disabled_text}\r\n        header='Marcar como Revisado | Opción deshabilitada'\r\n        disabled={revisado_disabled_text == null}\r\n        className='disable-text'\r\n        on='hover'\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\ntype ButtonActionsProps = {\r\n  prepend?: JSX.Element\r\n  append?: JSX.Element\r\n  completado: { permission: string } & ButtonActionProps\r\n  revisado: { permission: string } & ButtonActionProps\r\n}\r\n\r\nexport class StatusButtonGroupActions extends PureComponent<ButtonActionsProps> {\r\n  render() {\r\n    return (\r\n      <div className='actions ab-status-actions'>\r\n        {this.props.prepend}\r\n        {user_has_role_permission(this.props.completado.permission) && (\r\n          <CompletadoButtonAction {...this.props.completado} />\r\n        )}\r\n        {user_has_role_permission(this.props.revisado.permission) && <RevisadoButtonAction {...this.props.revisado} />}\r\n        {this.props.append}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype StatusDivBlockProps = {\r\n  status: string\r\n  className?: string\r\n  wrapperClassName?: string\r\n  hideLabel?: boolean\r\n}\r\n\r\nexport const StatusDivBlock = (props: StatusDivBlockProps) => {\r\n  return (\r\n    <div className={cx('lb-status-wrapper', props.wrapperClassName)}>\r\n      {!props.hideLabel && 'Estado:'}\r\n      <div className={cx(props.className, 'lb-status', `lb-status-${_.str.dasherize(props.status.toLowerCase())}`)}>\r\n        {props.status || ''}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { PureComponent, Fragment, createRef, SyntheticEvent } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\n\r\nimport { instance as eventStack } from '@semantic-ui-react/event-stack'\r\nimport keyboardKey from 'keyboard-key'\r\nimport CKeditor from 'ckeditor4-react'\r\nimport cx from 'classnames'\r\n\r\nimport ButtonEdit from './ButtonEdit'\r\nimport { AttachmentListPanel, cleanAttachmentFrom } from '../proyecto__hoja_trabajo/Attachments'\r\n\r\ndeclare var app: any\r\n\r\nconst CKEDITOR_OPTIONS: any = {\r\n  basic: {\r\n    height: 150,\r\n    toolbar: [\r\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic' ] },\r\n      {\r\n        name: 'paragraph',\r\n        groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ],\r\n        items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'TextColor' ]\r\n      }\r\n    ],\r\n    autoParagraph: false,\r\n    removePlugins: 'elementspath, uploadfile, uploadfileab, resize',\r\n    extraPlugins: 'openlink'\r\n  }\r\n}\r\n\r\nexport default class EditorPreview extends PureComponent<EditorPreviewProps, EditorPreviewState> {\r\n  private ckeditorComp: React.RefObject<CKeditorComp>\r\n  private _cachedEditor: CKEDITOR.editor\r\n\r\n  private previewRef = createRef<HTMLDivElement>()\r\n\r\n  private autosaveId: NodeJS.Timeout\r\n\r\n  static AUTOSAVE_DELAY: number = 60\r\n\r\n  static defaultProps = {\r\n    open: false,\r\n    autosave: false,\r\n    required: false,\r\n    editable: true,\r\n    openOnClickPreview: true,\r\n    ckeditorOptions: {}\r\n  }\r\n\r\n  constructor(props: EditorPreviewProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isModalEditOpen: this.props.open,\r\n      isAutosaving: false,\r\n      isLoading: true,\r\n      attachments: null,\r\n      isLoadingAttachments: false\r\n    }\r\n  }\r\n\r\n  handleEscape = (e: Event) => {\r\n    if (keyboardKey.getCode(e) !== keyboardKey.Escape) return\r\n\r\n    if (typeof CKEDITOR !== 'undefined' && CKEDITOR.dialog.getCurrent() != null) {\r\n      // si existe un CKEditor dialog abierto, no cerrar el modal.\r\n      return\r\n    }\r\n\r\n    this.onClose()\r\n  }\r\n\r\n  getEditor(): CKEDITOR.editor {\r\n    if (this.ckeditorComp != null) {\r\n      return (this.ckeditorComp as any).editor\r\n    }\r\n\r\n    if (this._cachedEditor) {\r\n      return this._cachedEditor\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  onChange = (evt: any) => {\r\n    if (this.props.inline) {\r\n      this.props.onSave(evt.editor, false, false)\r\n    }\r\n\r\n    if (!this._cachedEditor) {\r\n      this._cachedEditor = evt.editor\r\n    }\r\n\r\n    if (!this.props.autosave) {\r\n      return\r\n    }\r\n\r\n    if (!this.autosaveId) {\r\n      this.autosaveId = setTimeout(this.autosave, EditorPreview.AUTOSAVE_DELAY * 1000)\r\n    }\r\n  }\r\n\r\n  onClickEdit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isModalEditOpen: true, isLoading: true })\r\n  }\r\n\r\n  onSave = () => {\r\n    if (this.autosaveId) {\r\n      clearTimeout(this.autosaveId)\r\n      this.autosaveId = null\r\n    }\r\n\r\n    if ($.isFunction(this.props.onSave)) {\r\n      this.props.onSave(this.getEditor(), true, false, () => {\r\n        this.setState({ isAutosaving: false })\r\n        this.fetchAttachments()\r\n      })\r\n\r\n      this.setState({ isModalEditOpen: false })\r\n    } else {\r\n      this.setState({ isModalEditOpen: false, isAutosaving: false })\r\n      this.fetchAttachments()\r\n    }\r\n  }\r\n\r\n  onCancel = () => {\r\n    this.setState({ isModalEditOpen: false })\r\n    if ($.isFunction(this.props.onClose)) {\r\n      this.props.onClose()\r\n    }\r\n  }\r\n\r\n  onClose = () => {\r\n    if (this.autosaveId) {\r\n      clearInterval(this.autosaveId)\r\n      this.autosaveId = null\r\n    }\r\n\r\n    this.setState({ isModalEditOpen: false })\r\n    if ($.isFunction(this.props.onClose)) {\r\n      this.props.onClose()\r\n    }\r\n  }\r\n\r\n  onModalMount = () => {\r\n    eventStack.sub('keydown', this.handleEscape, { pool: 'default' })\r\n\r\n    if (this.state.attachments == null) {\r\n      this.fetchAttachments()\r\n    }\r\n  }\r\n\r\n  autosave = () => {\r\n    this.setState({ isAutosaving: true })\r\n    let ckeditor = this.getEditor()\r\n    if (ckeditor != null) {\r\n      this.props.onSave(ckeditor, false, true, () => this.setState({ isAutosaving: false }))\r\n      this.fetchAttachments()\r\n    }\r\n\r\n    if (this.autosaveId) {\r\n      clearInterval(this.autosaveId)\r\n      this.autosaveId = null\r\n    }\r\n  }\r\n\r\n  assertRequired() {\r\n    if (!this.props.editable) {\r\n      return false\r\n    }\r\n    if (!this.props.required) {\r\n      return false\r\n    }\r\n\r\n    const ckeditor = this.getEditor()\r\n\r\n    if (_.trim(ckeditor.getData()) != '') {\r\n      return false\r\n    }\r\n\r\n    bootbox.alert('Esta campo es requerido, por lo tanto no puede quedar vacío.')\r\n\r\n    return true\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps: EditorPreviewProps) {\r\n    if (nextProps.open && !this.state.isModalEditOpen) {\r\n      this.setState({ isModalEditOpen: true })\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    $(this.previewRef.current).find('a[href]').each(function() {\r\n      $(this).attr('target', '_blank')\r\n    })\r\n  }\r\n\r\n  onClickPreview = (ev: SyntheticEvent) => {\r\n    if (this.props.onClickPreview) {\r\n      this.props.onClickPreview(ev)\r\n    }\r\n\r\n    if (this.props.openOnClickPreview) {\r\n      this.setState({ isModalEditOpen: true })\r\n    }\r\n  }\r\n\r\n  parseCkeditorOptions() {\r\n    let { ckeditorOptions } = this.props\r\n\r\n    if (typeof ckeditorOptions == 'string') {\r\n      ckeditorOptions = CKEDITOR_OPTIONS[ckeditorOptions]\r\n    }\r\n\r\n    if (typeof this.props.ckeditorUploadOptions !== 'undefined') {\r\n      const defaultUrl = 'proyecto/' + app.vars.idproyecto + '/adjunto/upload'\r\n      const { url = defaultUrl, model, modelId } = this.props.ckeditorUploadOptions\r\n\r\n      if (modelId === null || modelId === undefined) {\r\n        ckeditorOptions.removePlugins = 'elementspath,uploadimage,uploadfile,uploadfileab'\r\n      } else {\r\n        ckeditorOptions.uploadUrl = url_for(`${url}?model=${model}&model_id=${modelId}`)\r\n        ckeditorOptions.imageUploadUrl = url_for(`${url}?model=${model}&model_id=${modelId}`)\r\n        ckeditorOptions.filebrowserUploadUrl = url_for(`${url}?model=${model}&model_id=${modelId}&n=attachment`)\r\n      }\r\n    }\r\n\r\n    return ckeditorOptions\r\n  }\r\n\r\n  fetchAttachments() {\r\n    if (typeof this.props.ckeditorUploadOptions === 'undefined') {\r\n      return\r\n    }\r\n\r\n    const { model, modelId } = this.props.ckeditorUploadOptions\r\n\r\n    this.setState({ isLoadingAttachments: true })\r\n    $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/adjunto/json`), {\r\n      model: model,\r\n      model_id: modelId\r\n    }).done((res) => {\r\n      this.setState({ attachments: res.response, isLoadingAttachments: false })\r\n    })\r\n  }\r\n\r\n  onUpdateAttachment = () => {\r\n    this.fetchAttachments()\r\n  }\r\n\r\n  onDeleteAttachment = (adjunto: ProyectoAttachment, cb: () => void) => {\r\n    this.setState({ isLoadingAttachments: true })\r\n\r\n    const data = cleanAttachmentFrom(this.props.data, adjunto)\r\n\r\n    if ($.isFunction(cb)) {\r\n      cb()\r\n    }\r\n\r\n    let ckeditor = this.getEditor()\r\n    if (ckeditor) {\r\n      ckeditor.setData(data)\r\n      this.autosave()\r\n    }\r\n  }\r\n\r\n  getCkeditorOptions() {\r\n    const self = this\r\n\r\n    let ckeditorOptions = Object.assign(\r\n      {\r\n        height: 200,\r\n        toolbar: [\r\n          { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', '-', 'Undo', 'Redo' ] },\r\n          { name: 'links', items: [ 'Link', 'pasolink', 'muestreolink', 'Attachments' ] },\r\n          { name: 'insert', items: [ 'Table', 'SpecialChar' ] },\r\n          { name: 'tools', items: [ 'Maximize' ] },\r\n          { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline' ] },\r\n          {\r\n            name: 'paragraph',\r\n            items: [\r\n              'NumberedList',\r\n              'BulletedList',\r\n              '-',\r\n              'Outdent',\r\n              'Indent',\r\n              '-',\r\n              'JustifyLeft',\r\n              'JustifyCenter',\r\n              'JustifyRight',\r\n              'JustifyBlock',\r\n              '-',\r\n              'TextColor'\r\n            ]\r\n          },\r\n          { name: 'styles', items: [ 'Styles', 'Format' ] }\r\n        ],\r\n        autoParagraph: false,\r\n        enterMode: CKEDITOR.ENTER_BR,\r\n        removePlugins: 'elementspath',\r\n        extraPlugins:\r\n          'uploadimage,pastebase64,uploadfileab,openlink,attach,justify,colorbutton,pastefromexcel,colordialog,pasolink',\r\n        openlink_modifier: 0,\r\n        onAttachmentUpload: function(response: string, editor: CKEDITOR.editor) {\r\n          response = response\r\n            .replace('<pre>', '')\r\n            .replace('<pre style=\"word-wrap: break-word; white-space: pre-wrap;\">', '')\r\n            .replace('</pre>', '')\r\n          var rs = JSON.parse(response)\r\n          console.log(rs)\r\n          _.forEach(rs, function(r) {\r\n            if (r.uploaded) {\r\n              editor.insertHtml(\r\n                \"<a href='\" + r.url + \"' target='_blank' class='proyecto-attachment' >\" + r.fileName + '</a><br> '\r\n              )\r\n            } else {\r\n              alert(r.error)\r\n            }\r\n          })\r\n          CKEDITOR.dialog.getCurrent().hide()\r\n          if (self.props.onUpload) {\r\n            self.props.onUpload()\r\n          }\r\n          self.fetchAttachments()\r\n          const ckeditor_comp = self.getEditor()\r\n          if (ckeditor_comp) {\r\n            self.props.onSave(ckeditor_comp, false, false)\r\n          }\r\n        }\r\n      },\r\n      this.parseCkeditorOptions()\r\n    )\r\n\r\n    ckeditorOptions.on = Object.assign(\r\n      {\r\n        fileUploadRequest: function(ev: any) {\r\n          const loader = ev.data.fileLoader\r\n          loader.on('abort', function() {\r\n            $.unblockUI()\r\n          })\r\n          loader.on('error', function() {\r\n            console.log(loader)\r\n            $.unblockUI()\r\n          })\r\n          $.blockUI({\r\n            message:\r\n              '<div class=\"ajax-loader-snake-32  _a-center\"></div><h3 class=\"loading-block-text\">Cargando archivo al servidor.<br> Por favor Espere ...</h3>'\r\n          })\r\n        },\r\n        fileUploadResponse: function() {\r\n          $.unblockUI()\r\n          this.fire('change')\r\n        },\r\n        paste: (evt: any) => {\r\n          evt.data.dataValue = evt.data.dataValue.replace(/(min-)?width:.+?;/g, '') // remove width\r\n        }\r\n      },\r\n      ckeditorOptions.on || {}\r\n    )\r\n\r\n    return ckeditorOptions\r\n  }\r\n\r\n  renderFooter() {\r\n    const { footer } = this.props\r\n\r\n    if (footer === 'AttachmentList') {\r\n      return (\r\n        <AttachmentListPanel\r\n          isLoading={this.state.isLoadingAttachments}\r\n          attachments={this.state.attachments}\r\n          onUpdateItem={this.onUpdateAttachment}\r\n          onDeleteItem={this.onDeleteAttachment}\r\n        />\r\n      )\r\n    }\r\n\r\n    return footer\r\n  }\r\n\r\n  renderModal() {\r\n    if (!this.state.isModalEditOpen) {\r\n      return\r\n    }\r\n\r\n    let classNames = cx([ 'editor-preview-modal', this.props.className ? this.props.className + '-modal' : false ])\r\n\r\n    return (\r\n      <Modal\r\n        className={classNames}\r\n        open\r\n        closeIcon\r\n        closeOnDimmerClick={false}\r\n        dimmer='inverted'\r\n        onClose={this.onClose}\r\n        closeOnEscape={false}\r\n        onMount={this.onModalMount}\r\n        size='large'\r\n      >\r\n        <Modal.Content>{this.renderEditor()}</Modal.Content>\r\n        {this.props.editable ? (\r\n          <Modal.Actions>\r\n            {this.props.leftActions}\r\n            <button className='ui button negative' onClick={this.onCancel}>\r\n              Cancelar\r\n            </button>\r\n            <button className='ui button primary' onClick={this.onSave}>\r\n              Guardar\r\n            </button>\r\n          </Modal.Actions>\r\n        ) : (\r\n          <Modal.Actions>\r\n            {this.props.leftActions}\r\n            <button className='ui button negative' onClick={this.onCancel}>\r\n              Cerrar\r\n            </button>\r\n          </Modal.Actions>\r\n        )}\r\n      </Modal>\r\n    )\r\n  }\r\n\r\n  renderEditor() {\r\n    let label\r\n    if (this.props.label || this.props.labelTitle) {\r\n      label =\r\n        '<div class=\"editor-label\"> <strong class=\"editor-label-title\">' +\r\n        (this.props.labelTitle || '') +\r\n        '</strong> ' +\r\n        (this.props.label || '') +\r\n        ' </div>'\r\n    }\r\n\r\n    return (\r\n      <Fragment>\r\n        {label && <div dangerouslySetInnerHTML={{ __html: label }} />}\r\n        <div style={{ minHeight: '200px' }}>\r\n          <div className='loading'>\r\n            <div className={this.state.isAutosaving ? '' : 'ui-helper-hidden'}>\r\n              <span className='ajax-loader-snake' /> Guardando...\r\n            </div>\r\n          </div>\r\n          <div className={cx('ui dimmer inverted', { active: this.state.isLoading })}>\r\n            <div className='ui loader'>Cargando...</div>\r\n          </div>\r\n          <CKeditor\r\n            ref={(c: React.RefObject<CKeditorComp>) => (this.ckeditorComp = c)}\r\n            data={this.props.data}\r\n            config={this.getCkeditorOptions()}\r\n            onChange={this.onChange}\r\n            onInstanceReady={() => this.setState({ isLoading: false })}\r\n            readOnly={!this.props.editable}\r\n          />\r\n        </div>\r\n        {this.renderFooter()}\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    if (this.props.inline) {\r\n      return <div className='editor-inline'> {this.renderEditor()}</div>\r\n    }\r\n\r\n    let preview = this.props.preview == null ? this.props.data || '' : this.props.preview\r\n\r\n    let classNames = cx([ 'editor-preview', this.props.className, preview ? 'text-non-empty' : 'text-empty' ])\r\n\r\n    if (this.props.prefixPreview) {\r\n      preview = '<strong class=\"editor-preview-title\" >' + this.props.prefixPreview + '</strong> ' + preview\r\n    }\r\n\r\n    preview = preview.replace(/(min-)?width:.+?;/g, '')\r\n\r\n    return (\r\n      <Fragment>\r\n        <div className={cx('editor-preview-wrapper', this.props.wrapperClassName)} onClick={this.onClickPreview}>\r\n          <div\r\n            ref={this.previewRef}\r\n            className={classNames}\r\n            dangerouslySetInnerHTML={{ __html: preview }}\r\n            style={this.props.previewStyle}\r\n          />\r\n          {this.props.editable && (\r\n            <div className='action-list'>\r\n              <ButtonEdit onClick={this.onClickEdit} />\r\n            </div>\r\n          )}\r\n        </div>\r\n        {this.renderModal()}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","export namespace HojaTrabajoUtils {\r\n  export function getAllVisitasAfter(hoja_trabajo: HojaTrabajo, visitaPivot: ProyectoPasoVisita) {\r\n    let visitas: ProyectoPasoVisita[] = []\r\n    let found: boolean = false\r\n\r\n    _.forEach(hoja_trabajo.visitas, function(visita) {\r\n      if (found) {\r\n        visitas.push(visita)\r\n        return\r\n      }\r\n      if (visita.id == visitaPivot.id) {\r\n        found = true\r\n      }\r\n    })\r\n\r\n    return visitas\r\n  }\r\n}\r\n\r\nexport namespace HojaTrabajoUpdateUtils {\r\n  /**\r\n   *\r\n   * @param hoja_trabajo Hoja de trabajo a actualizar\r\n   * @param visita Visita a actualizar\r\n   * @param new_data Datos actualizados a aplicar a la visita\r\n   */\r\n  export function updateVisita(\r\n    hoja_trabajo: HojaTrabajo,\r\n    visita: ProyectoPasoVisita | { id: string },\r\n    new_data: Partial<ProyectoPasoVisita>\r\n  ) {\r\n    let hoja_trabajo_copy = Object.assign({}, hoja_trabajo)\r\n\r\n    hoja_trabajo_copy.visitas = _.mapValues(hoja_trabajo_copy.visitas, (item) => {\r\n      if (item.id == visita.id) {\r\n        item = Object.assign({}, item, new_data)\r\n      }\r\n      return item\r\n    })\r\n\r\n    return hoja_trabajo_copy\r\n  }\r\n\r\n  export function updateVisitas(\r\n    hoja_trabajo: HojaTrabajo,\r\n    new_data: { [id_visita: string]: Partial<ProyectoPasoVisita> }\r\n  ) {\r\n    _.forEach(new_data, (visita_new_data, id_visita) => {\r\n      const visita = _.findWhere(hoja_trabajo.visitas, { id_visita })\r\n      hoja_trabajo = updateVisita(hoja_trabajo, visita, visita_new_data)\r\n    })\r\n\r\n    return hoja_trabajo\r\n  }\r\n\r\n  export function updateField(hoja_trabajo: HojaTrabajo, field: keyof HojaTrabajo, new_data: any) {\r\n    let hoja_trabajo_copy = Object.assign({}, hoja_trabajo)\r\n\r\n    hoja_trabajo_copy[field] = Object.assign({}, hoja_trabajo_copy[field], new_data)\r\n\r\n    return hoja_trabajo_copy\r\n  }\r\n}\r\n","import { PureComponent } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\n\r\ntype MenuItemNewProps = {\r\n  isEditable: boolean\r\n  headerText: string\r\n  buttonText: string\r\n  onSave: (data: any) => Promise<null>\r\n  moduleParams: any\r\n  item: any\r\n  contentAs: React.ComponentType<MenuItemModalType>\r\n}\r\n\r\ntype MenuItemModalType = {\r\n  item: any\r\n  isEditable: boolean\r\n  moduleParams: any\r\n  onSave: (item: any) => void\r\n}\r\n\r\nexport class MenuItemNew extends PureComponent<MenuItemNewProps, { modalOpen: boolean }> {\r\n  state = {\r\n    modalOpen: false\r\n  }\r\n\r\n  onClick = () => {\r\n    this.setState({ modalOpen: true })\r\n  }\r\n\r\n  onCloseModal = () => {\r\n    this.setState({ modalOpen: false })\r\n  }\r\n\r\n  onSave = (data: ProyectoHallazgo) => {\r\n    this.props.onSave(data).then(() => {\r\n      this.onCloseModal()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.isEditable) {\r\n      return\r\n    }\r\n\r\n    const MenuItemModal = this.props.contentAs\r\n\r\n    return (\r\n      <div className='_a-center'>\r\n        <button className='button ui right tiny compact plain green rounded' onClick={this.onClick}>\r\n          {this.props.buttonText} <i className='icon plus' />\r\n        </button>\r\n        {this.state.modalOpen && (\r\n          <Modal\r\n            open\r\n            dimmer='inverted'\r\n            className='modal-ab modal-sidebarmenuitem'\r\n            size='large'\r\n            closeIcon\r\n            closeOnDimmerClick={false}\r\n            closeOnEscape={false}\r\n            onClose={this.onCloseModal}\r\n          >\r\n            <Modal.Header>{this.props.headerText}</Modal.Header>\r\n            <MenuItemModal\r\n              onSave={this.onSave}\r\n              moduleParams={this.props.moduleParams}\r\n              isEditable={this.props.isEditable}\r\n              item={this.props.item}\r\n            />\r\n          </Modal>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype MenuItemNewHeaderProps = {\r\n  item: {\r\n    label: string\r\n    status: ProyectoModuleStatusEnum\r\n  } & IAuthorLog\r\n}\r\n\r\nexport const MenuItemNewHeader = (props: MenuItemNewHeaderProps) => {\r\n  const status = props.item.status || 'EN PROCESO'\r\n  return (\r\n    <div className='ui grid padded' style={{ marginBottom: 0 }}>\r\n      <div className='row' style={{ paddingTop: 0 }}>\r\n        <div className='column four wide'>\r\n          <strong style={{ fontWeight: 600 }}>{props.item.label}</strong>\r\n        </div>\r\n        <div className='column four wide'>\r\n          <span>Estado: </span>\r\n          <div className='lb-status-wrapper'>\r\n            <div className={`lb-status lb-status-${_.str.dasherize(status.toLowerCase())}`}>{status}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className='column four wide'>\r\n          <AuthorIconLogDefaultWrapper model={props.item} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import ReactNumeric from 'react-numeric'\r\nimport AutoNumeric from 'autonumeric'\r\n\r\nconst defaultProps = {\r\n  decimalPlaces: 2,\r\n  decimalCharacter: ',',\r\n  decimalCharacterAlternative: '.',\r\n  digitGroupSeparator: '.',\r\n  allowDecimalPadding: false,\r\n  selectOnFocus: false\r\n}\r\n\r\nexport default function InputAutoNumeric(props: any) {\r\n  props = Object.assign({}, props, defaultProps)\r\n\r\n  if (typeof props.value != 'undefined' && _.size(props.value) > 0) {\r\n    props.value = +props.value\r\n  }\r\n\r\n  if (typeof props.isEditable == 'undefined' || props.isEditable) {\r\n    return <ReactNumeric {...props} />\r\n  } else {\r\n    return <span className='autonumeric non-editable value'>{AutoNumeric.format(props.value, props)}</span>\r\n  }\r\n}\r\n","export namespace HallazgoUtils {\r\n  export function formatName(name: string) {\r\n    return ('' + name).match(/^\\d+$/) ? 'Hallazgo #' + name : name\r\n  }\r\n}\r\n","import { Component, Fragment, ReactNode } from 'react'\r\n\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\n\r\nimport EditorPreview from '../global/EditorPreview'\r\nimport { AuthorIconLogDefaultWrapper } from '../global/AuthorIconLog'\r\nimport HojaTrabajoContext from './HojaTrabajoContext'\r\nimport { HojaTrabajoUpdateUtils } from './utils'\r\n\r\nimport DualListBox from 'react-dual-listbox'\r\nimport Divider from 'semantic-ui-react/dist/commonjs/elements/Divider/Divider'\r\nimport Accordion from 'semantic-ui-react/dist/commonjs/modules/Accordion/Accordion'\r\nimport Form from 'semantic-ui-react/dist/commonjs/collections/Form/Form'\r\n\r\ntype AppVisitaDefaultTabProps = {\r\n  visita: ProyectoPasoVisita\r\n}\r\n\r\nexport class AppVisitaDefaultTab extends Component<AppVisitaDefaultTabProps> {\r\n  getStatusLabel() {\r\n    const { visita } = this.props\r\n\r\n    let status_label = null\r\n\r\n    if (visita.status) {\r\n      status_label = (\r\n        <Label\r\n          style={{ backgroundColor: visita.status_color }}\r\n          className={`visita-status visita-status-${_.str.underscored(visita.status)}`}\r\n          size='mini'\r\n        >\r\n          {visita.status}\r\n        </Label>\r\n      )\r\n    }\r\n\r\n    return status_label\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n\r\n    return (\r\n      <Fragment>\r\n        <span className='tabname' title={visita.label}>\r\n          {visita.label}\r\n        </span>\r\n        <AuthorIconLogDefaultWrapper model={visita} />\r\n        {this.getStatusLabel()}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype PasoObjetivoPaneProps = {\r\n  isEditable: boolean\r\n}\r\n\r\nexport class PasoObjetivoPane extends Component<PasoObjetivoPaneProps> {\r\n  static contextType = HojaTrabajoContext\r\n\r\n  static defaultProps: PasoObjetivoPaneProps = {\r\n    isEditable: false\r\n  }\r\n\r\n  context: HojaTrabajoContextType\r\n\r\n  onChangeValue = (editor: CKEDITOR.editor) => {\r\n    const objetivo = editor.getData()\r\n    const { hoja_trabajo, update } = this.context\r\n\r\n    $.blockUI(create_blockUI_loading_message('Guardando Cambios'))\r\n    const url = url_for(`proyecto/${hoja_trabajo.proyecto.id}/master_data/paso/${hoja_trabajo.paso.id}/objetivo`)\r\n    $.ajax(url, { type: 'POST', data: { objetivo }, dataType: 'json' }).done(() => {\r\n      let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateField(hoja_trabajo, 'paso', { objetivo })\r\n      update(hoja_trabajo_new)\r\n      $.unblockUI()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    let { hoja_trabajo }: { hoja_trabajo: HojaTrabajo } = this.context\r\n    const ckeditorOptions = {\r\n      height: 150,\r\n      toolbar: [\r\n        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic' ] },\r\n        {\r\n          name: 'paragraph',\r\n          groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ],\r\n          items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'TextColor' ]\r\n        }\r\n      ],\r\n      autoParagraph: false,\r\n      removePlugins: 'elementspath, uploadfile, resize',\r\n      extraPlugins: 'openlink'\r\n    }\r\n\r\n    return (\r\n      <div className='hoja-trabajo-objetivo hoverable-actions'>\r\n        <EditorPreview\r\n          className='objetivo-text-editor'\r\n          ckeditorOptions={ckeditorOptions}\r\n          prefixPreview='Objetivo:'\r\n          label=' '\r\n          labelTitle='Objetivo: '\r\n          data={hoja_trabajo.paso.objetivo}\r\n          editable={this.props.isEditable && user_has_role_permission('paso_objetivo_edit')}\r\n          onSave={this.onChangeValue}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype PasoVisitaStatusActionsProps = {\r\n  visita: ProyectoPasoVisita\r\n  revisadoDisabledText?: string\r\n  completadoDisabledText?: string\r\n}\r\n\r\nexport class PasoVisitaStatusActions extends Component<PasoVisitaStatusActionsProps> {\r\n  static contextType = HojaTrabajoContext\r\n  context: HojaTrabajoContextType\r\n\r\n  onClickCompletado = () => {\r\n    const { hoja_trabajo } = this.context\r\n    const url = url_for(\r\n      `proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita/${this.props.visita\r\n        .id_visita}/save`\r\n    )\r\n\r\n    let loadingMessage = 'Marcando como Completado...'\r\n    $.blockUI(create_blockUI_loading_message(loadingMessage))\r\n    $.ajax(url, { type: 'POST', data: { op: 'c' }, dataType: 'json' }).done((res) => {\r\n      if (res.hasErrors) {\r\n        $.unblockUI()\r\n        bootbox.alert(res.message)\r\n      } else {\r\n        this.updateVisita(res.response.record)\r\n        $.unblockUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  onClickRevisado = () => {\r\n    const { hoja_trabajo } = this.context\r\n    const url = url_for(\r\n      `proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita/${this.props.visita\r\n        .id_visita}/save`\r\n    )\r\n\r\n    let loadingMessage = 'Marcando como Revisado...'\r\n    $.blockUI(create_blockUI_loading_message(loadingMessage))\r\n    $.ajax(url, { type: 'POST', data: { op: 'r' }, dataType: 'json' }).done((res) => {\r\n      if (res.hasErrors) {\r\n        $.unblockUI()\r\n        bootbox.alert(res.message)\r\n      } else {\r\n        this.updateVisita(res.response.record)\r\n        $.unblockUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  getRevisadoDisabledText() {\r\n    if (_.include([ '1', '2', '3' ], this.props.visita.id_status) || this.props.completadoDisabledText) {\r\n      return 'Esta visita debe estar primero en estado COMPLETADO, para poder marcar esta hoja de trabajo como REVISADA.'\r\n    } else if (_.include([ '6' ], this.props.visita.id_status)) {\r\n      return 'Esta visita  tiene Notas de Revisión que deben primero ser atendidas para poder marcar esta hoja de trabajo como REVISADA.'\r\n    } else if (this.props.visita.additionals.revisiones > 0) {\r\n      return 'Esta visita tiene Notas de Revisión pendientes por revisar que deben primero ser revisadas para poder marcar esta hoja de trabajo como REVISADA.'\r\n    }\r\n\r\n    return this.props.revisadoDisabledText\r\n  }\r\n\r\n  updateVisita(_visita: any) {\r\n    const { hoja_trabajo, update } = this.context\r\n    let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, this.props.visita, _visita)\r\n    update(hoja_trabajo_new)\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n    const revisadoDisabledText = this.getRevisadoDisabledText()\r\n\r\n    let icon_revisado_alert\r\n    if (\r\n      visita.fecha_revision && // Tiene fecha de revision\r\n      ((visita.fecha_completado && Date.create(visita.fecha_completado) > Date.create(visita.fecha_revision)) || // Fue completado despues de revisado\r\n        !_.includes([ '5', '6' ], '' + visita.id_status)) // No esta en estado Revisado o Notas de Revision\r\n    ) {\r\n      icon_revisado_alert = (\r\n        <Popup\r\n          trigger={<Icon color='red' name='warning circle' />}\r\n          content={'Esta visita ha recibido modificaciones después de su última revisión.'}\r\n        />\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className='actions ab-status-actions'>\r\n        {user_has_role_permission('paso_completado') && (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <Button\r\n                  primary\r\n                  icon\r\n                  compact\r\n                  onClick={this.onClickCompletado}\r\n                  disabled={this.props.completadoDisabledText != null}\r\n                >\r\n                  {' '}\r\n                  <Icon name='check' /> Completado\r\n                </Button>\r\n              </div>\r\n            }\r\n            content={this.props.completadoDisabledText}\r\n            header='Marcar como Completado | Opción deshabilitada'\r\n            disabled={this.props.completadoDisabledText == null}\r\n            className='disable-text'\r\n            on='hover'\r\n          />\r\n        )}\r\n        {user_has_role_permission([ 'paso_revisado' ]) && (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <Button\r\n                  color='olive'\r\n                  icon\r\n                  compact\r\n                  onClick={this.onClickRevisado}\r\n                  disabled={revisadoDisabledText != null}\r\n                >\r\n                  {' '}\r\n                  <Icon name='check' fitted />\r\n                  <Icon name='check' /> Revisado {icon_revisado_alert}\r\n                </Button>\r\n              </div>\r\n            }\r\n            content={revisadoDisabledText}\r\n            header='Marcar como Revisado | Opción deshabilitada'\r\n            disabled={revisadoDisabledText == null}\r\n            className='disable-text'\r\n            on='hover'\r\n            position='top right'\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype PasoVisitaAssocProps = {\r\n  hoja_trabajo: HojaTrabajo\r\n  trigger: ReactNode\r\n}\r\ntype PasoVisitaAssocState = {\r\n  open: boolean\r\n  newVisitaOpen: boolean\r\n  selectedVisitas: number[]\r\n}\r\n\r\nexport class PasoVisitaAssoc extends Component<PasoVisitaAssocProps, PasoVisitaAssocState> {\r\n  constructor(props: PasoVisitaAssocProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      open: false,\r\n      newVisitaOpen: false,\r\n      selectedVisitas: _.filter(_.map(this.props.hoja_trabajo.visitas, (item, id) => (item.id ? id : null)))\r\n    }\r\n  }\r\n\r\n  getModal() {\r\n    if (!this.state.open) {\r\n      return null\r\n    }\r\n\r\n    const icons = {\r\n      moveLeft: <i className='icon angle left' />,\r\n      moveAllLeft: <i className='icon angle double left' />,\r\n      moveRight: <i className='icon angle right' />,\r\n      moveAllRight: <i className='icon angle double right' />,\r\n      moveDown: <i className='icon angle down' />,\r\n      moveUp: <i className='icon angle up' />\r\n    }\r\n\r\n    const { hoja_trabajo } = this.props\r\n\r\n    const visitas = hoja_trabajo.visitas\r\n    let options: { value: number; label: string }[] = []\r\n\r\n    _.forEach(visitas, function(visita, id) {\r\n      options.push({\r\n        value: id,\r\n        label: visita.label\r\n      })\r\n    })\r\n\r\n    const onChange = (selectedVisitas: number[]) => {\r\n      this.setState({ selectedVisitas })\r\n    }\r\n\r\n    const onClose = () => {\r\n      this.setState({ open: false })\r\n    }\r\n\r\n    const onToggle = () => {\r\n      this.setState((state) => {\r\n        return { newVisitaOpen: !state.newVisitaOpen }\r\n      })\r\n    }\r\n\r\n    return (\r\n      <Modal key='modal-assoc' open closeIcon dimmer='inverted' size='small' onClose={onClose} className='modal-ab'>\r\n        <Modal.Header> Asociación de Visitas a este Paso</Modal.Header>\r\n        <Modal.Content>\r\n          <form\r\n            method='post'\r\n            className='ui form'\r\n            action={url_for(`proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita`)}\r\n          >\r\n            <div style={{ marginBottom: '15px' }}>Asocie las visitas a relacionar con este paso: </div> <br />\r\n            <DualListBox\r\n              name='visitas'\r\n              options={options}\r\n              availableLabel='Por asociar'\r\n              selectedLabel='Asociadas'\r\n              selected={this.state.selectedVisitas}\r\n              icons={icons}\r\n              onChange={onChange}\r\n            />\r\n            <Divider horizontal>O</Divider>\r\n            <Accordion>\r\n              <Accordion.Title active={this.state.newVisitaOpen} onClick={onToggle}>\r\n                <Icon name='caret right' /> Crear Nueva Visita\r\n              </Accordion.Title>\r\n              <Accordion.Content active={this.state.newVisitaOpen}>\r\n                <Form.Field inline>\r\n                  <label>Nombre de la visita</label>\r\n                  <div className='ui input'>\r\n                    <input placeholder='Nombre de la visita' name='visita_name' type='text' />\r\n                  </div>\r\n                </Form.Field>\r\n              </Accordion.Content>\r\n            </Accordion>\r\n            <button className='primary small ui button right floated'>Guardar</button>\r\n            <button className='negative small ui button right floated' type='button' onClick={onClose}>\r\n              Cancelar\r\n            </button>\r\n            <div className='clearfix' />\r\n          </form>\r\n        </Modal.Content>\r\n      </Modal>\r\n    )\r\n  }\r\n  render() {\r\n    return [\r\n      <div key='trigger' onClick={() => this.setState({ open: true })}>\r\n        {this.props.trigger}\r\n      </div>,\r\n      this.getModal()\r\n    ]\r\n  }\r\n}\r\n","import { Component } from 'react'\r\n\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon'\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label'\r\nimport List from 'semantic-ui-react/dist/commonjs/elements/List'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer/Dimmer'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader/Loader'\r\n\r\nexport class AttachmentListItem extends Component<AttachmentListItemProps> {\r\n  private static getFileExtension(filename: string): string {\r\n    return filename.split('.').pop()\r\n  }\r\n\r\n  private static getFileIconUrl(file: string): string {\r\n    const extension = AttachmentListItem.getFileExtension(file)\r\n\r\n    const file_icon = function() {\r\n      switch (extension) {\r\n        case 'xls':\r\n        case 'xlsx':\r\n        case 'xlsm':\r\n        case 'xlsxm':\r\n          return 'excel'\r\n        case 'doc':\r\n        case 'docx':\r\n          return 'word'\r\n        case 'pdf':\r\n          return 'pdf'\r\n        case 'png':\r\n        case 'jpg':\r\n        case 'jpeg':\r\n        case 'bmp':\r\n        case 'gif':\r\n          return 'image'\r\n        case 'zip':\r\n        case 'rar':\r\n          return 'zip'\r\n        default:\r\n          return 'default'\r\n      }\r\n    }\r\n\r\n    return public_path(`images/file_icons/${file_icon()}.png`)\r\n  }\r\n\r\n  changeStatus(e: React.SyntheticEvent, status: 'completado' | 'revisado') {\r\n    e.preventDefault()\r\n\r\n    const url: string = url_for(\r\n      `proyecto/${this.props.attachment.id_proyecto}/adjunto/${this.props.attachment.id}/${status}`\r\n    )\r\n    $.blockUI({\r\n      message:\r\n        '<div class=\"ajax-loader-snake-32  _a-center\"></div><h3 class=\"loading-block-text\">Marcando archivo como ' +\r\n        _.str.capitalize(status) +\r\n        '.<br> Por favor Espere ...</h3>'\r\n    })\r\n\r\n    $.ajax(url, { type: 'POST', data: {}, dataType: 'json' })\r\n      .done((res) => {\r\n        this.props.onUpdate(res.response.record)\r\n        $.unblockUI()\r\n      })\r\n      .fail(() => {\r\n        $.pnotify({ text: 'El archivo no pudo ser actualizado.', type: 'error' })\r\n        $.unblockUI()\r\n      })\r\n  }\r\n\r\n  onRemove = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const url: string = url_for(\r\n      `proyecto/${this.props.attachment.id_proyecto}/adjunto/${this.props.attachment.id}/remove`\r\n    )\r\n    bootbox.warningConfirm(\r\n      '¿Esta seguro de querer borrar este archivo?<br><br>Tenga en cuenta que el sistema intentará borrar automáticamente los enlaces existentes a este archivo.',\r\n      'Cancelar',\r\n      'Aceptar',\r\n      (r) => {\r\n        if (r) {\r\n          $.blockUI({\r\n            message:\r\n              '<div class=\"ajax-loader-snake-32  _a-center\"></div><h3 class=\"loading-block-text\">Borrando archivo.<br> Por favor Espere ...</h3>'\r\n          })\r\n          $.ajax(url, { type: 'POST', data: {}, dataType: 'json' })\r\n            .done(() => {\r\n              this.props.onDelete(this.props.attachment, () => $.unblockUI())\r\n            })\r\n            .fail(() => {\r\n              $.pnotify({ text: 'El archivo no pudo ser borrado.', type: 'error' })\r\n              $.unblockUI()\r\n            })\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const { attachment } = this.props\r\n\r\n    let completadoComp\r\n    if (attachment.fecha_completado) {\r\n      completadoComp = (\r\n        <div style={{ display: 'inline-block' }}>\r\n          <strong className='title'>(P) </strong>\r\n          <div\r\n            style={{ display: 'inline-block', minWidth: 20, textAlign: 'center', marginRight: 2 }}\r\n            title={`Preparado por: ${attachment.UpdateLog[0].User.name}`}\r\n          >\r\n            {attachment.UpdateLog[0].User.sigla}&nbsp;\r\n          </div>\r\n          <div style={{ display: 'inline-block' }} title={attachment.fecha_completado}>\r\n            <span className='icon-moon-calendar' />{' '}\r\n            {Date.create(attachment.fecha_completado).format('{year}-{MM}-{dd}')}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    let revisadoComp\r\n    if (attachment.fecha_revisado) {\r\n      revisadoComp = (\r\n        <div style={{ display: 'inline-block' }}>\r\n          <strong className='title'>(R) </strong>\r\n          <div\r\n            style={{ display: 'inline-block', minWidth: 20, textAlign: 'center', marginRight: 2 }}\r\n            title={`Revisado por: ${attachment.RevisionLog[0].User.name}`}\r\n          >\r\n            {attachment.RevisionLog[0].User.sigla}&nbsp;\r\n          </div>\r\n          <div style={{ display: 'inline-block' }} title={attachment.fecha_revisado}>\r\n            <span className='icon-moon-calendar' /> {Date.create(attachment.fecha_revisado).format('{year}-{MM}-{dd}')}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    let revisadoLink\r\n    if (user_has_role([ 'PM', 'SR' ])) {\r\n      if (attachment.fecha_completado) {\r\n        revisadoLink = (\r\n          <button style={{ marginLeft: '8px' }} onClick={(e) => this.changeStatus(e, 'revisado')} className='act'>\r\n            <span className='icon-moon-checkmark-8' /> Revisar\r\n          </button>\r\n        )\r\n      } else {\r\n        revisadoLink = (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <button style={{ marginLeft: '8px' }} className='act disabled'>\r\n                  <span className='icon-moon-checkmark-8' /> Revisar\r\n                </button>\r\n              </div>\r\n            }\r\n            content='Esta archivo adjunto debe estar primero en estado COMPLETADO, para poder ser marcado como REVISADO'\r\n            header='Marcar como Revisado | Opción deshabilitada'\r\n            className='disable-text'\r\n            on='hover'\r\n          />\r\n        )\r\n      }\r\n    }\r\n\r\n    return (\r\n      <li key={attachment.id} style={{ marginBottom: 2 }}>\r\n        <div style={{ background: '#f5f9f8', borderRadius: 6, border: '1px solid #aecec7' }}>\r\n          <div className='col-md-1' style={{ marginTop: 5, borderRight: '1px inset #d7e1e2' }}>\r\n            <img src={AttachmentListItem.getFileIconUrl(attachment.filename)} alt='Icono' />\r\n          </div>\r\n          <div className='col-md-11' style={{ padding: '3px 10px' }}>\r\n            <div\r\n              className='noqtip'\r\n              title={attachment.filename}\r\n              style={{\r\n                fontWeight: 'bold',\r\n                fontSize: '12px',\r\n                maxWidth: 400,\r\n                whiteSpace: 'nowrap',\r\n                overflow: 'hidden',\r\n                textOverflow: 'ellipsis'\r\n              }}\r\n            >\r\n              {attachment.filename}\r\n            </div>\r\n            <div style={{ fontSize: '12px' }}>\r\n              <span\r\n                style={{ fontStyle: 'italic' }}\r\n                className='noqtip'\r\n                title={`Peso del archivo: ${attachment.filesize_human}`}\r\n              >\r\n                {attachment.filesize_human}\r\n              </span>{' '}\r\n              |\r\n              <div className='attachment-actionsbar'>\r\n                <div className='section-a'>\r\n                  <a\r\n                    href={public_path(`uploads/proyecto_adjunto/${attachment.filepath}`)}\r\n                    target='_blank'\r\n                    className='act'\r\n                    style={{ color: '#777' }}\r\n                  >\r\n                    <span className='icon-moon-download' style={{ fontSize: '10px' }} /> Descargar\r\n                  </a>\r\n                </div>\r\n\r\n                {user_has_role([ 'PM', 'SR', 'JR' ]) && (\r\n                  <div className='section-a'>\r\n                    <a href='#' className='act' onClick={this.onRemove}>\r\n                      <span className='icon-tc-trash' /> Borrar\r\n                    </a>\r\n                  </div>\r\n                )}\r\n\r\n                <div className='section-a' style={{ minWidth: 90 }}>\r\n                  {attachment.fecha_completado ? (\r\n                    <Popup trigger={completadoComp} position='bottom center'>\r\n                      <Popup.Header content='Preparado por' />\r\n                      <Popup.Content>\r\n                        <table className='table nowrap'>\r\n                          <tbody>\r\n                            {attachment.UpdateLog.map((item, k) => {\r\n                              return (\r\n                                <tr key={k}>\r\n                                  <td>\r\n                                    <Icon name='user circle' color='green' /> {item.User.name} ({item.User.sigla})\r\n                                  </td>\r\n                                  <td>\r\n                                    <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                                  </td>\r\n                                </tr>\r\n                              )\r\n                            })}\r\n                          </tbody>\r\n                        </table>\r\n                      </Popup.Content>\r\n                    </Popup>\r\n                  ) : (\r\n                    user_has_role([ 'PM', 'SR', 'JR' ]) && (\r\n                      <button\r\n                        style={{ marginLeft: '8px' }}\r\n                        onClick={(e) => this.changeStatus(e, 'completado')}\r\n                        className='act'\r\n                      >\r\n                        <span className='icon-moon-checkmark-8' /> Completar\r\n                      </button>\r\n                    )\r\n                  )}\r\n                </div>\r\n\r\n                <div className='section-a'>\r\n                  {attachment.fecha_revisado && (\r\n                    <Popup trigger={revisadoComp} position='bottom center'>\r\n                      <Popup.Header content='Revisado por' />\r\n                      <Popup.Content>\r\n                        <table className='table nowrap'>\r\n                          <tbody>\r\n                            {attachment.RevisionLog.map((item, k) => {\r\n                              return (\r\n                                <tr key={k}>\r\n                                  <td>\r\n                                    <Icon name='user circle' color='olive' /> {item.User.name} ({item.User.sigla})\r\n                                  </td>\r\n                                  <td>\r\n                                    <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                                  </td>\r\n                                </tr>\r\n                              )\r\n                            })}\r\n                          </tbody>\r\n                        </table>\r\n                      </Popup.Content>\r\n                    </Popup>\r\n                  )}\r\n                  {revisadoLink}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div />\r\n          </div>\r\n          <div className='clearfix' />\r\n        </div>\r\n      </li>\r\n    )\r\n  }\r\n}\r\n\r\nexport class AttachmentListPanel extends Component<AttachmentListPanelProps> {\r\n  static defaultProps = {\r\n    isLoading: false\r\n  }\r\n  render() {\r\n    let { isLoading, attachments } = this.props\r\n\r\n    return (\r\n      <div className='attachment-list-panel dimmable' style={{ minHeight: 40 }}>\r\n        {isLoading && (\r\n          <Dimmer inverted active>\r\n            <Loader inverted active className='elastic grey' />\r\n          </Dimmer>\r\n        )}\r\n        <h3 className='panel-title'>\r\n          Adjuntos:\r\n          <Label circular color='green'>\r\n            {_.size(attachments)}\r\n          </Label>\r\n        </h3>\r\n        {_.size(attachments) > 0 && (\r\n          <List divided className='attachment-list'>\r\n            {_.map(attachments, (attachment: ProyectoAttachment, i) => {\r\n              return (\r\n                <AttachmentListItem\r\n                  key={attachment.id}\r\n                  attachment={attachment}\r\n                  onUpdate={this.props.onUpdateItem}\r\n                  onDelete={this.props.onDeleteItem}\r\n                />\r\n              )\r\n            })}\r\n          </List>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport function cleanAttachmentFrom(value: string, adjunto: ProyectoAttachment) {\r\n  const h = public_path(`uploads/proyecto_adjunto/${adjunto.filepath}`, true).replace(/\\./g, '.').replace(/\\\\/g, '/')\r\n  const t = '<a .*href=\"' + h + '\"(.+?)/a>\\\\s*(<br\\\\s?/?>)?'\r\n  const re = new RegExp(t, 'g')\r\n\r\n  return value.replace(re, '')\r\n}\r\n","import { PureComponent, Fragment, SyntheticEvent } from 'react'\r\nimport { MenuItemNewHeader } from './menuitem__new'\r\nimport EditorPreview from '../../global/EditorPreview'\r\nimport InputAutoNumeric from '../../global/InputAutoNumeric'\r\nimport MenuItemAjusteContext from './menuitem_ajuste_context'\r\nimport Autocomplete from 'react-autocomplete'\r\nimport { getNombreCuenta } from '../utils_ajuste'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\nimport { StatusButtonGroupActions } from '../../global/StatusButtonAction'\r\nimport cx from 'classnames'\r\nimport { GenericTooltip } from '../../global/Tooltip'\r\n\r\ndeclare var app: any\r\n\r\ntype AjusteModalProps = {\r\n  moduleParams: any\r\n  item: ProyectoAjusteGroup\r\n  isEditable: boolean\r\n  onSave: (changes: any, blockingText?: string) => void\r\n  onClickDelete?: (ev: SyntheticEvent) => void\r\n}\r\n\r\ntype AjusteModalState = {\r\n  descripcion: string\r\n  items: ProyectoAjuste[]\r\n  status: ProyectoModuleStatusEnum\r\n  aplicado: number\r\n}\r\n\r\nexport class AjusteModal extends PureComponent<AjusteModalProps, AjusteModalState> {\r\n  constructor(props: AjusteModalProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      descripcion: props.item.descripcion,\r\n      items: props.item.items || [],\r\n      status: props.item.status,\r\n      aplicado: props.item.aplicado\r\n    }\r\n  }\r\n\r\n  isNewItem() {\r\n    return !this.props.item.idx\r\n  }\r\n\r\n  esPlanillaDescuadrada() {\r\n    const { items } = this.state\r\n\r\n    if (!items) {\r\n      return false\r\n    }\r\n\r\n    const totalD = _.reduce(items, (acc, curr) => num(curr.debe) + acc, 0)\r\n    const totalH = _.reduce(items, (acc, curr) => num(curr.haber) + acc, 0)\r\n\r\n    return totalD != totalH\r\n  }\r\n\r\n  validateItems() {\r\n    return (\r\n      _.size(this.state.items) > 0 &&\r\n      !_.any(this.state.items, (item) => {\r\n        return item['cuenta'] == '' || item['nombre_cuenta'] == '' || (!item['debe'] && !item['haber'])\r\n      })\r\n    )\r\n  }\r\n\r\n  onChangeAplicado = (ev: SyntheticEvent) => {\r\n    this.setState({ aplicado: (ev.target as any).value })\r\n    if (!this.isNewItem()) {\r\n      this.props.onSave({ aplicado: (ev.target as any).value })\r\n    }\r\n  }\r\n\r\n  onChangeDescripcion = (ckeditor: CKEDITOR.editor) => {\r\n    this.setState({ descripcion: ckeditor.getData() })\r\n    if (!this.isNewItem()) {\r\n      this.props.onSave({ descripcion: ckeditor.getData() })\r\n    }\r\n  }\r\n\r\n  onAddItem = () => {\r\n    this.setState((prevState) => {\r\n      const items = [ ...prevState.items, createAjusteEmpty() ]\r\n\r\n      return { items }\r\n    })\r\n  }\r\n\r\n  onDeleteItem = (item: ProyectoAjuste, itemIndex: number) => {\r\n    this.setState(\r\n      (prevState) => {\r\n        const items = _.reject(prevState.items, (_item, k: number) => k == itemIndex)\r\n\r\n        return { items }\r\n      },\r\n      () => {\r\n        if (!this.isNewItem()) {\r\n          this.props.onSave({ items: this.state.items })\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  onUpdateItem = (item: ProyectoAjuste, itemIndex: number, notify: boolean = true) => {\r\n    this.setState(\r\n      (prevState) => {\r\n        let items\r\n        if (typeof prevState.items[itemIndex] === 'undefined') {\r\n          items = [ ...prevState.items ]\r\n          items.push(item)\r\n        } else {\r\n          items = _.map(prevState.items, (_item, k) => {\r\n            if (k == itemIndex) {\r\n              return Object.assign({}, _item, item)\r\n            } else {\r\n              return _item\r\n            }\r\n          })\r\n        }\r\n\r\n        return { items }\r\n      },\r\n      () => {\r\n        if (notify && !this.isNewItem()) {\r\n          const blockingText = _.any(this.state.items, (_item) => !_item.id) ? 'Guardando cambios' : null\r\n          this.props.onSave({ items: this.state.items }, blockingText)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  _onCreate(changes: any, blockingText?: string) {\r\n    if (!this.validateItems()) {\r\n      bootbox.alert('Ingrese el codigo de la cuenta y valor del ajuste para cada una de las filas del ajuste contable.')\r\n      return\r\n    }\r\n    this.props.onSave(Object.assign({}, this.state, changes), blockingText)\r\n  }\r\n\r\n  onCreate = () => {\r\n    this._onCreate({ status: 'EN PROCESO' }, 'Creando Ajuste')\r\n  }\r\n\r\n  onCreateAndCompletado = () => {\r\n    this._onCreate({ status: 'COMPLETADO' }, 'Creando Ajuste')\r\n  }\r\n\r\n  onCompletado = () => {\r\n    this.props.onSave({ status: 'COMPLETADO' }, 'Marcando como COMPLETADO')\r\n  }\r\n\r\n  onRevisado = () => {\r\n    this.props.onSave({ status: 'REVISADO' }, 'Marcando como REVISASO')\r\n  }\r\n\r\n  renderItemHeader() {\r\n    const item = Object.assign(\r\n      { label: this.props.item.idx ? `Ajuste #${this.props.item.idx}` : 'Ajuste Nuevo' },\r\n      this.props.item\r\n    )\r\n\r\n    return <MenuItemNewHeader item={item} />\r\n  }\r\n\r\n  renderRows() {\r\n    let items = this.state.items\r\n\r\n    return (\r\n      <Fragment>\r\n        <MenuItemAjusteContext.Consumer>\r\n          {(cuentas) =>\r\n            _.map(items, (row, k) => {\r\n              return (\r\n                <AjusteTableRow\r\n                  item={row}\r\n                  key={k}\r\n                  itemIndex={k}\r\n                  cuentas={cuentas}\r\n                  isEditable={this.props.isEditable}\r\n                  canRemove={_.size(items) > 1}\r\n                  onUpdate={this.onUpdateItem}\r\n                  onClickDelete={this.onDeleteItem}\r\n                />\r\n              )\r\n            })}\r\n        </MenuItemAjusteContext.Consumer>\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  renderActions() {\r\n    const { item } = this.props\r\n\r\n    const esPlanillaDescuadrada = this.esPlanillaDescuadrada()\r\n\r\n    let revisadoDisableText = null\r\n    if (esPlanillaDescuadrada) {\r\n      revisadoDisableText =\r\n        'No es posible guardar los cambios realizados en este ajuste mientras la planilla esté descuadrada.'\r\n    } else if (!item.fecha_completado) {\r\n      revisadoDisableText = 'Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO.'\r\n    }\r\n\r\n    const rightActions = !this.isNewItem() && (\r\n      <button className='ui button compact negative left floated' onClick={this.props.onClickDelete}>\r\n        <i className='icon trash' /> Eliminar\r\n      </button>\r\n    )\r\n\r\n    return this.isNewItem() ? (\r\n      <div className='actions ab-status-actions'>\r\n        <Popup\r\n          content='No es posible guardar este ajuste mientras la planilla esté descuadrada.'\r\n          disabled={!esPlanillaDescuadrada}\r\n          className='disable-text'\r\n          trigger={\r\n            <div className='button-wrapper'>\r\n              <button className='ui button compact green' onClick={this.onCreate} disabled={esPlanillaDescuadrada}>\r\n                Crear\r\n              </button>\r\n            </div>\r\n          }\r\n        />\r\n\r\n        <Popup\r\n          content='No es posible guardar este ajuste mientras la planilla esté descuadrada.'\r\n          disabled={!esPlanillaDescuadrada}\r\n          className='disable-text'\r\n          trigger={\r\n            <div className='button-wrapper'>\r\n              <button\r\n                className='ui button compact green'\r\n                onClick={this.onCreateAndCompletado}\r\n                disabled={esPlanillaDescuadrada}\r\n              >\r\n                Crear y Completar\r\n              </button>\r\n            </div>\r\n          }\r\n        />\r\n      </div>\r\n    ) : (\r\n      <Fragment>\r\n        {rightActions}\r\n        <StatusButtonGroupActions\r\n          completado={{\r\n            permission: 'hallazgo_completado',\r\n            onClick: this.onCompletado,\r\n            disableText: esPlanillaDescuadrada\r\n              ? 'No es posible guardar los cambios realizados en este ajuste mientras la planilla esté descuadrada.'\r\n              : null\r\n          }}\r\n          revisado={{\r\n            permission: 'hallazgo_revisado',\r\n            onClick: this.onRevisado,\r\n            record: item,\r\n            disableText: revisadoDisableText\r\n          }}\r\n        />\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <div className='content'>\r\n          {this.renderItemHeader()}\r\n          <table className='ui table compact'>\r\n            <thead>\r\n              <tr>\r\n                <th>Código de la Cuenta</th>\r\n                <th>Nombre de la Cuenta</th>\r\n                <th>Debe</th>\r\n                <th>Haber</th>\r\n                <th />\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.renderRows()}\r\n              {this.props.isEditable && (\r\n                <tr>\r\n                  <td colSpan={5}>\r\n                    <button type='button' className='ui button olive fluid icon' onClick={this.onAddItem}>\r\n                      Añadir Fila <i className='icon plus' />\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n          {this.esPlanillaDescuadrada() && (\r\n            <div className='ui red tiny message _a-center m1 '>\r\n              <i className='icon exclamation triangle yellow' /> Alerta: Planilla descuadrada\r\n            </div>\r\n          )}\r\n          <div className='ui segment'>\r\n            <EditorPreview\r\n              prefixPreview='Descripción del Ajuste'\r\n              labelTitle='Descripción del Ajuste'\r\n              ckeditorOptions='basic'\r\n              editable={this.props.isEditable}\r\n              data={this.state.descripcion}\r\n              onSave={this.onChangeDescripcion}\r\n            />\r\n          </div>\r\n\r\n          <div className='ui segment basic nopad pull-left' style={{ marginTop: 5 }}>\r\n            <label style={{ marginRight: 10, display: 'inline-block', fontWeight: 600 }}>Error Tolerable:</label>\r\n            {accounting.formatNumber(app.vars.error_tolerable[this.props.moduleParams.id_visita])}\r\n          </div>\r\n\r\n          <div className='ui right aligned segment basic nopad'>\r\n            <label style={{ marginRight: 10, display: 'inline-block', fontWeight: 600 }}>\r\n              ¿Ajuste Registrado? <GenericTooltip text='@tooltip.ajustes.aplicado' /> :\r\n            </label>\r\n            <select\r\n              className='raw-select'\r\n              value={'' + this.state.aplicado == '1' ? '1' : '0'}\r\n              onChange={this.onChangeAplicado}\r\n            >\r\n              <option value='1'>Sí</option>\r\n              <option value='0'>No</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        <div className='actions'>\r\n          {this.renderActions()}\r\n          <div className='clearfix' />\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype AjusteTableRowProps = {\r\n  item: ProyectoAjuste\r\n  itemIndex: number\r\n  cuentas: ProyectoAjusteCuenta[]\r\n  isEditable: boolean\r\n  canRemove: boolean\r\n  onUpdate: (item: ProyectoAjuste, itemIndex: number, notify: boolean) => void\r\n  onClickDelete: (item: ProyectoAjuste, itemIndex: number) => void\r\n}\r\n\r\ntype AjusteTableRowState = {\r\n  cuenta: string\r\n  nombre_cuenta: string\r\n  debe: number\r\n  haber: number\r\n}\r\n\r\nclass AjusteTableRow extends PureComponent<AjusteTableRowProps, AjusteTableRowState> {\r\n  constructor(props: AjusteTableRowProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      cuenta: props.item.cuenta,\r\n      nombre_cuenta: props.item.nombre_cuenta,\r\n      debe: props.item.debe,\r\n      haber: props.item.haber\r\n    }\r\n  }\r\n\r\n  notifyUpdate(notify: boolean = true) {\r\n    const changes = Object.assign({}, this.props.item, this.state)\r\n    if (changes['cuenta'] == '' || changes['nombre_cuenta'] == '' || (!changes['debe'] && !changes['haber'])) {\r\n      return\r\n    }\r\n\r\n    this.props.onUpdate(changes, this.props.itemIndex, notify)\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    if (!this.props.canRemove) {\r\n      return\r\n    }\r\n\r\n    bootbox.confirm(\r\n      '¿Desea eliminar esta fila de su ajuste contable?',\r\n      'Cancelar',\r\n      'Sí, eliminar fila',\r\n      (r: boolean) => {\r\n        if (!r) {\r\n          return\r\n        }\r\n\r\n        this.props.onClickDelete(this.props.item, this.props.itemIndex)\r\n      }\r\n    )\r\n  }\r\n\r\n  onSelectCuenta = (value: string, item: ProyectoAjuste) => {\r\n    this.setState({ cuenta: item.cuenta, nombre_cuenta: item.nombre_cuenta }, () => {\r\n      this.notifyUpdate()\r\n    })\r\n  }\r\n\r\n  onChangeCuenta = (ev: SyntheticEvent, value: string) => {\r\n    this.setState({ cuenta: value, nombre_cuenta: '' })\r\n  }\r\n\r\n  onChangeNombreCuenta = (ev: SyntheticEvent, value: string) => {\r\n    this.setState({ nombre_cuenta: value, cuenta: '' })\r\n  }\r\n\r\n  onBlurCuenta = () => {\r\n    const { cuentas } = this.props\r\n\r\n    this.setState(\r\n      (prevState) => {\r\n        if (prevState.cuenta == '' && prevState.nombre_cuenta == '') {\r\n          return null\r\n        }\r\n\r\n        if (prevState.cuenta != '' && prevState.nombre_cuenta != '') {\r\n          return null\r\n        }\r\n\r\n        if (prevState.cuenta != '') {\r\n          const nombre_cuenta: string = getNombreCuenta(cuentas, prevState.cuenta)\r\n\r\n          return { cuenta: prevState.cuenta, nombre_cuenta }\r\n        }\r\n\r\n        if (prevState.nombre_cuenta != '') {\r\n          const cuenta = _.find(\r\n            cuentas,\r\n            (item) => item.nombre_cuenta.toUpperCase() == prevState.nombre_cuenta.toUpperCase()\r\n          )\r\n\r\n          return { cuenta: cuenta ? cuenta.cuenta : '', nombre_cuenta: prevState.nombre_cuenta }\r\n        }\r\n      },\r\n      () => this.notifyUpdate()\r\n    )\r\n  }\r\n\r\n  onChangeInput = (field: 'debe' | 'haber', value: number, persist: boolean) => {\r\n    if (field == 'debe') {\r\n      this.setState({ debe: value }, () => this.notifyUpdate(persist))\r\n    } else {\r\n      this.setState({ haber: value }, () => this.notifyUpdate(persist))\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <tr>\r\n        <td>\r\n          <Autocomplete\r\n            items={this.props.cuentas}\r\n            getItemValue={(item) => item.cuenta}\r\n            renderItem={(item, isHighlighted) => {\r\n              return (\r\n                <div key={item.id} className={'item ' + (isHighlighted ? 'item-highlighted' : '')}>\r\n                  <div>{item.cuenta}</div>\r\n                  <div className='description'>{item.nombre_cuenta}</div>\r\n                </div>\r\n              )\r\n            }}\r\n            value={this.state.cuenta}\r\n            onChange={this.onChangeCuenta}\r\n            onSelect={this.onSelectCuenta}\r\n            inputProps={{ type: 'text', spellCheck: false, required: true, onBlur: this.onBlurCuenta }}\r\n            shouldItemRender={(item, value) => {\r\n              return item.cuenta.replace(/\\D/g, '').startsWith(value.replace(/\\D/g, ''))\r\n            }}\r\n            renderMenu={(items) => {\r\n              return (\r\n                <div className='autocomplete-menu' style={{ position: 'absolute', zIndex: 1002 }} children={items} />\r\n              )\r\n            }}\r\n            wrapperProps={{ className: cx({ error: !this.state.cuenta }) }}\r\n            wrapperStyle={{ display: 'inline-block', position: 'relative' }}\r\n          />\r\n          {!this.state.cuenta && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          <Autocomplete\r\n            items={this.props.cuentas}\r\n            getItemValue={(item) => item.nombre_cuenta}\r\n            renderItem={(item, isHighlighted) => {\r\n              return (\r\n                <div key={item.id} className={'item ' + (isHighlighted ? 'item-highlighted' : '')}>\r\n                  <div>{item.nombre_cuenta}</div>\r\n                  <div className='description'>{item.cuenta}</div>\r\n                </div>\r\n              )\r\n            }}\r\n            value={this.state.nombre_cuenta}\r\n            onChange={this.onChangeNombreCuenta}\r\n            onSelect={this.onSelectCuenta}\r\n            inputProps={{ type: 'text', spellCheck: false, required: true }}\r\n            shouldItemRender={(item, value) => {\r\n              const text = item.nombre_cuenta.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').toUpperCase()\r\n              return _.str.contains(text, value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').toUpperCase())\r\n            }}\r\n            renderMenu={(items) => {\r\n              return (\r\n                <div className='autocomplete-menu' style={{ position: 'absolute', zIndex: 1002 }} children={items} />\r\n              )\r\n            }}\r\n            wrapperProps={{ className: cx({ error: !this.state.nombre_cuenta }) }}\r\n            wrapperStyle={{ display: 'inline-block', position: 'relative' }}\r\n          />\r\n          {!this.state.nombre_cuenta && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          <div className={cx({ error: !this.state.debe && !this.state.haber })}>\r\n            <InputAutoNumeric\r\n              isEditable={this.props.isEditable}\r\n              value={this.state.debe}\r\n              disabled={!!this.state.haber}\r\n              onChange={(ev: SyntheticEvent, value: number) => this.onChangeInput('debe', value, false)}\r\n              onBlur={(ev: SyntheticEvent, value: number) => this.onChangeInput('debe', value, true)}\r\n            />\r\n          </div>\r\n          {!this.state.debe &&\r\n          !this.state.haber && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          <div className={cx({ error: !this.state.haber && !this.state.debe })}>\r\n            <InputAutoNumeric\r\n              isEditable={this.props.isEditable}\r\n              value={this.state.haber}\r\n              disabled={!!this.state.debe}\r\n              onChange={(ev: SyntheticEvent, value: number) => this.onChangeInput('haber', value, false)}\r\n              onBlur={(ev: SyntheticEvent, value: number) => this.onChangeInput('haber', value, true)}\r\n            />\r\n          </div>\r\n          {!this.state.haber &&\r\n          !this.state.debe && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          {this.props.isEditable && (\r\n            <Popup\r\n              disabled={this.props.canRemove}\r\n              content='Todo ajuste contable debe tener un mínimo de 1 cuenta (fila).'\r\n              trigger={\r\n                <a href='#' onClick={this.onClickDelete} title='Eliminar Fila'>\r\n                  <i className='icon cancel red' />\r\n                </a>\r\n              }\r\n              header='Eliminar fila | Opción deshabilitada'\r\n              className='disable-text'\r\n            />\r\n          )}\r\n        </td>\r\n      </tr>\r\n    )\r\n  }\r\n}\r\n\r\nconst num = (input: any) => {\r\n  const v = parseFloat(input)\r\n  return isNaN(v) ? 0 : v\r\n}\r\n\r\nconst createAjusteEmpty = (): ProyectoAjuste => {\r\n  return {\r\n    cuenta: '',\r\n    debe: null,\r\n    haber: null,\r\n    nombre_cuenta: ''\r\n  }\r\n}\r\n","import { createContext } from 'react'\r\n\r\nexport default createContext([])\r\n","export const getNombreCuenta = (cuentas: ProyectoAjusteCuenta[], cuenta: string) => {\r\n  let found = _.findWhere(cuentas, { cuenta })\r\n\r\n  if (found) {\r\n    return found.nombre_cuenta\r\n  }\r\n\r\n  const cleanCuenta = function(c: string) {\r\n    return c.replace(/\\D/g, '')\r\n  }\r\n\r\n  found = _.findWhere(\r\n    _.map(cuentas, function(item) {\r\n      return { cuenta: cleanCuenta(item.cuenta), cuenta_real: item.cuenta_real, nombre_cuenta: item.nombre_cuenta }\r\n    }),\r\n    { cuenta: cleanCuenta(cuenta) }\r\n  )\r\n\r\n  return found ? found.nombre_cuenta : ''\r\n}\r\n","import { SFC, ReactNode } from 'react'\r\n\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport { SemanticCOLORS } from 'semantic-ui-react/dist/commonjs/generic'\r\nimport getvalue from 'get-value'\r\n\r\ndeclare var app: any\r\n\r\ntype TooltipProps = {\r\n  title?: string\r\n  text: string | ReactNode\r\n  wide?: boolean | 'very'\r\n  iconColor?: SemanticCOLORS\r\n  iconSize?: 'mini' | 'tiny' | 'small' | 'large' | 'big' | 'huge' | 'massive'\r\n}\r\n\r\nexport const GenericTooltip: SFC<TooltipProps> = (props): JSX.Element => {\r\n  let content\r\n  if (typeof props.text == 'object') {\r\n    content = <div className='content'>{props.text}</div>\r\n  } else if (typeof props.text == 'string') {\r\n    if (props.text.substr(0, 1) == '@') {\r\n      content = getvalue(app.vars.texts, props.text.substr(1))\r\n    } else {\r\n      content = props.text\r\n    }\r\n\r\n    if (!content) {\r\n      return null\r\n    }\r\n\r\n    content = <div dangerouslySetInnerHTML={{ __html: content }} />\r\n  }\r\n\r\n  return (\r\n    <Popup\r\n      size='tiny'\r\n      wide={props.wide}\r\n      trigger={<Icon color={props.iconColor} size={props.iconSize} name='question circle' className='tooltip-icon' />}\r\n      header={props.title}\r\n      content={content}\r\n    />\r\n  )\r\n}\r\n\r\nGenericTooltip.defaultProps = {\r\n  iconColor: 'blue',\r\n  iconSize: 'small',\r\n  wide: false\r\n}\r\n","import htmlTruncate from 'html-truncate'\r\n\r\nexport function cleanSpacesFromHtml(text: string) {\r\n  if (text == null) {\r\n    return text\r\n  }\r\n\r\n  text = text.trim().replace(/\\r?\\n|\\r/g, '')\r\n  text = text.replace(/>\\s+</g, '><')\r\n  text = text.replace(/\\s{2,}/g, ' ')\r\n\r\n  return text\r\n}\r\n\r\nexport function truncateText(text: string, length: number = 300) {\r\n  if (text == null) {\r\n    return text\r\n  }\r\n\r\n  text = cleanSpacesFromHtml(text)\r\n  text = text.replace(/<table.*\\/table>/g, '<img src=\"/images/icon_tabular.png\" title=\"Tabla\" />') // Remove all tables\r\n\r\n  let html = htmlTruncate('' + text, length, { keepImageTag: true })\r\n\r\n  html = html.replace(/(min-)?width:.+?;/g, '')\r\n  html = html.replace(/(min-)?height:.+?;/g, '')\r\n  html = html.replace(/style=\".+?\"/g, '')\r\n\r\n  return html.trim()\r\n}\r\n","import React, { PureComponent, Fragment, SyntheticEvent } from 'react'\r\n\r\nimport EditorPreview from '../../global/EditorPreview'\r\nimport { StatusButtonGroupActions } from '../../global/StatusButtonAction'\r\nimport DatePicker, { registerLocale } from 'react-datepicker'\r\nimport datepickerEs from 'date-fns/locale/es'\r\nimport { format as formatDate, parseISO as parseDate, isValid as isValidDate } from 'date-fns'\r\nimport { MentionsInput, Mention } from 'react-mentions'\r\nimport { HallazgoUtils } from '../utils_hallazgo'\r\nimport cx from 'classnames'\r\nimport { MenuItemNewHeader } from './menuitem__new'\r\n\r\ndeclare var app: any\r\n\r\nregisterLocale('es', datepickerEs)\r\n\r\ntype HallazgoModalProps = {\r\n  moduleParams: any\r\n  item: ProyectoHallazgo\r\n  isEditable: boolean\r\n  onSave: (item: Partial<ProyectoHallazgo>) => void\r\n  onClickDelete?: (ev: SyntheticEvent) => void\r\n}\r\n\r\ntype HallazgoModalState = {\r\n  value: Partial<ProyectoHallazgo>\r\n}\r\n\r\nexport class HallazgoModal extends PureComponent<HallazgoModalProps, HallazgoModalState> {\r\n  constructor(props: HallazgoModalProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: props.item\r\n    }\r\n  }\r\n\r\n  private handlers: { [s: string]: any } = {}\r\n\r\n  attachHandler(field: string, handler: any) {\r\n    if (!this.handlers[field]) {\r\n      this.handlers[field] = handler\r\n    }\r\n\r\n    return this.handlers[field]\r\n  }\r\n\r\n  isNewItem() {\r\n    return this.props.item.id == null\r\n  }\r\n\r\n  updateModel(changes: any) {\r\n    this.setState((prevState) => {\r\n      return { value: Object.assign({}, prevState.value, changes) }\r\n    })\r\n\r\n    if (!this.isNewItem()) {\r\n      this.props.onSave(changes)\r\n    }\r\n  }\r\n\r\n  getDate(date: string): Date {\r\n    if (!date) {\r\n      return null\r\n    }\r\n\r\n    const d = parseDate(date)\r\n\r\n    return isValidDate(d) ? d : null\r\n  }\r\n\r\n  formatImplementadoChoice(implementado: string | boolean) {\r\n    if (implementado === null || implementado === '') {\r\n      return ''\r\n    }\r\n\r\n    return implementado === true || implementado === '1' ? '1' : '0'\r\n  }\r\n\r\n  _onCreate(changes: any) {\r\n    if (_.isEmpty(this.state.value.hallazgo)) {\r\n      bootbox.alert('La descripción del hallazgo NO puede ser un campo vacío.')\r\n      return\r\n    }\r\n\r\n    this.props.onSave(Object.assign({}, this.state.value, changes))\r\n  }\r\n\r\n  onCreate = () => {\r\n    this._onCreate({ status: 'EN PROCESO' })\r\n  }\r\n\r\n  onCreateAndCompletado = () => {\r\n    this._onCreate({ status: 'COMPLETADO' })\r\n  }\r\n\r\n  onCompletado = () => {\r\n    this.props.onSave({ status: 'COMPLETADO' })\r\n  }\r\n\r\n  onRevisado = () => {\r\n    this.props.onSave({ status: 'REVISADO' })\r\n  }\r\n\r\n  onEditorChange = (field: keyof ProyectoHallazgo) => {\r\n    const handler = (editor: CKEDITOR.editor, closeModal: boolean, autosave: boolean, cb: () => void) => {\r\n      const value = editor.getData()\r\n      if (field == 'hallazgo' && !this.isNewItem() && _.size(_.str.trim(value)) == 0) {\r\n        bootbox.alert('La descripción del hallazgo NO puede ser un campo vacío.')\r\n        return\r\n      }\r\n\r\n      this.updateModel({ [field]: value })\r\n      if ($.isFunction(cb)) {\r\n        cb()\r\n      }\r\n    }\r\n\r\n    return this.attachHandler(field, handler)\r\n  }\r\n\r\n  onInputChange = (field: keyof ProyectoHallazgo) => {\r\n    return this.attachHandler(field, (ev: SyntheticEvent) => {\r\n      this.updateModel({ [field]: (ev.target as any).value })\r\n    })\r\n  }\r\n\r\n  onDateChange = (field: keyof ProyectoHallazgo) => {\r\n    return this.attachHandler(field, (value: Date) => {\r\n      this.updateModel({ [field]: formatDate(value, 'yyyy-MM-dd') })\r\n    })\r\n  }\r\n  onValueChange = (field: keyof ProyectoHallazgo) => {\r\n    return this.attachHandler(field, (value: string) => {\r\n      this.updateModel({ [field]: value })\r\n    })\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    if ($.isFunction(this.props.onClickDelete)) {\r\n      this.props.onClickDelete(ev)\r\n    }\r\n  }\r\n\r\n  renderActions() {\r\n    const { item } = this.props\r\n\r\n    const rightActions = item.id !== null && (\r\n      <button className='ui button compact negative left floated' onClick={this.onClickDelete}>\r\n        <i className='icon trash' /> Eliminar\r\n      </button>\r\n    )\r\n\r\n    return item.id === null ? (\r\n      <div className='actions ab-status-actions'>\r\n        <button className='ui button compact green' onClick={this.onCreate}>\r\n          Crear\r\n        </button>\r\n\r\n        <button className='ui button compact green' onClick={this.onCreateAndCompletado}>\r\n          Crear y Completar\r\n        </button>\r\n      </div>\r\n    ) : (\r\n      <Fragment>\r\n        {rightActions}\r\n        <StatusButtonGroupActions\r\n          completado={{ permission: 'hallazgo_completado', onClick: this.onCompletado }}\r\n          revisado={{ permission: 'hallazgo_revisado', onClick: this.onRevisado, record: item }}\r\n        />\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  renderItemHeader() {\r\n    const item = Object.assign(\r\n      { label: this.props.item.id ? HallazgoUtils.formatName(this.props.item.name) : 'Hallazgo Nuevo' },\r\n      this.props.item\r\n    )\r\n\r\n    return <MenuItemNewHeader item={item} />\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n    const { value } = this.state\r\n\r\n    return (\r\n      <Fragment>\r\n        <div className='content'>\r\n          {this.renderItemHeader()}\r\n\r\n          {item.id && (\r\n            <div className='description-text'>\r\n              <strong>NOTA:</strong> El hallazgo debe describir la situación actual, causa, impacto y recomendación.\r\n            </div>\r\n          )}\r\n          <EditorPreview\r\n            className={'editor-preview-hallazgo'}\r\n            wrapperClassName={cx(!item.id || 'ui segment')}\r\n            data={value.hallazgo}\r\n            inline={item.id == null}\r\n            ckeditorOptions={{\r\n              attach_disableText:\r\n                'Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo.',\r\n              height: item.id ? 300 : 150\r\n            }}\r\n            ckeditorUploadOptions={{ model: `${this.props.moduleParams.model}__hallazgo`, modelId: item.id }}\r\n            footer='AttachmentList'\r\n            onSave={this.onEditorChange('hallazgo')}\r\n            previewStyle={{ overflowY: 'auto', maxHeight: 200, width: '100%' }}\r\n            label='<div class=\"description-text\"><strong>NOTA:</strong> El hallazgo debe describir la situación actual, causa, impacto y recomendación</div>'\r\n          />\r\n\r\n          <hr />\r\n\r\n          <div className='ui segment'>\r\n            <EditorPreview\r\n              data={value.plan_accion}\r\n              prefixPreview='Descripción Plan de Acción: '\r\n              labelTitle='Descripción Plan de Acción:'\r\n              ckeditorOptions={{\r\n                attach_disableText:\r\n                  'Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo.'\r\n              }}\r\n              ckeditorUploadOptions={{ model: `${this.props.moduleParams.model}__plan_accion`, modelId: item.id }}\r\n              footer='AttachmentList'\r\n              onSave={this.onEditorChange('plan_accion')}\r\n            />\r\n          </div>\r\n\r\n          <div className='ui three column grid'>\r\n            <div className='column'>\r\n              <label htmlFor='hallazgo_modal__responsable'>Responsable del Plan Acción: </label>\r\n              <HallazgoResponsableInput\r\n                value={value.responsable}\r\n                onChange={this.onValueChange('responsable')}\r\n                attrs={{ placeholder: 'Escriba el Nombre', style: { display: 'inline-block' } }}\r\n              />\r\n            </div>\r\n\r\n            <div className='column'>\r\n              <label htmlFor='hallazgo_modal__fecha_implementado'>Fecha Implementación: </label>\r\n              <DatePicker\r\n                id='hallazgo_modal__fecha_implementado'\r\n                dateFormat='yyyy-MM-dd'\r\n                locale='es'\r\n                fixedHeight\r\n                placeholderText='AAAA-mm-dd'\r\n                className='react-datepicker--input'\r\n                selected={this.getDate(value.fecha_implementado)}\r\n                onChange={this.onDateChange('fecha_implementado')}\r\n              />\r\n            </div>\r\n\r\n            <div className='column right aligned'>\r\n              <label htmlFor='hallazgo_modal__implementado'>Estado Implementación: </label>\r\n              <select\r\n                id='hallazgo_modal__implementado'\r\n                value={this.formatImplementadoChoice(value.implementado)}\r\n                onChange={this.onInputChange('implementado')}\r\n              >\r\n                <option value=''>Pendiente</option>\r\n                <option value='0'>En Proceso</option>\r\n                <option value='1'>Hecho</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className='actions'>\r\n          {this.renderActions()}\r\n          <div className='clearfix' />\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype HallazgoResponsableInputProps = {\r\n  value: string\r\n  onChange: (newValue: string) => void\r\n  attrs?: any\r\n}\r\n\r\nclass HallazgoResponsableInput extends PureComponent<HallazgoResponsableInputProps, { value: string }> {\r\n  users: { id: string; display: string }[]\r\n\r\n  mentionStyle = {\r\n    display: 'inline-block',\r\n    minWidth: '200px',\r\n    suggestions: {\r\n      list: {\r\n        backgroundColor: 'white',\r\n        border: '1px solid rgba(0,0,0,0.15)',\r\n        fontSize: 14\r\n      },\r\n      item: {\r\n        padding: '5px 15px',\r\n        borderBottom: '1px solid rgba(0,0,0,0.15)',\r\n        '&focused': {\r\n          backgroundColor: '#cee4e5'\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(props: HallazgoResponsableInputProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: props.value\r\n    }\r\n\r\n    this.users = _.map(app.vars.proyecto_equipo, (user: any) => {\r\n      return {\r\n        id: user.user_id,\r\n        display: user.name\r\n      }\r\n    })\r\n  }\r\n\r\n  onChange = (event: SyntheticEvent, newValue: string, newPlainTextValue: string, mentions: any) => {\r\n    this.setState({ value: newValue })\r\n    this.props.onChange(newValue)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <MentionsInput\r\n        singleLine\r\n        type='text'\r\n        value={this.state.value == null ? '' : this.state.value}\r\n        onChange={this.onChange}\r\n        allowSpaceInQuery\r\n        {...this.props.attrs}\r\n        className='mentions-input'\r\n        style={this.mentionStyle}\r\n      >\r\n        <Mention trigger='@' data={this.users} appendSpaceOnAdd />\r\n      </MentionsInput>\r\n    )\r\n  }\r\n}\r\n","export namespace MaterialidadEnums {\r\n  export const factores = [\r\n    'Ingresos brutos',\r\n    'Resultado del Ejercicio',\r\n    'Patrimonio',\r\n    'Activos Netos',\r\n    'Gastos',\r\n    'Otro'\r\n  ]\r\n\r\n  export const niveles = [ 'Alto', 'Moderado', 'Bajo' ]\r\n}\r\n\r\nexport namespace MaterialidadUtils {\r\n  declare var app: any\r\n  export function getNivel(nivel: number): 'min' | 'med' | 'max' {\r\n    switch ('' + nivel) {\r\n      case '1':\r\n        return 'max'\r\n      case '2':\r\n        return 'med'\r\n      case '3':\r\n        return 'min'\r\n    }\r\n  }\r\n\r\n  export function getDefaulPorcMG(factor: number, nivel: number) {\r\n    if (!factor || !nivel) {\r\n      return null\r\n    }\r\n\r\n    const field = `monto${factor}_${nivel}`\r\n\r\n    switch (field) {\r\n      case 'monto1_3':\r\n      case 'monto3_3':\r\n      case 'monto4_3':\r\n      case 'monto5_3':\r\n      case 'monto6_3':\r\n        return 0.5\r\n      case 'monto2_3':\r\n        return 3\r\n      case 'monto1_2':\r\n        return 0.75\r\n      case 'monto2_2':\r\n        return 5\r\n      case 'monto3_2':\r\n      case 'monto4_2':\r\n      case 'monto5_2':\r\n      case 'monto6_2':\r\n      case 'monto1_1':\r\n        return 1\r\n      case 'monto2_1':\r\n        return 7\r\n      case 'monto3_1':\r\n      case 'monto4_1':\r\n      case 'monto5_1':\r\n      case 'monto6_1':\r\n        return 2\r\n    }\r\n  }\r\n\r\n  export function calculateTotal(\r\n    field: 'porc_general' | 'porc' | 'porc_error',\r\n    materialidad: Partial<ProyectoMaterialidad>,\r\n    factor: number | false,\r\n    nivel: number | false\r\n  ): number {\r\n    if (factor === false) {\r\n      factor = materialidad.factor\r\n    }\r\n\r\n    if (nivel === false) {\r\n      nivel = materialidad.nivel\r\n    }\r\n\r\n    if (!factor || !nivel || typeof materialidad.montos[factor] === 'undefined') {\r\n      return 0\r\n    }\r\n\r\n    let nivel_field = MaterialidadUtils.getNivel(nivel as 1 | 2 | 3)\r\n\r\n    if (field == 'porc_general') {\r\n      let monto = materialidad.montos[factor].valor\r\n      let porc = materialidad.montos[factor][nivel_field]\r\n      if (porc == null) {\r\n        porc = MaterialidadUtils.getDefaulPorcMG(factor, nivel)\r\n      }\r\n      return +Math.abs(Math.round(monto * porc)) / 100\r\n    } else {\r\n      let monto = calculateTotal('porc_general', materialidad, factor, nivel)\r\n      let porc = materialidad[field]\r\n\r\n      return +Math.abs(Math.round(monto * porc)) / 100\r\n    }\r\n  }\r\n\r\n  type MaterialidadChangeServerParam = {\r\n    field: keyof ProyectoMaterialidad | string\r\n    value: any\r\n  }\r\n\r\n  export function sendToServer(\r\n    id_visita: string,\r\n    change: MaterialidadChangeServerParam,\r\n    materialidad: Partial<ProyectoMaterialidad>,\r\n    params: any,\r\n    cb?: (response: any) => void\r\n  ) {\r\n    materialidad = Object.assign({}, materialidad, { [change.field]: change.value })\r\n    const url = url_for(`proyecto/${app.vars.idproyecto}/materialidad/${id_visita}/update`)\r\n    let changes: MaterialidadChangeServerParam[] = [ change ]\r\n    if (change.field != 'factor_justificacion') {\r\n      changes.push({ field: 'total', value: calculateTotal('porc_general', materialidad, false, false) })\r\n      changes.push({ field: 'total_planeacion', value: calculateTotal('porc', materialidad, false, false) })\r\n      changes.push({ field: 'total_error', value: calculateTotal('porc_error', materialidad, false, false) })\r\n    }\r\n    $.post(url, _.merge(params, { changes })).done((res) => {\r\n      if ($.isFunction(cb)) {\r\n        cb(res)\r\n      }\r\n    })\r\n  }\r\n}\r\n","import { render } from 'react-dom'\r\nimport App from './App'\r\n\r\ndeclare var app: any\r\n\r\nrender(<App hoja_trabajo={app.vars.hoja_trabajo} />, document.getElementById('root'))\r\n","import { Component } from 'react'\r\n\r\nimport Tab from 'semantic-ui-react/dist/commonjs/modules/Tab'\r\nimport Menu from 'semantic-ui-react/dist/commonjs/collections/Menu'\r\n\r\nimport HojaTrabajoContext from '../proyecto__hoja_trabajo/HojaTrabajoContext'\r\nimport { AppVisitaDefaultTab } from '../proyecto__hoja_trabajo/AppVisitaTab'\r\nimport TabPaneVisita from './TabPaneVisita'\r\n\r\ndeclare var app: any\r\ndeclare type HojaTrabajoAppMaterialidadState = {\r\n  activeIndex: number\r\n  hoja_trabajo: HojaTrabajo\r\n}\r\n\r\ndeclare type HojaTrabajoAppMaterialidadPane = {\r\n  type: string\r\n  menuItem: () => JSX.Element\r\n  pane?: () => JSX.Element\r\n}\r\n\r\nexport default class App extends Component<HojaTrabajoAppProps, HojaTrabajoAppMaterialidadState> {\r\n  private panes: HojaTrabajoAppMaterialidadPane[] = []\r\n\r\n  constructor(props: HojaTrabajoAppProps) {\r\n    super(props)\r\n\r\n    const visita_current = _.find(this.props.hoja_trabajo.visitas, { is_current: true })\r\n    const activeIndex = visita_current ? visita_current.index : null\r\n\r\n    if (visita_current) {\r\n      app.vars.current_idvisita = visita_current.id_visita\r\n    }\r\n\r\n    this.state = {\r\n      activeIndex,\r\n      hoja_trabajo: this.props.hoja_trabajo\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    /**\r\n     * Ancho de la tab.\r\n     */\r\n    const totalWidth =\r\n      this.state.hoja_trabajo.proyecto.isOpen && user_has_role_permission('hoja_trabajo_edit') ? 90 : 98\r\n    const tabWidth: number = totalWidth / _.size(_.filter(this.panes, { type: 'sheet' }))\r\n\r\n    $('#visita-tabs').find('.menu>a.visita-tab').css({ width: tabWidth + '%' })\r\n\r\n    const activeIndex = location.hash.replace(/^#!visita-/, '')\r\n    if (activeIndex) {\r\n      this.setState({ activeIndex: +activeIndex })\r\n      const visita = _.find(this.state.hoja_trabajo.visitas, { activeIndex })\r\n      if (visita) {\r\n        app.vars.current_idvisita = visita.id_visita\r\n      }\r\n    }\r\n  }\r\n\r\n  handleClick = (e: React.SyntheticEvent, { index }: { index: number }) => {\r\n    this.setState({ activeIndex: index })\r\n    const visita = _.find(this.state.hoja_trabajo.visitas, { index })\r\n    app.vars.current_idvisita = visita.id_visita\r\n    window.location.hash = '#!visita-' + index\r\n  }\r\n\r\n  update = (data: any) => {\r\n    this.setState((state: HojaTrabajoAppState) => {\r\n      let hoja_trabajo = Object.assign({}, state.hoja_trabajo, data)\r\n\r\n      return { hoja_trabajo }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    this.panes = []\r\n\r\n    const { activeIndex } = this.state\r\n\r\n    let visitas: ProyectoPasoVisita[] = _.values(this.state.hoja_trabajo.visitas)\r\n    visitas = _.sortBy(visitas, 'position')\r\n\r\n    _.forEach(visitas, (visita) => {\r\n      if (!visita.id) {\r\n        return\r\n      }\r\n\r\n      visita.HojaTrabajo = this.state.hoja_trabajo\r\n      this.panes.push({\r\n        type: 'sheet',\r\n        menuItem: () => {\r\n          return (\r\n            <Menu.Item\r\n              key={visita.id}\r\n              index={visita.index}\r\n              className='tab-nav-item visita-tab'\r\n              name={visita.label}\r\n              onClick={this.handleClick}\r\n              active={activeIndex == visita.index}\r\n            >\r\n              <AppVisitaDefaultTab visita={visita} />\r\n            </Menu.Item>\r\n          )\r\n        },\r\n        pane: () => {\r\n          return (\r\n            <TabPaneVisita\r\n              key={visita.id}\r\n              active={activeIndex == visita.index}\r\n              visita={visita}\r\n              isEditable={this.state.hoja_trabajo.proyecto.isOpen && user_has_role_permission('hoja_trabajo_edit')}\r\n            />\r\n          )\r\n        }\r\n      })\r\n    })\r\n\r\n    if (this.panes.length == 0) {\r\n      return (\r\n        <div className='alert alert-block nocontent'>\r\n          <h3>Sin visitas</h3>\r\n          <p>\r\n            <span className='icon-warning-sign' />Este proyecto no tiene visitas creadas.\r\n          </p>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <HojaTrabajoContext.Provider value={{ hoja_trabajo: this.state.hoja_trabajo, update: this.update }}>\r\n        <div id='visita-tabs' className={`paso-code-${this.state.hoja_trabajo.paso.code}  paso-default`}>\r\n          <Tab panes={this.panes} activeIndex={activeIndex} renderActiveOnly={false} />\r\n        </div>\r\n      </HojaTrabajoContext.Provider>\r\n    )\r\n  }\r\n}\r\n","module.exports = ReactDOM;","import Button from 'semantic-ui-react/dist/commonjs/elements/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport cx from 'classnames'\r\n\r\nconst ButtonEdit = (props: any) => {\r\n  let { children, ...buttonProps } = props\r\n  buttonProps.className = cx(buttonProps.className, 'action')\r\n  buttonProps = { icon: true, basic: true, compact: true, size: 'mini', title: 'Editar', ...buttonProps }\r\n\r\n  if (typeof children == 'undefined') {\r\n    children = <Icon name='pencil square' color='green' size='large' />\r\n  }\r\n\r\n  return (\r\n    <Button {...buttonProps} type='button'>\r\n      {children}\r\n    </Button>\r\n  )\r\n}\r\n\r\nexport default ButtonEdit\r\n","import { Component } from 'react'\r\n\r\nimport Tab from 'semantic-ui-react/dist/commonjs/modules/Tab/Tab'\r\n\r\nimport MenuSidebarVisita from '../proyecto__hoja_trabajo/MenuSidebarVisita'\r\nimport { PasoObjetivoPane, PasoVisitaStatusActions } from '../proyecto__hoja_trabajo/AppVisitaTab'\r\nimport MaterialidadForm from './MaterialidadForm'\r\n\r\nimport MaterialidadPercentTable from './MaterialidadPercentTable'\r\n\r\ntype TabPaneVisitaProps = {\r\n  visita: ProyectoPasoVisita\r\n  active: boolean\r\n  isEditable: boolean\r\n}\r\n\r\nexport default class TabPaneVisita extends Component<TabPaneVisitaProps> {\r\n  getCompletadoDisabledText() {\r\n    let materialidad = this.props.visita.materialidad\r\n    if (!materialidad.factor) {\r\n      return 'El factor para el cálculo de la Materialidad General aún no ha sido seleccionado.'\r\n    }\r\n\r\n    if (!materialidad.nivel) {\r\n      return 'El nivel de confianza aún no ha sido seleccionado.'\r\n    }\r\n\r\n    if (\r\n      typeof materialidad.montos[materialidad.factor] === 'undefined' ||\r\n      !materialidad.montos[materialidad.factor].valor\r\n    ) {\r\n      return 'El monto del factor seleccionado aun no ha sido ingresado.'\r\n    }\r\n\r\n    const niveles_field: { 1: 'max'; 2: 'med'; 3: 'min' } = { 1: 'max', 2: 'med', 3: 'min' }\r\n    if (!materialidad.montos[materialidad.factor][niveles_field[materialidad.nivel]]) {\r\n      return 'El porcentaje de Materialidad General aun no ha sido ingresado.'\r\n    }\r\n\r\n    if (!materialidad.porc) {\r\n      return 'El porcentaje de Materialidad de Planeación aun no ha sido ingresado.'\r\n    }\r\n\r\n    if (!materialidad.porc_error) {\r\n      return 'El porcentaje de Error Tolerable aun no ha sido ingresado.'\r\n    }\r\n\r\n    if (!materialidad.factor_justificacion) {\r\n      return 'La razón de la selección del Factor y Nivel de Confianza aun no ha sido ingresada.'\r\n    }\r\n\r\n    if (this.props.visita.additionals.revisiones > 0) {\r\n      return 'Esta visita tiene Notas de Revisión pendientes por revisar que deben primero ser revisadas para poder marcar esta hoja de trabajo como COMPLETADA.'\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let materialidad = this.props.visita.materialidad\r\n    materialidad.Visita = this.props.visita\r\n\r\n    return (\r\n      <Tab.Pane active={this.props.active}>\r\n        <MenuSidebarVisita visita={this.props.visita} actionItems={{ _ajustes: false, _muestreo: false }} />\r\n        <div id='materialidadformwrapper'>\r\n          <PasoObjetivoPane isEditable={this.props.isEditable} />\r\n\r\n          <MaterialidadForm materialidad={materialidad} isEditable={this.props.isEditable} />\r\n\r\n          <div className='footer-actions'>\r\n            <MaterialidadPercentTable materialidad={materialidad} isEditable={this.props.isEditable} />\r\n\r\n            <PasoVisitaStatusActions\r\n              visita={this.props.visita}\r\n              completadoDisabledText={this.getCompletadoDisabledText()}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Tab.Pane>\r\n    )\r\n  }\r\n}\r\n","import { Component, Fragment } from 'react'\r\n\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label/Label'\r\nimport Menu from 'semantic-ui-react/dist/commonjs/collections/Menu/Menu'\r\nimport Image from 'semantic-ui-react/dist/commonjs/elements/Image/Image'\r\nimport { MenuItemProps } from 'semantic-ui-react/dist/commonjs/collections/Menu/MenuItem'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\n\r\nimport { HojaTrabajoHistoryModal, HojaTrabajoAsignarVisitaModal } from './TabPaneVisitaModals'\r\nimport HojaTrabajoContext from './HojaTrabajoContext'\r\nimport { HojaTrabajoUpdateUtils } from './utils'\r\nimport { MenuItemAjuste } from './sidebar/menuitem_ajuste'\r\nimport { MenuItemHallazgo } from './sidebar/menuitem_hallazgo'\r\nimport { MenuItemRevision } from './sidebar/menuitem_revision'\r\n\r\nimport { HallazgoHojaTrabajoModelManager, RevisionHojaTrabajoModelManager } from './sidebar/menuitem__model_manager'\r\n\r\nimport cx from 'classnames'\r\n\r\ntype MenuSidebarVisitaProps = {\r\n  visita: ProyectoPasoVisita\r\n  actionItems?: { [s: string]: boolean | MenuItemProps }\r\n}\r\n\r\ntype MenuSidebarVisitaState = {\r\n  panelOpen: string\r\n  openAsignarUsuarioModal: boolean\r\n}\r\n\r\nexport default class MenuSidebarVisita extends Component<MenuSidebarVisitaProps, MenuSidebarVisitaState> {\r\n  static contextType = HojaTrabajoContext\r\n  static defaultProps = {\r\n    actionItems: {}\r\n  }\r\n\r\n  context: HojaTrabajoContextType\r\n\r\n  state: MenuSidebarVisitaState = {\r\n    panelOpen: null,\r\n    openAsignarUsuarioModal: false\r\n  }\r\n\r\n  isActionItemEnabled(action: string) {\r\n    return typeof this.props.actionItems[`_${action}`] === 'undefined' || this.props.actionItems[`_${action}`]\r\n  }\r\n\r\n  onItemOpen = (item: string) => {\r\n    this.setState({ panelOpen: item })\r\n  }\r\n\r\n  closeAllPanel = () => {\r\n    this.setState({ panelOpen: null })\r\n  }\r\n\r\n  renderAsignUserModal() {\r\n    if (this.state.openAsignarUsuarioModal) {\r\n      const { hoja_trabajo, update } = this.context\r\n      const onSaveAsignarVisita = (id_asignado: string) => {\r\n        const url = url_for(\r\n          `proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita/${this.props.visita\r\n            .id_visita}/save`\r\n        )\r\n        $.blockUI(create_blockUI_loading_message('Guardando asignado...'))\r\n\r\n        $.ajax(url, { type: 'POST', data: { op: 'a', paso_id_usuario: id_asignado }, dataType: 'json' }).done((res) => {\r\n          let hoja_trabajo_copy = HojaTrabajoUpdateUtils.updateVisita(\r\n            hoja_trabajo,\r\n            this.props.visita,\r\n            res.response.record\r\n          )\r\n          update(hoja_trabajo_copy)\r\n          $.unblockUI()\r\n        })\r\n\r\n        this.setState({ openAsignarUsuarioModal: false })\r\n      }\r\n\r\n      return (\r\n        <HojaTrabajoAsignarVisitaModal\r\n          visita={this.props.visita}\r\n          onSave={onSaveAsignarVisita}\r\n          onClose={() => this.setState({ openAsignarUsuarioModal: false })}\r\n        />\r\n      )\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const id_proyecto = this.props.visita.HojaTrabajo.proyecto.id\r\n    const id_paso = this.props.visita.HojaTrabajo.paso.id\r\n    const id_visita = this.props.visita.id_visita\r\n    const has_parent = this.props.visita.HojaTrabajo.proyecto.id_parent != null\r\n\r\n    const url_base = `proyecto/${id_proyecto}/paso/${id_paso}/visita/${id_visita}/`\r\n\r\n    const counters = this.props.visita.additionals\r\n\r\n    const image_path = public_path('images/sidebar_right/')\r\n\r\n    return (\r\n      <Fragment>\r\n        <div\r\n          className={cx('sidebar-fixed-overlay ui page dimmer inverted', { active: this.state.panelOpen != null })}\r\n          onClick={() => this.closeAllPanel()}\r\n        />\r\n        <Menu fixed='right' vertical compact icon className='visita-sidebar right-sidebar' id='app-right-sidebar'>\r\n          <Menu.Menu>\r\n            {_.map(this.props.actionItems, (actionItem: MenuItemProps, key: string) => {\r\n              if (key.substr(0, 1) == '_' || actionItem === null) {\r\n                return null\r\n              }\r\n\r\n              const _onClick = actionItem.onClick\r\n              actionItem.onClick = (ev: any, data: any) => {\r\n                this.closeAllPanel()\r\n                _onClick(ev, data)\r\n              }\r\n              return <Menu.Item key={key} {...actionItem} />\r\n            })}\r\n\r\n            {this.props.visita.HojaTrabajo.proyecto.isOpen &&\r\n            user_has_role_permission('paso_asignar_usuario') &&\r\n            this.isActionItemEnabled('assign_user') && (\r\n              <Menu.Item\r\n                link\r\n                title='Asignar usuario a esta visita'\r\n                onClick={(ev) => {\r\n                  this.closeAllPanel()\r\n                  this.setState({ openAsignarUsuarioModal: true })\r\n                }}\r\n              >\r\n                <Icon.Group size='large'>\r\n                  <Icon name='user outline' />\r\n                  <Icon corner name='plus' />\r\n                </Icon.Group>\r\n              </Menu.Item>\r\n            )}\r\n            {this.renderAsignUserModal()}\r\n\r\n            {has_parent &&\r\n            this.isActionItemEnabled('history') && (\r\n              <HojaTrabajoHistoryModal\r\n                trigger={\r\n                  <Menu.Item\r\n                    title='Hoja Trabajo Año Anterior '\r\n                    icon={{ name: 'history', size: 'large' }}\r\n                    onClick={this.closeAllPanel}\r\n                  />\r\n                }\r\n                url={url_for(url_base + 'prev')}\r\n              />\r\n            )}\r\n          </Menu.Menu>\r\n\r\n          <Menu.Menu>\r\n            {this.isActionItemEnabled('ajustes') && (\r\n              <MenuItemAjuste\r\n                counter={counters.ajustes}\r\n                moduleParams={{ id_paso, id_visita, model: 'ajuste' }}\r\n                open={this.state.panelOpen == 'ajuste'}\r\n                onOpen={this.onItemOpen}\r\n                modelManager={null}\r\n              />\r\n            )}\r\n            {this.isActionItemEnabled('hallazgo') && (\r\n              <MenuItemHallazgo\r\n                modelManager={HallazgoHojaTrabajoModelManager.getInstance()}\r\n                counter={counters.hallazgos}\r\n                moduleParams={{ id_paso, id_visita, model: 'hallazgo' }}\r\n                open={this.state.panelOpen == 'hallazgo'}\r\n                onOpen={this.onItemOpen}\r\n              />\r\n            )}\r\n            {this.isActionItemEnabled('muestreo') && (\r\n              <Menu.Item\r\n                as='a'\r\n                className='badged'\r\n                href={url_for(url_base + 'muestreo')}\r\n                title='Muestreo'\r\n                onClick={this.closeAllPanel}\r\n              >\r\n                <Image src={image_path + 'muestreo.svg'} size='large' /> {' '}\r\n                <Label\r\n                  size='mini'\r\n                  className='right'\r\n                  floating\r\n                  circular\r\n                  content={counters.muestreos}\r\n                  color={counters.muestreos == 0 ? 'green' : 'red'}\r\n                />\r\n              </Menu.Item>\r\n            )}\r\n            {this.isActionItemEnabled('revision') && (\r\n              <MenuItemRevision\r\n                counter={counters.revisiones}\r\n                moduleParams={{ id_paso, id_visita, model: 'revision' }}\r\n                modelManager={RevisionHojaTrabajoModelManager.getInstance(this.context)}\r\n                open={this.state.panelOpen == 'revision'}\r\n                onOpen={this.onItemOpen}\r\n              />\r\n            )}\r\n          </Menu.Menu>\r\n          {this.isActionItemEnabled('pdf') && (\r\n            <Menu.Menu>\r\n              <Menu.Item\r\n                as='a'\r\n                href={url_for(url_base + 'pdf.pdf')}\r\n                target='_blank'\r\n                title='Exportar como PDF'\r\n                content={<Image src={image_path + 'exportar_pdf.svg'} size='large' />}\r\n              />\r\n            </Menu.Menu>\r\n          )}\r\n        </Menu>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","import { Component } from 'react'\r\nimport CKeditor from 'ckeditor4-react'\r\n\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal'\r\nimport Dropdown from 'semantic-ui-react/dist/commonjs/modules/Dropdown'\r\n\r\nexport class HojaTrabajoHistoryModal extends Component<{ trigger: any; url: string }> {\r\n  state = {\r\n    content: ''\r\n  }\r\n\r\n  onOpen = () => {\r\n    if (this.state.content == '') {\r\n      const ckeditorOptions = {\r\n        height: 350,\r\n        removePlugins: 'elementspath, uploadfile',\r\n        toolbar: [ {} ]\r\n      }\r\n\r\n      this.setState({ content: <Loader active /> })\r\n      $.ajax(this.props.url, { dataType: 'json' }).done((res) => {\r\n        if (res.hasErrors) {\r\n          this.setState({\r\n            content: (\r\n              <div style={{ color: 'red', textAlign: 'center', fontSize: '18px', fontWeight: 'bold', marginTop: 25 }}>\r\n                Hoja de Trabajo NO disponible\r\n              </div>\r\n            )\r\n          })\r\n        } else {\r\n          let content = `&nbsp;<div class='watermark-text' style='color:#08828a33; font-size:70px; font-weight: bold; transform:rotate(340deg); -webkit-transform:rotate(340deg); left: 35%; position: absolute; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;  '>Hoja Trabajo<br>Año Anterior</div>\r\n          <div class='watermarked-content' style='position:absolute; z-index:1;  margin-right: 20px; '>${res.response\r\n            .content}</div>&nbsp;`\r\n          this.setState({ content: <CKeditor data={content} readOnly config={ckeditorOptions} /> })\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        closeIcon\r\n        trigger={this.props.trigger}\r\n        content={this.state.content}\r\n        header='Hoja de Trabajo - Año Anterior'\r\n        closeOnDimmerClick={false}\r\n        onOpen={this.onOpen}\r\n        size='fullscreen'\r\n        dimmer='inverted'\r\n        style={{ minHeight: 400 }}\r\n        className='modal-ab'\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\ninterface HojaTrabajoAsignarVisitaModalProps {\r\n  visita: ProyectoPasoVisita\r\n  onSave: (id_usuario_asignado: string) => void\r\n  onClose: () => void\r\n}\r\n\r\nexport class HojaTrabajoAsignarVisitaModal extends Component<\r\n  HojaTrabajoAsignarVisitaModalProps,\r\n  { id_asignado: string }\r\n> {\r\n  constructor(props: HojaTrabajoAsignarVisitaModalProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      id_asignado: props.visita.id_usuario_asignado\r\n    }\r\n  }\r\n\r\n  onChange = (ev: React.SyntheticEvent, data: any) => {\r\n    this.setState({ id_asignado: data.value })\r\n  }\r\n\r\n  onSave = () => {\r\n    this.props.onSave(this.state.id_asignado)\r\n    this.props.onClose()\r\n  }\r\n\r\n  onClose = () => {\r\n    this.props.onClose()\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n\r\n    let equipo = _.filter(visita.HojaTrabajo.equipo, function(item) {\r\n      return item.rol.is_assignable\r\n    })\r\n\r\n    const equipoOptions: any = _.map(equipo, function(item) {\r\n      return {\r\n        key: item.user_id,\r\n        text: item.name,\r\n        value: item.user_id,\r\n        description: item.rol.name,\r\n        label: { content: item.sigla, circular: true, color: 'green' }\r\n      }\r\n    })\r\n\r\n    return (\r\n      <Modal\r\n        closeIcon\r\n        open\r\n        closeOnDimmerClick={false}\r\n        size='tiny'\r\n        dimmer='inverted'\r\n        className='modal-ab'\r\n        onClose={this.onClose}\r\n      >\r\n        <Modal.Header>Asignar/Reasignar visita a usuario</Modal.Header>\r\n        <Modal.Content>\r\n          <blockquote>\r\n            <strong>Visita: </strong> {visita.label}\r\n          </blockquote>\r\n          <Dropdown\r\n            placeholder='Seleccione el usuario'\r\n            defaultValue={visita.id_usuario_asignado}\r\n            selection\r\n            clearable\r\n            fluid\r\n            options={equipoOptions}\r\n            onChange={this.onChange}\r\n          />\r\n        </Modal.Content>\r\n        <Modal.Actions>\r\n          <Button primary content='Aceptar' onClick={this.onSave} />\r\n        </Modal.Actions>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent } from 'react'\r\n\r\nimport { BaseMenuElement } from './menuitem'\r\nimport { MenuItemNew } from './menuitem__new'\r\nimport { AjusteModal } from './ajuste_modal'\r\nimport { AjusteList } from './ajuste_list'\r\nimport MenuItemAjusteContext from './menuitem_ajuste_context'\r\nimport { getNombreCuenta } from '../utils_ajuste'\r\n\r\ntype MenuItemAjusteState = {\r\n  items: ProyectoAjusteGroup[]\r\n}\r\n\r\ndeclare var app: any\r\n\r\nexport class MenuItemAjuste extends PureComponent<DefaultMenuElementProps<ProyectoAjusteGroup>, MenuItemAjusteState> {\r\n  cuentas: ProyectoAjusteCuenta[] = null\r\n\r\n  state: MenuItemAjusteState = {\r\n    items: null\r\n  }\r\n\r\n  parseAjustes = (input: any[]): ProyectoAjusteGroup[] => {\r\n    const self = this\r\n    let ajustes = _.groupBy(input, 'idx')\r\n\r\n    return _.map(ajustes, function(_row, idx) {\r\n      const row = _.map(_row, function(item) {\r\n        return {\r\n          id: item.id,\r\n          cuenta: item.cuenta,\r\n          debe: item.col == 'DEBE' ? item.valor : '',\r\n          haber: item.col == 'HABER' ? item.valor : '',\r\n          nombre_cuenta: self.getNombreCuenta(item.cuenta)\r\n        }\r\n      })\r\n\r\n      return Object.assign(\r\n        {},\r\n        {\r\n          idx,\r\n          items: row,\r\n          status: _row[0].status,\r\n          descripcion: _row[0].description,\r\n          id_visita: _row[0].id_proyecto_visita\r\n        },\r\n        _.pick(_row[0], [ 'fecha_completado', 'aplicado', 'fecha_revision', 'UpdateLog', 'RevisionLog' ])\r\n      )\r\n    })\r\n  }\r\n\r\n  getNombreCuenta(cuenta: string) {\r\n    return getNombreCuenta(this.cuentas, cuenta)\r\n  }\r\n\r\n  onCreateItem = (data: any) => {\r\n    return new Promise<null>((resolve) => {\r\n      $.blockUI(create_blockUI_loading_message('Creando ajuste'))\r\n      const { id_visita, id_paso } = this.props.moduleParams\r\n      $.post(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste`), {\r\n        changes: data,\r\n        id_paso,\r\n        v: 2\r\n      }).done((res) => {\r\n        this.setState((prevState) => {\r\n          const items = [ ...prevState.items ]\r\n          items.push(this.parseAjustes(res.response.ajustes)[0])\r\n\r\n          return { items }\r\n        })\r\n\r\n        $.unblockUI()\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  onMountPanel = () => {\r\n    if (this.state.items === null) {\r\n      const { id_visita } = this.props.moduleParams\r\n      $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste`)).done((res) => {\r\n        this.cuentas = _.isEmpty(res.response.cuentas) ? [] : res.response.cuentas\r\n        app.vars.error_tolerable[id_visita] = res.response.error_tolerable\r\n\r\n        this.setState({\r\n          items: _.isEmpty(res.response.ajustes) ? [] : this.parseAjustes(res.response.ajustes)\r\n        })\r\n      })\r\n    }\r\n  }\r\n\r\n  onSaveItem = (item: ProyectoAjusteGroup, changes: any, blockingText?: string) => {\r\n    return new Promise<ProyectoAjusteGroup>((resolve) => {\r\n      const { id_visita, id_paso } = this.props.moduleParams\r\n      if (blockingText) {\r\n        setTimeout(() => $.blockUI(create_blockUI_loading_message(blockingText)), 1000 * 0.1)\r\n      }\r\n\r\n      $.post(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste`), {\r\n        idx: item.idx,\r\n        changes,\r\n        id_paso,\r\n        v: 2\r\n      }).done((res) => {\r\n        const ajustes = this.parseAjustes(res.response.ajustes)\r\n        this.setState((prevState) => {\r\n          const items = _.map(prevState.items, (item) => {\r\n            if (item.idx == ajustes[0].idx) {\r\n              return ajustes[0]\r\n            } else {\r\n              return item\r\n            }\r\n          })\r\n          return { items }\r\n        })\r\n\r\n        if (blockingText) {\r\n          $.unblockUI()\r\n        }\r\n\r\n        resolve(ajustes[0])\r\n      })\r\n    })\r\n  }\r\n\r\n  onClickDeleteItem = (item: ProyectoAjusteGroup) => {\r\n    bootbox.warningConfirm(\r\n      `¿Desea eliminar el <strong>Ajuste #${item.idx}</strong>,\r\n      el cual contiene un total de ${_.size(item.items)} registros contables?`,\r\n      'No',\r\n      'Sí, Eliminar',\r\n      (r) => {\r\n        if (!r) {\r\n          return\r\n        }\r\n\r\n        const { id_visita } = this.props.moduleParams\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando ajustes'))\r\n        $.ajax(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste/${item.idx}`), {\r\n          type: 'delete'\r\n        }).done((res) => {\r\n          this.setState((prevState) => {\r\n            const items = _.reject(prevState.items, { idx: item.idx })\r\n\r\n            return { items }\r\n          })\r\n\r\n          $.unblockUI()\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  renderContent() {\r\n    const itemNew: ProyectoAjusteGroup = {\r\n      idx: null,\r\n      status: 'NUEVO',\r\n      descripcion: '',\r\n      id_visita: this.props.moduleParams.id_visita,\r\n      items: _.fill(new Array(2), { cuenta: '', debe: null, haber: null, nombre_cuenta: '' }, 0, 2)\r\n    }\r\n\r\n    return (\r\n      <div className='content'>\r\n        {_.size(this.cuentas) > 0 && (\r\n          <MenuItemNew\r\n            moduleParams={this.props.moduleParams}\r\n            buttonText='Crear Ajuste'\r\n            headerText='Nuevo Ajuste'\r\n            isEditable={user_has_role_permission('ajustes_edit')}\r\n            onSave={this.onCreateItem}\r\n            item={itemNew}\r\n            contentAs={AjusteModal}\r\n          />\r\n        )}\r\n        {_.isArray(this.cuentas) && _.size(this.cuentas) == 0 ? (\r\n          <div className='ui message error' style={{ marginTop: 40 }}>\r\n            <i className='icon warning sign' />\r\n            <strong>Advertencia: </strong> Al parecer aún no se han cargado sumarias a esta visita.\r\n          </div>\r\n        ) : (\r\n          <AjusteList\r\n            items={this.state.items}\r\n            moduleParams={this.props.moduleParams}\r\n            isEditable={es_proyecto_editable() && user_has_role_permission('ajustes_edit')}\r\n            onSaveItem={this.onSaveItem}\r\n            onClickDeleteItem={this.onClickDeleteItem}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BaseMenuElement\r\n        name='ajuste'\r\n        counter={this.state.items === null ? this.props.counter : _.size(this.state.items)}\r\n        icon='ajustes'\r\n        title='Ajustes'\r\n        open={this.props.open}\r\n        onToggle={this.props.onOpen}\r\n        onMountPanel={this.onMountPanel}\r\n      >\r\n        <MenuItemAjusteContext.Provider value={this.cuentas}>{this.renderContent()}</MenuItemAjusteContext.Provider>\r\n      </BaseMenuElement>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent } from 'react'\r\nimport { invoke } from 'lodash'\r\n\r\ntype SidebarPanelHeaderProps = {\r\n  title: string\r\n  onClose: (ev: SyntheticEvent) => void\r\n  onMount?: () => void\r\n}\r\n\r\nexport class SidebarPanelHeader extends PureComponent<SidebarPanelHeaderProps> {\r\n  componentDidMount() {\r\n    invoke(this.props, 'onMount')\r\n  }\r\n  render() {\r\n    return (\r\n      <header>\r\n        <a href='#' className='close-link' onClick={this.props.onClose}>\r\n          <i className='ui icon close green' />\r\n        </a>\r\n        <div className='title'>{this.props.title}</div>\r\n      </header>\r\n    )\r\n  }\r\n}\r\n","import { Component } from 'react'\r\n\r\ntype DefaultErrorHandlerProps = {\r\n  errorMessage?: string | JSX.Element\r\n}\r\n\r\nexport class DefaultErrorHandler extends Component<DefaultErrorHandlerProps> {\r\n  state = {\r\n    hasError: false\r\n  }\r\n\r\n  static defaultProps: Partial<DefaultErrorHandlerProps> = {\r\n    errorMessage: null\r\n  }\r\n\r\n  static getDerivedStateFromError(error: any) {\r\n    return { hasError: true }\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    if (this.isLocalhost()) {\r\n      alert('ERROR: ' + error.message)\r\n    }\r\n  }\r\n\r\n  isLocalhost() {\r\n    return window.location.host === 'auditbrain.local'\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return this.props.errorMessage\r\n    }\r\n\r\n    return this.props.children\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent, Fragment } from 'react'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport { MenuElementListPanel, MenuElementListActions } from './menuitem'\r\nimport { AjusteModal } from './ajuste_modal'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\nimport { StatusDivBlock } from '../../global/StatusButtonAction'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport { truncateText } from '../utils_truncate'\r\n\r\nexport class AjusteList extends PureComponent<DefaultMenuItemListProps<ProyectoAjusteGroup>> {\r\n  render() {\r\n    if (this.props.items === null) {\r\n      return (\r\n        <div style={{ height: 300, position: 'relative' }}>\r\n          <div className='ui active inverted text loader elastic olive'>Cargando Listado de Ajustes</div>\r\n        </div>\r\n      )\r\n    } else if (_.size(this.props.items) == 0) {\r\n      return <div className='empty nocontent'>0 Ajustes</div>\r\n    } else {\r\n      const { items } = this.props\r\n      return (\r\n        <MenuElementListPanel className='ajustes-list'>\r\n          {_.map(items, (item: ProyectoAjusteGroup) => {\r\n            return (\r\n              <div key={item.idx} className='listitem ajuste-listitem'>\r\n                <AjusteListItem\r\n                  item={item}\r\n                  isEditable={this.props.isEditable}\r\n                  onSave={this.props.onSaveItem}\r\n                  onClickDelete={this.props.onClickDeleteItem}\r\n                />\r\n              </div>\r\n            )\r\n          })}\r\n        </MenuElementListPanel>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\ntype AjusteListItemProps = {\r\n  item: ProyectoAjusteGroup\r\n  onSave: (item: ProyectoAjusteGroup, changes: any, blockingText?: string) => void\r\n  onClickDelete: (item: ProyectoAjusteGroup) => void\r\n  isEditable: boolean\r\n}\r\n\r\nclass AjusteListItem extends PureComponent<AjusteListItemProps, { isModalEdit: boolean }> {\r\n  state = {\r\n    isModalEdit: false\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onClickDelete(this.props.item)\r\n  }\r\n\r\n  onClickEdit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isModalEdit: true })\r\n  }\r\n\r\n  onCloseEdit = () => {\r\n    this.setState({ isModalEdit: false })\r\n  }\r\n\r\n  onSave = (item: ProyectoAjusteGroup, changes: any, blockingText?: string) => {\r\n    this.props.onSave(item, changes, blockingText)\r\n  }\r\n  render() {\r\n    const { item } = this.props\r\n    return (\r\n      <div>\r\n        {this.props.isEditable && (\r\n          <MenuElementListActions\r\n            actions={{\r\n              edit: { label: 'Editar', callback: this.onClickEdit, permission: 'ajustes_edit' },\r\n              delete: { label: 'Eliminar', callback: this.onClickDelete, permission: 'ajustes_delete' }\r\n            }}\r\n          />\r\n        )}\r\n        <div onClick={this.onClickEdit}>\r\n          <div className='row r1'>\r\n            <div className='pull-left r1_1'>\r\n              <span className='title-h1'> Ajuste #{item.idx}</span>\r\n              <AuthorIconLogDefaultWrapper model={item} size='small' />\r\n              <div className='r1_2'>\r\n                <strong>Ajuste Registrado: </strong> {'' + item.aplicado == '1' ? 'Sí' : 'No'}\r\n              </div>\r\n            </div>\r\n            <StatusDivBlock\r\n              wrapperClassName='pull-right text-mini'\r\n              status={item.status || 'EN PROCESO'}\r\n              className='mini'\r\n              hideLabel\r\n            />\r\n          </div>\r\n          <table className='ui compact very basic celled striped small table table-ajustes'>\r\n            <thead>\r\n              <tr>\r\n                <th>Cuenta</th>\r\n                <th>Debe</th>\r\n                <th>Haber</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {_.map(item.items, (subitem) => {\r\n                return (\r\n                  <Fragment key={subitem.id}>\r\n                    {!isEmpty(subitem.debe) && (\r\n                      <tr>\r\n                        <td>\r\n                          <Popup\r\n                            trigger={<span>{subitem.cuenta}</span>}\r\n                            content={subitem.nombre_cuenta}\r\n                            header={subitem.cuenta}\r\n                            size='mini'\r\n                          />\r\n                        </td>\r\n                        <td className='right aligned'>{accounting.formatNumber(subitem.debe)}</td>\r\n                        <td>&nbsp;</td>\r\n                      </tr>\r\n                    )}\r\n                    {!isEmpty(subitem.haber) && (\r\n                      <tr>\r\n                        <td>\r\n                          <Popup\r\n                            trigger={<span>{subitem.cuenta}</span>}\r\n                            content={subitem.nombre_cuenta}\r\n                            header={subitem.cuenta}\r\n                            size='mini'\r\n                          />\r\n                        </td>\r\n                        <td>&nbsp;</td>\r\n                        <td className='right aligned'>{accounting.formatNumber(subitem.haber)}</td>\r\n                      </tr>\r\n                    )}\r\n                  </Fragment>\r\n                )\r\n              })}\r\n            </tbody>\r\n          </table>\r\n          {item.descripcion && (\r\n            <div className='item-description'>\r\n              <div className='editor-preview' dangerouslySetInnerHTML={{ __html: truncateText(item.descripcion) }} />\r\n            </div>\r\n          )}\r\n        </div>\r\n        {this.state.isModalEdit && (\r\n          <AjusteModalEdit\r\n            item={item}\r\n            onSave={this.onSave}\r\n            onClickDelete={this.onClickDelete}\r\n            onClose={this.onCloseEdit}\r\n            isEditable={this.props.isEditable}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype AjusteModalEditProps = {\r\n  item: ProyectoAjusteGroup\r\n  onSave: (item: ProyectoAjusteGroup, data: ProyectoAjusteGroup, blockingText?: string) => void\r\n  onClickDelete: (ev: SyntheticEvent) => void\r\n  onClose: () => void\r\n  isEditable: boolean\r\n}\r\n\r\nclass AjusteModalEdit extends PureComponent<AjusteModalEditProps> {\r\n  onSave = (data: any, blockingText?: string) => {\r\n    this.props.onSave(this.props.item, data, blockingText)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        open\r\n        dimmer='inverted'\r\n        className='modal-ab modal-sidebarmenuitem'\r\n        size='large'\r\n        closeIcon\r\n        onClose={this.props.onClose}\r\n        closeOnEscape={false}\r\n        closeOnDimmerClick={false}\r\n      >\r\n        <Modal.Header>Editar Ajuste</Modal.Header>\r\n\r\n        <AjusteModal\r\n          moduleParams={{ id_visita: this.props.item.id_visita, model: 'ajuste' }}\r\n          item={this.props.item}\r\n          isEditable={this.props.isEditable}\r\n          onSave={this.onSave}\r\n          onClickDelete={this.props.onClickDelete}\r\n        />\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n\r\nconst isEmpty = (value: any) => {\r\n  if (_.isNumber(value)) {\r\n    return false\r\n  }\r\n\r\n  return _.size(value) == 0\r\n}\r\n","import React, { PureComponent } from 'react'\r\n\r\nimport { BaseMenuElement } from './menuitem'\r\nimport { MenuItemNew } from './menuitem__new'\r\nimport { HallazgoList } from './hallazgo_list'\r\nimport { HallazgoUtils } from '../utils_hallazgo'\r\nimport { HallazgoModal } from './hallazgo_modal'\r\n\r\ntype MenuItemHallazgoState = {\r\n  items: ProyectoHallazgo[]\r\n}\r\n\r\nexport class MenuItemHallazgo extends PureComponent<DefaultMenuElementProps<ProyectoHallazgo>, MenuItemHallazgoState> {\r\n  state: MenuItemHallazgoState = {\r\n    items: null\r\n  }\r\n\r\n  addItem(data: any) {\r\n    this.setState((prevState) => {\r\n      const copy = [ ...prevState.items, data ]\r\n\r\n      return { items: copy }\r\n    })\r\n  }\r\n\r\n  updateItem(item: ProyectoHallazgo, data: any) {\r\n    this.setState((prevState) => {\r\n      const copy = _.map(prevState.items, (_item) => {\r\n        if (_item.id == item.id) {\r\n          return Object.assign({}, _item, data)\r\n        } else {\r\n          return _item\r\n        }\r\n      })\r\n\r\n      return { items: copy }\r\n    })\r\n  }\r\n\r\n  deleteItem(item: ProyectoHallazgo) {\r\n    this.setState((prevState) => {\r\n      const copy = _.reject(prevState.items, { id: item.id })\r\n\r\n      return { items: copy }\r\n    })\r\n  }\r\n\r\n  onMountPanel = () => {\r\n    if (this.state.items === null) {\r\n      this.props.modelManager.getJson(this.props).then((items) => {\r\n        this.setState({ items })\r\n      })\r\n    }\r\n  }\r\n\r\n  onCreateItem = (data: ProyectoHallazgo) => {\r\n    return new Promise<null>((resolve) => {\r\n      $.blockUI(create_blockUI_loading_message('Creando Hallazgo'))\r\n\r\n      this.props.modelManager.createItem(this.props, data).then((item) => {\r\n        this.addItem(item)\r\n        $.unblockUI()\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  onSaveItem = (item: ProyectoHallazgo, changes: any, blockingText?: string) => {\r\n    return new Promise<ProyectoHallazgo>((resolve) => {\r\n      if (blockingText) {\r\n        $.blockUI(create_blockUI_loading_message(blockingText))\r\n      } else {\r\n        this.updateItem(item, changes)\r\n      }\r\n\r\n      this.props.modelManager.saveItem(this.props, item, changes).then((updatedItem) => {\r\n        this.updateItem(item, updatedItem)\r\n        if (blockingText) {\r\n          $.unblockUI()\r\n        }\r\n\r\n        resolve(updatedItem)\r\n      })\r\n    })\r\n  }\r\n\r\n  onClickDeleteItem = (item: ProyectoHallazgo) => {\r\n    bootbox.warningConfirm(\r\n      `¿Desea eliminar el hallazgo <strong>${HallazgoUtils.formatName(item.name)}</strong> ?`,\r\n      'No',\r\n      'Sí, Eliminar',\r\n      (answer: boolean) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Hallazgo'))\r\n\r\n        this.props.modelManager.deleteItem(this.props, item).then(() => {\r\n          this.deleteItem(item)\r\n          $.unblockUI()\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BaseMenuElement\r\n        name='hallazgo'\r\n        counter={this.state.items === null ? this.props.counter : _.size(this.state.items)}\r\n        icon='hallazgos'\r\n        title='Hallazgos'\r\n        open={this.props.open}\r\n        onToggle={this.props.onOpen}\r\n        onMountPanel={this.onMountPanel}\r\n      >\r\n        <div className='content'>\r\n          <MenuItemNew\r\n            moduleParams={this.props.moduleParams}\r\n            buttonText='Crear Hallazgo'\r\n            headerText='Nuevo Hallazgo'\r\n            isEditable={es_proyecto_editable() && user_has_role_permission('hallazgo_create')}\r\n            item={createNewHallazgo()}\r\n            onSave={this.onCreateItem}\r\n            contentAs={HallazgoModal}\r\n          />\r\n          <HallazgoList\r\n            isEditable={es_proyecto_editable() && user_has_role_permission('hallazgo_edit')}\r\n            moduleParams={this.props.moduleParams}\r\n            items={this.state.items}\r\n            onSaveItem={this.onSaveItem}\r\n            onClickDeleteItem={this.onClickDeleteItem}\r\n          />\r\n        </div>\r\n      </BaseMenuElement>\r\n    )\r\n  }\r\n}\r\n\r\nfunction createNewHallazgo(): ProyectoHallazgo {\r\n  return {\r\n    id: null,\r\n    status: 'NUEVO',\r\n    implementado: null,\r\n    hallazgo: '',\r\n    RevisionLog: [],\r\n    UpdateLog: []\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent } from 'react'\r\nimport { HallazgoUtils } from '../utils_hallazgo'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\nimport { HallazgoModalEdit } from './hallazgo_edit'\r\nimport { MenuElementListPanel, MenuElementListActions } from './menuitem'\r\nimport { StatusDivBlock } from '../../global/StatusButtonAction'\r\nimport { truncateText } from '../utils_truncate'\r\n\r\nexport class HallazgoList extends PureComponent<DefaultMenuItemListProps<ProyectoHallazgo>> {\r\n  render() {\r\n    if (this.props.items === null) {\r\n      return (\r\n        <div style={{ height: 300, position: 'relative' }}>\r\n          <div className='ui active inverted text loader elastic olive'>Cargando Listado de Hallazgos</div>\r\n        </div>\r\n      )\r\n    } else if (_.size(this.props.items) == 0) {\r\n      return <div className='empty nocontent'>0 Hallazgos</div>\r\n    } else {\r\n      const { items } = this.props\r\n      return (\r\n        <MenuElementListPanel>\r\n          {_.map(items, (item) => {\r\n            return (\r\n              <div key={item.id} className='listitem hallazgo-listitem'>\r\n                <HallazgoListItem\r\n                  item={item}\r\n                  moduleParams={this.props.moduleParams}\r\n                  onSave={this.props.onSaveItem}\r\n                  onClickDelete={this.props.onClickDeleteItem}\r\n                />\r\n              </div>\r\n            )\r\n          })}\r\n        </MenuElementListPanel>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\ntype HallazgoListItemProps = {\r\n  moduleParams: any\r\n  item: ProyectoHallazgo\r\n  onSave: (item: ProyectoHallazgo, changes: any, blockingText?: string) => void\r\n  onClickDelete: (item: ProyectoHallazgo) => void\r\n}\r\n\r\nexport class HallazgoListItem extends PureComponent<HallazgoListItemProps, { isModalEdit: boolean }> {\r\n  state = {\r\n    isModalEdit: false\r\n  }\r\n\r\n  renderDescripcion() {\r\n    const { item } = this.props\r\n    let html = truncateText(item.hallazgo)\r\n\r\n    return <div dangerouslySetInnerHTML={{ __html: html }} />\r\n  }\r\n\r\n  renderEstadoImplementacion() {\r\n    const { item } = this.props\r\n\r\n    if (item.implementado == null || '' + item.implementado == '') {\r\n      return 'Pendiente'\r\n    } else if (item.implementado == '0') {\r\n      return 'En Proceso'\r\n    } else {\r\n      return 'Hecho'\r\n    }\r\n  }\r\n\r\n  onClickEdit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isModalEdit: true })\r\n  }\r\n\r\n  onCloseEdit = () => {\r\n    this.setState({ isModalEdit: false })\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onClickDelete(this.props.item)\r\n  }\r\n\r\n  onSave = (item: ProyectoHallazgo, changes: any) => {\r\n    let blockingText = null\r\n    if (_.isEqual(changes, { status: 'COMPLETADO' })) {\r\n      blockingText = 'Marcando como COMPLETADO'\r\n    } else if (_.isEqual(changes, { status: 'REVISADO' })) {\r\n      blockingText = 'Marcando como REVISADO'\r\n    }\r\n\r\n    this.props.onSave(item, changes, blockingText)\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n\r\n    return (\r\n      <div>\r\n        <MenuElementListActions\r\n          actions={{\r\n            edit: { label: 'Editar', callback: this.onClickEdit, permission: 'hallazgo_edit' },\r\n            delete: { label: 'Eliminar', callback: this.onClickDelete, permission: 'hallazgo_delete' }\r\n          }}\r\n        />\r\n        <div onClick={() => this.setState({ isModalEdit: true })}>\r\n          <div className='row r1'>\r\n            <div className='pull-left r1_1'>\r\n              <span className='title-h1'>{HallazgoUtils.formatName(item.name)}</span>\r\n              <AuthorIconLogDefaultWrapper model={item} size='small' />\r\n              <div className='r1_2'>\r\n                <strong>Implementación: </strong> {this.renderEstadoImplementacion()}\r\n              </div>\r\n            </div>\r\n            <StatusDivBlock wrapperClassName='pull-right text-mini' status={item.status} className='mini' hideLabel />\r\n          </div>\r\n          <div className='row'>\r\n            <div className='editor-preview'>{this.renderDescripcion()}</div>\r\n          </div>\r\n          <div className='row' />\r\n        </div>\r\n        {this.state.isModalEdit && (\r\n          <HallazgoModalEdit\r\n            item={item}\r\n            moduleParams={this.props.moduleParams}\r\n            onSave={this.onSave}\r\n            onClickDelete={this.onClickDelete}\r\n            onClose={this.onCloseEdit}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { SyntheticEvent, PureComponent } from 'react'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport { HallazgoModal } from './hallazgo_modal'\r\n\r\ntype HallazgoModalEditProps = {\r\n  moduleParams: any\r\n  item: ProyectoHallazgo\r\n  onSave: (item: ProyectoHallazgo, data: ProyectoHallazgo) => void\r\n  onClickDelete: (ev: SyntheticEvent) => void\r\n  onClose: () => void\r\n}\r\nexport class HallazgoModalEdit extends PureComponent<HallazgoModalEditProps> {\r\n  onSave = (data: ProyectoHallazgo) => {\r\n    this.props.onSave(this.props.item, data)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        open\r\n        dimmer='inverted'\r\n        className='modal-ab modal-sidebarmenuitem'\r\n        size='large'\r\n        closeIcon\r\n        onClose={this.props.onClose}\r\n      >\r\n        <Modal.Header>Editar Hallazgo</Modal.Header>\r\n\r\n        <HallazgoModal\r\n          moduleParams={this.props.moduleParams}\r\n          item={this.props.item}\r\n          isEditable={user_has_role_permission('hallazgo_edit')}\r\n          onSave={this.onSave}\r\n          onClickDelete={this.props.onClickDelete}\r\n        />\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent } from 'react'\r\n\r\nimport { BaseMenuElement } from './menuitem'\r\nimport RevisionList from './revision_list'\r\n\r\nimport Textarea from 'react-textarea-autosize'\r\n\r\ntype MenuItemRevisionState = {\r\n  items: ProyectoRevisionTree[]\r\n}\r\n\r\nexport class MenuItemRevision extends PureComponent<\r\n  DefaultMenuElementProps<ProyectoRevisionTree>,\r\n  MenuItemRevisionState\r\n> {\r\n  state: MenuItemRevisionState = {\r\n    items: null\r\n  }\r\n\r\n  parseItems = (input: any[]): ProyectoRevisionTree[] => {\r\n    return input\r\n  }\r\n\r\n  onMountPanel = () => {\r\n    if (this.state.items === null) {\r\n      this.props.modelManager.getJson(this.props).then((items) => {\r\n        this.setState({ items })\r\n      })\r\n    }\r\n  }\r\n\r\n  onCreateItem = (params: { text: string; status: 'NUEVO' | 'COMPLETADO' }, cb: () => void) => {\r\n    $.blockUI(create_blockUI_loading_message('Creando Nota de Revisión'))\r\n\r\n    this.props.modelManager\r\n      .createItem(this.props, { revision_text: params.text, op: params.status })\r\n      .then((revision) => {\r\n        this.setState((prevState) => {\r\n          const items = [ ...prevState.items ]\r\n          items.push(revision)\r\n\r\n          return { items }\r\n        })\r\n\r\n        cb()\r\n        $.unblockUI()\r\n      })\r\n  }\r\n\r\n  onSaveItem = (item: ProyectoRevisionTree, changes: any, blockingText?: string) => {\r\n    return new Promise<ProyectoRevisionTree>((resolve) => {\r\n      if (blockingText) {\r\n        setTimeout(() => $.blockUI(create_blockUI_loading_message(blockingText)), 1000 * 0.1)\r\n      }\r\n\r\n      this.props.modelManager.saveItem(this.props, item, changes).then((revision) => {\r\n        this.setState((prevState) => {\r\n          const items = _.map(prevState.items, (item) => {\r\n            return item.id == revision.id ? revision : item\r\n          })\r\n\r\n          return { items }\r\n        })\r\n\r\n        if (blockingText) {\r\n          $.unblockUI()\r\n        }\r\n\r\n        resolve(revision)\r\n      })\r\n    })\r\n  }\r\n\r\n  onClickDeleteItem = (item: ProyectoRevisionTree) => {\r\n    bootbox.warningConfirm(\r\n      `¿Desea eliminar esta Nota de Revisión <b>#${item.name}</b> ?`,\r\n      'No',\r\n      'Sí, Eliminar',\r\n      (r) => {\r\n        if (!r) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Nota de Revisión'))\r\n\r\n        this.props.modelManager.deleteItem(this.props, item).then(() => {\r\n          this.setState((prevState) => {\r\n            const items = _.reject(prevState.items, { id: item.id })\r\n\r\n            return { items }\r\n          })\r\n          $.unblockUI()\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  renderContent() {\r\n    return (\r\n      <div className='content'>\r\n        <RevisionNewForm onSubmit={this.onCreateItem} />\r\n        <RevisionList\r\n          items={this.state.items}\r\n          moduleParams={this.props.moduleParams}\r\n          isEditable={es_proyecto_editable() && user_has_role_permission('revision_edit')}\r\n          onSaveItem={this.onSaveItem}\r\n          onClickDeleteItem={this.onClickDeleteItem}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BaseMenuElement\r\n        name='revision'\r\n        counter={\r\n          this.state.items === null ? this.props.counter : _.size(_.reject(this.state.items, { status: 'REVISADO' }))\r\n        }\r\n        icon='notas_de_revision'\r\n        title='Notas de Revisión'\r\n        open={this.props.open}\r\n        onToggle={this.props.onOpen}\r\n        onMountPanel={this.onMountPanel}\r\n      >\r\n        {this.renderContent()}\r\n      </BaseMenuElement>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionNewFormProps = {\r\n  onSubmit: (params: { text: string; status: 'NUEVO' | 'COMPLETADO' }, cb: () => void) => void\r\n}\r\n\r\nclass RevisionNewForm extends PureComponent<RevisionNewFormProps, { text: string; isEditMode: boolean }> {\r\n  state = {\r\n    text: '',\r\n    isEditMode: false\r\n  }\r\n\r\n  onChange = (ev: SyntheticEvent) => {\r\n    this.setState({ text: (ev.target as any).value })\r\n  }\r\n\r\n  onTextareaKeyDown = (ev: React.KeyboardEvent) => {\r\n    if (ev.keyCode == 27) {\r\n      // on press Esc\r\n      this.onCancel()\r\n    }\r\n\r\n    if ((ev.ctrlKey || ev.metaKey) && (ev.keyCode == 13 || ev.keyCode == 10)) {\r\n      // on press ctrl + Enter\r\n      this.onSubmit('NUEVO')\r\n    }\r\n  }\r\n\r\n  onClickNew = () => {\r\n    this.setState({ isEditMode: true })\r\n  }\r\n\r\n  onCancel = () => {\r\n    this.setState({ isEditMode: false, text: '' })\r\n  }\r\n\r\n  onSubmit = (status: 'NUEVO' | 'COMPLETADO') => {\r\n    if (_.str.trim(this.state.text) == '') {\r\n      bootbox.alertError('La Nota de Revisión no puede estar vacía.')\r\n      return\r\n    }\r\n\r\n    this.props.onSubmit({ text: _.str.trim(this.state.text), status }, () => {\r\n      this.setState({ text: '', isEditMode: false })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    if (!es_proyecto_editable() || !user_has_role_permission('revision_edit')) {\r\n      return null\r\n    }\r\n\r\n    return !this.state.isEditMode ? (\r\n      <div style={{ textAlign: 'center' }}>\r\n        <button className='ui button primary mini compact' onClick={this.onClickNew}>\r\n          Crear Nota\r\n        </button>\r\n      </div>\r\n    ) : (\r\n      <div>\r\n        <Textarea\r\n          minRows={2}\r\n          maxRows={8}\r\n          autoFocus\r\n          onChange={this.onChange}\r\n          value={this.state.text}\r\n          style={{ width: '98%' }}\r\n          onKeyDown={this.onTextareaKeyDown}\r\n          placeholder='Escriba aquí su Nota de Revisión'\r\n        />\r\n        <div style={{ marginTop: 8, textAlign: 'right' }}>\r\n          <button className='ui button negative mini compact' onClick={this.onCancel}>\r\n            Cancelar\r\n          </button>\r\n          <button className='ui button primary mini compact' onClick={() => this.onSubmit('NUEVO')}>\r\n            Guardar\r\n          </button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent, Fragment } from 'react'\r\nimport { MenuElementListPanel, MenuElementListActions } from './menuitem'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\nimport { StatusDivBlock } from '../../global/StatusButtonAction'\r\nimport Textarea from 'react-textarea-autosize'\r\nimport cx from 'classnames'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\n\r\nexport default class RevisionList extends PureComponent<DefaultMenuItemListProps<ProyectoRevisionTree>> {\r\n  render() {\r\n    if (this.props.items === null) {\r\n      return (\r\n        <div style={{ height: 300, position: 'relative' }}>\r\n          <div className='ui active inverted text loader elastic olive'>Cargando Notas de Revisión</div>\r\n        </div>\r\n      )\r\n    } else if (_.size(this.props.items) == 0) {\r\n      return <div className='empty nocontent'>0 Notas de Revisión</div>\r\n    } else {\r\n      const { items } = this.props\r\n\r\n      const porRevisarItems = _.reject(items, { status: 'REVISADO' })\r\n      const revisadoItems = _.filter(items, { status: 'REVISADO' })\r\n\r\n      return (\r\n        <MenuElementListPanel className='revision-list'>\r\n          {_.size(porRevisarItems) == 0 ? (\r\n            <div className='empty nocontent'>0 Notas de Revisión Abiertas</div>\r\n          ) : (\r\n            _.map(porRevisarItems, (item: ProyectoRevisionTree) => {\r\n              return (\r\n                <div key={item.id} className='listitem revision-listitem'>\r\n                  <RevisionListItem\r\n                    item={item}\r\n                    isEditable={this.props.isEditable}\r\n                    onSave={this.props.onSaveItem}\r\n                    onClickDelete={this.props.onClickDeleteItem}\r\n                  />\r\n                </div>\r\n              )\r\n            })\r\n          )}\r\n\r\n          {_.size(revisadoItems) > 0 && <RevisionDisabledList items={revisadoItems} />}\r\n        </MenuElementListPanel>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nclass RevisionDisabledList extends PureComponent<{ items: ProyectoRevisionTree[] }, { collapsed: boolean }> {\r\n  state = {\r\n    collapsed: true\r\n  }\r\n\r\n  toggle = () => {\r\n    this.setState((prevState) => {\r\n      return { collapsed: !prevState.collapsed }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { items } = this.props\r\n\r\n    return (\r\n      <div style={{ marginTop: 20, marginBottom: 20, padding: '0 10px' }}>\r\n        <h4 className='row clickable' onClick={this.toggle}>\r\n          <i className={cx('icon caret', !this.state.collapsed ? 'down' : 'right')} /> Notas Revisadas\r\n          <span className='toggle-action'>[{this.state.collapsed ? 'Mostrar' : 'Ocultar'}]</span>\r\n          <span className='ui mini circular green label pull-right'>{_.size(items)}</span>\r\n        </h4>\r\n        {!this.state.collapsed && (\r\n          <div className='revision-list-closed'>\r\n            {_.map(items, (item: ProyectoRevisionTree) => {\r\n              return (\r\n                <div key={item.id} className='listitem revision-listitem'>\r\n                  <RevisionListItem item={item} isEditable={false} />\r\n                </div>\r\n              )\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionListItemState = {\r\n  isEditMode: boolean\r\n  isThreadOpen: boolean\r\n}\r\n\r\nclass RevisionListItem extends PureComponent<\r\n  DefaultMenuItemListItemProps<ProyectoRevisionTree>,\r\n  RevisionListItemState\r\n> {\r\n  state = {\r\n    isEditMode: false,\r\n    isThreadOpen: false\r\n  }\r\n\r\n  onClickEdit = () => {\r\n    this.setState({ isEditMode: true })\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onClickDelete(this.props.item)\r\n  }\r\n\r\n  onClickNewComment = () => {\r\n    if (this.props.isEditable) {\r\n      this.setState({ isThreadOpen: true })\r\n    }\r\n  }\r\n\r\n  onCancelNewComment = () => {\r\n    this.setState({ isThreadOpen: false })\r\n  }\r\n\r\n  onChange = (changes: any) => {\r\n    this.props.onSave(this.props.item, changes, 'Guardando cambios...').then(() => {\r\n      this.setState({ isEditMode: false })\r\n    })\r\n  }\r\n\r\n  onClickChangeStatus = (status: any) => {\r\n    this.props.onSave(this.props.item, { op: status }, 'Marcando como ' + status + '...')\r\n  }\r\n\r\n  onAddComment = (params: { text: string; status: string }) => {\r\n    const changes: any = { comment: params.text }\r\n    if (params.status) {\r\n      changes.op = params.status\r\n    }\r\n\r\n    this.props.onSave(this.props.item, changes, 'Guardando comentario...').then(() => {\r\n      this.setState({ isThreadOpen: false })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n    return (\r\n      <div>\r\n        {this.props.isEditable && (\r\n          <MenuElementListActions\r\n            actions={{\r\n              delete: { label: 'Eliminar', callback: this.onClickDelete, permission: 'revision_delete' }\r\n            }}\r\n          />\r\n        )}\r\n        <div className='row header-item'>\r\n          <div className='pull-left'>\r\n            <span className='title-h1'>Nota #{item.name}</span>\r\n            <AuthorIconLogDefaultWrapper model={item} size='small' />\r\n          </div>\r\n          <StatusDivBlock\r\n            wrapperClassName='pull-right text-mini'\r\n            status={item.status || 'EN PROCESO'}\r\n            className='mini'\r\n            hideLabel\r\n          />\r\n        </div>\r\n\r\n        <div className='author-info'>\r\n          <i aria-hidden='true' className='user circle icon olive' style={{ float: 'left' }} />\r\n          <div className='content'>\r\n            <div className='header'>\r\n              {item.Creator.User.name}\r\n              <div className='pull-right description'>\r\n                {Date.create(item.Creator.ts).format('{d} {Mon} {year} {h}:{mm} {tt}')}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {this.props.isEditable && this.state.isEditMode ? (\r\n          <RevisionEditForm item={item} onSubmit={this.onChange} />\r\n        ) : (\r\n          <Fragment>\r\n            <p\r\n              onClick={this.onClickNewComment}\r\n              style={{ lineHeight: '1em' }}\r\n              dangerouslySetInnerHTML={{ __html: item.description.replace(/\\n/g, '<br/>') }}\r\n            />\r\n            <div className={cx('threadlist ui threaded comments', { empty: _.size(item.Comments) == 0 })}>\r\n              {this.state.isThreadOpen && (\r\n                <h5 className={cx('ui header', { dividing: _.size(item.Comments) == 0 })}>Comentarios</h5>\r\n              )}\r\n              {_.map(item.Comments, (comment) => {\r\n                return (\r\n                  <div className='comment' key={comment.id} onClick={this.onClickNewComment}>\r\n                    <div className='avatar'>\r\n                      <i\r\n                        className={cx('icon user circle', {\r\n                          green: comment.status == 'COMPLETADO',\r\n                          olive: comment.status == 'REVISADO'\r\n                        })}\r\n                      />\r\n                    </div>\r\n                    <div className='content'>\r\n                      <div className='author'>{comment.Creator.User.name}</div>\r\n                      <div className='metadata'>\r\n                        {Date.create(comment.Creator.ts).format('{d} {Mon} {year}  {h}:{mm} {tt}')}\r\n                      </div>\r\n                      <div className='text'>\r\n                        <p dangerouslySetInnerHTML={{ __html: comment.comentario }} />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )\r\n              })}\r\n            </div>\r\n            {this.state.isThreadOpen && this.props.isEditable ? (\r\n              <RevisionComentarioForm parentItem={item} onSave={this.onAddComment} onCancel={this.onCancelNewComment} />\r\n            ) : (\r\n              this.props.isEditable && (\r\n                <div className='actions-wrapper'>\r\n                  <div className='actions'>\r\n                    <div className='group-actions'>\r\n                      <button className='ui button icon blue mini compact' onClick={this.onClickNewComment}>\r\n                        Responder\r\n                      </button>\r\n                    </div>\r\n                    <div className='group-actions right-actions'>\r\n                      <button\r\n                        className='ui button icon primary mini compact'\r\n                        onClick={() => this.onClickChangeStatus('COMPLETADO')}\r\n                      >\r\n                        <i className='icon check' /> Completar\r\n                      </button>\r\n\r\n                      <Popup\r\n                        disabled={item.fecha_completado != null}\r\n                        className='disable-text'\r\n                        on='hover'\r\n                        basic\r\n                        content='Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.'\r\n                        trigger={\r\n                          <div className='button-wrapper'>\r\n                            <button\r\n                              className='ui button mini compact olive'\r\n                              disabled={item.fecha_completado == null}\r\n                              onClick={() =>\r\n                                item.fecha_completado == null ? void 0 : this.onClickChangeStatus('REVISADO')}\r\n                            >\r\n                              <i className='icon check fitted' />\r\n                              <i className='icon check' /> Revisado\r\n                            </button>\r\n                          </div>\r\n                        }\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            )}\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionEditFormProps = {\r\n  item: ProyectoRevisionTree\r\n  onSubmit: (changes: { revision_text: string; op?: 'COMPLETADO' | 'REVISADO' }) => void\r\n}\r\n\r\ntype RevisionEditFormState = {\r\n  value: string\r\n}\r\n\r\nclass RevisionEditForm extends PureComponent<RevisionEditFormProps, RevisionEditFormState> {\r\n  constructor(props: RevisionEditFormProps) {\r\n    super(props)\r\n    this.state = {\r\n      value: this.props.item.description\r\n    }\r\n  }\r\n\r\n  onChange = (ev: SyntheticEvent) => {\r\n    this.setState({ value: (ev.target as any).value })\r\n  }\r\n\r\n  onSubmit = (status?: 'COMPLETADO' | 'REVISADO') => {\r\n    if (_.str.trim(this.state.value) == '') {\r\n      bootbox.alertError('La Nota de Revisión no puede estar vacía.')\r\n      return\r\n    }\r\n\r\n    const changes: any = { revision_text: _.str.trim(this.state.value) }\r\n    if (status) {\r\n      changes.op = status\r\n    }\r\n    this.props.onSubmit(changes)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <Textarea\r\n          minRows={2}\r\n          maxRows={8}\r\n          onChange={this.onChange}\r\n          value={this.state.value}\r\n          style={{ width: '98%' }}\r\n          placeholder='Escriba aquí su Nota de Revisión'\r\n        />\r\n\r\n        <div style={{ marginTop: 8, textAlign: 'right' }}>\r\n          <button className='ui button icon primary mini compact' onClick={() => this.onSubmit()}>\r\n            Guardar\r\n          </button>\r\n\r\n          <button className='ui button icon primary mini compact' onClick={() => this.onSubmit('COMPLETADO')}>\r\n            <i className='icon check' /> Completar\r\n          </button>\r\n\r\n          <Popup\r\n            disabled={this.props.item.fecha_completado != null}\r\n            className='disable-text'\r\n            on='hover'\r\n            basic\r\n            content='Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.'\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <button\r\n                  className='ui button mini compact olive'\r\n                  disabled={this.props.item.fecha_completado == null}\r\n                  onClick={() => (this.props.item.fecha_completado == null ? void 0 : this.onSubmit('REVISADO'))}\r\n                >\r\n                  <i className='icon check fitted' />\r\n                  <i className='icon check' /> Revisado\r\n                </button>\r\n              </div>\r\n            }\r\n          />\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionComentarioFormProps = {\r\n  parentItem: ProyectoRevisionTree\r\n  onSave: (params: { text: string; status: string }) => void\r\n  onCancel: () => void\r\n}\r\nclass RevisionComentarioForm extends PureComponent<RevisionComentarioFormProps> {\r\n  cancelTimeout: number = null\r\n\r\n  state = {\r\n    value: ''\r\n  }\r\n\r\n  onChange = (ev: SyntheticEvent) => {\r\n    this.setState({ value: (ev.target as any).value })\r\n  }\r\n\r\n  onTextareaKeyDown = (ev: React.KeyboardEvent) => {\r\n    if (ev.keyCode == 27) {\r\n      // on press Esc\r\n      this.props.onCancel()\r\n      this.cancelTimeout = null\r\n    }\r\n\r\n    if ((ev.ctrlKey || ev.metaKey) && (ev.keyCode == 13 || ev.keyCode == 10)) {\r\n      // on press ctrl + Enter\r\n      this.onSubmit()\r\n    }\r\n  }\r\n\r\n  onSubmit = (status?: 'COMPLETADO' | 'REVISADO') => {\r\n    if (_.str.trim(this.state.value) == '' && !status) {\r\n      return\r\n    }\r\n\r\n    if (this.cancelTimeout != null) {\r\n      window.clearTimeout(this.cancelTimeout)\r\n      this.cancelTimeout = null\r\n    }\r\n\r\n    this.props.onSave({ text: _.str.trim(this.state.value), status })\r\n  }\r\n\r\n  onBlur = () => {\r\n    this.cancelTimeout = window.setTimeout(() => {\r\n      this.props.onCancel()\r\n    }, 1000 * 0.5)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div style={{ marginBottom: 30 }}>\r\n        <Textarea\r\n          minRows={2}\r\n          maxRows={5}\r\n          autoFocus\r\n          value={this.state.value}\r\n          onChange={this.onChange}\r\n          onKeyDown={this.onTextareaKeyDown}\r\n          placeholder='Escriba aquí su comentario'\r\n          style={{ width: '95%' }}\r\n          onBlur={() => this.onBlur()}\r\n        />\r\n\r\n        <div style={{ textAlign: 'right', marginTop: 5 }}>\r\n          <button className='ui button icon blue mini compact pull-left' onClick={() => this.onSubmit()}>\r\n            Enviar\r\n          </button>\r\n\r\n          <button className='ui button icon primary mini compact' onClick={() => this.onSubmit('COMPLETADO')}>\r\n            <i className='icon check' /> Completar\r\n          </button>\r\n\r\n          <Popup\r\n            disabled={this.props.parentItem.fecha_completado != null}\r\n            className='disable-text'\r\n            on='hover'\r\n            basic\r\n            content='Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.'\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <button\r\n                  className='ui button mini compact olive'\r\n                  disabled={this.props.parentItem.fecha_completado == null}\r\n                  onClick={() => (this.props.parentItem.fecha_completado == null ? void 0 : this.onSubmit('REVISADO'))}\r\n                >\r\n                  <i className='icon check fitted' />\r\n                  <i className='icon check' /> Revisado\r\n                </button>\r\n              </div>\r\n            }\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","export class HallazgoHojaTrabajoModelManager implements MenuElementModelManager<ProyectoHallazgo> {\r\n  private static instance: HallazgoHojaTrabajoModelManager\r\n\r\n  static getInstance(): HallazgoHojaTrabajoModelManager {\r\n    if (!HallazgoHojaTrabajoModelManager.instance) {\r\n      HallazgoHojaTrabajoModelManager.instance = new this()\r\n    }\r\n\r\n    return HallazgoHojaTrabajoModelManager.instance\r\n  }\r\n\r\n  /**\r\n   * Descarga el listado de los hallazgos.\r\n   *\r\n   * @param props\r\n   */\r\n  getJson(props: DefaultMenuElementProps<ProyectoHallazgo>): Promise<ProyectoHallazgo[]> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n\r\n    return new Promise((resolve) => {\r\n      $.getJSON(url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/hallazgo/json`)).done((res) => {\r\n        resolve(_.isEmpty(res.response) ? [] : res.response)\r\n      })\r\n    })\r\n  }\r\n\r\n  createItem(props: DefaultMenuElementProps<ProyectoHallazgo>, data: any): Promise<ProyectoHallazgo> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/hallazgo`)\r\n\r\n    return new Promise<ProyectoHallazgo>((resolve) => {\r\n      $.post(url, { data }).done((res) => {\r\n        resolve(res.response.record)\r\n      })\r\n    })\r\n  }\r\n\r\n  saveItem(props: DefaultMenuElementProps<ProyectoHallazgo>, item: any, data: any): Promise<ProyectoHallazgo> {\r\n    let url: string\r\n    if (_.isEqual(data, { status: 'COMPLETADO' })) {\r\n      url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id/c`\r\n    } else if (_.isEqual(data, { status: 'REVISADO' })) {\r\n      url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id/r`\r\n    } else {\r\n      url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id`\r\n    }\r\n\r\n    const { id_paso, id_visita } = props.moduleParams\r\n\r\n    return new Promise<ProyectoHallazgo>((resolve) => {\r\n      $.post(url_for2(url, { id_paso, id_visita, id: item.id }), { data }).done((res) => {\r\n        resolve(res.response.record)\r\n      })\r\n    })\r\n  }\r\n\r\n  deleteItem(props: DefaultMenuElementProps<ProyectoHallazgo>, item: any): Promise<null> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id`\r\n\r\n    return new Promise<null>((resolve) => {\r\n      $.ajax({ url: url_for2(url, { id_paso, id_visita, id: item.id }), type: 'DELETE' }).done((res) => {\r\n        if (res.status == 1) {\r\n          resolve()\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  parseItems(items: any): any {\r\n    return items\r\n  }\r\n}\r\n\r\nexport class RevisionHojaTrabajoModelManager implements MenuElementModelManager<ProyectoRevisionTree> {\r\n  private static instance: RevisionHojaTrabajoModelManager\r\n\r\n  private hojaTrabajoContext: HojaTrabajoContextType\r\n\r\n  static getInstance(hojaTrabajoContext: HojaTrabajoContextType): RevisionHojaTrabajoModelManager {\r\n    if (!RevisionHojaTrabajoModelManager.instance) {\r\n      RevisionHojaTrabajoModelManager.instance = new this()\r\n      RevisionHojaTrabajoModelManager.instance.hojaTrabajoContext = hojaTrabajoContext\r\n    }\r\n\r\n    return RevisionHojaTrabajoModelManager.instance\r\n  }\r\n\r\n  /**\r\n   * Descarga el listado de los notas de revision.\r\n   *\r\n   * @param props\r\n   */\r\n  getJson(props: DefaultMenuElementProps<ProyectoRevisionTree>): Promise<ProyectoRevisionTree[]> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n\r\n    return new Promise((resolve) => {\r\n      $.getJSON(url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/revision`)).done((res) => {\r\n        resolve(_.isEmpty(res.response.revisiones) ? [] : this.parseItems(res.response.revisiones))\r\n      })\r\n    })\r\n  }\r\n\r\n  createItem(props: DefaultMenuElementProps<ProyectoRevisionTree>, data: any): Promise<ProyectoRevisionTree> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/revision`)\r\n\r\n    return new Promise<ProyectoRevisionTree>((resolve) => {\r\n      $.post(url, data).done((res) => {\r\n        resolve(res.response.revision)\r\n\r\n        this.updateVisita(id_visita, res.response.paso_visita)\r\n      })\r\n    })\r\n  }\r\n\r\n  saveItem(props: DefaultMenuElementProps<ProyectoRevisionTree>, item: any, data: any): Promise<ProyectoRevisionTree> {\r\n    const { id_visita, id_paso } = props.moduleParams\r\n    const url = url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/revision/${item.id}`)\r\n\r\n    return new Promise<ProyectoRevisionTree>((resolve) => {\r\n      $.post(url, data).done((res) => {\r\n        resolve(res.response.revision)\r\n\r\n        this.updateVisita(id_visita, res.response.paso_visita)\r\n      })\r\n    })\r\n  }\r\n\r\n  deleteItem(props: DefaultMenuElementProps<ProyectoRevisionTree>, item: any): Promise<null> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/revision/:item_id`\r\n\r\n    return new Promise<null>((resolve) => {\r\n      $.ajax({ url: url_for2(url, { id_paso, id_visita, item_id: item.id }), type: 'DELETE' }).done((res) => {\r\n        resolve()\r\n\r\n        this.updateVisita(id_visita, res.response.paso_visita)\r\n      })\r\n    })\r\n  }\r\n\r\n  parseItems(items: any): any {\r\n    return items\r\n  }\r\n\r\n  updateVisita(id_visita: Readonly<string>, changes: any) {\r\n    const { hoja_trabajo, update } = this.hojaTrabajoContext\r\n\r\n    let hoja_trabajo_copy = Object.assign({}, hoja_trabajo)\r\n\r\n    hoja_trabajo_copy.visitas = _.mapValues(hoja_trabajo_copy.visitas, (item: ProyectoPasoVisita) => {\r\n      if (item.id_visita == id_visita) {\r\n        item = Object.assign({}, item, changes)\r\n      }\r\n      return item\r\n    })\r\n\r\n    update(hoja_trabajo_copy)\r\n  }\r\n}\r\n","import { Component, SyntheticEvent } from 'react'\r\n\r\nimport Form from 'semantic-ui-react/dist/commonjs/collections/Form'\r\nimport Select from 'semantic-ui-react/dist/commonjs/addons/Select'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\n\r\nimport cx from 'classnames'\r\n\r\nimport { GenericTooltip } from '../global/Tooltip'\r\nimport InputAutoNumeric from '../global/InputAutoNumeric'\r\n\r\nimport { MaterialidadEnums, MaterialidadUtils } from './MaterialidadUtils'\r\nimport HojaTrabajoContext from '../proyecto__hoja_trabajo/HojaTrabajoContext'\r\nimport { HojaTrabajoUpdateUtils, HojaTrabajoUtils } from '../proyecto__hoja_trabajo/utils'\r\nimport MaterialidadObservacionesEditor from './MaterialidadObservacionesEditor'\r\n\r\ntype MaterialidadFieldTotalProps = {\r\n  field: string\r\n  name: string\r\n  tooltip: string\r\n  width?: string\r\n  calculateTotal: (field: string) => number\r\n}\r\n\r\naccounting.settings.currency.decimal = ','\r\naccounting.settings.currency.thousand = '.'\r\naccounting.settings.currency.format = '%s %v'\r\naccounting.settings.currency.precision = 0\r\n\r\nconst MaterialidadFieldTotal = (props: MaterialidadFieldTotalProps) => {\r\n  return (\r\n    <div className={`box-total ${props.width ? props.width : 'ten'} wide column`}>\r\n      <div className='box-content'>\r\n        <GenericTooltip title={`Ayuda | ${props.name}`} iconColor='olive' text={props.tooltip} />\r\n        <div className='box-inner'>\r\n          <div className='title'>{props.name}</div>\r\n          <div className='value'>{accounting.formatMoney(props.calculateTotal(props.field), '$')}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\ntype MaterialidadFormProps = {\r\n  materialidad: ProyectoMaterialidad\r\n  isEditable: boolean\r\n}\r\n\r\nexport default class MaterialidadForm extends Component<MaterialidadFormProps, Partial<ProyectoMaterialidad>> {\r\n  static contextType = HojaTrabajoContext\r\n  context: HojaTrabajoContextType\r\n\r\n  private static changed = new Set()\r\n\r\n  constructor(props: MaterialidadFormProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      factor: props.materialidad ? props.materialidad.factor : null,\r\n      nivel: props.materialidad ? props.materialidad.nivel : null,\r\n      montos: props.materialidad ? props.materialidad.montos : {},\r\n      porc: props.materialidad ? props.materialidad.porc : null,\r\n      porc_error: props.materialidad ? props.materialidad.porc_error : null,\r\n      factor_justificacion: props.materialidad ? props.materialidad.factor_justificacion : '',\r\n      Attachments: props.materialidad ? props.materialidad.Attachments : []\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps: MaterialidadFormProps, prevState: Partial<ProyectoMaterialidad>) {\r\n    if (nextProps.materialidad.factor != prevState.factor) {\r\n      return { factor: nextProps.materialidad.factor }\r\n    }\r\n\r\n    if (nextProps.materialidad.nivel != prevState.nivel) {\r\n      return { nivel: nextProps.materialidad.nivel }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * @returns Retorna los factores como un listado de opciones para el componente Select.\r\n   */\r\n  getFactoresAsSelectChoices() {\r\n    const choices = MaterialidadEnums.factores.map(function(item, k) {\r\n      return { key: k + 1, value: k + 1 + '', text: item }\r\n    })\r\n\r\n    choices.unshift({ key: -1, value: '', text: '- Seleccionar -' })\r\n\r\n    return choices\r\n  }\r\n\r\n  /**\r\n   * @returns Retorna los niveles de confianza como un listado de opciones para el componente Select.\r\n   */\r\n  getNivelesAsSelectChoices() {\r\n    const choices = MaterialidadEnums.niveles.map(function(item, k) {\r\n      return { key: k + 1, value: k + 1 + '', text: item }\r\n    })\r\n\r\n    choices.unshift({ key: -1, value: '', text: '- Seleccionar -' })\r\n\r\n    return choices\r\n  }\r\n\r\n  getPorcMG() {\r\n    let { factor, montos } = this.state\r\n    let nivel = MaterialidadUtils.getNivel(this.state.nivel)\r\n    let porc = null\r\n\r\n    if (\r\n      typeof montos != 'undefined' &&\r\n      typeof montos[factor] != 'undefined' &&\r\n      typeof montos[factor][nivel] != 'undefined'\r\n    ) {\r\n      porc = montos[factor][nivel]\r\n    }\r\n\r\n    if (porc == null) {\r\n      porc = MaterialidadUtils.getDefaulPorcMG(this.state.factor, this.state.nivel)\r\n    }\r\n\r\n    return porc\r\n  }\r\n\r\n  isFactorInvalid() {\r\n    return !this.state.factor || typeof this.state.montos[this.state.factor] == 'undefined'\r\n  }\r\n\r\n  sendToServer(change: any, cb?: () => void) {\r\n    if (!this.props.isEditable) {\r\n      return\r\n    }\r\n\r\n    MaterialidadUtils.sendToServer(this.props.materialidad.Visita.id_visita, change, this.state, {}, (response) => {\r\n      if (response && response.response.visita) {\r\n        const { hoja_trabajo, update } = this.context\r\n        const visita = this.props.materialidad.Visita\r\n        let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, visita, response.response.visita)\r\n        update(hoja_trabajo_new)\r\n      }\r\n\r\n      if ($.isFunction(cb)) {\r\n        cb()\r\n      }\r\n    })\r\n\r\n    this.updateContext()\r\n  }\r\n\r\n  updateContext() {\r\n    const { hoja_trabajo, update } = this.context\r\n    let materialidad = Object.assign({}, this.props.materialidad, this.state)\r\n    let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, this.props.materialidad.Visita, {\r\n      materialidad\r\n    })\r\n    update(hoja_trabajo_new)\r\n  }\r\n\r\n  onSelectChoice(field: 'factor' | 'nivel', value: any) {\r\n    let change: any = {}\r\n    change[field] = value\r\n\r\n    this.setState(change, () => {\r\n      this.sendToServer({ field, value })\r\n\r\n      $.blockUI(create_blockUI_loading_message('Aplicando cambios'))\r\n      const { hoja_trabajo, update } = this.context\r\n      const materialidad = Object.assign({}, this.props.materialidad, change)\r\n      let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, this.props.materialidad.Visita, {\r\n        materialidad\r\n      })\r\n      update(hoja_trabajo_new)\r\n\r\n      const visitas = HojaTrabajoUtils.getAllVisitasAfter(hoja_trabajo, this.props.materialidad.Visita)\r\n      let promises: Promise<string>[] = []\r\n      _.forEach(visitas, (visita) => {\r\n        if (!visita.id) {\r\n          return\r\n        }\r\n\r\n        if (visita.id_status != '1') {\r\n          return\r\n        }\r\n\r\n        let promise = new Promise<string>((resolve, reject) => {\r\n          const materialidad = Object.assign({}, visita.materialidad, change)\r\n\r\n          MaterialidadUtils.sendToServer(visita.id_visita, { field, value }, materialidad, { s: 1 }, (response) => {\r\n            if (response && response.response.visita) {\r\n              response.response.visita.materialidad = materialidad\r\n              hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo_new, visita, response.response.visita)\r\n              update(hoja_trabajo_new)\r\n            }\r\n            resolve(visita.id)\r\n          })\r\n        })\r\n\r\n        promises.push(promise)\r\n      })\r\n\r\n      Promise.all(promises).then(function() {\r\n        $.unblockUI()\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Handler al cambiar un valor numerico.\r\n   *\r\n   * @param field Campo modificado.\r\n   * @param ev Evento.\r\n   * @param value Valor ingresado.\r\n   */\r\n  onChangeNumericField(field: keyof ProyectoMaterialidad, ev: SyntheticEvent, value: number, persist: boolean = false) {\r\n    let change: any = {}\r\n\r\n    if (persist && (ev.target as any).value == '') {\r\n      if (field == 'porc') {\r\n        value = 75\r\n      } else if (field == 'porc_error') {\r\n        value = 5\r\n      }\r\n    }\r\n\r\n    if (change[field] != value) {\r\n      change[field] = value\r\n      MaterialidadForm.changed.add(field)\r\n    }\r\n\r\n    this.setState(change, () => {\r\n      if (persist && MaterialidadForm.changed.has(field)) {\r\n        this.sendToServer({ field, value })\r\n        MaterialidadForm.changed.delete(field)\r\n      }\r\n    })\r\n  }\r\n\r\n  calculateTotal(field: 'porc_general' | 'porc' | 'porc_error') {\r\n    return MaterialidadUtils.calculateTotal(field, this.state, this.state.factor, this.state.nivel)\r\n  }\r\n\r\n  /**\r\n   * Handler al cambiar el valor del monto de un factor.\r\n   *\r\n   * @param ev Evento\r\n   * @param value Valor ingresado del monto.\r\n   */\r\n  onChangeMonto(ev: SyntheticEvent, value: number, useNivel: boolean, persist: boolean = false) {\r\n    if (persist && (ev.target as any).value == '') {\r\n      value = MaterialidadUtils.getDefaulPorcMG(this.state.factor, this.state.nivel)\r\n    }\r\n\r\n    let field: string\r\n\r\n    this.setState(\r\n      (state) => {\r\n        let { montos, factor } = state\r\n        if (typeof montos[factor] == 'undefined') {\r\n          montos[factor] = { valor: 0 }\r\n        }\r\n\r\n        if (useNivel) {\r\n          const { nivel } = state\r\n          const nivel_field = MaterialidadUtils.getNivel(nivel)\r\n          field = `monto${factor}_${nivel_field}`\r\n\r\n          if (montos[factor][nivel_field] != value) {\r\n            montos[factor][nivel_field] = value\r\n            MaterialidadForm.changed.add(field)\r\n          }\r\n        } else {\r\n          field = `monto${factor}`\r\n\r\n          if (montos[factor].valor != value) {\r\n            montos[factor].valor = value\r\n            MaterialidadForm.changed.add(field)\r\n          }\r\n\r\n          if (persist && MaterialidadForm.changed.has(field)) {\r\n            this.sendToServer({ field, value })\r\n            MaterialidadForm.changed.delete(field)\r\n          }\r\n        }\r\n\r\n        return { montos }\r\n      },\r\n      () => {\r\n        if (persist && MaterialidadForm.changed.has(field)) {\r\n          this.sendToServer({ field, value })\r\n          MaterialidadForm.changed.delete(field)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  onChangeObservaciones = (observaciones: string, cb?: () => void) => {\r\n    this.setState({ factor_justificacion: observaciones }, () => {\r\n      this.sendToServer({ field: 'factor_justificacion', value: observaciones }, cb)\r\n    })\r\n  }\r\n\r\n  onChangeAttachments = (attachments: ProyectoAttachment[]) => {\r\n    this.setState({ Attachments: attachments })\r\n    this.updateContext()\r\n  }\r\n\r\n  render() {\r\n    let row2_disabled_text = null\r\n    if (this.isFactorInvalid()) {\r\n      row2_disabled_text =\r\n        'Estos campos se encuentran deshabilitados debido a que es necesario que primero seleccione el factor para el cálculo de la Materialidad General'\r\n    } else if (!this.state.nivel || '' + this.state.nivel == '0') {\r\n      row2_disabled_text =\r\n        'Estos campos se encuentran deshabilitados debido a que es necesario que seleccione el nivel de confianza'\r\n    }\r\n\r\n    const calculateTotal = this.calculateTotal.bind(this)\r\n\r\n    const row2 = (\r\n      <Form.Group className={cx('form-group-2', row2_disabled_text ? 'ui-state-disabled' : null)}>\r\n        <Form.Field\r\n          width={5}\r\n          className='ui column grid compact'\r\n          error={\r\n            !!this.state.factor && !!this.state.montos[this.state.factor] && !this.state.montos[this.state.factor].valor\r\n          }\r\n        >\r\n          <div className='box-input six wide column'>\r\n            <div className='box-input-inner'>\r\n              <label htmlFor='materialidad_porc_general' title='% Materialidad General' className='noqtip'>\r\n                %MG\r\n              </label>\r\n              <InputAutoNumeric\r\n                value={this.getPorcMG()}\r\n                onChange={(ev: SyntheticEvent, value: number) => this.onChangeMonto(ev, value, true, false)}\r\n                onBlur={(ev: SyntheticEvent, value: number) => this.onChangeMonto(ev, value, true, true)}\r\n                disabled={!this.state.factor}\r\n                minimumValue={'0'}\r\n                maximumValue={'100'}\r\n                isEditable={this.props.isEditable}\r\n                className='percent eight wide field'\r\n                id='materialidad_porc_general'\r\n              />\r\n            </div>\r\n          </div>\r\n          <MaterialidadFieldTotal\r\n            field='porc_general'\r\n            name='Materialidad General'\r\n            tooltip={`Monto de materialidad que resulta de la aplicación de los porcentajes minimo, moderado o  máximo de los factores.`}\r\n            calculateTotal={calculateTotal}\r\n          />\r\n        </Form.Field>\r\n        <Form.Field width={6} className='ui column grid compact centered' error={!this.state.porc}>\r\n          <div className='box-input five wide column'>\r\n            <div className='box-input-inner'>\r\n              <label htmlFor='materialidad_porc' title='% Materialidad de Planeación' className='noqtip'>\r\n                %MP\r\n              </label>\r\n              <InputAutoNumeric\r\n                value={this.state.porc}\r\n                onChange={(ev: SyntheticEvent, value: number) => this.onChangeNumericField('porc', ev, value, false)}\r\n                onBlur={(ev: SyntheticEvent, value: number) => this.onChangeNumericField('porc', ev, value, true)}\r\n                disabled={!this.state.factor}\r\n                minimumValue={'0'}\r\n                maximumValue={'100'}\r\n                isEditable={this.props.isEditable}\r\n                className='percent nine wide field'\r\n                id='materialidad_porc'\r\n              />\r\n            </div>\r\n          </div>\r\n          <MaterialidadFieldTotal\r\n            field='porc'\r\n            name='Materialidad de Planeación'\r\n            tooltip={`Las partidas de los estados financieros que superen la cifra de materialidad de planeación deben ser auditadas\r\n            al ser consideradas las partidas de mayor riesgo de errores significativos.\r\n            Determinar una adecuada materialidad de planeación es importante para evitar sub auditar o sobre auditar.`}\r\n            calculateTotal={calculateTotal}\r\n          />\r\n        </Form.Field>\r\n        <Form.Field width={5} className='ui column grid compact' error={!this.state.porc}>\r\n          <div className='box-input six wide column right floated'>\r\n            <div className='box-input-inner'>\r\n              <label htmlFor='materialidad_porc_error' title='% Error Tolerable' className='noqtip'>\r\n                %ET\r\n              </label>\r\n              <InputAutoNumeric\r\n                value={this.state.porc_error}\r\n                onChange={(ev: SyntheticEvent, value: number) => this.onChangeNumericField('porc_error', ev, value)}\r\n                onBlur={(ev: SyntheticEvent, value: number) => this.onChangeNumericField('porc_error', ev, value, true)}\r\n                disabled={!this.state.factor}\r\n                minimumValue={'0'}\r\n                maximumValue={'100'}\r\n                isEditable={this.props.isEditable}\r\n                className='percent eight wide field'\r\n                id='materialidad_porc_error'\r\n              />\r\n            </div>\r\n          </div>\r\n          <MaterialidadFieldTotal\r\n            field='porc_error'\r\n            name='Error Tolerable'\r\n            tooltip={`Error mínimo considero significativo para cualquier partida de los estados financieros.\r\n            Si las diferencias de auditoria superan el Error Tolerable se debe proponer un ajuste contable.`}\r\n            calculateTotal={calculateTotal}\r\n          />\r\n        </Form.Field>\r\n      </Form.Group>\r\n    )\r\n\r\n    let montoSeleccionado = ''\r\n    if (this.state.montos[this.state.factor] && this.state.montos[this.state.factor].valor != null) {\r\n      montoSeleccionado = +this.state.montos[this.state.factor].valor + ''\r\n    }\r\n\r\n    return (\r\n      <Form id='materialidadform'>\r\n        <Form.Group>\r\n          <Form.Field width={5} error={!this.state.factor} className='fieldl'>\r\n            <label htmlFor='materialidad_factor'>\r\n              Factor para cálculo MG <span className='required_field_mark'>*</span>\r\n              <GenericTooltip\r\n                title='Factor seleccionado'\r\n                iconColor='olive'\r\n                wide\r\n                text={\r\n                  <div className='content'>\r\n                    Seleccione el factor financiero que a juicio profesional considere apropiado: <br />\r\n                    a.) El cliente es una entidad orientada a utilidades, se aconseja el factor de resultado del\r\n                    ejercicio, <br />\r\n                    b.) El cliente es una entidad sin animo de lucro, se aconseja el factor de ingresos brutos, gastos\r\n                    operacionales o activos netos, <br />\r\n                    c.) El cliente es una entidad basada en activos, se aconseja el factor de activos netos, <br />\r\n                    d.) Los resultados del ejercicio fluctuan significativamente de un año a otro, se aconseja otros\r\n                    factores como el promedio de los resultados de los ultimos 3 años, <br />\r\n                    e) Cualquier otro factor considerado por el auditor.\r\n                  </div>\r\n                }\r\n              />\r\n            </label>\r\n            <Select\r\n              id='materialiad_factor'\r\n              options={this.getFactoresAsSelectChoices()}\r\n              value={this.state.factor}\r\n              disabled={!this.props.isEditable}\r\n              selectOnNavigation={false}\r\n              onChange={(_, { value }) => this.onSelectChoice('factor', value)}\r\n            />\r\n          </Form.Field>\r\n\r\n          <Form.Field\r\n            width={6}\r\n            className={this.isFactorInvalid() ? 'ui-state-disabled' : ''}\r\n            error={!!this.state.factor && !montoSeleccionado}\r\n          >\r\n            <label htmlFor='materialidad_monto'>\r\n              Monto del Factor <span className='required_field_mark'>*</span>\r\n            </label>\r\n            {this.isFactorInvalid() ? (\r\n              <Popup\r\n                trigger={\r\n                  <div className='input-wrapper'>\r\n                    <input disabled className='ui input' />\r\n                  </div>\r\n                }\r\n                header='Campo deshabilitado'\r\n                content='Este campo se encuentra deshabilitado debido a que es necesario que primero seleccione el factor para el cálculo de la Materialidad General'\r\n                className='disable-text'\r\n                on='hover'\r\n                wide\r\n                position='top center'\r\n              />\r\n            ) : (\r\n              <InputAutoNumeric\r\n                value={montoSeleccionado}\r\n                onChange={(ev: SyntheticEvent, value: number) => this.onChangeMonto(ev, value, false, false)}\r\n                onBlur={(ev: SyntheticEvent, value: number) => this.onChangeMonto(ev, value, false, true)}\r\n                disabled={!this.state.factor}\r\n                isEditable={this.props.isEditable}\r\n                className='currency'\r\n                id='materialiad_monto'\r\n              />\r\n            )}\r\n          </Form.Field>\r\n\r\n          <Form.Field width={5} error={!this.state.nivel} className='fieldr'>\r\n            <label htmlFor='materialidad_nivel'>\r\n              Nivel de Confianza <span className='required_field_mark'>*</span>\r\n              <GenericTooltip\r\n                title='Nivel de confianza'\r\n                iconColor='olive'\r\n                text={\r\n                  <div>\r\n                    Elija el nivel que considere apropiado:<br />\r\n                    <ul style={{ marginLeft: 4, lineHeight: '1em' }} className='unstyled'>\r\n                      <li style={{ marginBottom: 3, marginTop: 4 }}>\r\n                        a.) <strong>Nivel bajo:</strong> para clientes de primer año o auditorias recurrentes con\r\n                        ajustes frecuentes de auditoria,\r\n                      </li>\r\n                      <li style={{ marginBottom: 3, marginTop: 4 }}>\r\n                        b.) <strong>Nivel moderado:</strong> para auditorias recurrentes con pocos ajustes de auditoria,{' '}\r\n                      </li>\r\n                      <li style={{ marginBottom: 3, marginTop: 4 }}>\r\n                        c.) <strong>Nivel alto:</strong> para auditorias recurrentes sin ajustes de auditoria.\r\n                      </li>\r\n                    </ul>\r\n                  </div>\r\n                }\r\n              />\r\n            </label>\r\n            <Select\r\n              id='materialidad_nivel'\r\n              options={this.getNivelesAsSelectChoices()}\r\n              value={this.state.nivel}\r\n              disabled={!this.props.isEditable}\r\n              selectOnNavigation={false}\r\n              onChange={(_, { value }) => this.onSelectChoice('nivel', value)}\r\n            />\r\n          </Form.Field>\r\n        </Form.Group>\r\n        {row2_disabled_text ? (\r\n          <Popup\r\n            trigger={row2}\r\n            content={row2_disabled_text}\r\n            header='Campos deshabilitados'\r\n            className='disable-text'\r\n            on='hover'\r\n            wide\r\n            position='bottom center'\r\n          />\r\n        ) : (\r\n          row2\r\n        )}\r\n\r\n        <Form.Group className={!this.state.factor_justificacion ? 'error' : ''}>\r\n          <div className='ui raised segment' id='segment-materialidad-observaciones'>\r\n            <Form.Field width={16} className='ui column hoverable-actions'>\r\n              <label>\r\n                Documente la Razón de la Selección del Factor y Nivel de Confianza{' '}\r\n                <span className='required_field_mark'>*</span>\r\n              </label>\r\n              <MaterialidadObservacionesEditor\r\n                data={this.state.factor_justificacion}\r\n                attachments={this.state.Attachments}\r\n                isEditable={this.props.isEditable}\r\n                onChangeData={this.onChangeObservaciones}\r\n                onChangeAttachments={this.onChangeAttachments}\r\n              />\r\n            </Form.Field>\r\n          </div>\r\n        </Form.Group>\r\n      </Form>\r\n    )\r\n  }\r\n}\r\n","import { Component } from 'react'\r\nimport EditorPreview from '../global/EditorPreview'\r\nimport { AttachmentListPanel } from '../proyecto__hoja_trabajo/Attachments'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer/Dimmer'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader/Loader'\r\n\r\ndeclare var app: any\r\n\r\ntype MaterialidadObservacionesEditorProps = {\r\n  data: string\r\n  attachments: ProyectoAttachment[]\r\n  onChangeData: (data: string, cb: () => void) => void\r\n  onChangeAttachments: (attachments: ProyectoAttachment[]) => void\r\n  isEditable: boolean\r\n}\r\n\r\ntype MaterialidadObservacionesEditorState = {\r\n  isLoadingAttachments: boolean\r\n}\r\n\r\nexport default class MaterialidadObservacionesEditor extends Component<\r\n  MaterialidadObservacionesEditorProps,\r\n  MaterialidadObservacionesEditorState\r\n> {\r\n  state = {\r\n    isLoadingAttachments: false\r\n  }\r\n\r\n  fetchAttachments(showLoading: boolean = true) {\r\n    if (showLoading) {\r\n      this.setState({ isLoadingAttachments: true })\r\n    }\r\n\r\n    const url = url_for(`proyecto/${app.vars.idproyecto}/hoja-trabajo/attachments`)\r\n    $.ajax(url, {\r\n      type: 'GET',\r\n      data: { model: 'materialidad__obs', model_id: app.vars.current_idvisita },\r\n      dataType: 'json'\r\n    }).done((res) => {\r\n      this.props.onChangeAttachments(res.response.Attachments)\r\n      this.setState({ isLoadingAttachments: false })\r\n    })\r\n  }\r\n\r\n  onUpdateAttachment = () => {\r\n    this.fetchAttachments()\r\n  }\r\n\r\n  onDeleteAttachment = (adjunto: ProyectoAttachment, cb: () => void) => {\r\n    this.setState({ isLoadingAttachments: true })\r\n\r\n    const h = public_path(`uploads/proyecto_adjunto/${adjunto.filepath}`, true).replace(/\\./g, '.').replace(/\\\\/g, '/')\r\n    const t = '<a .*href=\"' + h + '\"(.+?)/a>s*(<br/?>)?'\r\n    const re = new RegExp(t, 'g')\r\n    const data_new = this.props.data.replace(re, '')\r\n\r\n    if ($.isFunction(cb)) {\r\n      cb()\r\n    }\r\n    this.props.onChangeData(data_new, () => this.fetchAttachments())\r\n  }\r\n\r\n  onChangeData = (editor: CKEDITOR.editor, closeModal: boolean, autosave: boolean, cb: () => void) => {\r\n    this.props.onChangeData(editor.getData(), () => {\r\n      if ($.isFunction(cb)) {\r\n        cb()\r\n      }\r\n      this.fetchAttachments()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const ckeditorOptionsObs = {\r\n      uploadUrl: url_for(\r\n        'proyecto/' +\r\n          app.vars.idproyecto +\r\n          '/master_data/paso/' +\r\n          app.vars.idpaso +\r\n          '/upload?id_visita=' +\r\n          app.vars.current_idvisita +\r\n          '&model=materialidad__obs' +\r\n          '&model_id=' +\r\n          app.vars.current_idvisita\r\n      ),\r\n      imageUploadUrl: url_for(\r\n        'proyecto/' +\r\n          app.vars.idproyecto +\r\n          '/master_data/paso/' +\r\n          app.vars.idpaso +\r\n          '/upload?id_visita=' +\r\n          app.vars.current_idvisita +\r\n          '&model=materialidad__obs' +\r\n          '&model_id=' +\r\n          app.vars.current_idvisita\r\n      ),\r\n      filebrowserUploadUrl: url_for(\r\n        'proyecto/' +\r\n          app.vars.idproyecto +\r\n          '/master_data/paso/' +\r\n          app.vars.idpaso +\r\n          '/upload?id_visita=' +\r\n          app.vars.current_idvisita +\r\n          '&n=attachment&model=materialidad__obs' +\r\n          '&model_id=' +\r\n          app.vars.current_idvisita\r\n      )\r\n    }\r\n\r\n    const attachmentsList = (\r\n      <div style={{ position: 'relative' }}>\r\n        <Dimmer inverted active={this.state.isLoadingAttachments}>\r\n          <Loader inverted />\r\n        </Dimmer>\r\n        <AttachmentListPanel\r\n          attachments={this.props.attachments}\r\n          onUpdateItem={this.onUpdateAttachment}\r\n          onDeleteItem={this.onDeleteAttachment}\r\n        />\r\n      </div>\r\n    )\r\n\r\n    return (\r\n      <EditorPreview\r\n        className='observaciones-text-editor'\r\n        ckeditorOptions={ckeditorOptionsObs}\r\n        data={this.props.data}\r\n        required\r\n        label=' '\r\n        labelTitle='Documente la Razón de la Selección del Factor y Nivel de Confianza'\r\n        autosave\r\n        onSave={this.onChangeData}\r\n        editable={this.props.isEditable}\r\n        footer={attachmentsList}\r\n        openOnClickPreview\r\n      />\r\n    )\r\n  }\r\n}\r\n","import { Component, SyntheticEvent } from 'react'\r\nimport cx from 'classnames'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\n\r\nimport { MaterialidadEnums, MaterialidadUtils } from './MaterialidadUtils'\r\nimport HojaTrabajoContext from '../proyecto__hoja_trabajo/HojaTrabajoContext'\r\nimport { HojaTrabajoUpdateUtils } from '../proyecto__hoja_trabajo/utils'\r\nimport InputAutoNumeric from '../global/InputAutoNumeric'\r\n\r\ntype MaterialidadProps = {\r\n  materialidad: ProyectoMaterialidad\r\n  isEditable: boolean\r\n}\r\n\r\ntype MaterialidadPercentTableState = {\r\n  montos: ProyectoMaterialidadMonto\r\n}\r\n\r\nexport default class MaterialidadPercentTable extends Component<MaterialidadProps, MaterialidadPercentTableState> {\r\n  static contextType = HojaTrabajoContext\r\n  context: HojaTrabajoContextType\r\n\r\n  private static changed = new Set()\r\n  constructor(props: MaterialidadProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      montos: props.materialidad ? props.materialidad.montos : {}\r\n    }\r\n  }\r\n\r\n  onChangeMonto(ev: SyntheticEvent, value: number, factor: number, nivel: number, persist: boolean) {\r\n    if (persist && (ev.target as any).value == '') {\r\n      value = MaterialidadUtils.getDefaulPorcMG(factor, nivel)\r\n    }\r\n\r\n    let field: string\r\n    this.setState(\r\n      (state) => {\r\n        let { montos } = state\r\n        if (typeof montos[factor] == 'undefined') {\r\n          montos[factor] = { valor: 0 }\r\n        }\r\n\r\n        const nivel_field = MaterialidadUtils.getNivel(nivel)\r\n\r\n        field = `monto${factor}_${nivel_field}`\r\n\r\n        if (montos[factor][nivel_field] != value) {\r\n          montos[factor][nivel_field] = value\r\n          MaterialidadPercentTable.changed.add(field)\r\n        }\r\n\r\n        montos[factor][nivel_field] = value\r\n\r\n        return { montos }\r\n      },\r\n      () => {\r\n        if (persist && MaterialidadPercentTable.changed.has(field)) {\r\n          this.sendToServer({ field, value })\r\n          MaterialidadPercentTable.changed.delete(field)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  sendToServer(change: any) {\r\n    const materialidad = Object.assign({}, this.props.materialidad, { montos: this.state.montos })\r\n    MaterialidadUtils.sendToServer(this.props.materialidad.Visita.id_visita, change, materialidad, {}, (response) => {\r\n      if (response && response.response.visita) {\r\n        const { hoja_trabajo, update } = this.context\r\n        const visita = this.props.materialidad.Visita\r\n        let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, visita, response.response.visita)\r\n        update(hoja_trabajo_new)\r\n      }\r\n    })\r\n\r\n    const { hoja_trabajo, update } = this.context\r\n    let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, this.props.materialidad.Visita, {\r\n      materialidad\r\n    })\r\n    update(hoja_trabajo_new)\r\n  }\r\n\r\n  getMonto(factor: number, nivel: number) {\r\n    let monto = this.state.montos[factor][MaterialidadUtils.getNivel(nivel)]\r\n    if (monto == null) {\r\n      monto = MaterialidadUtils.getDefaulPorcMG(factor, nivel)\r\n    }\r\n    return monto\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        closeIcon\r\n        trigger={<Button color='orange' floated='left' compact icon='table' content='Tabla de porcentajes' />}\r\n        className='modal-ab'\r\n      >\r\n        <Modal.Header content='Porcentajes y Montos de Materialidades' />\r\n        <Modal.Content>\r\n          <table className='table table-striped table-condensed' id='materialidad-percent-table'>\r\n            <thead>\r\n              <tr className='th1'>\r\n                <th>&nbsp;</th>\r\n                <th colSpan={3}>Porcentajes de Materialidades</th>\r\n                <th colSpan={3}>Montos de Materialidades</th>\r\n              </tr>\r\n              <tr className='th2'>\r\n                <th>Factor</th>\r\n                <th>Máx %</th>\r\n                <th>Moderado %</th>\r\n                <th>Mín %</th>\r\n                <th>Máx</th>\r\n                <th>Moderado</th>\r\n                <th>Mín</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {MaterialidadEnums.factores.map((factor, i) => {\r\n                return (\r\n                  <tr key={`tr-factor-${i}`} className={i + 1 == this.props.materialidad.factor ? 'selected' : ''}>\r\n                    <th className='td-factor'>{factor}</th>\r\n                    {MaterialidadEnums.niveles.map((nivel, j) => {\r\n                      return (\r\n                        <td\r\n                          key={`td-${i}-${j}-1`}\r\n                          className={cx([ 'td-nivel', j + 1 == this.props.materialidad.nivel ? 'selected' : '' ])}\r\n                        >\r\n                          <InputAutoNumeric\r\n                            value={this.getMonto(i + 1, j + 1)}\r\n                            onChange={(ev: SyntheticEvent, value: number) =>\r\n                              this.onChangeMonto(ev, value, i + 1, j + 1, false)}\r\n                            onBlur={(ev: SyntheticEvent, value: number) =>\r\n                              this.onChangeMonto(ev, value, i + 1, j + 1, true)}\r\n                            minimumValue={'0'}\r\n                            maximumValue={'100'}\r\n                            className='percent input-mini'\r\n                            isEditable={this.props.isEditable}\r\n                          />\r\n                        </td>\r\n                      )\r\n                    })}\r\n                    {MaterialidadEnums.niveles.map((nivel, j) => {\r\n                      return (\r\n                        <td\r\n                          key={`td-${i}-${j}-2`}\r\n                          className={cx([\r\n                            'td-total col-numeric',\r\n                            j + 1 == this.props.materialidad.nivel ? 'selected' : ''\r\n                          ])}\r\n                        >\r\n                          {accounting.formatMoney(\r\n                            MaterialidadUtils.calculateTotal('porc_general', this.state, i + 1, j + 1)\r\n                          )}\r\n                        </td>\r\n                      )\r\n                    })}\r\n                  </tr>\r\n                )\r\n              })}\r\n            </tbody>\r\n          </table>\r\n        </Modal.Content>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, Fragment, SyntheticEvent, createRef } from 'react'\r\n\r\nimport Transition from 'semantic-ui-react/dist/commonjs/modules/Transition/Transition'\r\nimport cx from 'classnames'\r\nimport { SidebarPanelHeader } from './panel_header'\r\nimport { DefaultErrorHandler } from '../../global/ErrorHandler'\r\n\r\ntype BaseMenuItemProps = {\r\n  open: boolean\r\n  image: string\r\n  counter: number\r\n  onClick: () => void\r\n  title: string\r\n}\r\n\r\nexport class BaseMenuItem extends PureComponent<BaseMenuItemProps> {\r\n  render() {\r\n    const image_path = public_path('images/sidebar_right/')\r\n\r\n    return (\r\n      <a\r\n        className={cx('item badged', !this.props.open || 'active')}\r\n        title={this.props.title}\r\n        onClick={this.props.onClick}\r\n      >\r\n        <img src={`${image_path}${this.props.image}.svg`} className='ui large image' /> {' '}\r\n        <div className={cx('ui mini circular floating label right', this.props.counter == 0 ? 'green' : 'red')}>\r\n          {this.props.counter}\r\n        </div>\r\n      </a>\r\n    )\r\n  }\r\n}\r\n\r\ntype BaseMenuElementProps = {\r\n  name: string\r\n  counter: number\r\n  title: string\r\n  icon: string\r\n  open: boolean\r\n  onToggle: (item: string) => void\r\n  onMountPanel?: () => void\r\n}\r\n\r\nexport class BaseMenuElement extends PureComponent<BaseMenuElementProps> {\r\n  onToggle = () => {\r\n    this.props.onToggle(this.props.open ? null : this.props.name)\r\n  }\r\n\r\n  onClose = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onToggle(null)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <DefaultErrorHandler>\r\n          <BaseMenuItem\r\n            counter={this.props.counter}\r\n            open={this.props.open}\r\n            title={this.props.title}\r\n            image={this.props.icon}\r\n            onClick={this.onToggle}\r\n          />\r\n          {this.props.open && (\r\n            <Transition.Group animation='slide right' duration={1500}>\r\n              <div\r\n                className={`sidebar-fixed-content ui vertical right fixed menu menu-${this.props.name}`}\r\n                style={{ right: 45 }}\r\n              >\r\n                <SidebarPanelHeader title={this.props.title} onClose={this.onClose} onMount={this.props.onMountPanel} />\r\n                {this.props.children}\r\n              </div>\r\n            </Transition.Group>\r\n          )}\r\n        </DefaultErrorHandler>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport class MenuElementListPanel extends PureComponent<{ className?: string }> {\r\n  listRef = createRef<HTMLDivElement>()\r\n  listHeight: number = null\r\n\r\n  componentDidMount() {\r\n    if (this.listRef.current) {\r\n      this.calculateHeight()\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.listRef.current && !this.listHeight) {\r\n      this.calculateHeight()\r\n    }\r\n  }\r\n\r\n  calculateHeight() {\r\n    const $list = $(this.listRef.current)\r\n    this.listHeight = window.innerHeight - $list.position().top - 30\r\n    $list.height(this.listHeight)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={`main-list ${this.props.className}`} ref={this.listRef}>\r\n        {this.props.children}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype MenuElementListActionsProps = {\r\n  actions: {\r\n    [s: string]: {\r\n      label: string\r\n      permission: string\r\n      callback: (ev: SyntheticEvent) => void\r\n    }\r\n  }\r\n}\r\nexport const MenuElementListActions = (props: MenuElementListActionsProps) => {\r\n  return (\r\n    <div className='pull-right sf_admin_td_actions'>\r\n      <div className='btn-group dropdown-modern'>\r\n        <a className='btn btn-mini dropdown-toggle' data-toggle='dropdown' href='#'>\r\n          <span className='icon-tc-ellipsis-v' />\r\n        </a>\r\n\r\n        <ul className='dropdown-menu pull-right'>\r\n          {_.map(props.actions, (action, key) => {\r\n            return (\r\n              user_has_role_permission(action.permission) && (\r\n                <li key={key}>\r\n                  <a href='#' onClick={action.callback}>\r\n                    {action.label}\r\n                  </a>\r\n                </li>\r\n              )\r\n            )\r\n          })}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"sourceRoot":""}