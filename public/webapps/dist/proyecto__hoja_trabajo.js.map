{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"React\"","webpack:///./src/global/AuthorIconLog.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem.tsx","webpack:///./src/global/StatusButtonAction.tsx","webpack:///./src/global/EditorPreview.tsx","webpack:///./src/proyecto__hoja_trabajo/HojaTrabajoContext.ts","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem__new.tsx","webpack:///./src/proyecto__hoja_trabajo/utils_hallazgo.ts","webpack:///external \"ReactDOM\"","webpack:///./src/proyecto__hoja_trabajo/TabPaneVisita.tsx","webpack:///./src/proyecto__hoja_trabajo/Attachments.tsx","webpack:///./src/proyecto__hoja_trabajo/AppVisitaTab.tsx","webpack:///./src/proyecto__hoja_trabajo/utils.ts","webpack:///./src/global/ErrorHandler.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/ajuste_modal.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_ajuste_context.ts","webpack:///./src/proyecto__hoja_trabajo/utils_ajuste.ts","webpack:///./src/proyecto__hoja_trabajo/utils_truncate.ts","webpack:///./src/proyecto__hoja_trabajo/sidebar/hallazgo_modal.tsx","webpack:///./src/proyecto__hoja_trabajo/index.tsx","webpack:///./src/proyecto__hoja_trabajo/App.tsx","webpack:///./src/proyecto__hoja_trabajo/TableRowInstruccion.tsx","webpack:///./src/global/ButtonEdit.tsx","webpack:///./src/proyecto__hoja_trabajo/TabPaneVisitaBase.tsx","webpack:///./src/proyecto__hoja_trabajo/MenuSidebarVisita.tsx","webpack:///./src/proyecto__hoja_trabajo/TabPaneVisitaModals.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_ajuste.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/panel_header.tsx","webpack:///./src/global/InputAutoNumeric.tsx","webpack:///./src/global/Tooltip.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/ajuste_list.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_hallazgo.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/hallazgo_list.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/hallazgo_edit.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem_revision.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/revision_list.tsx","webpack:///./src/proyecto__hoja_trabajo/sidebar/menuitem__model_manager.ts","webpack:///./src/proyecto__hoja_trabajo/AppPeriodo.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","React","AuthorIconLog","Component","classes","this","props","className","inline","size","iconComp","icon","color","_","log","iconColor","disabled","alertText","Group","corner","item","label","User","sigla","dateTime","Date","ts","format","trigger","position","pinned","Header","Content","map","k","AuthorIconLogEditable","state","isLoading","onClickEdit","ev","preventDefault","setState","style","inverted","active","disableEdit","compact","onClick","editText","content","defaultProps","AuthorIconLogDefaultWrapper","model","alertTextRevisado","fecha_completado","fecha_revision","UpdateLog","RevisionLog","BaseMenuItem","PureComponent","image_path","public_path","open","title","src","image","counter","BaseMenuElement","onToggle","onClose","Fragment","DefaultErrorHandler","animation","duration","right","SidebarPanelHeader","onMount","onMountPanel","children","MenuElementListPanel","listRef","createRef","listHeight","current","calculateHeight","$list","$","innerHeight","top","height","ref","data-toggle","href","actions","action","user_has_role_permission","permission","callback","CompletadoButtonAction","completado_disabled_text","disableText","primary","header","on","RevisadoButtonAction","showAlert","revisado_disabled_text","record","icon_revisado_alert","StatusButtonGroupActions","prepend","completado","revisado","append","wrapperClassName","hideLabel","str","dasherize","status","toLowerCase","CKEDITOR_OPTIONS","basic","toolbar","groups","items","autoParagraph","removePlugins","extraPlugins","EditorPreview","previewRef","handleEscape","e","getCode","Escape","CKEDITOR","dialog","getCurrent","onChange","evt","onSave","editor","_cachedEditor","autosave","autosaveId","setTimeout","AUTOSAVE_DELAY","isModalEditOpen","clearTimeout","isFunction","getEditor","isAutosaving","fetchAttachments","onCancel","clearInterval","onModalMount","sub","pool","attachments","ckeditor","onClickPreview","openOnClickPreview","onUpdateAttachment","onDeleteAttachment","adjunto","cb","isLoadingAttachments","cleanAttachmentFrom","setData","ckeditorComp","editable","required","trim","getData","bootbox","alert","nextProps","find","each","attr","ckeditorOptions","ckeditorUploadOptions","defaultUrl","app","vars","idproyecto","url","modelId","uploadUrl","url_for","imageUploadUrl","filebrowserUploadUrl","getJSON","model_id","done","res","response","self","assign","enterMode","ENTER_BR","openlink_modifier","onAttachmentUpload","replace","rs","JSON","parse","console","forEach","uploaded","insertHtml","fileName","error","hide","onUpload","ckeditor_comp","parseCkeditorOptions","fileUploadRequest","loader","fileLoader","unblockUI","blockUI","message","fileUploadResponse","fire","paste","dataValue","footer","AttachmentListPanel","onUpdateItem","onDeleteItem","classNames","closeIcon","closeOnDimmerClick","dimmer","closeOnEscape","renderEditor","Actions","leftActions","labelTitle","dangerouslySetInnerHTML","__html","minHeight","config","getCkeditorOptions","onInstanceReady","readOnly","renderFooter","preview","prefixPreview","previewStyle","renderModal","createContext","hoja_trabajo","update","MenuItemNew","modalOpen","onCloseModal","then","isEditable","MenuItemModal","contentAs","buttonText","headerText","moduleParams","marginBottom","paddingTop","fontWeight","HallazgoUtils","formatName","match","ReactDOM","TabPaneVisita","onClickAddInstruccion","visita","instructions","local_id","uuid","v1","category","description","Attachments","is_done","Visita","updated_at","recalculateProgress","isAllowedSortInstructions","id","tableDnDUpdate","onUpdateInstruccion","instruccion","onRemoveInstruccion","filter","text","padLeft","progress","calculateProgress","id_status","openAsignarUsuarioModal","$table","floatThead","isAllowedAddInstructions","tableDnD","dragHandle","onDragClass","onDragStop","table","serialize","rows","rowId","substr","HojaTrabajo","proyecto","ajax","type","sort","id_paso","paso","id_visita","dataType","done_count","_item","Math","round","includes","code","menuSidebarActionItems","_ajustes","_history","instructions_add","link","Pane","percent","actionItems","PasoObjetivoPane","stackable","Row","HeaderCell","colSpan","Body","renderInstrucciones","floated","renderStatusActions","Cell","textAlign","marginTop","index","instructionGroups","values","groupBy","instruccionGroup","iteration","isSortable","onUpdate","onRemove","onUpdateVisita","h","filepath","re","RegExp","AttachmentListItem","attachment","id_proyecto","warningConfirm","onDelete","fail","pnotify","capitalize","completadoComp","revisadoComp","revisadoLink","display","minWidth","marginRight","fecha_revisado","user_has_role","marginLeft","changeStatus","background","borderRadius","border","borderRight","getFileIconUrl","filename","alt","padding","fontSize","maxWidth","whiteSpace","overflow","textOverflow","fontStyle","filesize_human","target","split","pop","file","extension","getFileExtension","file_icon","circular","divided","AppVisitaDefaultTab","status_label","backgroundColor","status_color","underscored","getStatusLabel","onChangeValue","objetivo","context","create_blockUI_loading_message","hoja_trabajo_new","HojaTrabajoUpdateUtils","updateField","contextType","PasoVisitaStatusActions","onClickCompletado","op","hasErrors","updateVisita","onClickRevisado","include","completadoDisabledText","additionals","revisiones","revisadoDisabledText","_visita","getRevisadoDisabledText","fitted","PasoVisitaAssoc","newVisitaOpen","selectedVisitas","visitas","icons","moveLeft","moveAllLeft","moveRight","moveAllRight","moveDown","moveUp","options","method","availableLabel","selectedLabel","selected","horizontal","Title","Field","placeholder","getModal","HojaTrabajoUtils","getAllVisitasAfter","visitaPivot","found","new_data","hoja_trabajo_copy","mapValues","updateVisitas","visita_new_data","findWhere","field","hasError","errorInfo","isLocalhost","location","host","errorMessage","AjusteModal","onChangeAplicado","aplicado","isNewItem","onChangeDescripcion","descripcion","onAddItem","prevState","createAjusteEmpty","itemIndex","reject","notify","blockingText","any","onCreate","_onCreate","onCreateAndCompletado","onCompletado","onRevisado","idx","reduce","acc","curr","num","debe","haber","changes","validateItems","MenuItemNewHeader","Consumer","cuentas","row","AjusteTableRow","canRemove","onClickDelete","esPlanillaDescuadrada","revisadoDisableText","rightActions","renderItemHeader","renderRows","accounting","formatNumber","error_tolerable","GenericTooltip","renderActions","confirm","onSelectCuenta","cuenta","nombre_cuenta","notifyUpdate","onChangeCuenta","onChangeNombreCuenta","onBlurCuenta","getNombreCuenta","toUpperCase","onChangeInput","persist","getItemValue","renderItem","isHighlighted","onSelect","inputProps","spellCheck","onBlur","shouldItemRender","startsWith","renderMenu","zIndex","wrapperProps","wrapperStyle","normalize","contains","input","v","parseFloat","isNaN","cleanCuenta","cuenta_real","cleanSpacesFromHtml","html","keepImageTag","registerLocale","HallazgoModal","handlers","onEditorChange","attachHandler","closeModal","updateModel","onInputChange","onDateChange","onValueChange","handler","date","isValid","implementado","isEmpty","hallazgo","attach_disableText","overflowY","maxHeight","width","plan_accion","htmlFor","HallazgoResponsableInput","responsable","attrs","dateFormat","locale","fixedHeight","placeholderText","getDate","fecha_implementado","formatImplementadoChoice","mentionStyle","suggestions","list","borderBottom","event","newValue","newPlainTextValue","mentions","users","proyecto_equipo","user","user_id","MentionsInput","singleLine","allowSpaceInQuery","Mention","appendSpaceOnAdd","settings","number","precision","thousand","decimal","tipo","render","document","getElementById","App","handleClick","activeIndex","current_idvisita","hash","showModal","assocModalOpen","onChangeVisita","onChangeApp","visita_current","locationHash","is_current","tabWidth","panes","css","urlToAppend","isAllowedAsociarVisita","isOpen","getUrlFor","assocModal","getAssocModal","menuItem","Item","pane","Provider","renderActiveOnly","TableRowInstruccion","evalIsDone","answer","observations","checkIsDoneDisabled","onChecked","checked","onActionChanged","onChangeEditor","isEditorOpen","onClickAttachmentCell","String","getFormattedIteration","observaciones","cleanHtml","modified_data","doUpdateModel","sendInstructionToServer","params_data","changed","showLoading","actionChoices","formattedDescription","getFormattedDescription","ckeditorOptionsInstr","link_to_muestreo_enabled","ckeditorOptionsObs","attachmentsList","modalLeftActions","negative","collapsing","clearable","getFormattedObservations","floating","direction","Menu","buttonProps","TabPaneVisitaBase","loadingMessage","instrucciones","isArray","rest","instruccion_mdata","cmd","modelLabel","getCompletadoDisabledText","MenuSidebarVisita","panelOpen","onItemOpen","closeAllPanel","HojaTrabajoAsignarVisitaModal","id_asignado","paso_id_usuario","has_parent","id_parent","url_base","counters","fixed","vertical","actionItem","_onClick","isActionItemEnabled","renderAsignUserModal","HojaTrabajoHistoryModal","MenuItemAjuste","ajustes","onOpen","modelManager","MenuItemHallazgo","HallazgoHojaTrabajoModelManager","getInstance","hallazgos","as","muestreos","MenuItemRevision","RevisionHojaTrabajoModelManager","id_usuario_asignado","equipo","rol","is_assignable","equipoOptions","defaultValue","selection","fluid","parseAjustes","_row","col","valor","id_proyecto_visita","pick","onCreateItem","Promise","resolve","post","onSaveItem","onClickDeleteItem","itemNew","fill","Array","AjusteList","es_proyecto_editable","renderContent","decimalPlaces","decimalCharacter","decimalCharacterAlternative","digitGroupSeparator","allowDecimalPadding","selectOnFocus","texts","wide","iconSize","AjusteListItem","isModalEdit","onCloseEdit","MenuElementListActions","edit","delete","StatusDivBlock","subitem","truncateText","AjusteModalEdit","isNumber","getJson","createItem","addItem","updateItem","saveItem","updatedItem","deleteItem","HallazgoList","HallazgoListItem","isEqual","renderEstadoImplementacion","renderDescripcion","HallazgoModalEdit","parseItems","params","revision_text","revision","RevisionNewForm","onSubmit","isEditMode","onTextareaKeyDown","keyCode","ctrlKey","metaKey","onClickNew","alertError","minRows","maxRows","autoFocus","onKeyDown","RevisionList","porRevisarItems","revisadoItems","RevisionListItem","RevisionDisabledList","collapsed","toggle","isThreadOpen","onClickNewComment","onCancelNewComment","onClickChangeStatus","onAddComment","comment","aria-hidden","float","Creator","RevisionEditForm","lineHeight","empty","Comments","dividing","green","olive","comentario","RevisionComentarioForm","parentItem","cancelTimeout","url_for2","instance","paso_visita","item_id","hojaTrabajoContext","AppPeriodo","onClickActionElement","prompt","addClass","head","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre","to","from","Tab","shortVisitaName","Panel","sortBy","DragHandle","SortableHandle","SortElement","SortableElement","SortableList","SortableContainer","lockAxis","helperClass","useDragHandle","onSortEnd","oldIndex","newIndex","array","sorted","arrayMoveMutate","neworder","helperContainer","margin","Tabs","onTabChange","showModalButton","modalHeader","modalContent","renderModalContent","TabList","renderTab","PanelList","renderPanel"],"mappings":"4BACE,SAASA,EAAqBC,GAQ7B,IAPA,IAMIC,EAAUC,EANVC,EAAWH,EAAK,GAChBI,EAAcJ,EAAK,GACnBK,EAAiBL,EAAK,GAIHM,EAAI,EAAGC,EAAW,GACpCD,EAAIH,EAASK,OAAQF,IACzBJ,EAAUC,EAASG,GAChBG,OAAOC,UAAUC,eAAeC,KAAKC,EAAiBX,IAAYW,EAAgBX,IACpFK,EAASO,KAAKD,EAAgBX,GAAS,IAExCW,EAAgBX,GAAW,EAE5B,IAAID,KAAYG,EACZK,OAAOC,UAAUC,eAAeC,KAAKR,EAAaH,KACpDc,EAAQd,GAAYG,EAAYH,IAKlC,IAFGe,GAAqBA,EAAoBhB,GAEtCO,EAASC,QACdD,EAASU,OAATV,GAOD,OAHAW,EAAgBJ,KAAKK,MAAMD,EAAiBb,GAAkB,IAGvDe,IAER,SAASA,IAER,IADA,IAAIC,EACIf,EAAI,EAAGA,EAAIY,EAAgBV,OAAQF,IAAK,CAG/C,IAFA,IAAIgB,EAAiBJ,EAAgBZ,GACjCiB,GAAY,EACRC,EAAI,EAAGA,EAAIF,EAAed,OAAQgB,IAAK,CAC9C,IAAIC,EAAQH,EAAeE,GACG,IAA3BX,EAAgBY,KAAcF,GAAY,GAE3CA,IACFL,EAAgBQ,OAAOpB,IAAK,GAC5Be,EAASM,EAAoBA,EAAoBC,EAAIN,EAAe,KAItE,OAAOD,EAIR,IAAIQ,EAAmB,GAKnBhB,EAAkB,CACrBiB,EAAG,GAGAZ,EAAkB,GAGtB,SAASS,EAAoB1B,GAG5B,GAAG4B,EAAiB5B,GACnB,OAAO4B,EAAiB5B,GAAU8B,QAGnC,IAAIC,EAASH,EAAiB5B,GAAY,CACzCK,EAAGL,EACHgC,GAAG,EACHF,QAAS,IAUV,OANAhB,EAAQd,GAAUW,KAAKoB,EAAOD,QAASC,EAAQA,EAAOD,QAASJ,GAG/DK,EAAOC,GAAI,EAGJD,EAAOD,QAKfJ,EAAoBO,EAAInB,EAGxBY,EAAoBQ,EAAIN,EAGxBF,EAAoBS,EAAI,SAASL,EAASM,EAAMC,GAC3CX,EAAoBY,EAAER,EAASM,IAClC5B,OAAO+B,eAAeT,EAASM,EAAM,CAAEI,YAAY,EAAMC,IAAKJ,KAKhEX,EAAoBgB,EAAI,SAASZ,GACX,oBAAXa,QAA0BA,OAAOC,aAC1CpC,OAAO+B,eAAeT,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DrC,OAAO+B,eAAeT,EAAS,aAAc,CAAEe,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKzC,OAAO0C,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBzC,OAAO+B,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBS,EAAEc,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAStB,GAChC,IAAIM,EAASN,GAAUA,EAAOiB,WAC7B,WAAwB,OAAOjB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAL,EAAoBS,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRX,EAAoBY,EAAI,SAASgB,EAAQC,GAAY,OAAO/C,OAAOC,UAAUC,eAAeC,KAAK2C,EAAQC,IAGzG7B,EAAoB8B,EAAI,GAExB,IAAIC,EAAaC,OAAgC,wBAAIA,OAAgC,yBAAK,GACtFC,EAAmBF,EAAW5C,KAAKuC,KAAKK,GAC5CA,EAAW5C,KAAOf,EAClB2D,EAAaA,EAAWG,QACxB,IAAI,IAAIvD,EAAI,EAAGA,EAAIoD,EAAWlD,OAAQF,IAAKP,EAAqB2D,EAAWpD,IAC3E,IAAIU,EAAsB4C,EAM1B,OAFA1C,EAAgBJ,KAAK,CAAC,IAAI,IAEnBM,I,kBCvJTY,EAAOD,QAAU+B,O,+JCEjB,WACA,UAEA,WACA,WACA,YACA,WACA,Y,ytCAEaC,E,wFAAsB,EAAAC,W,oCAE/B,IAAIC,EAA6B,CAAE,mBAE/BC,KAAKC,MAAMC,WACbH,EAAQnD,KAAKoD,KAAKC,MAAMC,WAEtBF,KAAKC,MAAME,QACbJ,EAAQnD,KAAK,UAGfmD,GAAU,aAAWA,EAASC,KAAKC,MAAMG,MAEzC,IAiBIC,EAjBAC,EACF,oBAAC,UAAD,CACEnC,KAAK,cACLiC,KAAMJ,KAAKC,MAAMG,KACjBG,MAAiC,GAA1BC,EAAEJ,KAAKJ,KAAKC,MAAMQ,KAAY,KAAOT,KAAKC,MAAMS,UACvDC,SAAoC,GAA1BH,EAAEJ,KAAKJ,KAAKC,MAAMQ,OAahC,GAVIT,KAAKC,MAAMW,YACbN,EACE,oBAAC,UAAKO,MAAN,KACGP,EACD,oBAAC,UAAD,CAAMQ,OAAO,YAAYP,MAAM,MAAMpC,KAAK,qBAM3C6B,KAAKC,MAAME,OAOT,CACL,IAAMY,EAAyB,MAAlBf,KAAKC,MAAMQ,IAAc,KAAOT,KAAKC,MAAMQ,IAAI,GAC5DJ,EACE,+BACGL,KAAKC,MAAMe,OAAS,4BAAMd,UAAU,MAAMF,KAAKC,MAAMe,OACrDV,EACAN,KAAKC,MAAMW,WACV,4BAAMV,UAAU,cACd,oBAAC,UAAD,CAAMK,MAAM,MAAMpC,KAAK,mBADzB,IAC8C6B,KAAKC,MAAMW,WAG1DG,GACC,2BAAKb,UAAU,qBACb,2BAAKA,UAAU,cAAca,EAAKE,KAAKC,OACvC,4BAAMC,SAAUC,KAAKnC,OAAO8B,EAAKM,IAAIC,OAAO,qBACzCF,KAAKnC,OAAO8B,EAAKM,IAAIC,OAAO,4BArBvCjB,EACE,+BACGL,KAAKC,MAAMe,OAAS,4BAAMd,UAAU,MAAMF,KAAKC,MAAMe,OACrDV,GA0BP,OACE,2BAAKJ,UAAWH,GACd,oBAAC,UAAD,CACEwB,QAASlB,EACTmB,SAAS,gBACTtB,UAAU,wBACVuB,QAAM,EACNrB,KAAMJ,KAAKC,MAAMG,MAEjB,oBAAC,UAAMsB,OAAP,KACG1B,KAAKC,MAAM9B,KACX6B,KAAKC,MAAMW,WACV,2BAAKV,UAAU,cACb,oBAAC,UAAD,CAAMK,MAAM,MAAMpC,KAAK,mBADzB,IAC8C6B,KAAKC,MAAMW,YAI7D,oBAAC,UAAMe,QAAP,KACqB,MAAlB3B,KAAKC,MAAMQ,IACV,2BAAKP,UAAU,SAAf,mBAEA,6BAAOA,UAAU,gBACf,iCACGF,KAAKC,MAAMQ,IAAImB,IAAI,SAACb,EAAMc,GACzB,OACE,0BAAI3C,IAAK2C,GACP,8BACGvB,EADH,IACUS,EAAKE,KAAK9C,KADpB,KAC4B4C,EAAKE,KAAKC,MADtC,KAGA,8BACE,8BAAKE,KAAKnC,OAAO8B,EAAKM,IAAIC,OAAO,kC,2BAe9CQ,E,YAAb,qC,sCACEC,MAAQ,CACNC,WAAW,GAOb,EAAAC,YAAc,SAACC,GACbA,EAAGC,iBACH,EAAKC,SAAS,CAAEJ,WAAW,IAC3B,EAAK/B,MAAMgC,eAZf,E,WAA2C,EAAAnC,W,oCAgBvC,IAAIC,EAA6B,CAAE,mBAE/BC,KAAKC,MAAMC,WACbH,EAAQnD,KAAKoD,KAAKC,MAAMC,WAG1BH,GAAU,aAAWA,EAASC,KAAKC,MAAMG,MAEzC,IAAME,EACJ,oBAAC,UAAD,CACEnC,KAAK,cACLiC,KAAMJ,KAAKC,MAAMG,KACjBG,MAAyB,MAAlBP,KAAKC,MAAMQ,IAAc,KAAOT,KAAKC,MAAMS,UAClDC,SAA4B,MAAlBX,KAAKC,MAAMQ,MAInBJ,EACJ,2BAAKgC,MAAO,CAAEb,SAAU,aACtB,oBAAC,UAAD,CAAQc,UAAQ,EAACC,OAAQvC,KAAK+B,MAAMC,WAClC,oBAAC,UAAD,CAAQM,UAAQ,KAEjBtC,KAAKC,MAAMe,OAAS,4BAAMd,UAAU,MAAMF,KAAKC,MAAMe,OACrDV,EACD,oBAAC,UAAD,CACEJ,UAAU,cACVS,SAAUX,KAAKC,MAAMuC,YACrBC,SAAO,EACPrC,KAAK,OACLG,MAAOP,KAAKC,MAAMS,UAClBgC,QAAS1C,KAAKiC,aAEbjC,KAAKC,MAAM0C,WAKlB,OACE,2BAAKzC,UAAWH,GACd,oBAAC,UAAD,CAAOwB,QAASlB,EAAUmB,SAAS,gBAAgBC,QAAM,EAACrB,KAAMJ,KAAKC,MAAMG,MACzE,oBAAC,UAAMsB,OAAP,CAAckB,QAAS5C,KAAKC,MAAM9B,OAClC,oBAAC,UAAMwD,QAAP,KACqB,MAAlB3B,KAAKC,MAAMQ,IACV,2BAAKP,UAAU,SAAf,mBAEA,6BAAOA,UAAU,gBACf,iCACGF,KAAKC,MAAMQ,IAAImB,IAAI,SAACb,EAAMc,GACzB,OACE,0BAAI3C,IAAK2C,GACP,8BACGvB,EADH,IACUS,EAAKE,KAAK9C,KADpB,KAC4B4C,EAAKE,KAAKC,MADtC,KAGA,8BACE,8BAAKE,KAAKnC,OAAO8B,EAAKM,IAAIC,OAAO,kC,+BAjElD,EAAAuB,aAAe,CACpBL,aAAa,G,IAqFJM,E,wFAAoC,EAAAhD,W,oCACzC,IACIiD,EAAU/C,KAAKC,MAAf8C,MAEFC,EACJD,EAAME,kBACNF,EAAMG,gBACN9B,KAAKnC,OAAO8D,EAAME,kBAAoB7B,KAAKnC,OAAO8D,EAAMG,gBACpD,iCACA,KAEN,OACE,2BAAKhD,WAAW,aAAW,0BAA2BF,KAAKC,MAAMG,KAAMJ,KAAKC,MAAMC,YAChF,oBAACL,EAAD,CAAeY,IAAKsC,EAAMI,UAAWhF,KAAK,gBAAgB6C,MAAM,IAAIN,UAAU,QAAQN,KAAMJ,KAAKC,MAAMG,OACvG,oBAACP,EAAD,CACEY,IAAKsC,EAAMK,YACXjF,KAAK,eACL6C,MAAM,IACNN,UAAU,QACVN,KAAMJ,KAAKC,MAAMG,KACjBQ,UAAWoC,S,gNCpOrB,WAEA,YACA,UACA,SACA,S,ytCAUaK,E,wFAAqB,EAAAC,e,oCAE9B,IAAMC,EAAaC,YAAY,yBAE/B,OACE,yBACEtD,WAAW,aAAG,eAAgBF,KAAKC,MAAMwD,MAAQ,UACjDC,MAAO1D,KAAKC,MAAMyD,MAClBhB,QAAS1C,KAAKC,MAAMyC,SAEpB,2BAAKiB,IAAG,UAAKJ,GAAL,OAAkBvD,KAAKC,MAAM2D,MAA7B,QAA0C1D,UAAU,mBAL9D,IAKmF,IACjF,2BAAKA,WAAW,aAAG,wCAA+D,GAAtBF,KAAKC,MAAM4D,QAAe,QAAU,QAC7F7D,KAAKC,MAAM4D,c,0BAiBTC,E,YAAb,qC,sCACEC,SAAW,WACT,EAAK9D,MAAM8D,SAAS,EAAK9D,MAAMwD,KAAO,KAAO,EAAKxD,MAAM9B,OAG1D,EAAA6F,QAAU,SAAC9B,GACTA,EAAGC,iBACH,EAAKlC,MAAM8D,SAAS,OAPxB,E,WAAqC,EAAAT,e,oCAWjC,OACE,oBAAC,EAAAW,SAAD,KACE,oBAAC,EAAAC,oBAAD,KACE,oBAACb,EAAD,CACEQ,QAAS7D,KAAKC,MAAM4D,QACpBJ,KAAMzD,KAAKC,MAAMwD,KACjBC,MAAO1D,KAAKC,MAAMyD,MAClBE,MAAO5D,KAAKC,MAAMK,KAClBoC,QAAS1C,KAAK+D,WAEf/D,KAAKC,MAAMwD,MACV,oBAAC,UAAW5C,MAAZ,CAAkBsD,UAAU,cAAcC,SAAU,MAClD,2BACElE,UAAS,kEAA6DF,KAAKC,MAAM9B,MACjFkE,MAAO,CAAEgC,MAAO,KAEhB,oBAAC,EAAAC,mBAAD,CAAoBZ,MAAO1D,KAAKC,MAAMyD,MAAOM,QAAShE,KAAKgE,QAASO,QAASvE,KAAKC,MAAMuE,eACvFxE,KAAKC,MAAMwE,iB,6BAUfC,E,YAAb,qC,sCACEC,SAAU,IAAAC,aACV,EAAAC,WAAqB,KAFvB,E,WAA0C,EAAAvB,e,+CAKlCtD,KAAK2E,QAAQG,SACf9E,KAAK+E,oB,2CAKH/E,KAAK2E,QAAQG,UAAY9E,KAAK6E,YAChC7E,KAAK+E,oB,wCAKP,IAAMC,EAAQC,EAAEjF,KAAK2E,QAAQG,SAC7B9E,KAAK6E,WAAapF,OAAOyF,YAAcF,EAAMxD,WAAW2D,IAAM,GAC9DH,EAAMI,OAAOpF,KAAK6E,c,+BAIlB,OACE,2BAAK3E,UAAS,oBAAeF,KAAKC,MAAMC,WAAamF,IAAKrF,KAAK2E,SAC5D3E,KAAKC,MAAMwE,c,uDAekB,SAACxE,GACrC,OACE,2BAAKC,UAAU,kCACb,2BAAKA,UAAU,6BACb,yBAAGA,UAAU,+BAA+BoF,cAAY,WAAWC,KAAK,KACtE,4BAAMrF,UAAU,wBAGlB,0BAAIA,UAAU,4BACXM,EAAEoB,IAAI3B,EAAMuF,QAAS,SAACC,EAAQvG,GAC7B,OACEwG,yBAAyBD,EAAOE,aAC9B,0BAAIzG,IAAKA,GACP,yBAAGqG,KAAK,IAAI7C,QAAS+C,EAAOG,UACzBH,EAAOzE,e,qLCxI5B,WAEA,WACA,WAEA,U,ytCAYa6E,E,wFAA+B,EAAAvC,e,oCAExC,IAAMwC,EAA2B9F,KAAKC,MAAM8F,YAE5C,OACE,oBAAC,UAAD,CACExE,QACE,2BAAKrB,UAAU,kBACb,oBAAC,UAAD,CAAQ8F,SAAO,EAAC1F,MAAI,EAACmC,SAAO,EAACC,QAAS1C,KAAKC,MAAMyC,QAAS/B,SAAsC,MAA5BmF,GACjE,IACD,yBAAG5F,UAAU,eAFf,gBAMJ0C,QAASkD,EACTG,OAAO,gDACPtF,SAAsC,MAA5BmF,EACV5F,UAAU,eACVgG,GAAG,c,oCAMEC,E,wFAA6B,EAAA7C,e,oCAEtC,IASI8C,EATAC,EAAyBrG,KAAKC,MAAM8F,YAUxC,GARE,MAACM,GACDrG,KAAKC,MAAMqG,SACVtG,KAAKC,MAAMqG,OAAOrD,mBAEnBoD,EAAyB,+EAIG,OAAzBrG,KAAKC,MAAMmG,gBAAsD,IAAzBpG,KAAKC,MAAMmG,YAA8BpG,KAAKC,MAAMqG,OAO/FF,EAAYpG,KAAKC,MAAMmG,cAPgF,CACvG,IAAME,EAAStG,KAAKC,MAAMqG,OAC1BF,EACEE,EAAOrD,kBACPqD,EAAOpD,gBACP9B,KAAKnC,OAAOqH,EAAOrD,kBAAoB7B,KAAKnC,OAAOqH,EAAOpD,gBAK9D,IAAMqD,EAAsBH,EAC1B,oBAAC,UAAD,CACE7E,QAAS,yBAAGrB,UAAU,4BACtB0C,QAAS,8DAET,KAEJ,OACE,oBAAC,UAAD,CACErB,QACE,2BAAKrB,UAAU,kBACb,oBAAC,UAAD,CAAQK,MAAM,QAAQD,MAAI,EAACmC,SAAO,EAACC,QAAS1C,KAAKC,MAAMyC,QAAS/B,SAAoC,MAA1B0F,GACvE,IACD,yBAAGnG,UAAU,sBACb,yBAAGA,UAAU,eAHf,aAGyCqG,IAI7C3D,QAASyD,EACTJ,OAAO,8CACPtF,SAAoC,MAA1B0F,EACVnG,UAAU,eACVgG,GAAG,c,kCAaEM,E,wFAAiC,EAAAlD,e,oCAE1C,OACE,2BAAKpD,UAAU,6BACZF,KAAKC,MAAMwG,QACXf,yBAAyB1F,KAAKC,MAAMyG,WAAWf,aAC9C,oBAACE,EAA2B7F,KAAKC,MAAMyG,YAExChB,yBAAyB1F,KAAKC,MAAM0G,SAAShB,aAAe,oBAACQ,EAAyBnG,KAAKC,MAAM0G,UACjG3G,KAAKC,MAAM2G,Y,mDAaU,SAAC3G,GAC7B,OACE,2BAAKC,WAAW,aAAG,oBAAqBD,EAAM4G,oBAC1C5G,EAAM6G,WAAa,UACrB,2BAAK5G,WAAW,aAAGD,EAAMC,UAAW,YAApB,oBAA8CM,EAAEuG,IAAIC,UAAU/G,EAAMgH,OAAOC,kBACxFjH,EAAMgH,QAAU,O,mGC7HzB,WAEA,WAEA,SACA,YACA,YACA,UAEA,YACA,S,01BAIA,IAAME,EAAwB,CAC5BC,MAAO,CACLhC,OAAQ,IACRiC,QAAS,CACP,CAAElJ,KAAM,cAAemJ,OAAQ,CAAE,cAAe,WAAaC,MAAO,CAAE,OAAQ,WAC9E,CACEpJ,KAAM,YACNmJ,OAAQ,CAAE,OAAQ,SAAU,SAAU,QAAS,QAC/CC,MAAO,CAAE,eAAgB,eAAgB,IAAK,UAAW,SAAU,IAAK,eAG5EC,eAAe,EACfC,cAAe,iDACfC,aAAc,aAIGC,E,YAmBnB,WAAY1H,GAAyB,a,4FAAA,UACnC,wBAAMA,KAhBA2H,YAAa,IAAAhD,aA2BrB,EAAAiD,aAAe,SAACC,GACV,UAAYC,QAAQD,KAAO,UAAYE,SAEnB,oBAAbC,UAA4D,MAAhCA,SAASC,OAAOC,cAKvD,EAAKnE,YAeP,EAAAoE,SAAW,SAACC,GACN,EAAKpI,MAAME,QACb,EAAKF,MAAMqI,OAAOD,EAAIE,QAAQ,GAAO,GAGlC,EAAKC,gBACR,EAAKA,cAAgBH,EAAIE,QAGtB,EAAKtI,MAAMwI,WAIX,EAAKC,aACR,EAAKA,WAAaC,WAAW,EAAKF,SAAyC,IAA/Bd,EAAciB,mBAI9D,EAAA3G,YAAc,SAACC,GACbA,EAAGC,iBACH,EAAKC,SAAS,CAAEyG,iBAAiB,EAAM7G,WAAW,KAGpD,EAAAsG,OAAS,WACH,EAAKI,aACPI,aAAa,EAAKJ,YAClB,EAAKA,WAAa,MAGhBzD,EAAE8D,WAAW,EAAK9I,MAAMqI,SAC1B,EAAKrI,MAAMqI,OAAO,EAAKU,aAAa,GAAM,EAAO,WAC/C,EAAK5G,SAAS,CAAE6G,cAAc,IAC9B,EAAKC,qBAGP,EAAK9G,SAAS,CAAEyG,iBAAiB,MAEjC,EAAKzG,SAAS,CAAEyG,iBAAiB,EAAOI,cAAc,IACtD,EAAKC,qBAIT,EAAAC,SAAW,WACT,EAAK/G,SAAS,CAAEyG,iBAAiB,IAC7B5D,EAAE8D,WAAW,EAAK9I,MAAM+D,UAC1B,EAAK/D,MAAM+D,WAIf,EAAAA,QAAU,WACJ,EAAK0E,aACPU,cAAc,EAAKV,YACnB,EAAKA,WAAa,MAGpB,EAAKtG,SAAS,CAAEyG,iBAAiB,IAC7B5D,EAAE8D,WAAW,EAAK9I,MAAM+D,UAC1B,EAAK/D,MAAM+D,WAIf,EAAAqF,aAAe,WACb,WAAWC,IAAI,UAAW,EAAKzB,aAAc,CAAE0B,KAAM,YAEvB,MAA1B,EAAKxH,MAAMyH,aACb,EAAKN,oBAIT,EAAAT,SAAW,WACT,EAAKrG,SAAS,CAAE6G,cAAc,IAC9B,IAAIQ,EAAW,EAAKT,YACJ,MAAZS,IACF,EAAKxJ,MAAMqI,OAAOmB,GAAU,GAAO,EAAM,kBAAM,EAAKrH,SAAS,CAAE6G,cAAc,MAC7E,EAAKC,oBAGH,EAAKR,aACPU,cAAc,EAAKV,YACnB,EAAKA,WAAa,OAmCtB,EAAAgB,eAAiB,SAACxH,GACZ,EAAKjC,MAAMyJ,gBACb,EAAKzJ,MAAMyJ,eAAexH,GAGxB,EAAKjC,MAAM0J,oBACb,EAAKvH,SAAS,CAAEyG,iBAAiB,KA2CrC,EAAAe,mBAAqB,WACnB,EAAKV,oBAGP,EAAAW,mBAAqB,SAACC,EAA6BC,GACjD,EAAK3H,SAAS,CAAE4H,sBAAsB,IAEtC,IAAMlO,GAAO,IAAAmO,qBAAoB,EAAKhK,MAAMnE,KAAMgO,GAE9C7E,EAAE8D,WAAWgB,IACfA,IAGF,IAAIN,EAAW,EAAKT,YAChBS,IACFA,EAASS,QAAQpO,GACjB,EAAK2M,aAnNP,EAAK1G,MAAQ,CACX8G,gBAAiB,EAAK5I,MAAMwD,KAC5BwF,cAAc,EACdjH,WAAW,EACXwH,YAAa,KACbQ,sBAAsB,GARW,E,sPAnBI,EAAA1G,e,0CA2CvC,OAAyB,MAArBtD,KAAKmK,aACCnK,KAAKmK,aAAqB5B,OAGhCvI,KAAKwI,cACAxI,KAAKwI,cAGP,O,uCAuFP,IAAKxI,KAAKC,MAAMmK,SACd,OAAO,EAET,IAAKpK,KAAKC,MAAMoK,SACd,OAAO,EAGT,IAAMZ,EAAWzJ,KAAKgJ,YAEtB,MAAkC,IAA9BxI,EAAE8J,KAAKb,EAASc,aAIpBC,QAAQC,MAAM,iEAEP,K,gDAGiBC,GACpBA,EAAUjH,OAASzD,KAAK+B,MAAM8G,iBAChC7I,KAAKoC,SAAS,CAAEyG,iBAAiB,M,0CAKnC5D,EAAEjF,KAAK4H,WAAW9C,SAAS6F,KAAK,WAAWC,KAAK,WAC9C3F,EAAEjF,MAAM6K,KAAK,SAAU,c,6CAcP,IACZC,EAAoB9K,KAAKC,MAAzB6K,gBAMN,GAJ8B,iBAAnBA,IACTA,EAAkB3D,EAAiB2D,SAGW,IAArC9K,KAAKC,MAAM8K,sBAAuC,CAC3D,IAAMC,EAAa,YAAcC,IAAIC,KAAKC,WAAa,kBADI,EAEdnL,KAAKC,MAAM8K,sBAFG,IAEnDK,WAFmD,MAE7CJ,EAF6C,EAEjCjI,EAFiC,EAEjCA,MAAOsI,EAF0B,EAE1BA,QAE7BA,QACFP,EAAgBrD,cAAgB,oDAEhCqD,EAAgBQ,UAAYC,QAAQ,GAAD,OAAIH,EAAJ,kBAAiBrI,EAAjB,qBAAmCsI,IACtEP,EAAgBU,eAAiBD,QAAQ,GAAD,OAAIH,EAAJ,kBAAiBrI,EAAjB,qBAAmCsI,IAC3EP,EAAgBW,qBAAuBF,QAAQ,GAAD,OAAIH,EAAJ,kBAAiBrI,EAAjB,qBAAmCsI,EAAnC,mBAIlD,OAAOP,I,yCAGO,WACd,QAAgD,IAArC9K,KAAKC,MAAM8K,sBAAtB,CADc,MAKa/K,KAAKC,MAAM8K,sBAA9BhI,EALM,EAKNA,MAAOsI,EALD,EAKCA,QAEfrL,KAAKoC,SAAS,CAAE4H,sBAAsB,IACtC/E,EAAEyG,QAAQH,QAAQ,YAAD,OAAaN,IAAIC,KAAKC,WAAtB,kBAAkD,CACjEpI,MAAOA,EACP4I,SAAUN,IACTO,KAAK,SAACC,GACP,EAAKzJ,SAAS,CAAEoH,YAAaqC,EAAIC,SAAU9B,sBAAsB,S,2CAyBnE,IAAM+B,EAAO/L,KAET8K,EAAkBvO,OAAOyP,OAC3B,CACE5G,OAAQ,IACRiC,QAAS,CACP,CAAElJ,KAAM,YAAaoJ,MAAO,CAAE,MAAO,OAAQ,QAAS,IAAK,OAAQ,SACnE,CAAEpJ,KAAM,QAASoJ,MAAO,CAAE,OAAQ,WAAY,eAAgB,gBAC9D,CAAEpJ,KAAM,SAAUoJ,MAAO,CAAE,QAAS,gBACpC,CAAEpJ,KAAM,QAASoJ,MAAO,CAAE,aAC1B,CAAEpJ,KAAM,cAAeoJ,MAAO,CAAE,OAAQ,SAAU,cAClD,CACEpJ,KAAM,YACNoJ,MAAO,CACL,eACA,eACA,IACA,UACA,SACA,IACA,cACA,gBACA,eACA,eACA,IACA,cAGJ,CAAEpJ,KAAM,SAAUoJ,MAAO,CAAE,SAAU,YAEvCC,eAAe,EACfyE,UAAWhE,SAASiE,SACpBzE,cAAe,eACfC,aACE,+GACFyE,kBAAmB,EACnBC,mBAAoB,SAASN,EAAkBvD,GAC7CuD,EAAWA,EACRO,QAAQ,QAAS,IACjBA,QAAQ,8DAA+D,IACvEA,QAAQ,SAAU,IACrB,IAAIC,EAAKC,KAAKC,MAAMV,GACpBW,QAAQhM,IAAI6L,GACZ9L,EAAEkM,QAAQJ,EAAI,SAAS7N,GACjBA,EAAEkO,SACJpE,EAAOqE,WACL,YAAcnO,EAAE2M,IAAM,kDAAoD3M,EAAEoO,SAAW,aAGzFpC,MAAMhM,EAAEqO,SAGZ7E,SAASC,OAAOC,aAAa4E,OACzBhB,EAAK9L,MAAM+M,UACbjB,EAAK9L,MAAM+M,WAEbjB,EAAK7C,mBACL,IAAM+D,EAAgBlB,EAAK/C,YACvBiE,GACFlB,EAAK9L,MAAMqI,OAAO2E,GAAe,GAAO,KAI9CjN,KAAKkN,wBA8BP,OA3BApC,EAAgB5E,GAAK3J,OAAOyP,OAC1B,CACEmB,kBAAmB,SAASjL,GAC1B,IAAMkL,EAASlL,EAAGpG,KAAKuR,WACvBD,EAAOlH,GAAG,QAAS,WACjBjB,EAAEqI,cAEJF,EAAOlH,GAAG,QAAS,WACjBuG,QAAQhM,IAAI2M,GACZnI,EAAEqI,cAEJrI,EAAEsI,QAAQ,CACRC,QACE,mJAGNC,mBAAoB,WAClBxI,EAAEqI,YACFtN,KAAK0N,KAAK,WAEZC,MAAO,SAACtF,GACNA,EAAIvM,KAAK8R,UAAYvF,EAAIvM,KAAK8R,UAAUvB,QAAQ,qBAAsB,MAG1EvB,EAAgB5E,IAAM,IAGjB4E,I,qCAGG,IACF+C,EAAW7N,KAAKC,MAAhB4N,OAER,MAAe,mBAAXA,EAEA,oBAAC,EAAAC,oBAAD,CACE9L,UAAWhC,KAAK+B,MAAMiI,qBACtBR,YAAaxJ,KAAK+B,MAAMyH,YACxBuE,aAAc/N,KAAK4J,mBACnBoE,aAAchO,KAAK6J,qBAKlBgE,I,oCAIP,GAAK7N,KAAK+B,MAAM8G,gBAAhB,CAIA,IAAIoF,GAAa,aAAG,CAAE,yBAAwBjO,KAAKC,MAAMC,WAAYF,KAAKC,MAAMC,UAAY,WAE5F,OACE,oBAAC,UAAD,CACEA,UAAW+N,EACXxK,MAAI,EACJyK,WAAS,EACTC,oBAAoB,EACpBC,OAAO,WACPpK,QAAShE,KAAKgE,QACdqK,eAAe,EACf9J,QAASvE,KAAKqJ,aACdjJ,KAAK,SAEL,oBAAC,UAAMuB,QAAP,KAAgB3B,KAAKsO,gBACpBtO,KAAKC,MAAMmK,SACV,oBAAC,UAAMmE,QAAP,KACGvO,KAAKC,MAAMuO,YACZ,8BAAQtO,UAAU,qBAAqBwC,QAAS1C,KAAKmJ,UAArD,YAGA,8BAAQjJ,UAAU,oBAAoBwC,QAAS1C,KAAKsI,QAApD,YAKF,oBAAC,UAAMiG,QAAP,KACGvO,KAAKC,MAAMuO,YACZ,8BAAQtO,UAAU,qBAAqBwC,QAAS1C,KAAKmJ,UAArD,e,qCASE,IACNnI,EADM,OAWV,OATIhB,KAAKC,MAAMe,OAAShB,KAAKC,MAAMwO,cACjCzN,EACE,kEACChB,KAAKC,MAAMwO,YAAc,IAC1B,cACCzO,KAAKC,MAAMe,OAAS,IACrB,WAIF,oBAAC,EAAAiD,SAAD,KACGjD,GAAS,2BAAK0N,wBAAyB,CAAEC,OAAQ3N,KAClD,2BAAKqB,MAAO,CAAEuM,UAAW,UACvB,2BAAK1O,UAAU,WACb,2BAAKA,UAAWF,KAAK+B,MAAMkH,aAAe,GAAK,oBAC7C,4BAAM/I,UAAU,sBADlB,kBAIF,2BAAKA,WAAW,aAAG,qBAAsB,CAAEqC,OAAQvC,KAAK+B,MAAMC,aAC5D,2BAAK9B,UAAU,aAAf,gBAEF,oBAAC,UAAD,CACEmF,IAAK,SAACpH,GAAD,OAAuC,EAAKkM,aAAelM,GAChEnC,KAAMkE,KAAKC,MAAMnE,KACjB+S,OAAQ7O,KAAK8O,qBACb1G,SAAUpI,KAAKoI,SACf2G,gBAAiB,kBAAM,EAAK3M,SAAS,CAAEJ,WAAW,KAClDgN,UAAWhP,KAAKC,MAAMmK,YAGzBpK,KAAKiP,kB,+BAMV,GAAIjP,KAAKC,MAAME,OACb,OAAO,2BAAKD,UAAU,iBAAf,IAAiCF,KAAKsO,gBAG/C,IAAIY,EAAgC,MAAtBlP,KAAKC,MAAMiP,QAAkBlP,KAAKC,MAAMnE,MAAQ,GAAKkE,KAAKC,MAAMiP,QAE1EjB,GAAa,aAAG,CAAE,iBAAkBjO,KAAKC,MAAMC,UAAWgP,EAAU,iBAAmB,eAQ3F,OANIlP,KAAKC,MAAMkP,gBACbD,EAAU,yCAA2ClP,KAAKC,MAAMkP,cAAgB,aAAeD,GAGjGA,EAAUA,EAAQ7C,QAAQ,qBAAsB,IAG9C,oBAAC,EAAApI,SAAD,KACE,2BAAK/D,WAAW,aAAG,yBAA0BF,KAAKC,MAAM4G,kBAAmBnE,QAAS1C,KAAK0J,gBACvF,2BACErE,IAAKrF,KAAK4H,WACV1H,UAAW+N,EACXS,wBAAyB,CAAEC,OAAQO,GACnC7M,MAAOrC,KAAKC,MAAMmP,eAEnBpP,KAAKC,MAAMmK,UACV,2BAAKlK,UAAU,eACb,oBAAC,UAAD,CAAYwC,QAAS1C,KAAKiC,gBAI/BjC,KAAKqP,oB,4CApcL,EAAAzG,eAAyB,GAEzB,EAAA/F,aAAe,CACpBY,MAAM,EACNgF,UAAU,EACV4B,UAAU,EACVD,UAAU,EACVT,oBAAoB,EACpBmB,gBAAiB,K,mGC/CrB,I,GAEe,EAFf,KAEewE,eAAsC,CAAEC,aAAc,KAAMC,OAAQ,SAAC1T,O,wICFpF,I,EAAA,OAEA,G,EAAA,Q,2BACA,S,2yBAmBa2T,E,YAAb,0B,4FAAA,U,sCACE1N,MAAQ,CACN2N,WAAW,GAGb,EAAAhN,QAAU,WACR,EAAKN,SAAS,CAAEsN,WAAW,KAG7B,EAAAC,aAAe,WACb,EAAKvN,SAAS,CAAEsN,WAAW,KAG7B,EAAApH,OAAS,SAACxM,GACR,EAAKmE,MAAMqI,OAAOxM,GAAM8T,KAAK,WAC3B,EAAKD,kBAfX,E,sPAAiC,EAAArM,e,uCAoB7B,GAAKtD,KAAKC,MAAM4P,WAAhB,CAIA,IAAMC,EAAgB9P,KAAKC,MAAM8P,UAEjC,OACE,2BAAK7P,UAAU,aACb,8BAAQA,UAAU,mDAAmDwC,QAAS1C,KAAK0C,SAChF1C,KAAKC,MAAM+P,WADd,IAC0B,yBAAG9P,UAAU,eAEtCF,KAAK+B,MAAM2N,WACV,oBAAC,UAAD,CACEjM,MAAI,EACJ2K,OAAO,WACPlO,UAAU,iCACVE,KAAK,QACL8N,WAAS,EACTC,oBAAoB,EACpBE,eAAe,EACfrK,QAAShE,KAAK2P,cAEd,oBAAC,UAAMjO,OAAP,KAAe1B,KAAKC,MAAMgQ,YAC1B,oBAACH,EAAD,CACExH,OAAQtI,KAAKsI,OACb4H,aAAclQ,KAAKC,MAAMiQ,aACzBL,WAAY7P,KAAKC,MAAM4P,WACvB9O,KAAMf,KAAKC,MAAMc,e,oEAgBE,SAACd,GAChC,IAAMgH,EAAShH,EAAMc,KAAKkG,QAAU,aACpC,OACE,2BAAK/G,UAAU,iBAAiBmC,MAAO,CAAE8N,aAAc,IACrD,2BAAKjQ,UAAU,MAAMmC,MAAO,CAAE+N,WAAY,IACxC,2BAAKlQ,UAAU,oBACb,8BAAQmC,MAAO,CAAEgO,WAAY,MAAQpQ,EAAMc,KAAKC,QAElD,2BAAKd,UAAU,oBACb,4CACA,2BAAKA,UAAU,qBACb,2BAAKA,UAAS,8BAAyBM,EAAEuG,IAAIC,UAAUC,EAAOC,iBAAmBD,KAIrF,2BAAK/G,UAAU,oBACb,oBAAC,EAAA4C,4BAAD,CAA6BC,MAAO9C,EAAMc,Y,iCCrG9C,IAAWuP,E,0FAAjB,SAAiBA,GACC,EAAAC,WAAhB,SAA2BpS,GACzB,OAAQ,GAAKA,GAAMqS,MAAM,SAAW,aAAerS,EAAOA,GAF9D,CAAiBmS,IAAa,gBAAbA,EAAa,M,iBCA9BxS,EAAOD,QAAU4S,U,mGCAjB,eACA,YACA,YACA,YAEA,YACA,SACA,YACA,YAEA,E,uSAAA,SACA,S,81BAEqBC,E,YACnB,WAAYzQ,GAAyB,a,4FAAA,UACnC,wBAAMA,KAwDR0Q,sBAAwB,WACtB,EAAK1Q,MAAM2Q,OAAOC,aAAajU,KAAK,CAClCkU,SAAUC,EAAKC,KACfC,SAAU,KACVC,YAAa,KACbC,YAAa,GACbC,SAAS,EACTC,OAAQ,EAAKpR,MAAM2Q,OACnBU,WAAY,OAEd,EAAKrR,MAAM2Q,OAAOU,WAAalQ,KAAKnC,SAASqC,OAAO,mCAEpD,EAAKiQ,sBAED,EAAKtR,MAAM4P,YAAc,EAAK2B,6BAA+B9L,yBAAyB,qBACxFiD,WAAW,WACT1D,EAAE,+BAAD,OAAgC,EAAKhF,MAAM2Q,OAAOa,KAAMC,kBACxD,MAyBP,EAAAC,oBAAsB,SAACC,EAA0B1S,GAC/C,EAAKe,MAAM2Q,OAAOC,aAAa3R,GAAO0S,EACtC,EAAKL,uBAGP,EAAAM,oBAAsB,SAAC3S,GACrB,EAAKe,MAAM2Q,OAAOC,aAAe,EAAK5Q,MAAM2Q,OAAOC,aAAaiB,OAAO,SAACtR,EAAGpE,GAAJ,OAAUA,IAAM8C,IACvF,EAAKqS,sBAELtM,EAAE,+BAAD,OAAgC,EAAKhF,MAAM2Q,OAAOa,GAAlD,cAAiE7G,KAAK,SAASxO,GAC9E6I,EAAEjF,MAAM2K,KAAK,0BAA0BoH,KAAKvR,EAAEwR,QAAQ,IAAM5V,EAAI,GAAI,EAAG,KAAO,QA1GhF,EAAK2F,MAAQ,CACXkQ,SAAU,EAAKC,oBACfC,UAAW,GAAKlS,EAAM2Q,OAAOuB,UAE7BC,yBAAyB,GAPQ,E,sPADI,c,kDAYxB,WACTC,EAASpN,EAAE,+BAAD,OAAgCjF,KAAKC,MAAM2Q,OAAOa,KAElEY,EAAOC,aAEHtS,KAAKC,MAAM4P,YAAc7P,KAAKuS,4BAA8B7M,yBAAyB,qBACvF2M,EAAOG,SAAS,CACdC,WAAY,gBACZC,YAAa,WACbC,WAAY,SAACC,GAIX,IAHA,IAAIC,EAAY,GACVC,EAAOF,EAAME,KAEV1W,EAAY,EAAGA,EAAI0W,EAAKxW,OAAQF,IAAK,CAC5C,IAAI2W,EAAQD,EAAK1W,GAAGqV,GAAGuB,OAAO,IAC9BH,EAAUjW,KAAKmW,GACf9N,EAAE6N,EAAK1W,IAAIuO,KAAK,0BAA0BoH,KAAKvR,EAAEwR,QAAQ,GAAK5V,EAAG,EAAG,KAAO,KAG7E,IAAMgP,EAAMG,QAAQ,YAAD,OAAa,EAAKtL,MAAM2Q,OAAOqC,YAAYC,SAASzB,GAApD,kCACnBxM,EAAEkO,KAAK/H,EAAK,CACVgI,KAAM,OACNtX,KAAM,CACJuX,KAAMR,EACNS,QAAS,EAAKrT,MAAM2Q,OAAOqC,YAAYM,KAAK9B,GAC5C+B,UAAW,EAAKvT,MAAM2Q,OAAO4C,WAE/BC,SAAU,c,6CAQlBxO,EAAE,+BAAD,OAAgCjF,KAAKC,MAAM2Q,OAAOa,KAAMa,WAAW,a,2CAIpE,IAAMD,EAASpN,EAAE,+BAAD,OAAgCjF,KAAKC,MAAM2Q,OAAOa,KAElE9I,WAAW,WACT0J,EAAOC,WAAW,WACjB,O,0CAyBH,IAAMoB,EAAa1T,KAAKC,MAAM2Q,OAAOC,aAAaiB,OAAO,SAAC6B,GAAD,OAAWA,EAAMvC,UAAS9U,OACnF,OAAgD,GAAzC0D,KAAKC,MAAM2Q,OAAOC,aAAavU,OAClC,EACAsX,KAAKC,MAAM,IAAMH,EAAa1T,KAAKC,MAAM2Q,OAAOC,aAAavU,U,iDAIjE,OAAQkE,EAAEsT,SAAS,CAAE,MAAO,OAAS9T,KAAKC,MAAM2Q,OAAOqC,YAAYM,KAAKQ,Q,kDAIxE,OAAQvT,EAAEsT,SAAS,CAAE,MAAO,OAAS9T,KAAKC,MAAM2Q,OAAOqC,YAAYM,KAAKQ,Q,4CAIxE,IAAM9B,EAAWjS,KAAKkS,oBAEtBlS,KAAKoC,SAAS,CAAE6P,e,kDAkBhB,OAAIjS,KAAK+B,MAAMkQ,SAAW,IACjB,iGAGF,O,+BAGH,MACuBjS,KAAKC,MAAxBsC,EADJ,EACIA,OAAQqO,EADZ,EACYA,OAEVoD,EAAyB,CAC7BC,SAA6B,WAAnBjU,KAAKC,MAAMmT,KACrBc,SAA6B,WAAnBlU,KAAKC,MAAMmT,KACrBe,iBACEnU,KAAKC,MAAM4P,YAAc7P,KAAKuS,4BAA8B7M,yBAAyB,sBACjF,CACE0O,MAAM,EACN9T,KAAM,CAAEnC,KAAM,OAAQiC,KAAM,SAC5BsD,MAAO,qBACPhB,QAAS1C,KAAK2Q,uBAEhB,MAGR,OACE,oBAAC,UAAI0D,KAAL,CAAU9R,OAAQA,GAChB,2BAAKrC,UAAU,6BACb,oBAAC,UAAD,CAAUA,UAAU,kBAAkBE,KAAK,OAAOG,MAAM,QAAQ+T,QAAStU,KAAK+B,MAAMkQ,WACpF,2BAAK/R,UAAU,yBAAf,UAA2CF,KAAK+B,MAAMkQ,SAAtD,OAGF,oBAAC,EAAA/N,oBAAD,KACE,oBAAC,UAAD,CAAmB0M,OAAQA,EAAQ2D,YAAaP,KAGlD,oBAAC,EAAAQ,iBAAD,CAAkB3E,WAAY7P,KAAKC,MAAM4P,aAEzC,oBAAC,UAAD,CAAO4E,WAAS,EAACvU,UAAU,6BAA6BuR,GAAE,qCAAgCb,EAAOa,KAC/F,oBAAC,UAAM/P,OAAP,KACE,oBAAC,UAAMgT,IAAP,KACE,oBAAC,UAAMC,WAAP,CAAkBzU,UAAU,iBAAiB0U,QAAQ,KAArD,iBAGA,oBAAC,UAAMD,WAAP,CAAkBzU,UAAU,aAA5B,UACA,oBAAC,UAAMyU,WAAP,CAAkBzU,UAAU,oBAA5B,2BACA,oBAAC,UAAMyU,WAAP,CAAkBzU,UAAU,eAA5B,YACA,oBAAC,UAAMyU,WAAP,CAAkBzU,UAAU,uBAA5B,OAGJ,oBAAC,UAAM2U,KAAP,KAAa7U,KAAK8U,oBAAoBlE,KAGxC,+BACGpQ,EAAEJ,KAAKwQ,EAAOC,cAAgB,GAC/B7Q,KAAKC,MAAM4P,YACX7P,KAAKuS,4BACL7M,yBAAyB,uBACvB,2BAAKxF,UAAU,oCACb,oBAAC,UAAD,CACE8F,SAAO,EACP+O,QAAQ,OACRtS,SAAO,EACPnC,KAAK,OACLsC,QAAQ,qBACRF,QAAS1C,KAAK2Q,yBAKnBnQ,EAAEJ,KAAKwQ,EAAOC,cAAgB,GAAK7Q,KAAKgV,0B,0CAM7BpE,GAA0B,WAC5C,GAAmC,GAA/BpQ,EAAEJ,KAAKwQ,EAAOC,cAChB,OACE,oBAAC,UAAM6D,IAAP,KACE,oBAAC,UAAMO,KAAP,CAAYL,QAAQ,IAAIvS,MAAO,CAAE6S,UAAW,WAC1C,2BAAKhV,UAAU,+BACb,oDACA,6BACE,4BAAMA,UAAU,sBADlB,+DACqG,KAEpGF,KAAKC,MAAM4P,YACZnK,yBAAyB,uBAAyB,CAChD,oBAAC,UAAD,CACExG,IAAI,SACJ0D,QAAQ,sBACRrC,MAAM,QACNkC,SAAO,EACPnC,KAAK,cACLoC,QAAS1C,KAAK2Q,sBACdtO,MAAO,CAAE8S,UAAW,cASlC,IAAItE,EAAerQ,EAAEoB,IAAIgP,EAAOC,aAAc,SAAS9P,EAAMc,GAE3D,OADAd,EAAKqU,MAAQvT,EACNd,IAELsU,EAAoB7U,EAAE8U,OACxB9U,EAAEoB,IAAIpB,EAAE+U,QAAQ1E,EAAc,YAAa,SAAS9P,EAAMc,GACxD,MAAO,CAAEkQ,KAAMlQ,EAAGgP,aAAc9P,MAIhC+R,EAAsB,GA4B1B,OA3BAuC,EAAkB3I,QAAQ,SAAC8I,EAAiEpZ,GAC7D,IAAzBoZ,EAAiBzD,MAAuC,QAAzByD,EAAiBzD,MAA2C,MAAzByD,EAAiBzD,MACrFe,EAAKlW,KACH,0BAAIsC,IAAK9C,EAAG8D,UAAU,sCACpB,0BAAI0U,QAAS,GAAIY,EAAiBzD,QAKxCyD,EAAiB3E,aAAanE,QAAQ,SAACkF,EAA0BtU,GAC/DsU,EAAYP,OAAST,EACrBkC,EAAKlW,KACH,oBAAC,UAAD,CACEsC,IAAK0S,EAAYd,SACjBsE,MAAOxD,EAAYwD,MACnBK,UAAWnY,EACXsU,YAAaA,EACb/B,WAAY,EAAK5P,MAAM4P,WACvB6F,WAAY,EAAKzV,MAAM4P,YAAc,EAAK2B,4BAC1CmE,SAAU,EAAKhE,oBACfiE,SAAU,EAAK/D,oBACfgE,eAAgB,EAAKF,gBAMtB7C,O,qJC2DL,SAA8BlU,EAAekL,GACjD,IAAMgM,EAAItS,YAAY,4BAAD,OAA6BsG,EAAQiM,WAAY,GAAM1J,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KAEzG2J,EAAK,IAAIC,OADL,cAAgBH,EAAI,6BACL,KAEzB,OAAOlX,EAAMyN,QAAQ2J,EAAI,K,kDA7U3B,WAEA,WACA,WACA,YACA,YACA,YACA,Y,ytCAEaE,E,YAAb,qC,sCA6DEN,SAAW,SAAC1T,GACVA,EAAGC,iBAEH,IAAMiJ,EAAcG,QAAQ,YAAD,OACb,EAAKtL,MAAMkW,WAAWC,YADT,oBACgC,EAAKnW,MAAMkW,WAAW1E,GADtD,YAG3BjH,QAAQ6L,eACN,4JACA,WACA,UACA,SAAC5X,GACKA,IACFwG,EAAEsI,QAAQ,CACRC,QACE,sIAEJvI,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,GAAI2X,SAAU,SAC7C7H,KAAK,WACJ,EAAK3L,MAAMqW,SAAS,EAAKrW,MAAMkW,WAAY,kBAAMlR,EAAEqI,gBAEpDiJ,KAAK,WACJtR,EAAEuR,QAAQ,CAAEzE,KAAM,kCAAmCqB,KAAM,UAC3DnO,EAAEqI,kBAnFhB,E,WAAwC,EAAAxN,W,wCAqCzBgI,EAAyBb,GAAiC,WACrEa,EAAE3F,iBAEF,IAAMiJ,EAAcG,QAAQ,YAAD,OACbvL,KAAKC,MAAMkW,WAAWC,YADT,oBACgCpW,KAAKC,MAAMkW,WAAW1E,GADtD,YAC4DxK,IAEvFhC,EAAEsI,QAAQ,CACRC,QACE,2GACAhN,EAAEuG,IAAI0P,WAAWxP,GACjB,oCAGJhC,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,GAAI2X,SAAU,SAC7C7H,KAAK,SAACC,GACL,EAAK5L,MAAM0V,SAAS9J,EAAIC,SAASxF,QACjCrB,EAAEqI,cAEHiJ,KAAK,WACJtR,EAAEuR,QAAQ,CAAEzE,KAAM,sCAAuCqB,KAAM,UAC/DnO,EAAEqI,gB,+BAiCF,IAGAoJ,EAmBAC,EAkBAC,EAxCA,OACIT,EAAenW,KAAKC,MAApBkW,WAkER,OA/DIA,EAAWlT,mBACbyT,EACE,2BAAKrU,MAAO,CAAEwU,QAAS,iBACrB,8BAAQ3W,UAAU,SAAlB,QACA,2BACEmC,MAAO,CAAEwU,QAAS,eAAgBC,SAAU,GAAI5B,UAAW,SAAU6B,YAAa,GAClFrT,MAAK,yBAAoByS,EAAWhT,UAAU,GAAGlC,KAAK9C,OAErDgY,EAAWhT,UAAU,GAAGlC,KAAKC,MAJhC,KAMA,2BAAKmB,MAAO,CAAEwU,QAAS,gBAAkBnT,MAAOyS,EAAWlT,kBACzD,4BAAM/C,UAAU,uBAAwB,IACvCkB,KAAKnC,OAAOkX,EAAWlT,kBAAkB3B,OAAO,uBAOrD6U,EAAWa,iBACbL,EACE,2BAAKtU,MAAO,CAAEwU,QAAS,iBACrB,8BAAQ3W,UAAU,SAAlB,QACA,2BACEmC,MAAO,CAAEwU,QAAS,eAAgBC,SAAU,GAAI5B,UAAW,SAAU6B,YAAa,GAClFrT,MAAK,wBAAmByS,EAAW/S,YAAY,GAAGnC,KAAK9C,OAEtDgY,EAAW/S,YAAY,GAAGnC,KAAKC,MAJlC,KAMA,2BAAKmB,MAAO,CAAEwU,QAAS,gBAAkBnT,MAAOyS,EAAWa,gBACzD,4BAAM9W,UAAU,uBADlB,IAC2CkB,KAAKnC,OAAOkX,EAAWa,gBAAgB1V,OAAO,uBAO3F2V,cAAc,CAAE,KAAM,SAEtBL,EADET,EAAWlT,iBAEX,8BAAQZ,MAAO,CAAE6U,WAAY,OAASxU,QAAS,SAACoF,GAAD,OAAO,EAAKqP,aAAarP,EAAG,aAAa5H,UAAU,OAChG,4BAAMA,UAAU,0BADlB,YAMA,oBAAC,UAAD,CACEqB,QACE,2BAAKrB,UAAU,kBACb,8BAAQmC,MAAO,CAAE6U,WAAY,OAAShX,UAAU,gBAC9C,4BAAMA,UAAU,0BADlB,aAKJ0C,QAAQ,qGACRqD,OAAO,8CACP/F,UAAU,eACVgG,GAAG,WAOT,0BAAIhH,IAAKiX,EAAW1E,GAAIpP,MAAO,CAAE8N,aAAc,IAC7C,2BAAK9N,MAAO,CAAE+U,WAAY,UAAWC,aAAc,EAAGC,OAAQ,sBAC5D,2BAAKpX,UAAU,WAAWmC,MAAO,CAAE8S,UAAW,EAAGoC,YAAa,sBAC5D,2BAAK5T,IAAKuS,EAAmBsB,eAAerB,EAAWsB,UAAWC,IAAI,WAExE,2BAAKxX,UAAU,YAAYmC,MAAO,CAAEsV,QAAS,aAC3C,2BACEzX,UAAU,SACVwD,MAAOyS,EAAWsB,SAClBpV,MAAO,CACLgO,WAAY,OACZuH,SAAU,OACVC,SAAU,IACVC,WAAY,SACZC,SAAU,SACVC,aAAc,aAGf7B,EAAWsB,UAEd,2BAAKpV,MAAO,CAAEuV,SAAU,SACtB,4BACEvV,MAAO,CAAE4V,UAAW,UACpB/X,UAAU,SACVwD,MAAK,4BAAuByS,EAAW+B,iBAEtC/B,EAAW+B,gBACN,IAPV,IASE,2BAAKhY,UAAU,yBACb,2BAAKA,UAAU,aACb,yBACEqF,KAAM/B,YAAY,4BAAD,OAA6B2S,EAAWJ,WACzDoC,OAAO,SACPjY,UAAU,MACVmC,MAAO,CAAE9B,MAAO,SAEhB,4BAAML,UAAU,qBAAqBmC,MAAO,CAAEuV,SAAU,UAN1D,eAUDX,cAAc,CAAE,KAAM,KAAM,QAC3B,2BAAK/W,UAAU,aACb,yBAAGqF,KAAK,IAAIrF,UAAU,MAAMwC,QAAS1C,KAAK4V,UACxC,4BAAM1V,UAAU,kBADlB,YAMJ,2BAAKA,UAAU,YAAYmC,MAAO,CAAEyU,SAAU,KAC3CX,EAAWlT,iBACV,oBAAC,UAAD,CAAO1B,QAASmV,EAAgBlV,SAAS,iBACvC,oBAAC,UAAME,OAAP,CAAckB,QAAQ,kBACtB,oBAAC,UAAMjB,QAAP,KACE,6BAAOzB,UAAU,gBACf,iCACGiW,EAAWhT,UAAUvB,IAAI,SAACb,EAAMc,GAC/B,OACE,0BAAI3C,IAAK2C,GACP,8BACE,oBAAC,UAAD,CAAM1D,KAAK,cAAcoC,MAAM,UADjC,IAC6CQ,EAAKE,KAAK9C,KADvD,KAC+D4C,EAAKE,KAAKC,MADzE,KAGA,8BACE,8BAAKE,KAAKnC,OAAO8B,EAAKM,IAAIC,OAAO,6BAUjD2V,cAAc,CAAE,KAAM,KAAM,QAC1B,8BACE5U,MAAO,CAAE6U,WAAY,OACrBxU,QAAS,SAACoF,GAAD,OAAO,EAAKqP,aAAarP,EAAG,eACrC5H,UAAU,OAEV,4BAAMA,UAAU,0BALlB,eAWN,2BAAKA,UAAU,aACZiW,EAAWa,gBACV,oBAAC,UAAD,CAAOzV,QAASoV,EAAcnV,SAAS,iBACrC,oBAAC,UAAME,OAAP,CAAckB,QAAQ,iBACtB,oBAAC,UAAMjB,QAAP,KACE,6BAAOzB,UAAU,gBACf,iCACGiW,EAAW/S,YAAYxB,IAAI,SAACb,EAAMc,GACjC,OACE,0BAAI3C,IAAK2C,GACP,8BACE,oBAAC,UAAD,CAAM1D,KAAK,cAAcoC,MAAM,UADjC,IAC6CQ,EAAKE,KAAK9C,KADvD,KAC+D4C,EAAKE,KAAKC,MADzE,KAGA,8BACE,8BAAKE,KAAKnC,OAAO8B,EAAKM,IAAIC,OAAO,6BAUlDsV,KAIP,iCAEF,2BAAK1W,UAAU,kB,wCAhRSuX,GAC9B,OAAOA,EAASW,MAAM,KAAKC,Q,qCAGCC,GAC5B,IAAMC,EAAYrC,EAAmBsC,iBAAiBF,GA4BtD,OAAO9U,YAAY,qBAAD,OA1BA,WAChB,OAAQ+U,GACN,IAAK,MACL,IAAK,OACL,IAAK,OACL,IAAK,QACH,MAAO,QACT,IAAK,MACL,IAAK,OACH,MAAO,OACT,IAAK,MACH,MAAO,MACT,IAAK,MACL,IAAK,MACL,IAAK,OACL,IAAK,MACL,IAAK,MACH,MAAO,QACT,IAAK,MACL,IAAK,MACH,MAAO,MACT,QACE,MAAO,WAI2BE,GAAtB,a,gCAsPT3K,E,wFAA4B,EAAAhO,W,oCAIjC,aAC6BE,KAAKC,MAAhC+B,EADF,EACEA,UAAWwH,EADb,EACaA,YAEjB,OACE,2BAAKtJ,UAAU,iCAAiCmC,MAAO,CAAEuM,UAAW,KACjE5M,GACC,oBAAC,UAAD,CAAQM,UAAQ,EAACC,QAAM,GACrB,oBAAC,UAAD,CAAQD,UAAQ,EAACC,QAAM,EAACrC,UAAU,kBAGtC,0BAAIA,UAAU,eAAd,YAEE,oBAAC,UAAD,CAAOwY,UAAQ,EAACnY,MAAM,SACnBC,EAAEJ,KAAKoJ,KAGXhJ,EAAEJ,KAAKoJ,GAAe,GACrB,oBAAC,UAAD,CAAMmP,SAAO,EAACzY,UAAU,mBACrBM,EAAEoB,IAAI4H,EAAa,SAAC2M,EAAgC/Z,GACnD,OACE,oBAAC8Z,EAAD,CACEhX,IAAKiX,EAAW1E,GAChB0E,WAAYA,EACZR,SAAU,EAAK1V,MAAM8N,aACrBuI,SAAU,EAAKrW,MAAM+N,uB,6BA3B9B,EAAAnL,aAAe,CACpBb,WAAW,I,8KCnSf,WAEA,WACA,WACA,WACA,WACA,WAEA,YACA,SACA,YACA,SAEA,YACA,YACA,YACA,Y,ytCAMa4W,E,wFAA4B,EAAA9Y,W,4CACzB,IACJ8Q,EAAW5Q,KAAKC,MAAhB2Q,OAEJiI,EAAe,KAcnB,OAZIjI,EAAO3J,SACT4R,EACE,oBAAC,UAAD,CACExW,MAAO,CAAEyW,gBAAiBlI,EAAOmI,cACjC7Y,UAAS,sCAAiCM,EAAEuG,IAAIiS,YAAYpI,EAAO3J,SACnE7G,KAAK,QAEJwQ,EAAO3J,SAKP4R,I,+BAGH,IACIjI,EAAW5Q,KAAKC,MAAhB2Q,OAER,OACE,oBAAC,EAAA3M,SAAD,KACE,4BAAM/D,UAAU,UAAUwD,MAAOkN,EAAO5P,OACrC4P,EAAO5P,OAEV,oBAAC,EAAA8B,4BAAD,CAA6BC,MAAO6N,IACnC5Q,KAAKiZ,sB,iCAUDzE,E,YAAb,qC,sCASE0E,cAAgB,SAAC3Q,GACf,IAAM4Q,EAAW5Q,EAAOgC,UADkB,EAET,EAAK6O,QAA9B7J,EAFkC,EAElCA,aAAcC,EAFoB,EAEpBA,OAEtBvK,EAAEsI,QAAQ8L,+BAA+B,sBACzC,IAAMjO,EAAMG,QAAQ,YAAD,OAAagE,EAAa2D,SAASzB,GAAnC,6BAA0DlC,EAAagE,KAAK9B,GAA5E,cACnBxM,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,CAAEqd,YAAY1F,SAAU,SAAU7H,KAAK,WACvE,IAAI0N,EAAmB,EAAAC,uBAAuBC,YAAYjK,EAAc,OAAQ,CAAE4J,aAClF3J,EAAO8J,GACPrU,EAAEqI,eAlBR,E,WAAsC,EAAAxN,W,oCAsB9B,IACEyP,EAAgDvP,KAAKoZ,QAArD7J,aAgBN,OACE,2BAAKrP,UAAU,2CACb,oBAAC,UAAD,CACEA,UAAU,uBACV4K,gBAnBkB,CACtB1F,OAAQ,IACRiC,QAAS,CACP,CAAElJ,KAAM,cAAemJ,OAAQ,CAAE,cAAe,WAAaC,MAAO,CAAE,OAAQ,WAC9E,CACEpJ,KAAM,YACNmJ,OAAQ,CAAE,OAAQ,SAAU,SAAU,QAAS,QAC/CC,MAAO,CAAE,eAAgB,eAAgB,IAAK,UAAW,SAAU,IAAK,eAG5EC,eAAe,EACfC,cAAe,mCACfC,aAAc,YAQVyH,cAAc,YACdnO,MAAM,IACNyN,WAAW,aACX3S,KAAMyT,EAAagE,KAAK4F,SACxB/O,SAAUpK,KAAKC,MAAM4P,YAAcnK,yBAAyB,sBAC5D4C,OAAQtI,KAAKkZ,qB,0BAhDd,EAAAO,YAAc,UAEd,EAAA5W,aAAsC,CAC3CgN,YAAY,G,IA0DH6J,E,YAAb,qC,sCAIEC,kBAAoB,WAAK,IACfpK,EAAiB,EAAK6J,QAAtB7J,aACFnE,EAAMG,QAAQ,YAAD,OACLgE,EAAa2D,SAASzB,GADjB,8BACyClC,EAAagE,KAAK9B,GAD3D,mBACwE,EAAKxR,MAAM2Q,OACjG4C,UAFc,UAMnBvO,EAAEsI,QAAQ8L,+BADW,gCAErBpU,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,CAAE8d,GAAI,KAAOnG,SAAU,SAAU7H,KAAK,SAACC,GACnEA,EAAIgO,WACN5U,EAAEqI,YACF9C,QAAQC,MAAMoB,EAAI2B,WAElB,EAAKsM,aAAajO,EAAIC,SAASxF,QAC/BrB,EAAEqI,gBAKR,EAAAyM,gBAAkB,WAAK,IACbxK,EAAiB,EAAK6J,QAAtB7J,aACFnE,EAAMG,QAAQ,YAAD,OACLgE,EAAa2D,SAASzB,GADjB,8BACyClC,EAAagE,KAAK9B,GAD3D,mBACwE,EAAKxR,MAAM2Q,OACjG4C,UAFc,UAMnBvO,EAAEsI,QAAQ8L,+BADW,8BAErBpU,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,CAAE8d,GAAI,KAAOnG,SAAU,SAAU7H,KAAK,SAACC,GACnEA,EAAIgO,WACN5U,EAAEqI,YACF9C,QAAQC,MAAMoB,EAAI2B,WAElB,EAAKsM,aAAajO,EAAIC,SAASxF,QAC/BrB,EAAEqI,gBAvCV,E,WAA6C,EAAAxN,W,qDA6CzC,OAAIU,EAAEwZ,QAAQ,CAAE,IAAK,IAAK,KAAOha,KAAKC,MAAM2Q,OAAOuB,YAAcnS,KAAKC,MAAMga,uBACnE,6GACEzZ,EAAEwZ,QAAQ,CAAE,KAAOha,KAAKC,MAAM2Q,OAAOuB,WACvC,6HACEnS,KAAKC,MAAM2Q,OAAOsJ,YAAYC,WAAa,EAC7C,mJAGFna,KAAKC,MAAMma,uB,mCAGPC,GAAY,MACUra,KAAKoZ,QAA9B7J,EADe,EACfA,cAERC,EAHuB,EACDA,QACC,EAAA+J,uBAAuBO,aAAavK,EAAcvP,KAAKC,MAAM2Q,OAAQyJ,M,+BAIxF,IAIA9T,EAHIqK,EAAW5Q,KAAKC,MAAhB2Q,OACFwJ,EAAuBpa,KAAKsa,0BAgBlC,OAZE1J,EAAO1N,iBACL0N,EAAO3N,kBAAoB7B,KAAKnC,OAAO2R,EAAO3N,kBAAoB7B,KAAKnC,OAAO2R,EAAO1N,kBACpF1C,EAAEsT,SAAS,CAAE,IAAK,KAAO,GAAKlD,EAAOuB,cAExC5L,EACE,oBAAC,UAAD,CACEhF,QAAS,oBAAC,UAAD,CAAMhB,MAAM,MAAMpC,KAAK,mBAChCyE,QAAS,2EAMb,2BAAK1C,UAAU,6BACZwF,yBAAyB,oBACxB,oBAAC,UAAD,CACEnE,QACE,2BAAKrB,UAAU,kBACb,oBAAC,UAAD,CACE8F,SAAO,EACP1F,MAAI,EACJmC,SAAO,EACPC,QAAS1C,KAAK2Z,kBACdhZ,SAA+C,MAArCX,KAAKC,MAAMga,wBAEpB,IACD,oBAAC,UAAD,CAAM9b,KAAK,UARb,gBAYJyE,QAAS5C,KAAKC,MAAMga,uBACpBhU,OAAO,gDACPtF,SAA+C,MAArCX,KAAKC,MAAMga,uBACrB/Z,UAAU,eACVgG,GAAG,UAGNR,yBAAyB,CAAE,mBAC1B,oBAAC,UAAD,CACEnE,QACE,2BAAKrB,UAAU,kBACb,oBAAC,UAAD,CACEK,MAAM,QACND,MAAI,EACJmC,SAAO,EACPC,QAAS1C,KAAK+Z,gBACdpZ,SAAkC,MAAxByZ,GAET,IACD,oBAAC,UAAD,CAAMjc,KAAK,QAAQoc,QAAM,IACzB,oBAAC,UAAD,CAAMpc,KAAK,UATb,aASkCoI,IAItC3D,QAASwX,EACTnU,OAAO,8CACPtF,SAAkC,MAAxByZ,EACVla,UAAU,eACVgG,GAAG,QACH1E,SAAS,mB,iCA9HZ,EAAAiY,YAAc,U,IAgJVe,E,YACX,WAAYva,GAA2B,wBACrC,wBAAMA,KAED8B,MAAQ,CACX0B,MAAM,EACNgX,eAAe,EACfC,gBAAiBla,EAAEsR,OAAOtR,EAAEoB,IAAI,EAAK3B,MAAMsP,aAAaoL,QAAS,SAAC5Z,EAAM0Q,GAAP,OAAe1Q,EAAK0Q,GAAKA,EAAK,SAN5D,E,WADJ,EAAA3R,W,sCAW3B,WACN,IAAKE,KAAK+B,MAAM0B,KACd,OAAO,KAGT,IAAMmX,EAAQ,CACZC,SAAU,yBAAG3a,UAAU,oBACvB4a,YAAa,yBAAG5a,UAAU,2BAC1B6a,UAAW,yBAAG7a,UAAU,qBACxB8a,aAAc,yBAAG9a,UAAU,4BAC3B+a,SAAU,yBAAG/a,UAAU,oBACvBgb,OAAQ,yBAAGhb,UAAU,mBAGfqP,EAAiBvP,KAAKC,MAAtBsP,aAEFoL,EAAUpL,EAAaoL,QACzBQ,EAA8C,GAElD3a,EAAEkM,QAAQiO,EAAS,SAAS/J,EAAQa,GAClC0J,EAAQve,KAAK,CACXgC,MAAO6S,EACPzQ,MAAO4P,EAAO5P,UAIlB,IAIMgD,EAAU,WACd,EAAK5B,SAAS,CAAEqB,MAAM,KASxB,OACE,oBAAC,UAAD,CAAOvE,IAAI,cAAcuE,MAAI,EAACyK,WAAS,EAACE,OAAO,WAAWhO,KAAK,QAAQ4D,QAASA,EAAS9D,UAAU,YACjG,oBAAC,UAAMwB,OAAP,2CACA,oBAAC,UAAMC,QAAP,KACE,4BACEyZ,OAAO,OACPlb,UAAU,UACVuF,OAAQ8F,QAAQ,YAAD,OAAagE,EAAa2D,SAASzB,GAAnC,8BAA2DlC,EAAagE,KAAK9B,GAA7E,aAEf,2BAAKpP,MAAO,CAAE8N,aAAc,SAA5B,mDALF,IAK8F,+BAC5F,oBAAC,UAAD,CACEhS,KAAK,UACLgd,QAASA,EACTE,eAAe,cACfC,cAAc,YACdC,SAAUvb,KAAK+B,MAAM2Y,gBACrBE,MAAOA,EACPxS,SA/BO,SAACsS,GAChB,EAAKtY,SAAS,CAAEsY,uBAgCV,oBAAC,UAAD,CAASc,YAAU,GAAnB,KACA,oBAAC,UAAD,KACE,oBAAC,UAAUC,MAAX,CAAiBlZ,OAAQvC,KAAK+B,MAAM0Y,cAAe/X,QA3B5C,WACf,EAAKN,SAAS,SAACL,GACb,MAAO,CAAE0Y,eAAgB1Y,EAAM0Y,mBA0BvB,oBAAC,UAAD,CAAMtc,KAAK,gBADb,uBAGA,oBAAC,UAAUwD,QAAX,CAAmBY,OAAQvC,KAAK+B,MAAM0Y,eACpC,oBAAC,UAAKiB,MAAN,CAAYvb,QAAM,GAChB,wDACA,2BAAKD,UAAU,YACb,6BAAOyb,YAAY,sBAAsBxd,KAAK,cAAciV,KAAK,aAKzE,8BAAQlT,UAAU,yCAAlB,WACA,8BAAQA,UAAU,yCAAyCkT,KAAK,SAAS1Q,QAASsB,GAAlF,YAGA,2BAAK9D,UAAU,kB,+BAMnB,WACJ,MAAO,CACL,2BAAKhB,IAAI,UAAUwD,QAAS,kBAAM,EAAKN,SAAS,CAAEqB,MAAM,MACrDzD,KAAKC,MAAMsB,SAEdvB,KAAK4b,gB,2DChXL,IAAWC,EAmBAtC,E,yHAnBjB,SAAiBsC,GACC,EAAAC,mBAAhB,SAAmCvM,EAA2BwM,GAC5D,IAAIpB,EAAgC,GAChCqB,GAAiB,EAYrB,OAVAxb,EAAEkM,QAAQ6C,EAAaoL,QAAS,SAAS/J,GACnCoL,EACFrB,EAAQ/d,KAAKgU,GAGXA,EAAOa,IAAMsK,EAAYtK,KAC3BuK,GAAQ,KAILrB,GAfX,CAAiBkB,IAAgB,mBAAhBA,EAAgB,K,2BAmBjC,SAAiBtC,GAOf,SAAgBO,EACdvK,EACAqB,EACAqL,GAEA,IAAIC,EAAoB3f,OAAOyP,OAAO,GAAIuD,GAS1C,OAPA2M,EAAkBvB,QAAUna,EAAE2b,UAAUD,EAAkBvB,QAAS,SAAC5Z,GAIlE,OAHIA,EAAK0Q,IAAMb,EAAOa,KACpB1Q,EAAOxE,OAAOyP,OAAO,GAAIjL,EAAMkb,IAE1Blb,IAGFmb,EAdO,EAAApC,aAAY,EAiBZ,EAAAsC,cAAhB,SACE7M,EACA0M,GAOA,OALAzb,EAAEkM,QAAQuP,EAAU,SAACI,EAAiB7I,GACpC,IAAM5C,EAASpQ,EAAE8b,UAAU/M,EAAaoL,QAAS,CAAEnH,cACnDjE,EAAeuK,EAAavK,EAAcqB,EAAQyL,KAG7C9M,GAGO,EAAAiK,YAAhB,SAA4BjK,EAA2BgN,EAA0BN,GAC/E,IAAIC,EAAoB3f,OAAOyP,OAAO,GAAIuD,GAI1C,OAFA2M,EAAkBK,GAAShgB,OAAOyP,OAAO,GAAIkQ,EAAkBK,GAAQN,GAEhEC,GAzCX,CAAiB3C,IAAsB,yBAAtBA,EAAsB,M,+GCnBvC,W,2yBAMarV,E,YAAb,0B,4FAAA,U,sCACEnC,MAAQ,CACNya,UAAU,GAFd,E,sPAAyC,EAAA1c,W,sDASPgN,GAC9B,MAAO,CAAE0P,UAAU,O,2CAGH1P,EAAc2P,GAC1Bzc,KAAK0c,eACPjS,MAAM,UAAYqC,EAAMU,W,oCAK1B,MAAgC,qBAAzB/N,OAAOkd,SAASC,O,+BAIvB,OAAI5c,KAAK+B,MAAMya,SACNxc,KAAKC,MAAM4c,aAGb7c,KAAKC,MAAMwE,c,wDAvBb,EAAA5B,aAAkD,CACvDga,aAAc,O,uGCZlB,WACA,SACA,YACA,YACA,YACA,YACA,SACA,YACA,SACA,UACA,S,8iDAmBaC,E,YACX,WAAY7c,GAAuB,wBACjC,wBAAMA,KAoCR8c,iBAAmB,SAAC7a,GAClB,EAAKE,SAAS,CAAE4a,SAAW9a,EAAGiW,OAAevZ,QACxC,EAAKqe,aACR,EAAKhd,MAAMqI,OAAO,CAAE0U,SAAW9a,EAAGiW,OAAevZ,SAIrD,EAAAse,oBAAsB,SAACzT,GACrB,EAAKrH,SAAS,CAAE+a,YAAa1T,EAASc,YACjC,EAAK0S,aACR,EAAKhd,MAAMqI,OAAO,CAAE6U,YAAa1T,EAASc,aAI9C,EAAA6S,UAAY,WACV,EAAKhb,SAAS,SAACib,GAGb,MAAO,CAAE9V,MAFK,GAAH,SAAQ8V,EAAU9V,OAAlB,CAAyB+V,UAMxC,EAAAtP,aAAe,SAACjN,EAAsBwc,GACpC,EAAKnb,SACH,SAACib,GAGC,MAAO,CAAE9V,MAFK/G,EAAEgd,OAAOH,EAAU9V,MAAO,SAACoM,EAAO9R,GAAR,OAAsBA,GAAK0b,MAIrE,WACO,EAAKN,aACR,EAAKhd,MAAMqI,OAAO,CAAEf,MAAO,EAAKxF,MAAMwF,WAM9C,EAAAwG,aAAe,SAAChN,EAAsBwc,GAA6C,IAA1BE,IAA0B,yDACjF,EAAKrb,SACH,SAACib,GACC,IAAI9V,EAcJ,YAb0C,IAA/B8V,EAAU9V,MAAMgW,IACzBhW,EAAQ,EAAK8V,EAAU9V,QACjB3K,KAAKmE,GAEXwG,EAAQ/G,EAAEoB,IAAIyb,EAAU9V,MAAO,SAACoM,EAAO9R,GACrC,OAAIA,GAAK0b,EACAhhB,OAAOyP,OAAO,GAAI2H,EAAO5S,GAEzB4S,IAKN,CAAEpM,UAEX,WACE,GAAIkW,IAAW,EAAKR,YAAa,CAC/B,IAAMS,EAAeld,EAAEmd,IAAI,EAAK5b,MAAMwF,MAAO,SAACoM,GAAD,OAAYA,EAAMlC,KAAM,oBAAsB,KAC3F,EAAKxR,MAAMqI,OAAO,CAAEf,MAAO,EAAKxF,MAAMwF,OAASmW,OAcvD,EAAAE,SAAW,WACT,EAAKC,UAAU,CAAE5W,OAAQ,cAAgB,mBAG3C,EAAA6W,sBAAwB,WACtB,EAAKD,UAAU,CAAE5W,OAAQ,cAAgB,mBAG3C,EAAA8W,aAAe,WACb,EAAK9d,MAAMqI,OAAO,CAAErB,OAAQ,cAAgB,6BAG9C,EAAA+W,WAAa,WACX,EAAK/d,MAAMqI,OAAO,CAAErB,OAAQ,YAAc,2BAxH1C,EAAKlF,MAAQ,CACXob,YAAald,EAAMc,KAAKoc,YACxB5V,MAAOtH,EAAMc,KAAKwG,OAAS,GAC3BN,OAAQhH,EAAMc,KAAKkG,OACnB+V,SAAU/c,EAAMc,KAAKic,UAPU,E,WADJ,EAAA1Z,e,uCAa7B,OAAQtD,KAAKC,MAAMc,KAAKkd,M,8CAGL,IACX1W,EAAUvH,KAAK+B,MAAfwF,MAER,QAAKA,GAIU/G,EAAE0d,OAAO3W,EAAO,SAAC4W,EAAKC,GAAN,OAAeC,EAAID,EAAKE,MAAQH,GAAK,IACrD3d,EAAE0d,OAAO3W,EAAO,SAAC4W,EAAKC,GAAN,OAAeC,EAAID,EAAKG,OAASJ,GAAK,K,sCAMrE,OACE3d,EAAEJ,KAAKJ,KAAK+B,MAAMwF,OAAS,IAC1B/G,EAAEmd,IAAI3d,KAAK+B,MAAMwF,MAAO,SAACxG,GACxB,MAAyB,IAAlBA,EAAI,QAA6C,IAAzBA,EAAI,gBAA6BA,EAAI,OAAaA,EAAI,U,gCAsEjFyd,EAAcd,GACjB1d,KAAKye,gBAIVze,KAAKC,MAAMqI,OAAO/L,OAAOyP,OAAO,GAAIhM,KAAK+B,MAAOyc,GAAUd,GAHxDlT,QAAQC,MAAM,uG,yCAuBhB,IAAM1J,EAAOxE,OAAOyP,OAClB,CAAEhL,MAAOhB,KAAKC,MAAMc,KAAKkd,IAAhB,kBAAiCje,KAAKC,MAAMc,KAAKkd,KAAQ,gBAClEje,KAAKC,MAAMc,MAGb,OAAO,oBAAC,EAAA2d,kBAAD,CAAmB3d,KAAMA,M,mCAGxB,WACJwG,EAAQvH,KAAK+B,MAAMwF,MAEvB,OACE,oBAAC,EAAAtD,SAAD,KACE,oBAAC,UAAsB0a,SAAvB,KACG,SAACC,GAAD,OACCpe,EAAEoB,IAAI2F,EAAO,SAACsX,EAAKhd,GACjB,OACE,oBAACid,EAAD,CACE/d,KAAM8d,EACN3f,IAAK2C,EACL0b,UAAW1b,EACX+c,QAASA,EACT/O,WAAY,EAAK5P,MAAM4P,WACvBkP,UAAWve,EAAEJ,KAAKmH,GAAS,EAC3BoO,SAAU,EAAK5H,aACfiR,cAAe,EAAKhR,sB,sCASvB,IACHjN,EAASf,KAAKC,MAAdc,KAEFke,EAAwBjf,KAAKif,wBAE/BC,EAAsB,KACtBD,EACFC,EACE,qGACQne,EAAKkC,mBACfic,EAAsB,+EAGxB,IAAMC,GAAgBnf,KAAKid,aACzB,8BAAQ/c,UAAU,0CAA0CwC,QAAS1C,KAAKC,MAAM+e,eAC9E,yBAAG9e,UAAU,eADf,aAKF,OAAOF,KAAKid,YACV,2BAAK/c,UAAU,6BACb,oBAAC,UAAD,CACE0C,QAAQ,2EACRjC,UAAWse,EACX/e,UAAU,eACVqB,QACE,2BAAKrB,UAAU,kBACb,8BAAQA,UAAU,0BAA0BwC,QAAS1C,KAAK4d,SAAUjd,SAAUse,GAA9E,YAON,oBAAC,UAAD,CACErc,QAAQ,2EACRjC,UAAWse,EACX/e,UAAU,eACVqB,QACE,2BAAKrB,UAAU,kBACb,8BACEA,UAAU,0BACVwC,QAAS1C,KAAK8d,sBACdnd,SAAUse,GAHZ,yBAYR,oBAAC,EAAAhb,SAAD,KACGkb,EACD,oBAAC,EAAA3Y,yBAAD,CACEE,WAAY,CACVf,WAAY,sBACZjD,QAAS1C,KAAK+d,aACdhY,YAAakZ,EACT,qGACA,MAENtY,SAAU,CACRhB,WAAY,oBACZjD,QAAS1C,KAAKge,WACd1X,OAAQvF,EACRgF,YAAamZ,Q,+BAQrB,OACE,oBAAC,EAAAjb,SAAD,KACE,2BAAK/D,UAAU,WACZF,KAAKof,mBACN,6BAAOlf,UAAU,oBACf,iCACE,8BACE,qDACA,qDACA,sCACA,uCACA,iCAGJ,iCACGF,KAAKqf,aACLrf,KAAKC,MAAM4P,YACV,8BACE,0BAAI+E,QAAS,GACX,8BAAQxB,KAAK,SAASlT,UAAU,6BAA6BwC,QAAS1C,KAAKod,WAA3E,eACc,yBAAGld,UAAU,mBAOpCF,KAAKif,yBACJ,2BAAK/e,UAAU,qCACb,yBAAGA,UAAU,qCADf,iCAIF,2BAAKA,UAAU,cACb,oBAAC,UAAD,CACEiP,cAAc,yBACdV,WAAW,yBACX3D,gBAAgB,QAChBV,SAAUpK,KAAKC,MAAM4P,WACrB/T,KAAMkE,KAAK+B,MAAMob,YACjB7U,OAAQtI,KAAKkd,uBAIjB,2BAAKhd,UAAU,mCAAmCmC,MAAO,CAAE8S,UAAW,IACpE,6BAAO9S,MAAO,CAAE0U,YAAa,GAAIF,QAAS,eAAgBxG,WAAY,MAAtE,oBACCiP,WAAWC,aAAatU,IAAIC,KAAKsU,gBAAgBxf,KAAKC,MAAMiQ,aAAasD,aAG5E,2BAAKtT,UAAU,wCACb,6BAAOmC,MAAO,CAAE0U,YAAa,GAAIF,QAAS,eAAgBxG,WAAY,MAAtE,uBACsB,oBAAC,EAAAoP,eAAD,CAAgB1N,KAAK,8BAD3C,MAGA,8BACE7R,UAAU,aACVtB,MAAO,GAAKoB,KAAK+B,MAAMib,UAAY,IAAM,IAAM,IAC/C5U,SAAUpI,KAAK+c,kBAEf,8BAAQne,MAAM,KAAd,MACA,8BAAQA,MAAM,KAAd,SAIN,2BAAKsB,UAAU,WACZF,KAAK0f,gBACN,2BAAKxf,UAAU,mB,yBAwBnB4e,E,YACJ,WAAY7e,GAA0B,wBACpC,wBAAMA,KAmBR+e,cAAgB,SAAC9c,GACfA,EAAGC,iBACE,EAAKlC,MAAM8e,WAIhBvU,QAAQmV,QACN,mDACA,WACA,oBACA,SAAClhB,GACMA,GAIL,EAAKwB,MAAM+e,cAAc,EAAK/e,MAAMc,KAAM,EAAKd,MAAMsd,cAK3D,EAAAqC,eAAiB,SAAChhB,EAAemC,GAC/B,EAAKqB,SAAS,CAAEyd,OAAQ9e,EAAK8e,OAAQC,cAAe/e,EAAK+e,eAAiB,WACxE,EAAKC,kBAIT,EAAAC,eAAiB,SAAC9d,EAAoBtD,GACpC,EAAKwD,SAAS,CAAEyd,OAAQjhB,EAAOkhB,cAAe,MAGhD,EAAAG,qBAAuB,SAAC/d,EAAoBtD,GAC1C,EAAKwD,SAAS,CAAE0d,cAAelhB,EAAOihB,OAAQ,MAGhD,EAAAK,aAAe,WAAK,IACVtB,EAAY,EAAK3e,MAAjB2e,QAER,EAAKxc,SACH,SAACib,GACC,GAAwB,IAApBA,EAAUwC,QAA2C,IAA3BxC,EAAUyC,cACtC,OAAO,KAGT,GAAwB,IAApBzC,EAAUwC,QAA2C,IAA3BxC,EAAUyC,cACtC,OAAO,KAGT,GAAwB,IAApBzC,EAAUwC,OAAc,CAC1B,IAAMC,GAAwB,IAAAK,iBAAgBvB,EAASvB,EAAUwC,QAEjE,MAAO,CAAEA,OAAQxC,EAAUwC,OAAQC,iBAGrC,GAA+B,IAA3BzC,EAAUyC,cAAqB,CACjC,IAAMD,EAASrf,EAAEmK,KACfiU,EACA,SAAC7d,GAAD,OAAUA,EAAK+e,cAAcM,eAAiB/C,EAAUyC,cAAcM,gBAGxE,MAAO,CAAEP,OAAQA,EAASA,EAAOA,OAAS,GAAIC,cAAezC,EAAUyC,iBAG3E,kBAAM,EAAKC,kBAIf,EAAAM,cAAgB,SAAC9D,EAAyB3d,EAAe0hB,GAC1C,QAAT/D,EACF,EAAKna,SAAS,CAAEkc,KAAM1f,GAAS,kBAAM,EAAKmhB,aAAaO,KAEvD,EAAKle,SAAS,CAAEmc,MAAO3f,GAAS,kBAAM,EAAKmhB,aAAaO,MAvF1D,EAAKve,MAAQ,CACX8d,OAAQ5f,EAAMc,KAAK8e,OACnBC,cAAe7f,EAAMc,KAAK+e,cAC1BxB,KAAMre,EAAMc,KAAKud,KACjBC,MAAOte,EAAMc,KAAKwd,OAPgB,E,WADX,EAAAjb,e,0CAYQ,IAAtBma,IAAsB,yDAC3Be,EAAUjiB,OAAOyP,OAAO,GAAIhM,KAAKC,MAAMc,KAAMf,KAAK+B,OAC/B,IAArByc,EAAO,QAAgD,IAA5BA,EAAO,gBAA6BA,EAAO,MAAaA,EAAO,QAI9Fxe,KAAKC,MAAM0V,SAAS6I,EAASxe,KAAKC,MAAMsd,UAAWE,K,+BA6E/C,WACJ,OACE,8BACE,8BACE,oBAAC,UAAD,CACElW,MAAOvH,KAAKC,MAAM2e,QAClB2B,aAAc,SAACxf,GAAD,OAAUA,EAAK8e,QAC7BW,WAAY,SAACzf,EAAM0f,GACjB,OACE,2BAAKvhB,IAAK6B,EAAK0Q,GAAIvR,UAAW,SAAWugB,EAAgB,mBAAqB,KAC5E,+BAAM1f,EAAK8e,QACX,2BAAK3f,UAAU,eAAea,EAAK+e,iBAIzClhB,MAAOoB,KAAK+B,MAAM8d,OAClBzX,SAAUpI,KAAKggB,eACfU,SAAU1gB,KAAK4f,eACfe,WAAY,CAAEvN,KAAM,OAAQwN,YAAY,EAAOvW,UAAU,EAAMwW,OAAQ7gB,KAAKkgB,cAC5EY,iBAAkB,SAAC/f,EAAMnC,GACvB,OAAOmC,EAAK8e,OAAOxT,QAAQ,MAAO,IAAI0U,WAAWniB,EAAMyN,QAAQ,MAAO,MAExE2U,WAAY,SAACzZ,GACX,OACE,2BAAKrH,UAAU,oBAAoBmC,MAAO,CAAEb,SAAU,WAAYyf,OAAQ,MAAQxc,SAAU8C,KAGhG2Z,aAAc,CAAEhhB,WAAW,aAAG,CAAE4M,OAAQ9M,KAAK+B,MAAM8d,UACnDsB,aAAc,CAAEtK,QAAS,eAAgBrV,SAAU,eAEnDxB,KAAK+B,MAAM8d,QAAU,2BAAK3f,UAAU,uCAAf,cAEzB,8BACE,oBAAC,UAAD,CACEqH,MAAOvH,KAAKC,MAAM2e,QAClB2B,aAAc,SAACxf,GAAD,OAAUA,EAAK+e,eAC7BU,WAAY,SAACzf,EAAM0f,GACjB,OACE,2BAAKvhB,IAAK6B,EAAK0Q,GAAIvR,UAAW,SAAWugB,EAAgB,mBAAqB,KAC5E,+BAAM1f,EAAK+e,eACX,2BAAK5f,UAAU,eAAea,EAAK8e,UAIzCjhB,MAAOoB,KAAK+B,MAAM+d,cAClB1X,SAAUpI,KAAKigB,qBACfS,SAAU1gB,KAAK4f,eACfe,WAAY,CAAEvN,KAAM,OAAQwN,YAAY,EAAOvW,UAAU,GACzDyW,iBAAkB,SAAC/f,EAAMnC,GACvB,IAAMmT,EAAOhR,EAAK+e,cAAcsB,UAAU,OAAO/U,QAAQ,mBAAoB,IAAI+T,cACjF,OAAO5f,EAAEuG,IAAIsa,SAAStP,EAAMnT,EAAMwiB,UAAU,OAAO/U,QAAQ,mBAAoB,IAAI+T,gBAErFY,WAAY,SAACzZ,GACX,OACE,2BAAKrH,UAAU,oBAAoBmC,MAAO,CAAEb,SAAU,WAAYyf,OAAQ,MAAQxc,SAAU8C,KAGhG2Z,aAAc,CAAEhhB,WAAW,aAAG,CAAE4M,OAAQ9M,KAAK+B,MAAM+d,iBACnDqB,aAAc,CAAEtK,QAAS,eAAgBrV,SAAU,eAEnDxB,KAAK+B,MAAM+d,eAAiB,2BAAK5f,UAAU,uCAAf,cAEhC,8BACE,2BAAKA,WAAW,aAAG,CAAE4M,OAAQ9M,KAAK+B,MAAMuc,OAASte,KAAK+B,MAAMwc,SAC1D,oBAAC,UAAD,CACE1O,WAAY7P,KAAKC,MAAM4P,WACvBjR,MAAOoB,KAAK+B,MAAMuc,KAClB3d,WAAYX,KAAK+B,MAAMwc,MACvBnW,SAAU,SAAClG,EAAoBtD,GAArB,OAAuC,EAAKyhB,cAAc,OAAQzhB,GAAO,IACnFiiB,OAAQ,SAAC3e,EAAoBtD,GAArB,OAAuC,EAAKyhB,cAAc,OAAQzhB,GAAO,QAGnFoB,KAAK+B,MAAMuc,OACZte,KAAK+B,MAAMwc,OAAS,2BAAKre,UAAU,uCAAf,cAEvB,8BACE,2BAAKA,WAAW,aAAG,CAAE4M,OAAQ9M,KAAK+B,MAAMwc,QAAUve,KAAK+B,MAAMuc,QAC3D,oBAAC,UAAD,CACEzO,WAAY7P,KAAKC,MAAM4P,WACvBjR,MAAOoB,KAAK+B,MAAMwc,MAClB5d,WAAYX,KAAK+B,MAAMuc,KACvBlW,SAAU,SAAClG,EAAoBtD,GAArB,OAAuC,EAAKyhB,cAAc,QAASzhB,GAAO,IACpFiiB,OAAQ,SAAC3e,EAAoBtD,GAArB,OAAuC,EAAKyhB,cAAc,QAASzhB,GAAO,QAGpFoB,KAAK+B,MAAMwc,QACZve,KAAK+B,MAAMuc,MAAQ,2BAAKpe,UAAU,uCAAf,cAEtB,8BACGF,KAAKC,MAAM4P,YACV,oBAAC,UAAD,CACElP,SAAUX,KAAKC,MAAM8e,UACrBnc,QAAQ,gEACRrB,QACE,yBAAGgE,KAAK,IAAI7C,QAAS1C,KAAKgf,cAAetb,MAAM,iBAC7C,yBAAGxD,UAAU,qBAGjB+F,OAAO,uCACP/F,UAAU,uB,KASlBme,EAAM,SAACiD,GACX,IAAMC,EAAIC,WAAWF,GACrB,OAAOG,MAAMF,GAAK,EAAIA,GAGlBjE,EAAoB,WACxB,MAAO,CACLuC,OAAQ,GACRvB,KAAM,KACNC,MAAO,KACPuB,cAAe,M,mGCtjBnB,I,GAEe,EAFf,KAEexQ,eAAc,I,0ICFE,SAACsP,EAAiCiB,GAC/D,IAAI7D,EAAQxb,EAAE8b,UAAUsC,EAAS,CAAEiB,WAEnC,GAAI7D,EACF,OAAOA,EAAM8D,cAGf,IAAM4B,EAAc,SAASzjB,GAC3B,OAAOA,EAAEoO,QAAQ,MAAO,KAU1B,OAPA2P,EAAQxb,EAAE8b,UACR9b,EAAEoB,IAAIgd,EAAS,SAAS7d,GACtB,MAAO,CAAE8e,OAAQ6B,EAAY3gB,EAAK8e,QAAS8B,YAAa5gB,EAAK4gB,YAAa7B,cAAe/e,EAAK+e,iBAEhG,CAAED,OAAQ6B,EAAY7B,MAGT7D,EAAM8D,cAAgB,K,yHCJjC,SAAuB/N,GAAkC,IAApBzV,EAAoB,uDAAH,IAC1D,GAAY,MAARyV,EACF,OAAOA,EAITA,GADAA,EAAO6P,EAAoB7P,IACf1F,QAAQ,oBAAqB,wDAEzC,IAAIwV,GAAO,aAAa,GAAK9P,EAAMzV,EAAQ,CAAEwlB,cAAc,IAM3D,OAFAD,GADAA,GADAA,EAAOA,EAAKxV,QAAQ,qBAAsB,KAC9BA,QAAQ,sBAAuB,KAC/BA,QAAQ,eAAgB,KAExB/B,QA5Bd,I,EAAA,G,EAAA,S,2BAEM,SAAUsX,EAAoB7P,GAClC,OAAY,MAARA,EACKA,EAKTA,GADAA,GADAA,EAAOA,EAAKzH,OAAO+B,QAAQ,YAAa,KAC5BA,QAAQ,SAAU,OAClBA,QAAQ,UAAW,O,yGCTjC,cAEA,YACA,SACA,YACA,YACA,SACA,SACA,SACA,UACA,S,s0DAIA,IAAA0V,gBAAe,KAAM,W,IAcRC,E,YACX,WAAY/hB,GAAyB,wBACnC,wBAAMA,KAOAgiB,SAAiC,GAmDzC,EAAArE,SAAW,WACT,EAAKC,UAAU,CAAE5W,OAAQ,gBAG3B,EAAA6W,sBAAwB,WACtB,EAAKD,UAAU,CAAE5W,OAAQ,gBAG3B,EAAA8W,aAAe,WACb,EAAK9d,MAAMqI,OAAO,CAAErB,OAAQ,gBAG9B,EAAA+W,WAAa,WACX,EAAK/d,MAAMqI,OAAO,CAAErB,OAAQ,cAG9B,EAAAib,eAAiB,SAAC3F,GAchB,OAAO,EAAK4F,cAAc5F,EAbV,SAAChU,EAAyB6Z,EAAqB3Z,EAAmBsB,GAChF,IAAMnL,EAAQ2J,EAAOgC,UACR,YAATgS,GAAwB,EAAKU,aAA4C,GAA7Bzc,EAAEJ,KAAKI,EAAEuG,IAAIuD,KAAK1L,KAKlE,EAAKyjB,YAAL,KAAoB9F,EAAQ3d,IACxBqG,EAAE8D,WAAWgB,IACfA,KANAS,QAAQC,MAAM,+DAapB,EAAA6X,cAAgB,SAAC/F,GACf,OAAO,EAAK4F,cAAc5F,EAAO,SAACra,GAChC,EAAKmgB,YAAL,KAAoB9F,EAASra,EAAGiW,OAAevZ,WAInD,EAAA2jB,aAAe,SAAChG,GACd,OAAO,EAAK4F,cAAc5F,EAAO,SAAC3d,GAChC,EAAKyjB,YAAL,KAAoB9F,GAAQ,IAAAjb,QAAW1C,EAAO,mBAGlD,EAAA4jB,cAAgB,SAACjG,GACf,OAAO,EAAK4F,cAAc5F,EAAO,SAAC3d,GAChC,EAAKyjB,YAAL,KAAoB9F,EAAQ3d,OAIhC,EAAAogB,cAAgB,SAAC9c,GACX+C,EAAE8D,WAAW,EAAK9I,MAAM+e,gBAC1B,EAAK/e,MAAM+e,cAAc9c,IA5G3B,EAAKH,MAAQ,CACXnD,MAAOqB,EAAMc,MAJoB,E,WADJ,EAAAuC,e,yCAWnBiZ,EAAekG,GAK3B,OAJKziB,KAAKiiB,SAAS1F,KACjBvc,KAAKiiB,SAAS1F,GAASkG,GAGlBziB,KAAKiiB,SAAS1F,K,kCAIrB,OAA6B,MAAtBvc,KAAKC,MAAMc,KAAK0Q,K,kCAGb+M,GACVxe,KAAKoC,SAAS,SAACib,GACb,MAAO,CAAEze,MAAOrC,OAAOyP,OAAO,GAAIqR,EAAUze,MAAO4f,MAGhDxe,KAAKid,aACRjd,KAAKC,MAAMqI,OAAOkW,K,8BAIdkE,GACN,IAAKA,EACH,OAAO,KAGT,IAAMxkB,GAAI,cAAUwkB,GAEpB,OAAO,IAAAC,SAAYzkB,GAAKA,EAAI,O,+CAGL0kB,GACvB,OAAqB,OAAjBA,GAA0C,KAAjBA,EACpB,IAGe,IAAjBA,GAA0C,MAAjBA,EAAuB,IAAM,M,gCAGrDpE,GACJhe,EAAEqiB,QAAQ7iB,KAAK+B,MAAMnD,MAAMkkB,UAC7BtY,QAAQC,MAAM,4DAIhBzK,KAAKC,MAAMqI,OAAO/L,OAAOyP,OAAO,GAAIhM,KAAK+B,MAAMnD,MAAO4f,M,sCA2D3C,IACHzd,EAASf,KAAKC,MAAdc,KAEFoe,EAA2B,OAAZpe,EAAK0Q,IACxB,kCAAQvR,UAAU,0CAA0CwC,QAAS1C,KAAKgf,eACxE,6BAAG9e,UAAU,eADf,aAKF,OAAmB,OAAZa,EAAK0Q,GACV,+BAAKvR,UAAU,6BACb,kCAAQA,UAAU,0BAA0BwC,QAAS1C,KAAK4d,UAA1D,SAIA,kCAAQ1d,UAAU,0BAA0BwC,QAAS1C,KAAK8d,uBAA1D,sBAKF,wBAAC,EAAA7Z,SAAD,KACGkb,EACD,wBAAC,EAAA3Y,yBAAD,CACEE,WAAY,CAAEf,WAAY,sBAAuBjD,QAAS1C,KAAK+d,cAC/DpX,SAAU,CAAEhB,WAAY,oBAAqBjD,QAAS1C,KAAKge,WAAY1X,OAAQvF,Q,yCAOrF,IAAMA,EAAOxE,OAAOyP,OAClB,CAAEhL,MAAOhB,KAAKC,MAAMc,KAAK0Q,GAAK,EAAAnB,cAAcC,WAAWvQ,KAAKC,MAAMc,KAAK5C,MAAQ,kBAC/E6B,KAAKC,MAAMc,MAGb,OAAO,wBAAC,EAAA2d,kBAAD,CAAmB3d,KAAMA,M,+BAG5B,IACIA,EAASf,KAAKC,MAAdc,KACAnC,EAAUoB,KAAK+B,MAAfnD,MAER,OACE,wBAAC,EAAAqF,SAAD,KACE,+BAAK/D,UAAU,WACZF,KAAKof,mBAELre,EAAK0Q,IACJ,+BAAKvR,UAAU,oBACb,+CADF,oFAIF,wBAAC,UAAD,CACEA,UAAW,0BACX2G,kBAAkB,cAAI9F,EAAK0Q,IAAM,cACjC3V,KAAM8C,EAAMkkB,SACZ3iB,OAAmB,MAAXY,EAAK0Q,GACb3G,gBAAiB,CACfiY,mBACE,8FACF3d,OAAQrE,EAAK0Q,GAAK,IAAM,KAE1B1G,sBAAuB,CAAEhI,MAAO,GAAF,OAAK/C,KAAKC,MAAMiQ,aAAanN,MAA7B,cAAgDsI,QAAStK,EAAK0Q,IAC5F5D,OAAO,iBACPvF,OAAQtI,KAAKkiB,eAAe,YAC5B9S,aAAc,CAAE4T,UAAW,OAAQC,UAAW,IAAKC,MAAO,QAC1DliB,MAAM,8IAGR,mCAEA,+BAAKd,UAAU,cACb,wBAAC,UAAD,CACEpE,KAAM8C,EAAMukB,YACZhU,cAAc,+BACdV,WAAW,8BACX3D,gBAAiB,CACfiY,mBACE,+FAEJhY,sBAAuB,CAAEhI,MAAO,GAAF,OAAK/C,KAAKC,MAAMiQ,aAAanN,MAA7B,iBAAmDsI,QAAStK,EAAK0Q,IAC/F5D,OAAO,iBACPvF,OAAQtI,KAAKkiB,eAAe,kBAIhC,+BAAKhiB,UAAU,wBACb,+BAAKA,UAAU,UACb,iCAAOkjB,QAAQ,+BAAf,iCACA,wBAACC,EAAD,CACEzkB,MAAOA,EAAM0kB,YACblb,SAAUpI,KAAKwiB,cAAc,eAC7Be,MAAO,CAAE5H,YAAa,oBAAqBtZ,MAAO,CAAEwU,QAAS,oBAIjE,+BAAK3W,UAAU,UACb,iCAAOkjB,QAAQ,sCAAf,0BACA,wBAAC,UAAD,CACE3R,GAAG,qCACH+R,WAAW,aACXC,OAAO,KACPC,aAAW,EACXC,gBAAgB,aAChBzjB,UAAU,0BACVqb,SAAUvb,KAAK4jB,QAAQhlB,EAAMilB,oBAC7Bzb,SAAUpI,KAAKuiB,aAAa,yBAIhC,+BAAKriB,UAAU,wBACb,iCAAOkjB,QAAQ,gCAAf,2BACA,kCACE3R,GAAG,+BACH7S,MAAOoB,KAAK8jB,yBAAyBllB,EAAMgkB,cAC3Cxa,SAAUpI,KAAKsiB,cAAc,iBAE7B,kCAAQ1jB,MAAM,IAAd,aACA,kCAAQA,MAAM,KAAd,cACA,kCAAQA,MAAM,KAAd,aAKR,+BAAKsB,UAAU,WACZF,KAAK0f,gBACN,+BAAKxf,UAAU,mB,2BAanBmjB,E,YAsBJ,WAAYpjB,GAAoC,wBAC9C,wBAAMA,KApBR8jB,aAAe,CACblN,QAAS,eACTC,SAAU,QACVkN,YAAa,CACXC,KAAM,CACJnL,gBAAiB,QACjBxB,OAAQ,6BACRM,SAAU,IAEZ7W,KAAM,CACJ4W,QAAS,WACTuM,aAAc,6BACd,WAAY,CACVpL,gBAAiB,cAqBzB,EAAA1Q,SAAW,SAAC+b,EAAuBC,EAAkBC,EAA2BC,GAC9E,EAAKliB,SAAS,CAAExD,MAAOwlB,IACvB,EAAKnkB,MAAMmI,SAASgc,IAdpB,EAAKriB,MAAQ,CACXnD,MAAOqB,EAAMrB,OAGf,EAAK2lB,MAAQ/jB,EAAEoB,IAAIqJ,IAAIC,KAAKsZ,gBAAiB,SAACC,GAC5C,MAAO,CACLhT,GAAIgT,EAAKC,QACT7N,QAAS4N,EAAKtmB,QAV4B,E,WAtBX,EAAAmF,e,oCA2CnC,OACE,wBAAC,EAAAqhB,cAAD,GACEC,YAAU,EACVxR,KAAK,OACLxU,MAA2B,MAApBoB,KAAK+B,MAAMnD,MAAgB,GAAKoB,KAAK+B,MAAMnD,MAClDwJ,SAAUpI,KAAKoI,SACfyc,mBAAiB,GACb7kB,KAAKC,MAAMsjB,MANjB,CAOErjB,UAAU,iBACVmC,MAAOrC,KAAK+jB,eAEZ,wBAAC,EAAAe,QAAD,CAASvjB,QAAQ,IAAIzF,KAAMkE,KAAKukB,MAAOQ,kBAAgB,S,uCClV/D,YACA,YACA,Y,mDAIAzF,WAAW0F,SAASC,OAAOC,UAAY,EACvC5F,WAAW0F,SAASC,OAAOE,SAAW,IACtC7F,WAAW0F,SAASC,OAAOG,QAAU,IAEE,WAAnCna,IAAIC,KAAKqE,aAAagE,KAAK8R,MAC7B,IAAAC,QAAO,oBAAC,UAAD,CAAY/V,aAActE,IAAIC,KAAKqE,eAAkBgW,SAASC,eAAe,UAEpF,IAAAF,QAAO,oBAAC,UAAD,CAAK/V,aAActE,IAAIC,KAAKqE,eAAkBgW,SAASC,eAAe,U,wLCb/E,OACA,YAEA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,YAEA,SAGA,YACA,Y,81BAIqBC,E,YAEnB,WAAYxlB,GAA0B,O,4FAAA,UACpC,wBAAMA,KAmCRylB,YAAc,SAAC5d,EAAD,GAA0D,IAA9BsN,EAA8B,EAA9BA,MACxC,EAAKhT,SAAS,CAAEujB,YAAavQ,IAC7B,IAAMxE,GAAS,aAAO,EAAK7O,MAAMwN,aAAaoL,QAAS,CAAEvF,UACzDnK,IAAIC,KAAK0a,iBAAmBhV,EAAO4C,UACnCvO,EAAE,+BAAD,OAAgC2L,EAAOa,KAAMa,WAAW,UACzD7S,OAAOkd,SAASkJ,KAAO,SAAWzQ,GAGpC,EAAA0Q,UAAY,WACV,EAAK1jB,SAAS,CAAE2jB,gBAAgB,KAGlC,EAAAC,eAAiB,SAACpV,GAChB,EAAKxO,SAAS,SAACL,GACb,IAAIwN,EAAehT,OAAOyP,OAAO,GAAIjK,EAAMwN,cAQ3C,OAPAA,EAAaoL,SAAU,aAAMpL,EAAaoL,QAAS,SAAC5Z,GAClD,OAAIA,EAAKqU,MAAQ,IAAMxE,EAAOwE,MAAQ,GAC7BxE,EAEA7P,IAGJ,CAAEwO,mBAIb,EAAA0W,YAAc,SAACnqB,GACb,EAAKsG,SAAS,SAACL,GAGb,MAAO,CAAEwN,aAFUhT,OAAOyP,OAAO,GAAIjK,EAAMwN,aAAczT,OA7D3D,IAEI6pB,EACAO,EAHEC,EAAe1mB,OAAOkd,SAASkJ,KAAKxZ,QAAQ,UAAW,IAHzB,OAOhC8Z,GACFR,GAAeQ,EACfD,GAAiB,aAAO,EAAKjmB,MAAMsP,aAAaoL,QAAS,CAAEvF,MAAOuQ,KAGlEA,GADAO,GAAiB,aAAO,EAAKjmB,MAAMsP,aAAaoL,QAAS,CAAEyL,YAAY,KACxCF,EAAe9Q,MAAQ,KAGpD8Q,IACFjb,IAAIC,KAAK0a,iBAAmBM,EAAe1S,WAG7C,EAAKzR,MAAQ,CACX4jB,cACAjL,iBAAiB,cAAS,aAAM,EAAKza,MAAMsP,aAAaoL,QAAS,SAAC5Z,EAAM0Q,GAAP,OAAe1Q,EAAK0Q,GAAKA,EAAK,QAC/FgJ,eAAe,EACfsL,gBAAgB,EAChBxW,aAAc,EAAKtP,MAAMsP,cAxBS,E,sPAFP,EAAAzP,W,kDAkC7B,IAAMumB,EAAmB,IAAK,cAAO,aAASrmB,KAAKsmB,MAAO,CAAElT,KAAM,WAClEnO,EAAE,gBAAgB0F,KAAK,sBAAsB4b,IAAI,CAAErD,MAAOmD,EAAW,Q,gCAqC7DG,GACR,OAAOjb,QAAQ,YAAD,OACAvL,KAAKC,MAAMsP,aAAa2D,SAASzB,GADjC,8BACyDzR,KAAKC,MAAMsP,aAAagE,KAC1F9B,GAFS,YAEH+U,M,+CAKX,QAAK9gB,yBAAyB,yB,sCAOnB,WACX,IAAK1F,KAAKymB,yBACR,OAAO,KAGT,IAAKzmB,KAAK+B,MAAMwN,aAAa2D,SAASwT,OACpC,OAAO,KANE,MASgD1mB,KAAK+B,MAAxDgkB,EATG,EASHA,eAAgBrL,EATb,EASaA,gBAAiBD,EAT9B,EAS8BA,cAEnCG,EAAQ,CACZC,SAAU,yBAAG3a,UAAU,oBACvB4a,YAAa,yBAAG5a,UAAU,2BAC1B6a,UAAW,yBAAG7a,UAAU,qBACxB8a,aAAc,yBAAG9a,UAAU,4BAC3B+a,SAAU,yBAAG/a,UAAU,oBACvBgb,OAAQ,yBAAGhb,UAAU,mBAGjBya,EAAU3a,KAAKC,MAAMsP,aAAaoL,QACpCQ,EAA8C,IAElD,aAAUR,EAAS,SAAS/J,EAAQa,GAClC0J,EAAQve,KAAK,CACXgC,MAAO6S,EACPzQ,MAAO4P,EAAO5P,UAIlB,IAIMgD,EAAU,WACd,EAAK5B,SAAS,CAAE2jB,gBAAgB,KASlC,OACE,oBAAC,UAAD,CAAOtiB,KAAMsiB,EAAgB7X,WAAS,EAACE,OAAO,WAAWhO,KAAK,QAAQ4D,QAASA,EAAS9D,UAAU,YAChG,oBAAC,UAAMwB,OAAP,2CACA,oBAAC,UAAMC,QAAP,KACE,4BAAMyZ,OAAO,OAAOlb,UAAU,UAAUuF,OAAQzF,KAAK2mB,UAAU,WAC7D,2BAAKtkB,MAAO,CAAE8N,aAAc,SAA5B,mDADF,IAC8F,+BAC5F,oBAAC,UAAD,CACEhS,KAAK,UACLgd,QAASA,EACTE,eAAe,cACfC,cAAc,YACdC,SAAUb,EACVE,MAAOA,EACPxS,SA3BO,SAACsS,GAChB,EAAKtY,SAAS,CAAEsY,uBA4BV,oBAAC,UAAD,CAASc,YAAU,GAAnB,KACA,oBAAC,UAAD,KACE,oBAAC,UAAUC,MAAX,CAAiBlZ,OAAQkY,EAAe/X,QAvBjC,WACf,EAAKN,SAAS,SAACL,GACb,MAAO,CAAE0Y,eAAgB1Y,EAAM0Y,mBAsBvB,oBAAC,UAAD,CAAMtc,KAAK,gBADb,uBAGA,oBAAC,UAAUwD,QAAX,CAAmBY,OAAQkY,GACzB,oBAAC,UAAKiB,MAAN,CAAYvb,QAAM,GAChB,wDACA,2BAAKD,UAAU,YACZ,IACD,6BAAOyb,YAAY,sBAAsBxd,KAAK,cAAciV,KAAK,SAAU,QAKnF,8BAAQlT,UAAU,yCAAlB,WACA,8BAAQA,UAAU,yCAAyCkT,KAAK,SAAS1Q,QAASsB,GAAlF,YAGA,2BAAK9D,UAAU,kB,+BAOnB,WACE6L,EAAO/L,KAEL2lB,EAAgB3lB,KAAK+B,MAArB4jB,YAEFiB,EAAa5mB,KAAK6mB,gBAExB7mB,KAAKsmB,MAAQ,GAEb,IAAI3L,GAAgC,aAAS5O,EAAKhK,MAAMwN,aAAaoL,SAwCrE,OAvCAA,GAAU,aAASA,EAAS,aAE5B,aAAUA,EAAS,SAAS/J,EAAQ/O,GACjB,MAAb+O,EAAOa,KAIXb,EAAOqC,YAAclH,EAAKhK,MAAMwN,aAEhCxD,EAAKua,MAAM1pB,KAAK,CACdwW,KAAM,QACN0T,SAAU,WACR,OACE,oBAAC,UAAKC,KAAN,CACE7nB,IAAK0R,EAAOa,GACZ2D,MAAOxE,EAAOwE,MACdlV,UAAU,0BACV/B,KAAMyS,EAAO5P,MACb0B,QAASqJ,EAAK2Z,YACdnjB,OAAQojB,GAAe/U,EAAOwE,OAE9B,oBAAC,EAAAwD,oBAAD,CAAqBhI,OAAQA,MAInCoW,KAAM,kBACJ,oBAAC,UAAD,CACE9nB,IAAK0R,EAAOa,GACZwM,IAAKrN,EAAOwE,MACZ7S,OAAQojB,GAAe/U,EAAOwE,MAC9BxE,OAAQA,EACRf,WAAY9D,EAAKhK,MAAMwN,aAAa2D,SAASwT,OAC7Cte,SAAU2D,EAAKia,eACfC,YAAala,EAAKka,oBAMD,GAArBla,EAAKua,MAAMhqB,OAEX,2BAAK4D,UAAU,+BACb,6CACA,6BACE,4BAAMA,UAAU,sBADlB,4CACkF,KAEjF6L,EAAKhK,MAAMwN,aAAa2D,SAASwT,QAClC1mB,KAAKymB,0BAA4B,CAC/B,oBAAC,UAAD,CACEvnB,IAAI,SACJ0D,QAAQ,kBACRrC,MAAM,QACNkC,SAAO,EACPnC,KAAK,cACLoC,QAAS1C,KAAK8lB,UACdzjB,MAAO,CAAE8S,UAAW,UAEtB,2BAAKjW,IAAI,SAAS0nB,MAMtB5mB,KAAKymB,0BAA4B1a,EAAKhK,MAAMwN,aAAa2D,SAASwT,QACpE3a,EAAKua,MAAM1pB,KAAK,CACdwW,KAAM,SACN0T,SAAU,WACR,OACE,oBAAC,UAAKC,KAAN,CACE7nB,IAAI,OACJgB,UAAU,uBACVwD,MAAM,yCACNhB,QAAS,EAAKojB,WAEd,oBAAC,UAAD,CAAM3nB,KAAK,aAQnB,oBAAC,UAAmB8oB,SAApB,CAA6BroB,MAAO,CAAE2Q,aAAcvP,KAAK+B,MAAMwN,aAAcC,OAAQxP,KAAKimB,cACxF,2BAAKxU,GAAG,cAAcvR,UAAS,oBAAeF,KAAK+B,MAAMwN,aAAagE,KAAKQ,KAA5C,mBAC7B,oBAAC,UAAD,CAAKuS,MAAOtmB,KAAKsmB,MAAOX,YAAaA,EAAauB,kBAAkB,IAEnEN,U,gJChSX,WAEA,WACA,WACA,YACA,WACA,YACA,YACA,YACA,YAEA,YACA,S,81BAEqBO,E,YACnB,WAAYlnB,GAA+B,a,4FAAA,UACzC,wBAAMA,KAmBRmnB,WAAa,SAACxV,GACZ,QAAIA,EAAYyV,UAIZzV,EAAY0V,cAOlB,EAAAC,oBAAsB,SAAC3V,GACrB,OAAKlM,yBAAyB,wBAGzB,EAAKzF,MAAM4P,aAGZ+B,EAAYyV,SAIZzV,EAAY0V,eAOlB,EAAAE,UAAY,SAACrD,GACX,IAAMsD,EAAWtD,EAAMhM,OAAesP,QACtC,EAAKrlB,SACH,SAACL,GACC,IAAI6P,EAAcrV,OAAOyP,OAAO,GAAIjK,EAAM6P,aAG1C,OAFAA,EAAYR,QAAUqW,EAEf,CAAE7V,gBAEX,kBAAM,EAAK3R,MAAM0V,SAAS,EAAK5T,MAAM6P,YAAa,EAAK3R,MAAMmV,UAIjE,EAAAsS,gBAAkB,SAACvD,EAA6BroB,GAC9C,EAAKumB,YAAY,SAAUvmB,EAAK8C,QAGlC,EAAA+oB,eAAiB,SAACpL,GAAD,OAA2C,SAC1DhU,GAIE,IAHF6Z,EAGE,wDADFrY,GACE,gGACW,eAATwS,GACFtX,EAAEsI,QAAQ8L,+BAA+B,8CACzC,EAAKgJ,YAAY9F,EAAOhU,EAAOgC,UAAW,WACpCtF,EAAE8D,WAAWgB,IACfA,IAEF9E,EAAEqI,eAGJ,EAAK+U,YAAY9F,EAAOhU,EAAOgC,UAAWR,GAExCqY,GACF,EAAKhgB,SAAS,CAAEwlB,cAAc,MAIlC,EAAAhS,SAAW,WACTpL,QAAQ6L,eAAe,qDAAsD,WAAY,UAAW,SAAC5X,GACnG,GAAIA,EAIF,GAHAwG,EAAEsI,QAAQ8L,+BAA+B,8BACzC,EAAKpZ,MAAM2V,SAAS,EAAK3V,MAAMmV,OAE3B,EAAKnV,MAAM2R,YAAYH,GAAI,CAC7B,IAAMrG,EAAMG,QAAQ,YAAD,OACL,EAAKxJ,MAAM6P,YAAYP,OAAO4B,YAAYC,SAASzB,GAD9C,qCAGnBxM,EAAEkO,KAAK/H,EAAK,CACVgI,KAAM,OACNtX,KAAM,CAAE2V,GAAI,CAAEX,SAAU,EAAK7Q,MAAM2R,YAAYd,WAC/C2C,SAAU,SACT7H,KAAK,SAACC,GACHA,EAAIC,SAASxF,QACf,EAAKrG,MAAM4V,eAAe,CAAEhK,EAAIC,SAASxF,SAE3CrB,EAAEqI,mBAGJrI,EAAEqI,eAMV,EAAAN,SAAW,WACT,EAAK9D,oBAGP,EAAA2e,sBAAwB,SAAC3lB,GACvBA,EAAGC,iBACH,EAAKC,SAAS,CAAEwlB,cAAc,KAGhC,EAAAhe,mBAAqB,WACnB,EAAKV,oBAGP,EAAAW,mBAAqB,SAACC,EAA6BC,GACjD,EAAKb,mBACL,EAAK9G,SACH,SAACL,GACC,IAAI6P,EAA2BrV,OAAOyP,OAAO,GAAIjK,EAAM6P,aAGjDkE,EAAItS,YAAY,4BAAD,OAA6BsG,EAAQiM,WAAY,GACnE1J,QAAQ,MAAO,KACfA,QAAQ,MAAO,KAEZ2J,EAAK,IAAIC,OADL,cAAgBH,EAAI,6BACL,KAKzB,OAJAlE,EAAY0V,aAAe1V,EAAY0V,aAAajb,QAAQ2J,EAAI,IAEhE,EAAKqM,YAAY,eAAgBzQ,EAAY0V,cAEtC,CAAE1V,gBAEX,WACM3M,EAAE8D,WAAWgB,IACfA,OAlJN,EAAKhI,MAAQ,CACX6P,YAAa3R,EAAM2R,YACnBgW,cAAc,EACd5d,sBAAsB,GANiB,E,sPADI,EAAAlK,W,sDAWf4K,EAAqC2S,GACnE,OAAI3S,EAAUkH,YAAYN,YAAc+L,EAAUzL,YAAYN,WACrD,CAAEM,YAAalH,EAAUkH,aAG3B,S,iDA+IP,OAAOpR,EAAEwR,QAAQ8V,OAAO9nB,KAAKC,MAAMwV,UAAY,GAAI,EAAG,O,gDAItD,IAAI7D,EAAc5R,KAAK+B,MAAM6P,YAAYV,YACzC,OAAmB,MAAfU,EACK,IAGTA,EAAcA,EAAYvF,QAAQ,kBAAoB,wBAGpD,mEACArM,KAAK+nB,wBACL,YACAnW,K,iDAKF,IAAIoW,EAAgBhoB,KAAK+B,MAAM6P,YAAY0V,aAE3C,IAAKU,EACH,MAAO,GAKT,IAAIC,GAFJD,EAAgBA,EAAc1d,QAEA+B,QAAQ,sBAAc,4BAapD,OAFA4b,GAFAA,GADAA,GAFAA,GADAA,GADAA,GADAA,GADAA,EAAYA,EAAU5b,QAAQ,+BAAuB,kBAC/BA,QAAQ,iCAAyB,mBACjCA,QAAQ,SAAU,SAClBA,QAAQ,WAAY,SACpBA,QAAQ,UAAW,KAEnBA,QAAQ,qGAA2B,KACnCA,QAAQ,gFAAiB,SAEzBA,QAAQ,+BAAuB,yC,oCAMrDkQ,EACA3d,EACAmL,GAAsE,WAElEme,EAA0D,GAC9DloB,KAAKoC,SACH,SAACL,GACC,IAAI6P,EAA2BrV,OAAOyP,OAAO,GAAIjK,EAAM6P,aA2BvD,MA1ByB,IAArBpR,EAAEuG,IAAIuD,KAAK1L,KACbA,EAAQ,MAGRgT,EAAY2K,GADD,WAATA,IACqB3d,EAEFA,EAGvBspB,EAActrB,KAAK,CAAE2f,QAAO3d,UAEf,eAAT2d,IACF3K,EAAYR,QAAU,EAAKgW,WAAWxV,GACtCsW,EAActrB,KAAK,CAAE2f,MAAO,UAAW3d,MAAOgT,EAAYR,QAAU,EAAI,KAI/D,gBAATmL,GAC4B,MAA5B3K,EAAY0V,cACgB,IAA5B1V,EAAY0V,cACX1V,EAAYyV,SAEbzV,EAAYyV,OAAS,QACrBa,EAActrB,KAAK,CAAE2f,MAAO,SAAU3d,MAAO,WAGxC,CAAEgT,gBAEX,WACE,EAAK3R,MAAM0V,SAAS,EAAK5T,MAAM6P,YAAa,EAAK3R,MAAMmV,OACnDnQ,EAAE8D,WAAWgB,IACfA,EAAGme,O,kCAMC3L,EAA0C3d,EAAYmL,GAAe,WAC/E/J,KAAKmoB,cAAc5L,EAAO3d,EAAO,SAACspB,GAChC,EAAKE,wBAAwBF,EAAe,WAC1C,EAAKhf,kBAAiB,GAClBjE,EAAE8D,WAAWgB,IACfA,U,8CAMgBjO,GAAqE,WAArBiO,EAAqB,uDAAJ,KACjFse,EAAmD,CACvD5W,GAAI,CAAEX,SAAU9Q,KAAK+B,MAAM6P,YAAYd,UACvCwC,QAAStT,KAAK+B,MAAM6P,YAAYP,OAAO4B,YAAYM,KAAK9B,GACxD+B,UAAWxT,KAAK+B,MAAM6P,YAAYP,OAAOmC,UACzC1X,QAEIsP,EAAMG,QAAQ,YAAD,OAAavL,KAAK+B,MAAM6P,YAAYP,OAAO4B,YAAYC,SAASzB,GAAhE,8BACdzR,KAAK+B,MAAM6P,YAAYH,IAC1BxM,EAAEsI,QAAQ8L,+BAA+B,2BAE3CpU,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAMusB,EAAa5U,SAAU,SAAU7H,KAAK,SAACC,GACnEA,EAAIC,SAAJ,MACF,EAAK1J,SAAS,CAAEwP,YAAarV,OAAOyP,OAAO,GAAI,EAAKjK,MAAM6P,YAAa/F,EAAIC,SAASxF,UACpFrB,EAAEqI,aAGJ,EAAKrN,MAAM4V,eAAehK,EAAIC,SAAS6O,QAAS9O,EAAIC,SAASwc,SACzDrjB,EAAE8D,WAAWgB,IACfA,Q,yCAKsC,WAA3Bwe,IAA2B,yDACtCA,GACFvoB,KAAKoC,SAAS,CAAE4H,sBAAsB,IAGxC,IAAMoB,EAAMG,QAAQ,YAAD,OACLvL,KAAK+B,MAAM6P,YAAYP,OAAO4B,YAAYC,SAASzB,GAD9C,0CAGnBxM,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,MAAOtX,KAAM,CAAEgV,SAAU9Q,KAAK+B,MAAM6P,YAAYd,UAAY2C,SAAU,SAAU7H,KAAK,SAACC,GACxG,EAAKsc,cAAc,cAAetc,EAAIC,SAASqF,aAC/C,EAAK/O,SAAS,CAAE4H,sBAAsB,Q,+BAIpC,WACI4H,EAAgB5R,KAAK+B,MAArB6P,YAEJ4W,EAAuB,CAAE,QAAS,KAAM,KAAM,SAAU,YAAa,SAAU,aACnFA,EAAgBA,EAAc5mB,IAAI,SAAC+R,GAAD,MAAY,CAAEzU,IAAKyU,EAAO/U,MAAO+U,EAAO5B,KAAM4B,KAEhF,IAAM8U,EAAuBzoB,KAAK0oB,0BAC5BC,EAAuB,CAC3Brd,UAAWC,QACT,YACEqG,EAAYP,OAAO4B,YAAYC,SAASzB,GACxC,qBACAG,EAAYP,OAAO4B,YAAYM,KAAK9B,GACpC,qBACAG,EAAYP,OAAOmC,UACnB,2CACA5B,EAAYd,UAEhBtF,eAAgBD,QACd,YACEqG,EAAYP,OAAO4B,YAAYC,SAASzB,GACxC,qBACAG,EAAYP,OAAO4B,YAAYM,KAAK9B,GACpC,qBACAG,EAAYP,OAAOmC,UACnB,2CACA5B,EAAYd,UAEhBrF,qBAAsBF,QACpB,YACEqG,EAAYP,OAAO4B,YAAYC,SAASzB,GACxC,qBACAG,EAAYP,OAAO4B,YAAYM,KAAK9B,GACpC,qBACAG,EAAYP,OAAOmC,UACnB,wDACA5B,EAAYd,UAEhB8X,0BAA0B,GAGtBC,EAAqB,CACzBvd,UAAWC,QACT,YACEqG,EAAYP,OAAO4B,YAAYC,SAASzB,GACxC,qBACAG,EAAYP,OAAO4B,YAAYM,KAAK9B,GACpC,qBACAG,EAAYP,OAAOmC,UACnB,yCACA5B,EAAYd,UAEhBtF,eAAgBD,QACd,YACEqG,EAAYP,OAAO4B,YAAYC,SAASzB,GACxC,qBACAG,EAAYP,OAAO4B,YAAYM,KAAK9B,GACpC,qBACAG,EAAYP,OAAOmC,UACnB,yCACA5B,EAAYd,UAEhBrF,qBAAsBF,QACpB,YACEqG,EAAYP,OAAO4B,YAAYC,SAASzB,GACxC,qBACAG,EAAYP,OAAO4B,YAAYM,KAAK9B,GACpC,qBACAG,EAAYP,OAAOmC,UACnB,sDACA5B,EAAYd,UAEhB8X,0BAA0B,GAGtBE,EACJ,2BAAKzmB,MAAO,CAAEb,SAAU,aACtB,oBAAC,UAAD,CAAQc,UAAQ,EAACC,OAAQvC,KAAK+B,MAAMiI,sBAClC,oBAAC,UAAD,CAAQ1H,UAAQ,KAElB,oBAAC,EAAAwL,oBAAD,CACEtE,YAAaoI,EAAYT,YACzBpD,aAAc/N,KAAK4J,mBACnBoE,aAAchO,KAAK6J,sBAKrBkf,EAAmB,KAavB,OAZI/oB,KAAKC,MAAM4P,YAAcnK,yBAAyB,wBACpDqjB,EACE,oBAAC,UAAD,CACEC,UAAQ,EACRjU,QAAQ,OACRzU,KAAK,0BACLsC,QAAQ,uBACRF,QAAS1C,KAAK4V,YAMlB,oBAAC,UAAMlB,IAAP,CACExU,UAAS,4CAAuCF,KAAKC,MAAMwV,UAAY,EAAI,OAAS,OACpFhE,GAAE,4BAAuBG,EAAYd,WAErC,oBAAC,UAAMmE,KAAP,CAAY/U,UAAU,SAAS+oB,YAAU,GACvC,6BAAO/oB,UAAU,sBACf,6BACEuR,GAAE,mBAAcG,EAAYH,IAC5B2B,KAAK,WACLqU,QAAS7V,EAAYR,QACrBzQ,SAAUX,KAAKunB,oBAAoB3V,GACnChT,MAAM,IACNwJ,SAAUpI,KAAKwnB,YAEjB,4BAAMtnB,UAAU,eAEjBF,KAAKC,MAAM4P,YACZ7P,KAAKC,MAAMyV,YACXhQ,yBAAyB,sBACvB,2BAAKxF,UAAU,eACb,2BAAKA,UAAU,6BAIrB,oBAAC,UAAM+U,KAAP,CAAYiO,MAAM,IAAIhjB,UAAU,oBAC9B,oBAAC,UAAD,CACEA,UAAU,0BACV4K,gBAAiB6d,EACjBzZ,QAASuZ,EACT3sB,KAAM8V,EAAYV,YAClB7G,UAAQ,EACRrJ,MAAM,IACNyN,WAAW,gCACXhL,MAAOmO,EAAYH,KAAOG,EAAYV,YACtC9G,SAAUpK,KAAKC,MAAM4P,YAAcnK,yBAAyB,oBAC5D8I,YAAaua,EACbtgB,UAAQ,EACRH,OAAQtI,KAAK2nB,eAAe,kBAGhC,oBAAC,UAAM1S,KAAP,CAAY5S,MAAO,CAAE6gB,MAAO,SACzBljB,KAAKC,MAAM4P,YAAcnK,yBAAyB,qBACjD,oBAAC,UAAD,CACEiW,YAAY,gBACZzb,UAAU,qBACVtB,MAAOgT,EAAYyV,OACnB6B,WAAS,EACT9gB,SAAUpI,KAAK0nB,gBACfvM,QAASqN,IAGX,gCAAO5W,EAAYyV,SAGvB,oBAAC,UAAMpS,KAAP,CAAYiO,MAAM,IAAIhjB,UAAU,qBAC9B,oBAAC,UAAD,CACEA,UAAU,2BACV4K,gBAAiB+d,EACjB3Z,QAASlP,KAAKmpB,2BACdrtB,KAAM8V,EAAY0V,aAClBtmB,MAAOynB,EACPhlB,KAAMzD,KAAK+B,MAAM6lB,aACjBxd,SAAUpK,KAAKC,MAAM4P,YAAcnK,yBAAyB,qBAC5D+C,UAAQ,EACRH,OAAQtI,KAAK2nB,eAAe,gBAC5B3jB,QAAS,kBAAM,EAAK5B,SAAS,CAAEwlB,cAAc,KAC7C5a,SAAUhN,KAAKgN,SACftD,eAAgB1J,KAAK6nB,sBACrBha,OAAQib,KAGZ,oBAAC,UAAM7T,KAAP,CAAY/U,UAAU,eACpB,+BACE,yBAAGqF,KAAK,IAAIrF,UAAU,aAAawC,QAAS1C,KAAK6nB,uBAC/C,oBAAC,UAAD,CAAOnP,UAAQ,EAAC0Q,UAAQ,EAAC7oB,MAAM,QAAQH,KAAK,QACzCI,EAAEJ,KAAKwR,EAAYT,cAEtB,oBAAC,UAAD,CAAMhT,KAAK,eAAe+B,UAAU,wBAI1C,oBAAC,UAAM+U,KAAP,CAAYC,UAAU,QAAQ+T,YAAU,EAAC/oB,UAAU,YAChDF,KAAKC,MAAM4P,YACZnK,yBAAyB,uBACvB,oBAAC,UAAD,CACExF,UAAU,SACVC,QAAM,EACNkpB,UAAU,OACV/oB,MAAM,EACNiB,QAAS,oBAAC,UAAD,CAAMpD,KAAK,oBAAoBoC,MAAM,UAE9C,oBAAC,UAAS+oB,KAAV,KACE,oBAAC,UAASvC,KAAV,CAAezmB,KAAK,0BAA0BsC,QAAQ,uBAAuBF,QAAS1C,KAAK4V,oB,gJC1f3G,gBACA,WACA,U,olBAEmB,SAAC3V,GACd,IAAEwE,EAA6BxE,EAA7BwE,SAAU,oBAQhB,OAPA8kB,EAAYrpB,WAAY,aAAGqpB,EAAYrpB,UAAW,UAClDqpB,EAAc,OAAH,QAAKjpB,MAAM,EAAM8G,OAAO,EAAM3E,SAAS,EAAMrC,KAAM,OAAQsD,MAAO,UAAa6lB,QAEnE,IAAZ9kB,IACTA,EAAW,oBAAC,UAAD,CAAMtG,KAAK,gBAAgBoC,MAAM,QAAQH,KAAK,WAIzD,oBAAC,UAAD,KAAYmpB,EAAZ,CAAyBnW,KAAK,WAC3B3O,I,gHCfP,WAEA,WACA,WACA,Y,81BAEM+kB,E,YAAN,0B,4FAAA,U,sCAaE7P,kBAAoB,WAClB,IAAMvO,EAAMG,QAAQ,YAAD,OACL,EAAKtL,MAAM2Q,OAAOqC,YAAYC,SAASzB,GADlC,8BAC0D,EAAKxR,MAAM2Q,OAAOqC,YAAYM,KACtG9B,GAFc,mBAED,EAAKxR,MAAM2Q,OAAO4C,UAFjB,UAIfiW,EACiB,WAAnB,EAAKxpB,MAAMmT,KAAoB,sCAAwC,qCACzEnO,EAAEsI,QAAQ8L,+BAA+BoQ,IACzCxkB,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,CAAE8d,GAAI,KAAOnG,SAAU,SAAU7H,KAAK,SAACC,GACnEA,EAAIgO,WACN5U,EAAEqI,YACF9C,QAAQC,MAAMoB,EAAI2B,WAElB,EAAKsM,aAAajO,EAAIC,SAASxF,QAC/BrB,EAAEqI,gBAKR,EAAAyM,gBAAkB,WAChB,IAAM3O,EAAMG,QAAQ,YAAD,OACL,EAAKtL,MAAM2Q,OAAOqC,YAAYC,SAASzB,GADlC,8BAC0D,EAAKxR,MAAM2Q,OAAOqC,YAAYM,KACtG9B,GAFc,mBAED,EAAKxR,MAAM2Q,OAAO4C,UAFjB,UAIfiW,EACiB,WAAnB,EAAKxpB,MAAMmT,KAAoB,oCAAsC,mCACvEnO,EAAEsI,QAAQ8L,+BAA+BoQ,IACzCxkB,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,CAAE8d,GAAI,KAAOnG,SAAU,SAAU7H,KAAK,SAACC,GACnEA,EAAIgO,WACN5U,EAAEqI,YACF9C,QAAQC,MAAMoB,EAAI2B,WAElB,EAAKsM,aAAajO,EAAIC,SAASxF,QAC/BrB,EAAEqI,gBAWR,EAAAqI,SAAW,SAACgF,EAA+B+O,GACpCzkB,EAAE0kB,QAAQhP,KACbA,EAAU,CAAEA,IAEd,EAAKb,aAAaa,EAAQ,IAG1BA,EAAUna,EAAEopB,KAAKjP,GACbna,EAAEJ,KAAKua,IACTna,EAAEkM,QAAQiO,EAAS,SAAC/J,GAClB,IAAIyJ,EAAU7Z,EAAEmK,KAAK,EAAK1K,MAAM2Q,OAAOqC,YAAY0H,QAAS,CAAEnH,UAAW5C,EAAO4C,YAChF6G,EAAU9d,OAAOyP,OAAOqO,EAASzJ,KAMjC8Y,GACFlpB,EAAEkM,QAAQgd,EAAe,SAACG,GACxB,IAAIjZ,EAASpQ,EAAEmK,KAAK,EAAK1K,MAAM2Q,OAAOqC,YAAY0H,QAAS,CAAEnH,UAAWqW,EAAkBrW,YAE1F,OAAQqW,EAAkBC,KACxB,IAAK,SACHlZ,EAAOC,aAAajU,KAAKitB,EAAkB/tB,MAC3C,MACF,IAAK,SACH8U,EAAOC,aAAerQ,EAAEoB,IAAIgP,EAAOC,aAAc,SAASe,GACxD,OAAIA,EAAYd,UAAY+Y,EAAkB/tB,KAAKgV,SAC1CvU,OAAOyP,OAAO4F,EAAaiY,EAAkB/tB,MAE7C8V,QAvFvB,E,sPAA4F,EAAA9R,W,sDAK1D4K,EAA+B2S,GAC7D,OAAI3S,EAAUkG,OAAOuB,WAAakL,EAAUlL,UACnC,CAAEA,UAAW,GAAKzH,EAAUkG,OAAOuB,WAGrC,S,sCAyCIkI,GACX,IAAIzJ,EAA6BrU,OAAOyP,OAAOhM,KAAKC,MAAM2Q,OAAQyJ,GAClEra,KAAKC,MAAMmI,SAASwI,GACpB5Q,KAAKoC,SAAS,CAAE+P,UAAW,GAAKvB,EAAOuB,c,kDA2CvC,OAAO,O,gDAIP,IAAI4X,EAAgC,WAAnB/pB,KAAKC,MAAMmT,KAAoB,eAAiB,cACjE,OAAI5S,EAAEsT,SAAS,CAAE,IAAK,IAAK,KAAO9T,KAAK+B,MAAMoQ,YAAcnS,KAAKgqB,4BAE5DD,EAAa,kGAENvpB,EAAEsT,SAAS,CAAE,KAAO9T,KAAK+B,MAAMoQ,WAEtC4X,EACA,iHAEO/pB,KAAKC,MAAM2Q,OAAOsJ,YAAYC,WAAa,EAElD4P,EACA,wIAIG,O,4CAIP,IAAK/pB,KAAKC,MAAM4P,WACd,OAAO,KAGT,IAEItJ,EAFEF,EAAyBrG,KAAKsa,0BAG9B1J,EAAS5Q,KAAKC,MAAM2Q,OAC1B,GACEA,EAAO3N,kBACP2N,EAAO1N,gBACP9B,KAAKnC,OAAO2R,EAAO3N,kBAAoB7B,KAAKnC,OAAO2R,EAAO1N,gBAC1D,CACA,IAAI6mB,EAAgC,WAAnB/pB,KAAKC,MAAMmT,KAAoB,eAAiB,cACjE7M,EACE,oBAAC,UAAD,CACEhF,QAAS,oBAAC,UAAD,CAAMhB,MAAM,MAAMpC,KAAK,mBAChCyE,QAASmnB,EAAa,+DAK5B,IAAMjkB,EAA2B9F,KAAKgqB,4BAEtC,OACE,2BAAK9pB,UAAU,6BACZwF,yBAAyB,oBACxB,oBAAC,UAAD,CACEnE,QACE,2BAAKrB,UAAU,kBACb,oBAAC,UAAD,CACE8F,SAAO,EACP1F,MAAI,EACJmC,SAAO,EACPC,QAAS1C,KAAK2Z,kBACdhZ,SAAsC,MAA5BmF,GAET,IACD,oBAAC,UAAD,CAAM3H,KAAK,UARb,gBAYJyE,QAASkD,EACTG,OAAO,gDACPtF,SAAsC,MAA5BmF,EACV5F,UAAU,eACVgG,GAAG,UAGNR,yBAAyB,CAAE,mBAC1B,oBAAC,UAAD,CACEnE,QACE,2BAAKrB,UAAU,kBACb,oBAAC,UAAD,CACEK,MAAM,QACND,MAAI,EACJmC,SAAO,EACPC,QAAS1C,KAAK+Z,gBACdpZ,SAAoC,MAA1B0F,GAET,IACD,oBAAC,UAAD,CAAMlI,KAAK,QAAQoc,QAAM,IACzB,oBAAC,UAAD,CAAMpc,KAAK,UATb,aASkCoI,IAItC3D,QAASyD,EACTJ,OAAO,8CACPtF,SAAoC,MAA1B0F,EACVnG,UAAU,eACVgG,GAAG,gB,gCA/LN,EAAArD,aAAe,CACpBuQ,KAAM,W,MAsMKoW,E,gHC9Mf,WAEA,YACA,YACA,YAEA,WAEA,SACA,YACA,SACA,SACA,SACA,SAEA,SAEA,U,6iCAYqBS,E,YAArB,0B,4FAAA,U,sCAQEloB,MAAgC,CAC9BmoB,UAAW,KACX9X,yBAAyB,GAO3B,EAAA+X,WAAa,SAACppB,GACZ,EAAKqB,SAAS,CAAE8nB,UAAWnpB,KAG7B,EAAAqpB,cAAgB,WACd,EAAKhoB,SAAS,CAAE8nB,UAAW,QAtB/B,E,sPAA+C,EAAApqB,W,kDAazB2F,GAClB,YAAuD,IAAzCzF,KAAKC,MAAMsU,YAAX,WAA2B9O,KAA6BzF,KAAKC,MAAMsU,YAAX,WAA2B9O,M,6CAW/E,WAClB,GAAIzF,KAAK+B,MAAMqQ,wBAAyB,OACLpS,KAAKoZ,QAA9B7J,EAD8B,EAC9BA,aAAcC,EADgB,EAChBA,OAqBtB,OACE,oBAAC,EAAA6a,8BAAD,CACEzZ,OAAQ5Q,KAAKC,MAAM2Q,OACnBtI,OAvBwB,SAACgiB,GAC3B,IAAMlf,EAAMG,QAAQ,YAAD,OACLgE,EAAa2D,SAASzB,GADjB,8BACyClC,EAAagE,KAAK9B,GAD3D,mBACwE,EAAKxR,MAAM2Q,OACjG4C,UAFc,UAInBvO,EAAEsI,QAAQ8L,+BAA+B,0BAEzCpU,EAAEkO,KAAK/H,EAAK,CAAEgI,KAAM,OAAQtX,KAAM,CAAE8d,GAAI,IAAK2Q,gBAAiBD,GAAe7W,SAAU,SAAU7H,KAAK,SAACC,GACrG,IAAIqQ,EAAoB,EAAA3C,uBAAuBO,aAC7CvK,EACA,EAAKtP,MAAM2Q,OACX/E,EAAIC,SAASxF,QAEfkJ,EAAO0M,GACPjX,EAAEqI,cAGJ,EAAKlL,SAAS,CAAEgQ,yBAAyB,KAOvCpO,QAAS,kBAAM,EAAK5B,SAAS,CAAEgQ,yBAAyB,U,+BAM1D,WACEgE,EAAcpW,KAAKC,MAAM2Q,OAAOqC,YAAYC,SAASzB,GACrD6B,EAAUtT,KAAKC,MAAM2Q,OAAOqC,YAAYM,KAAK9B,GAC7C+B,EAAYxT,KAAKC,MAAM2Q,OAAO4C,UAC9BgX,EAAiE,MAApDxqB,KAAKC,MAAM2Q,OAAOqC,YAAYC,SAASuX,UAEpDC,EAAW,YAAH,OAAetU,EAAf,iBAAmC9C,EAAnC,mBAAqDE,EAArD,KAERmX,EAAW3qB,KAAKC,MAAM2Q,OAAOsJ,YAE7B3W,EAAaC,YAAY,yBAE/B,OACE,oBAAC,EAAAS,SAAD,KACE,2BACE/D,WAAW,aAAG,gDAAiD,CAAEqC,OAAgC,MAAxBvC,KAAK+B,MAAMmoB,YACpFxnB,QAAS,kBAAM,EAAK0nB,mBAEtB,oBAAC,UAAD,CAAMQ,MAAM,QAAQC,UAAQ,EAACpoB,SAAO,EAACnC,MAAI,EAACJ,UAAU,+BAA+BuR,GAAG,qBACpF,oBAAC,UAAK6X,KAAN,KACG9oB,EAAEoB,IAAI5B,KAAKC,MAAMsU,YAAa,SAACuW,EAA2B5rB,GACzD,GAAwB,KAApBA,EAAI8T,OAAO,EAAG,IAA4B,OAAf8X,EAC7B,OAAO,KAGT,IAAMC,EAAWD,EAAWpoB,QAK5B,OAJAooB,EAAWpoB,QAAU,SAACR,EAASpG,GAC7B,EAAKsuB,gBACLW,EAAS7oB,EAAIpG,IAER,oBAAC,UAAKirB,KAAN,GAAW7nB,IAAKA,GAAS4rB,MAGjC9qB,KAAKC,MAAM2Q,OAAOqC,YAAYC,SAASwT,QACxChhB,yBAAyB,yBACzB1F,KAAKgrB,oBAAoB,gBACvB,oBAAC,UAAKjE,KAAN,CACE3S,MAAI,EACJ1Q,MAAM,gCACNhB,QAAS,SAACR,GACR,EAAKkoB,gBACL,EAAKhoB,SAAS,CAAEgQ,yBAAyB,MAG3C,oBAAC,UAAKvR,MAAN,CAAYT,KAAK,SACf,oBAAC,UAAD,CAAMjC,KAAK,iBACX,oBAAC,UAAD,CAAM2C,QAAM,EAAC3C,KAAK,WAIvB6B,KAAKirB,uBAELT,GACDxqB,KAAKgrB,oBAAoB,YACvB,oBAAC,EAAAE,wBAAD,CACE3pB,QACE,oBAAC,UAAKwlB,KAAN,CACErjB,MAAM,6BACNpD,KAAM,CAAEnC,KAAM,UAAWiC,KAAM,SAC/BsC,QAAS1C,KAAKoqB,gBAGlBhf,IAAKG,QAAQmf,EAAW,WAK9B,oBAAC,UAAKpB,KAAN,KACGtpB,KAAKgrB,oBAAoB,YACxB,oBAAC,EAAAG,eAAD,CACEtnB,QAAS8mB,EAASS,QAClBlb,aAAc,CAAEoD,UAASE,YAAWzQ,MAAO,UAC3CU,KAA8B,UAAxBzD,KAAK+B,MAAMmoB,UACjBmB,OAAQrrB,KAAKmqB,WACbmB,aAAc,OAGjBtrB,KAAKgrB,oBAAoB,aACxB,oBAAC,EAAAO,iBAAD,CACED,aAAc,EAAAE,gCAAgCC,cAC9C5nB,QAAS8mB,EAASe,UAClBxb,aAAc,CAAEoD,UAASE,YAAWzQ,MAAO,YAC3CU,KAA8B,YAAxBzD,KAAK+B,MAAMmoB,UACjBmB,OAAQrrB,KAAKmqB,aAGhBnqB,KAAKgrB,oBAAoB,aACxB,oBAAC,UAAKjE,KAAN,CACE4E,GAAG,IACHzrB,UAAU,SACVqF,KAAMgG,QAAQmf,EAAW,YACzBhnB,MAAM,WACNhB,QAAS1C,KAAKoqB,eAEd,oBAAC,UAAD,CAAOzmB,IAAKJ,EAAa,eAAgBnD,KAAK,UAPhD,IAO4D,IAC1D,oBAAC,UAAD,CACEA,KAAK,OACLF,UAAU,QACVkpB,UAAQ,EACR1Q,UAAQ,EACR9V,QAAS+nB,EAASiB,UAClBrrB,MAA6B,GAAtBoqB,EAASiB,UAAiB,QAAU,SAIhD5rB,KAAKgrB,oBAAoB,aACxB,oBAAC,EAAAa,iBAAD,CACEhoB,QAAS8mB,EAASxQ,WAClBjK,aAAc,CAAEoD,UAASE,YAAWzQ,MAAO,YAC3CuoB,aAAc,EAAAQ,gCAAgCL,YAAYzrB,KAAKoZ,SAC/D3V,KAA8B,YAAxBzD,KAAK+B,MAAMmoB,UACjBmB,OAAQrrB,KAAKmqB,cAIlBnqB,KAAKgrB,oBAAoB,QACxB,oBAAC,UAAK1B,KAAN,KACE,oBAAC,UAAKvC,KAAN,CACE4E,GAAG,IACHpmB,KAAMgG,QAAQmf,EAAW,WACzBvS,OAAO,SACPzU,MAAM,oBACNd,QAAS,oBAAC,UAAD,CAAOe,IAAKJ,EAAa,mBAAoBnD,KAAK,oB,4CAnLlE,EAAAqZ,YAAc,UACd,EAAA5W,aAAe,CACpB0R,YAAa,K,mJChCjB,WACA,YAEA,WACA,YACA,YACA,Y,ytCAEa2W,E,YAAb,qC,sCACEnpB,MAAQ,CACNa,QAAS,IAGX,EAAAyoB,OAAS,WACP,GAA0B,IAAtB,EAAKtpB,MAAMa,QAAe,CAC5B,IAAMkI,EAAkB,CACtB1F,OAAQ,IACRqC,cAAe,2BACfJ,QAAS,CAAE,KAGb,EAAKjF,SAAS,CAAEQ,QAAS,oBAAC,UAAD,CAAQL,QAAM,MACvC0C,EAAEkO,KAAK,EAAKlT,MAAMmL,IAAK,CAAEqI,SAAU,SAAU7H,KAAK,SAACC,GACjD,GAAIA,EAAIgO,UACN,EAAKzX,SAAS,CACZQ,QACE,2BAAKP,MAAO,CAAE9B,MAAO,MAAO2U,UAAW,SAAU0C,SAAU,OAAQvH,WAAY,OAAQ8E,UAAW,KAAlG,uCAKC,CACL,IAAIvS,EAAU,saAAH,OACoFiJ,EAAIC,SAChGlJ,QAFQ,gBAGX,EAAKR,SAAS,CAAEQ,QAAS,oBAAC,UAAD,CAAU9G,KAAM8G,EAASoM,UAAQ,EAACH,OAAQ/D,WA3B7E,E,WAA6C,EAAAhL,W,oCAkCzC,OACE,oBAAC,UAAD,CACEoO,WAAS,EACT3M,QAASvB,KAAKC,MAAMsB,QACpBqB,QAAS5C,KAAK+B,MAAMa,QACpBqD,OAAO,iCACPkI,oBAAoB,EACpBkd,OAAQrrB,KAAKqrB,OACbjrB,KAAK,aACLgO,OAAO,WACP/L,MAAO,CAAEuM,UAAW,KACpB1O,UAAU,iB,qCAYLmqB,E,YAIX,WAAYpqB,GAAyC,wBACnD,wBAAMA,KAORmI,SAAW,SAAClG,EAA0BpG,GACpC,EAAKsG,SAAS,CAAEkoB,YAAaxuB,EAAK8C,SAGpC,EAAA0J,OAAS,WACP,EAAKrI,MAAMqI,OAAO,EAAKvG,MAAMuoB,aAC7B,EAAKrqB,MAAM+D,WAGb,EAAAA,QAAU,WACR,EAAK/D,MAAM+D,WAfX,EAAKjC,MAAQ,CACXuoB,YAAarqB,EAAM2Q,OAAOmb,qBAJuB,E,WAJJ,EAAAjsB,W,oCAyB3C,IACI8Q,EAAW5Q,KAAKC,MAAhB2Q,OAEJob,EAASxrB,EAAEsR,OAAOlB,EAAOqC,YAAY+Y,OAAQ,SAASjrB,GACxD,OAAOA,EAAKkrB,IAAIC,gBAGZC,EAAqB3rB,EAAEoB,IAAIoqB,EAAQ,SAASjrB,GAChD,MAAO,CACL7B,IAAK6B,EAAK2jB,QACV3S,KAAMhR,EAAK5C,KACXS,MAAOmC,EAAK2jB,QACZxT,YAAanQ,EAAKkrB,IAAI9tB,KACtB6C,MAAO,CAAE4B,QAAS7B,EAAKG,MAAOwX,UAAU,EAAMnY,MAAO,YAIzD,OACE,oBAAC,UAAD,CACE2N,WAAS,EACTzK,MAAI,EACJ0K,oBAAoB,EACpB/N,KAAK,OACLgO,OAAO,WACPlO,UAAU,WACV8D,QAAShE,KAAKgE,SAEd,oBAAC,UAAMtC,OAAP,2CACA,oBAAC,UAAMC,QAAP,KACE,sCACE,8CADF,IAC6BiP,EAAO5P,OAEpC,oBAAC,UAAD,CACE2a,YAAY,wBACZyQ,aAAcxb,EAAOmb,oBACrBM,WAAS,EACTnD,WAAS,EACToD,OAAK,EACLnR,QAASgR,EACT/jB,SAAUpI,KAAKoI,YAGnB,oBAAC,UAAMmG,QAAP,KACE,oBAAC,UAAD,CAAQvI,SAAO,EAACpD,QAAQ,UAAUF,QAAS1C,KAAKsI,e,kJCrI1D,I,EAAA,OAEA,SACA,SACA,SACA,SACA,G,EAAA,S,2BACA,S,4jCAQa6iB,E,YAAb,mB,IAAA,O,4FAAA,S,yFACEvM,QAAkC,KAElC,EAAA7c,MAA6B,CAC3BwF,MAAO,MAGT,EAAAglB,aAAe,SAACjL,GACd,IAAMvV,EAAO,EAAH,GACNqf,EAAU5qB,EAAE+U,QAAQ+L,EAAO,OAE/B,OAAO9gB,EAAEoB,IAAIwpB,EAAS,SAASoB,EAAMvO,GACnC,IAAMY,EAAMre,EAAEoB,IAAI4qB,EAAM,SAASzrB,GAC/B,MAAO,CACL0Q,GAAI1Q,EAAK0Q,GACToO,OAAQ9e,EAAK8e,OACbvB,KAAkB,QAAZvd,EAAK0rB,IAAgB1rB,EAAK2rB,MAAQ,GACxCnO,MAAmB,SAAZxd,EAAK0rB,IAAiB1rB,EAAK2rB,MAAQ,GAC1C5M,cAAe/T,EAAKoU,gBAAgBpf,EAAK8e,WAI7C,OAAOtjB,OAAOyP,OACZ,GACA,CACEiS,MACA1W,MAAOsX,EACP5X,OAAQulB,EAAK,GAAGvlB,OAChBkW,YAAaqP,EAAK,GAAGtb,YACrBsC,UAAWgZ,EAAK,GAAGG,oBAErBnsB,EAAEosB,KAAKJ,EAAK,GAAI,CAAE,mBAAoB,WAAY,iBAAkB,YAAa,oBASvF,EAAAK,aAAe,SAAC/wB,GACd,OAAO,IAAIgxB,QAAc,SAACC,GACxB9nB,EAAEsI,QAAQ8L,+BAA+B,mBADN,MAEJ,EAAKpZ,MAAMiQ,aAAlCsD,EAF2B,EAE3BA,UAAWF,EAFgB,EAEhBA,QACnBrO,EAAE+nB,KAAKzhB,QAAQ,YAAD,OAAaN,IAAIC,KAAKC,WAAtB,mBAA2CqI,EAA3C,kBAAsE,CAClFgL,QAAS1iB,EACTwX,UACAiO,EAAG,IACF3V,KAAK,SAACC,GACP,EAAKzJ,SAAS,SAACib,GACb,IAAM9V,EAAQ,EAAK8V,EAAU9V,OAG7B,OAFAA,EAAM3K,KAAK,EAAK2vB,aAAa1gB,EAAIC,SAASsf,SAAS,IAE5C,CAAE7jB,WAGXtC,EAAEqI,YACFyf,SAKN,EAAAvoB,aAAe,WACb,GAAyB,OAArB,EAAKzC,MAAMwF,MAAgB,KACrBiM,EAAc,EAAKvT,MAAMiQ,aAAzBsD,UACRvO,EAAEyG,QAAQH,QAAQ,YAAD,OAAaN,IAAIC,KAAKC,WAAtB,mBAA2CqI,EAA3C,mBAAsE5H,KAAK,SAACC,GAC3F,EAAK+S,QAAUpe,EAAEqiB,QAAQhX,EAAIC,SAAS8S,SAAW,GAAK/S,EAAIC,SAAS8S,QACnE3T,IAAIC,KAAKsU,gBAAgBhM,GAAa3H,EAAIC,SAAS0T,gBAEnD,EAAKpd,SAAS,CACZmF,MAAO/G,EAAEqiB,QAAQhX,EAAIC,SAASsf,SAAW,GAAK,EAAKmB,aAAa1gB,EAAIC,SAASsf,eAMrF,EAAA6B,WAAa,SAAClsB,EAA2Byd,EAAcd,GACrD,OAAO,IAAIoP,QAA6B,SAACC,GAAW,MACnB,EAAK9sB,MAAMiQ,aAAlCsD,EAD0C,EAC1CA,UAAWF,EAD+B,EAC/BA,QACfoK,GACF/U,WAAW,kBAAM1D,EAAEsI,QAAQ8L,+BAA+BqE,KAAgB,KAG5EzY,EAAE+nB,KAAKzhB,QAAQ,YAAD,OAAaN,IAAIC,KAAKC,WAAtB,mBAA2CqI,EAA3C,kBAAsE,CAClFyK,IAAKld,EAAKkd,IACVO,UACAlL,UACAiO,EAAG,IACF3V,KAAK,SAACC,GACP,IAAMuf,EAAU,EAAKmB,aAAa1gB,EAAIC,SAASsf,SAC/C,EAAKhpB,SAAS,SAACib,GAQb,MAAO,CAAE9V,MAPK/G,EAAEoB,IAAIyb,EAAU9V,MAAO,SAACxG,GACpC,OAAIA,EAAKkd,KAAOmN,EAAQ,GAAGnN,IAClBmN,EAAQ,GAERrqB,OAMT2c,GACFzY,EAAEqI,YAGJyf,EAAQ3B,EAAQ,SAKtB,EAAA8B,kBAAoB,SAACnsB,GACnByJ,QAAQ6L,eAAR,6CACwCtV,EAAKkd,IAD7C,0DAEiCzd,EAAEJ,KAAKW,EAAKwG,OAF7C,yBAGE,KACA,eACA,SAAC9I,GACC,GAAKA,EAAL,CADI,IAKI+U,EAAc,EAAKvT,MAAMiQ,aAAzBsD,UAERvO,EAAEsI,QAAQ8L,+BAA+B,uBACzCpU,EAAEkO,KAAK5H,QAAQ,YAAD,OAAaN,IAAIC,KAAKC,WAAtB,mBAA2CqI,EAA3C,yBAAqEzS,EAAKkd,MAAQ,CAC9F7K,KAAM,WACLxH,KAAK,SAACC,GACP,EAAKzJ,SAAS,SAACib,GAGb,MAAO,CAAE9V,MAFK/G,EAAEgd,OAAOH,EAAU9V,MAAO,CAAE0W,IAAKld,EAAKkd,SAKtDhZ,EAAEqI,kBArIZ,E,sPAAoC,EAAAhK,e,8CAoClBuc,GACd,OAAO,IAAAM,iBAAgBngB,KAAK4e,QAASiB,K,sCAuGrC,IAAMsN,EAA+B,CACnClP,IAAK,KACLhX,OAAQ,QACRkW,YAAa,GACb3J,UAAWxT,KAAKC,MAAMiQ,aAAasD,UACnCjM,MAAO/G,EAAE4sB,KAAK,IAAIC,MAAM,GAAI,CAAExN,OAAQ,GAAIvB,KAAM,KAAMC,MAAO,KAAMuB,cAAe,IAAM,EAAG,IAG7F,OACE,2BAAK5f,UAAU,WACZM,EAAEJ,KAAKJ,KAAK4e,SAAW,GACtB,oBAAC,EAAAnP,YAAD,CACES,aAAclQ,KAAKC,MAAMiQ,aACzBF,WAAW,eACXC,WAAW,eACXJ,WAAYnK,yBAAyB,gBACrC4C,OAAQtI,KAAK6sB,aACb9rB,KAAMosB,EACNpd,UAAW,EAAA+M,cAGdtc,EAAEmpB,QAAQ3pB,KAAK4e,UAAoC,GAAxBpe,EAAEJ,KAAKJ,KAAK4e,SACtC,2BAAK1e,UAAU,mBAAmBmC,MAAO,CAAE8S,UAAW,KACpD,yBAAGjV,UAAU,sBACb,mDAFF,6DAKA,oBAAC,EAAAotB,WAAD,CACE/lB,MAAOvH,KAAK+B,MAAMwF,MAClB2I,aAAclQ,KAAKC,MAAMiQ,aACzBL,WAAY0d,wBAA0B7nB,yBAAyB,gBAC/DunB,WAAYjtB,KAAKitB,WACjBC,kBAAmBltB,KAAKktB,uB,+BAQhC,OACE,oBAAC,EAAAppB,gBAAD,CACE3F,KAAK,SACL0F,QAA8B,OAArB7D,KAAK+B,MAAMwF,MAAiBvH,KAAKC,MAAM4D,QAAUrD,EAAEJ,KAAKJ,KAAK+B,MAAMwF,OAC5EjH,KAAK,UACLoD,MAAM,UACND,KAAMzD,KAAKC,MAAMwD,KACjBM,SAAU/D,KAAKC,MAAMorB,OACrB7mB,aAAcxE,KAAKwE,cAEnB,oBAAC,UAAsByiB,SAAvB,CAAgCroB,MAAOoB,KAAK4e,SAAU5e,KAAKwtB,uB,gNC7MnE,O,2yBASalpB,E,8ZAA2B,EAAAhB,e,mDAEpC,aAAOtD,KAAKC,MAAO,a,+BAGnB,OACE,kCACE,yBAAGsF,KAAK,IAAIrF,UAAU,aAAawC,QAAS1C,KAAKC,MAAM+D,SACrD,yBAAG9D,UAAU,yBAEf,2BAAKA,UAAU,SAASF,KAAKC,MAAMyD,a,oJCP7B,SAA2BzD,QAGb,KAF1BA,EAAQ1D,OAAOyP,OAAO,GAAI/L,EAAO4C,IAEhBjE,OAAwB4B,EAAEJ,KAAKH,EAAMrB,OAAS,IAC7DqB,EAAMrB,OAASqB,EAAMrB,OAGvB,YAA+B,IAApBqB,EAAM4P,YAA6B5P,EAAM4P,WAC3C,oBAAC,UAAiB5P,GAElB,4BAAMC,UAAU,kCAAkC,UAAYoB,OAAOrB,EAAMrB,MAAOqB,KAtB7F,gBACA,Y,mDAEA,IAAM4C,EAAe,CACnB4qB,cAAe,EACfC,iBAAkB,IAClBC,4BAA6B,IAC7BC,oBAAqB,IACrBC,qBAAqB,EACrBC,eAAe,I,0GCPjB,eACA,WAEA,Y,wRAYO,IAAMrO,EAAoC,SAACxf,GAChD,IAAI2C,EACJ,GAAyB,UAArB,EAAO3C,EAAM8R,MACfnP,EAAU,2BAAK1C,UAAU,WAAWD,EAAM8R,WACrC,GAAyB,iBAAd9R,EAAM8R,KAAkB,CAOxC,KALEnP,EAD6B,KAA3B3C,EAAM8R,KAAKiB,OAAO,EAAG,IACb,aAAS/H,IAAIC,KAAK6iB,MAAO9tB,EAAM8R,KAAKiB,OAAO,IAE3C/S,EAAM8R,MAIhB,OAAO,KAGTnP,EAAU,2BAAK8L,wBAAyB,CAAEC,OAAQ/L,KAGpD,OACE,oBAAC,UAAD,CACExC,KAAK,OACL4tB,KAAM/tB,EAAM+tB,KACZzsB,QAAS,oBAAC,UAAD,CAAMhB,MAAON,EAAMS,UAAWN,KAAMH,EAAMguB,SAAU9vB,KAAK,kBAAkB+B,UAAU,iBAC9F+F,OAAQhG,EAAMyD,MACdd,QAASA,K,mBAKf6c,EAAe5c,aAAe,CAC5BnC,UAAW,OACXutB,SAAU,QACVD,MAAM,I,sGCjDR,WACA,WACA,SACA,SACA,SACA,SACA,WACA,S,ytCAEaV,E,wFAAmB,EAAAhqB,e,oCACxB,WACJ,GAAyB,OAArBtD,KAAKC,MAAMsH,MACb,OACE,2BAAKlF,MAAO,CAAE+C,OAAQ,IAAK5D,SAAU,aACnC,2BAAKtB,UAAU,gDAAf,gCAGC,GAAgC,GAA5BM,EAAEJ,KAAKJ,KAAKC,MAAMsH,OAC3B,OAAO,2BAAKrH,UAAU,mBAAf,aACF,IACGqH,EAAUvH,KAAKC,MAAfsH,MACR,OACE,oBAAC,EAAA7C,qBAAD,CAAsBxE,UAAU,gBAC7BM,EAAEoB,IAAI2F,EAAO,SAACxG,GACb,OACE,2BAAK7B,IAAK6B,EAAKkd,IAAK/d,UAAU,4BAC5B,oBAACguB,EAAD,CACEntB,KAAMA,EACN8O,WAAY,EAAK5P,MAAM4P,WACvBvH,OAAQ,EAAKrI,MAAMgtB,WACnBjO,cAAe,EAAK/e,MAAMitB,4B,wBAkBtCgB,E,YAAN,qC,sCACEnsB,MAAQ,CACNosB,aAAa,GAGf,EAAAnP,cAAgB,SAAC9c,GACfA,EAAGC,iBACH,EAAKlC,MAAM+e,cAAc,EAAK/e,MAAMc,OAGtC,EAAAkB,YAAc,SAACC,GACbA,EAAGC,iBACH,EAAKC,SAAS,CAAE+rB,aAAa,KAG/B,EAAAC,YAAc,WACZ,EAAKhsB,SAAS,CAAE+rB,aAAa,KAG/B,EAAA7lB,OAAS,SAACvH,EAA2Byd,EAAcd,GACjD,EAAKzd,MAAMqI,OAAOvH,EAAMyd,EAASd,IApBrC,E,WAA6B,EAAApa,e,oCAsBrB,IACIvC,EAASf,KAAKC,MAAdc,KACR,OACE,+BACGf,KAAKC,MAAM4P,YACV,oBAAC,EAAAwe,uBAAD,CACE7oB,QAAS,CACP8oB,KAAM,CAAEttB,MAAO,SAAU4E,SAAU5F,KAAKiC,YAAa0D,WAAY,gBACjE4oB,OAAQ,CAAEvtB,MAAO,WAAY4E,SAAU5F,KAAKgf,cAAerZ,WAAY,qBAI7E,2BAAKjD,QAAS1C,KAAKiC,aACjB,2BAAK/B,UAAU,UACb,2BAAKA,UAAU,kBACb,4BAAMA,UAAU,YAAhB,YAAqCa,EAAKkd,KAC1C,oBAAC,EAAAnb,4BAAD,CAA6BC,MAAOhC,EAAMX,KAAK,UAC/C,2BAAKF,UAAU,QACb,yDADF,IACwC,GAAKa,EAAKic,UAAY,IAAM,KAAO,OAG7E,oBAAC,EAAAwR,eAAD,CACE3nB,iBAAiB,uBACjBI,OAAQlG,EAAKkG,QAAU,aACvB/G,UAAU,OACV4G,WAAS,KAGb,6BAAO5G,UAAU,kEACf,iCACE,8BACE,wCACA,sCACA,yCAGJ,iCACGM,EAAEoB,IAAIb,EAAKwG,MAAO,SAACknB,GAClB,OACE,oBAAC,EAAAxqB,SAAD,CAAU/E,IAAKuvB,EAAQhd,KACnBoR,EAAQ4L,EAAQnQ,OAChB,8BACE,8BACE,oBAAC,UAAD,CACE/c,QAAS,gCAAOktB,EAAQ5O,QACxBjd,QAAS6rB,EAAQ3O,cACjB7Z,OAAQwoB,EAAQ5O,OAChBzf,KAAK,UAGT,0BAAIF,UAAU,iBAAiBof,WAAWC,aAAakP,EAAQnQ,OAC/D,qCAGFuE,EAAQ4L,EAAQlQ,QAChB,8BACE,8BACE,oBAAC,UAAD,CACEhd,QAAS,gCAAOktB,EAAQ5O,QACxBjd,QAAS6rB,EAAQ3O,cACjB7Z,OAAQwoB,EAAQ5O,OAChBzf,KAAK,UAGT,mCACA,0BAAIF,UAAU,iBAAiBof,WAAWC,aAAakP,EAAQlQ,cAQ5Exd,EAAKoc,aACJ,2BAAKjd,UAAU,oBACb,2BAAKA,UAAU,iBAAiBwO,wBAAyB,CAAEC,QAAQ,IAAA+f,cAAa3tB,EAAKoc,kBAI1Fnd,KAAK+B,MAAMosB,aACV,oBAACQ,EAAD,CACE5tB,KAAMA,EACNuH,OAAQtI,KAAKsI,OACb0W,cAAehf,KAAKgf,cACpBhb,QAAShE,KAAKouB,YACdve,WAAY7P,KAAKC,MAAM4P,kB,KAgB7B8e,E,YAAN,qC,sCACErmB,OAAS,SAACxM,EAAW4hB,GACnB,EAAKzd,MAAMqI,OAAO,EAAKrI,MAAMc,KAAMjF,EAAM4hB,IAF7C,E,WAA8B,EAAApa,e,oCAM1B,OACE,oBAAC,UAAD,CACEG,MAAI,EACJ2K,OAAO,WACPlO,UAAU,iCACVE,KAAK,QACL8N,WAAS,EACTlK,QAAShE,KAAKC,MAAM+D,QACpBqK,eAAe,EACfF,oBAAoB,GAEpB,oBAAC,UAAMzM,OAAP,sBAEA,oBAAC,EAAAob,YAAD,CACE5M,aAAc,CAAEsD,UAAWxT,KAAKC,MAAMc,KAAKyS,UAAWzQ,MAAO,UAC7DhC,KAAMf,KAAKC,MAAMc,KACjB8O,WAAY7P,KAAKC,MAAM4P,WACvBvH,OAAQtI,KAAKsI,OACb0W,cAAehf,KAAKC,MAAM+e,qB,KAO9B6D,EAAU,SAACjkB,GACf,OAAI4B,EAAEouB,SAAShwB,IAIS,GAAjB4B,EAAEJ,KAAKxB,K,4GC/MhB,M,uSAAA,OAEA,SACA,SACA,SACA,SACA,S,goCAMa2sB,E,YAAb,0B,4FAAA,U,sCACExpB,MAA+B,CAC7BwF,MAAO,MAiCT,EAAA/C,aAAe,WACY,OAArB,EAAKzC,MAAMwF,OACb,EAAKtH,MAAMqrB,aAAauD,QAAQ,EAAK5uB,OAAO2P,KAAK,SAACrI,GAChD,EAAKnF,SAAS,CAAEmF,aAKtB,EAAAslB,aAAe,SAAC/wB,GACd,OAAO,IAAIgxB,QAAc,SAACC,GACxB9nB,EAAEsI,QAAQ8L,+BAA+B,qBAEzC,EAAKpZ,MAAMqrB,aAAawD,WAAW,EAAK7uB,MAAOnE,GAAM8T,KAAK,SAAC7O,GACzD,EAAKguB,QAAQhuB,GACbkE,EAAEqI,YACFyf,SAKN,EAAAE,WAAa,SAAClsB,EAAwByd,EAAcd,GAClD,OAAO,IAAIoP,QAA0B,SAACC,GAChCrP,EACFzY,EAAEsI,QAAQ8L,+BAA+BqE,IAEzC,EAAKsR,WAAWjuB,EAAMyd,GAGxB,EAAKve,MAAMqrB,aAAa2D,SAAS,EAAKhvB,MAAOc,EAAMyd,GAAS5O,KAAK,SAACsf,GAChE,EAAKF,WAAWjuB,EAAMmuB,GAClBxR,GACFzY,EAAEqI,YAGJyf,EAAQmC,QAKd,EAAAhC,kBAAoB,SAACnsB,GACnByJ,QAAQ6L,eAAR,8CACyC,EAAA/F,cAAcC,WAAWxP,EAAK5C,MADvE,eAEE,KACA,eACA,SAACkpB,GACMA,IAILpiB,EAAEsI,QAAQ8L,+BAA+B,wBAEzC,EAAKpZ,MAAMqrB,aAAa6D,WAAW,EAAKlvB,MAAOc,GAAM6O,KAAK,WACxD,EAAKuf,WAAWpuB,GAChBkE,EAAEqI,kBAxFZ,E,sPAAsC,EAAAhK,e,sCAK5BxH,GACNkE,KAAKoC,SAAS,SAACib,GAGb,MAAO,CAAE9V,MAFI,GAAH,SAAQ8V,EAAU9V,OAAlB,CAAyBzL,S,iCAM5BiF,EAAwBjF,GACjCkE,KAAKoC,SAAS,SAACib,GASb,MAAO,CAAE9V,MARI/G,EAAEoB,IAAIyb,EAAU9V,MAAO,SAACoM,GACnC,OAAIA,EAAMlC,IAAM1Q,EAAK0Q,GACZlV,OAAOyP,OAAO,GAAI2H,EAAO7X,GAEzB6X,S,iCAQJ5S,GACTf,KAAKoC,SAAS,SAACib,GAGb,MAAO,CAAE9V,MAFI/G,EAAEgd,OAAOH,EAAU9V,MAAO,CAAEkK,GAAI1Q,EAAK0Q,U,+BAkEpD,OACE,wBAAC,EAAA3N,gBAAD,CACE3F,KAAK,WACL0F,QAA8B,OAArB7D,KAAK+B,MAAMwF,MAAiBvH,KAAKC,MAAM4D,QAAUrD,EAAEJ,KAAKJ,KAAK+B,MAAMwF,OAC5EjH,KAAK,YACLoD,MAAM,YACND,KAAMzD,KAAKC,MAAMwD,KACjBM,SAAU/D,KAAKC,MAAMorB,OACrB7mB,aAAcxE,KAAKwE,cAEnB,+BAAKtE,UAAU,WACb,wBAAC,EAAAuP,YAAD,CACES,aAAclQ,KAAKC,MAAMiQ,aACzBF,WAAW,iBACXC,WAAW,iBACXJ,WAAY0d,wBAA0B7nB,yBAAyB,mBAC/D3E,KAkBH,CACL0Q,GAAI,KACJxK,OAAQ,QACR2b,aAAc,KACdE,SAAU,GACV1f,YAAa,GACbD,UAAW,IAvBHmF,OAAQtI,KAAK6sB,aACb9c,UAAW,EAAAiS,gBAEb,wBAAC,EAAAoN,aAAD,CACEvf,WAAY0d,wBAA0B7nB,yBAAyB,iBAC/DwK,aAAclQ,KAAKC,MAAMiQ,aACzB3I,MAAOvH,KAAK+B,MAAMwF,MAClB0lB,WAAYjtB,KAAKitB,WACjBC,kBAAmBltB,KAAKktB,2B,iLCpIpC,WACA,SACA,SACA,SACA,SACA,SACA,S,sqCAEakC,E,wFAAqB,EAAA9rB,e,oCAC1B,WACJ,GAAyB,OAArBtD,KAAKC,MAAMsH,MACb,OACE,2BAAKlF,MAAO,CAAE+C,OAAQ,IAAK5D,SAAU,aACnC,2BAAKtB,UAAU,gDAAf,kCAGC,GAAgC,GAA5BM,EAAEJ,KAAKJ,KAAKC,MAAMsH,OAC3B,OAAO,2BAAKrH,UAAU,mBAAf,eACF,IACGqH,EAAUvH,KAAKC,MAAfsH,MACR,OACE,oBAAC,EAAA7C,qBAAD,KACGlE,EAAEoB,IAAI2F,EAAO,SAACxG,GACb,OACE,2BAAK7B,IAAK6B,EAAK0Q,GAAIvR,UAAU,8BAC3B,oBAACmvB,EAAD,CACEtuB,KAAMA,EACNmP,aAAc,EAAKjQ,MAAMiQ,aACzB5H,OAAQ,EAAKrI,MAAMgtB,WACnBjO,cAAe,EAAK/e,MAAMitB,4B,0BAkB/BmC,E,YAAb,qC,sCACEttB,MAAQ,CACNosB,aAAa,GAsBf,EAAAlsB,YAAc,SAACC,GACbA,EAAGC,iBACH,EAAKC,SAAS,CAAE+rB,aAAa,KAG/B,EAAAC,YAAc,WACZ,EAAKhsB,SAAS,CAAE+rB,aAAa,KAG/B,EAAAnP,cAAgB,SAAC9c,GACfA,EAAGC,iBACH,EAAKlC,MAAM+e,cAAc,EAAK/e,MAAMc,OAGtC,EAAAuH,OAAS,SAACvH,EAAwByd,GAChC,IAAId,EAAe,KACfld,EAAE8uB,QAAQ9Q,EAAS,CAAEvX,OAAQ,eAC/ByW,EAAe,2BACNld,EAAE8uB,QAAQ9Q,EAAS,CAAEvX,OAAQ,eACtCyW,EAAe,0BAGjB,EAAKzd,MAAMqI,OAAOvH,EAAMyd,EAASd,IA9CrC,E,WAAsC,EAAApa,e,+CAKnB,IACPvC,EAASf,KAAKC,MAAdc,KACJ8gB,GAAO,IAAA6M,cAAa3tB,EAAK+hB,UAE7B,OAAO,2BAAKpU,wBAAyB,CAAEC,OAAQkT,O,mDAGvB,IAChB9gB,EAASf,KAAKC,MAAdc,KAER,OAAyB,MAArBA,EAAK6hB,cAAwB,GAAK7hB,EAAK6hB,cAAgB,GAClD,YACuB,KAArB7hB,EAAK6hB,aACP,aAEA,U,+BA6BL,WACI7hB,EAASf,KAAKC,MAAdc,KAER,OACE,+BACE,oBAAC,EAAAstB,uBAAD,CACE7oB,QAAS,CACP8oB,KAAM,CAAEttB,MAAO,SAAU4E,SAAU5F,KAAKiC,YAAa0D,WAAY,iBACjE4oB,OAAQ,CAAEvtB,MAAO,WAAY4E,SAAU5F,KAAKgf,cAAerZ,WAAY,sBAG3E,2BAAKjD,QAAS,kBAAM,EAAKN,SAAS,CAAE+rB,aAAa,MAC/C,2BAAKjuB,UAAU,UACb,2BAAKA,UAAU,kBACb,4BAAMA,UAAU,YAAY,EAAAoQ,cAAcC,WAAWxP,EAAK5C,OAC1D,oBAAC,EAAA2E,4BAAD,CAA6BC,MAAOhC,EAAMX,KAAK,UAC/C,2BAAKF,UAAU,QACb,sDADF,IACqCF,KAAKuvB,+BAG5C,oBAAC,EAAAf,eAAD,CAAgB3nB,iBAAiB,uBAAuBI,OAAQlG,EAAKkG,OAAQ/G,UAAU,OAAO4G,WAAS,KAEzG,2BAAK5G,UAAU,OACb,2BAAKA,UAAU,kBAAkBF,KAAKwvB,sBAExC,2BAAKtvB,UAAU,SAEhBF,KAAK+B,MAAMosB,aACV,oBAAC,EAAAsB,kBAAD,CACE1uB,KAAMA,EACNmP,aAAclQ,KAAKC,MAAMiQ,aACzB5H,OAAQtI,KAAKsI,OACb0W,cAAehf,KAAKgf,cACpBhb,QAAShE,KAAKouB,mB,wICjI1B,I,EAAA,OACA,G,EAAA,Q,2BACA,S,2yBASaqB,E,YAAb,0B,4FAAA,U,sCACEnnB,OAAS,SAACxM,GACR,EAAKmE,MAAMqI,OAAO,EAAKrI,MAAMc,KAAMjF,IAFvC,E,sPAAuC,EAAAwH,e,uCAMnC,OACE,oBAAC,UAAD,CACEG,MAAI,EACJ2K,OAAO,WACPlO,UAAU,iCACVE,KAAK,QACL8N,WAAS,EACTlK,QAAShE,KAAKC,MAAM+D,SAEpB,oBAAC,UAAMtC,OAAP,wBAEA,oBAAC,EAAAsgB,cAAD,CACE9R,aAAclQ,KAAKC,MAAMiQ,aACzBnP,KAAMf,KAAKC,MAAMc,KACjB8O,WAAYnK,yBAAyB,iBACrC4C,OAAQtI,KAAKsI,OACb0W,cAAehf,KAAKC,MAAM+e,sB,mKCjCpC,WAEA,SACA,YAEA,Y,8iDAMa6M,E,YAAb,qC,sCAIE9pB,MAA+B,CAC7BwF,MAAO,MAGT,EAAAmoB,WAAa,SAACpO,GACZ,OAAOA,GAGT,EAAA9c,aAAe,WACY,OAArB,EAAKzC,MAAMwF,OACb,EAAKtH,MAAMqrB,aAAauD,QAAQ,EAAK5uB,OAAO2P,KAAK,SAACrI,GAChD,EAAKnF,SAAS,CAAEmF,aAKtB,EAAAslB,aAAe,SAAC8C,EAA0D5lB,GACxE9E,EAAEsI,QAAQ8L,+BAA+B,6BAEzC,EAAKpZ,MAAMqrB,aACRwD,WAAW,EAAK7uB,MAAO,CAAE2vB,cAAeD,EAAO5d,KAAM6H,GAAI+V,EAAO1oB,SAChE2I,KAAK,SAACigB,GACL,EAAKztB,SAAS,SAACib,GACb,IAAM9V,EAAQ,EAAK8V,EAAU9V,OAG7B,OAFAA,EAAM3K,KAAKizB,GAEJ,CAAEtoB,WAGXwC,IACA9E,EAAEqI,eAIR,EAAA2f,WAAa,SAAClsB,EAA4Byd,EAAcd,GACtD,OAAO,IAAIoP,QAA8B,SAACC,GACpCrP,GACF/U,WAAW,kBAAM1D,EAAEsI,QAAQ8L,+BAA+BqE,KAAgB,KAG5E,EAAKzd,MAAMqrB,aAAa2D,SAAS,EAAKhvB,MAAOc,EAAMyd,GAAS5O,KAAK,SAACigB,GAChE,EAAKztB,SAAS,SAACib,GAKb,MAAO,CAAE9V,MAJK/G,EAAEoB,IAAIyb,EAAU9V,MAAO,SAACxG,GACpC,OAAOA,EAAK0Q,IAAMoe,EAASpe,GAAKoe,EAAW9uB,OAM3C2c,GACFzY,EAAEqI,YAGJyf,EAAQ8C,QAKd,EAAA3C,kBAAoB,SAACnsB,GACnByJ,QAAQ6L,eAAR,oDAC+CtV,EAAK5C,KADpD,UAEE,KACA,eACA,SAACM,GACMA,IAILwG,EAAEsI,QAAQ8L,+BAA+B,gCAEzC,EAAKpZ,MAAMqrB,aAAa6D,WAAW,EAAKlvB,MAAOc,GAAM6O,KAAK,WACxD,EAAKxN,SAAS,SAACib,GAGb,MAAO,CAAE9V,MAFK/G,EAAEgd,OAAOH,EAAU9V,MAAO,CAAEkK,GAAI1Q,EAAK0Q,QAIrDxM,EAAEqI,kBAhFZ,E,WAAsC,EAAAhK,e,2CAuFlC,OACE,2BAAKpD,UAAU,WACb,oBAAC4vB,EAAD,CAAiBC,SAAU/vB,KAAK6sB,eAChC,oBAAC,UAAD,CACEtlB,MAAOvH,KAAK+B,MAAMwF,MAClB2I,aAAclQ,KAAKC,MAAMiQ,aACzBL,WAAY0d,wBAA0B7nB,yBAAyB,iBAC/DunB,WAAYjtB,KAAKitB,WACjBC,kBAAmBltB,KAAKktB,uB,+BAO9B,OACE,oBAAC,EAAAppB,gBAAD,CACE3F,KAAK,WACL0F,QACuB,OAArB7D,KAAK+B,MAAMwF,MAAiBvH,KAAKC,MAAM4D,QAAUrD,EAAEJ,KAAKI,EAAEgd,OAAOxd,KAAK+B,MAAMwF,MAAO,CAAEN,OAAQ,cAE/F3G,KAAK,oBACLoD,MAAM,oBACND,KAAMzD,KAAKC,MAAMwD,KACjBM,SAAU/D,KAAKC,MAAMorB,OACrB7mB,aAAcxE,KAAKwE,cAElBxE,KAAKwtB,qB,8BAURsC,E,YAAN,qC,sCACE/tB,MAAQ,CACNgQ,KAAM,GACNie,YAAY,GAGd,EAAA5nB,SAAW,SAAClG,GACV,EAAKE,SAAS,CAAE2P,KAAO7P,EAAGiW,OAAevZ,SAG3C,EAAAqxB,kBAAoB,SAAC/tB,GACD,IAAdA,EAAGguB,SAEL,EAAK/mB,YAGFjH,EAAGiuB,UAAWjuB,EAAGkuB,SAA2B,IAAdluB,EAAGguB,SAA+B,IAAdhuB,EAAGguB,SAExD,EAAKH,SAAS,UAIlB,EAAAM,WAAa,WACX,EAAKjuB,SAAS,CAAE4tB,YAAY,KAG9B,EAAA7mB,SAAW,WACT,EAAK/G,SAAS,CAAE4tB,YAAY,EAAOje,KAAM,MAG3C,EAAAge,SAAW,SAAC9oB,GACyB,IAA/BzG,EAAEuG,IAAIuD,KAAK,EAAKvI,MAAMgQ,MAK1B,EAAK9R,MAAM8vB,SAAS,CAAEhe,KAAMvR,EAAEuG,IAAIuD,KAAK,EAAKvI,MAAMgQ,MAAO9K,UAAU,WACjE,EAAK7E,SAAS,CAAE2P,KAAM,GAAIie,YAAY,MALtCxlB,QAAQ8lB,WAAW,8CAhCzB,E,WAA8B,EAAAhtB,e,oCAyCtB,WACJ,OAAKiqB,wBAA2B7nB,yBAAyB,iBAIjD1F,KAAK+B,MAAMiuB,WAOjB,+BACE,oBAAC,UAAD,CACEO,QAAS,EACTC,QAAS,EACTC,WAAS,EACTroB,SAAUpI,KAAKoI,SACfxJ,MAAOoB,KAAK+B,MAAMgQ,KAClB1P,MAAO,CAAE6gB,MAAO,OAChBwN,UAAW1wB,KAAKiwB,kBAChBtU,YAAY,qCAEd,2BAAKtZ,MAAO,CAAE8S,UAAW,EAAGD,UAAW,UACrC,8BAAQhV,UAAU,kCAAkCwC,QAAS1C,KAAKmJ,UAAlE,YAGA,8BAAQjJ,UAAU,iCAAiCwC,QAAS,kBAAM,EAAKqtB,SAAS,WAAhF,aArBJ,2BAAK1tB,MAAO,CAAE6S,UAAW,WACvB,8BAAQhV,UAAU,iCAAiCwC,QAAS1C,KAAKqwB,YAAjE,eALK,S,yGClLb,WACA,SACA,SACA,SACA,YACA,UACA,Y,ytCAEqBM,E,wFAAqB,EAAArtB,e,oCAClC,WACJ,GAAyB,OAArBtD,KAAKC,MAAMsH,MACb,OACE,2BAAKlF,MAAO,CAAE+C,OAAQ,IAAK5D,SAAU,aACnC,2BAAKtB,UAAU,gDAAf,+BAGC,GAAgC,GAA5BM,EAAEJ,KAAKJ,KAAKC,MAAMsH,OAC3B,OAAO,2BAAKrH,UAAU,mBAAf,uBACF,IACGqH,EAAUvH,KAAKC,MAAfsH,MAEFqpB,EAAkBpwB,EAAEgd,OAAOjW,EAAO,CAAEN,OAAQ,aAC5C4pB,EAAgBrwB,EAAEsR,OAAOvK,EAAO,CAAEN,OAAQ,aAEhD,OACE,oBAAC,EAAAvC,qBAAD,CAAsBxE,UAAU,iBACF,GAA3BM,EAAEJ,KAAKwwB,GACN,2BAAK1wB,UAAU,mBAAf,gCAEAM,EAAEoB,IAAIgvB,EAAiB,SAAC7vB,GACtB,OACE,2BAAK7B,IAAK6B,EAAK0Q,GAAIvR,UAAU,8BAC3B,oBAAC4wB,EAAD,CACE/vB,KAAMA,EACN8O,WAAY,EAAK5P,MAAM4P,WACvBvH,OAAQ,EAAKrI,MAAMgtB,WACnBjO,cAAe,EAAK/e,MAAMitB,uBAOnC1sB,EAAEJ,KAAKywB,GAAiB,GAAK,oBAACE,EAAD,CAAsBxpB,MAAOspB,S,qBAO/DE,E,YAAN,qC,sCACEhvB,MAAQ,CACNivB,WAAW,GAGb,EAAAC,OAAS,WACP,EAAK7uB,SAAS,SAACib,GACb,MAAO,CAAE2T,WAAY3T,EAAU2T,cAPrC,E,WAAmC,EAAA1tB,e,oCAW3B,IACIiE,EAAUvH,KAAKC,MAAfsH,MAER,OACE,2BAAKlF,MAAO,CAAE8S,UAAW,GAAIhF,aAAc,GAAIwH,QAAS,WACtD,0BAAIzX,UAAU,gBAAgBwC,QAAS1C,KAAKixB,QAC1C,yBAAG/wB,WAAW,aAAG,aAAeF,KAAK+B,MAAMivB,UAAqB,QAAT,UADzD,mBAEE,4BAAM9wB,UAAU,iBAAhB,IAAkCF,KAAK+B,MAAMivB,UAAY,UAAY,UAArE,KACA,4BAAM9wB,UAAU,2CAA2CM,EAAEJ,KAAKmH,MAElEvH,KAAK+B,MAAMivB,WACX,2BAAK9wB,UAAU,wBACZM,EAAEoB,IAAI2F,EAAO,SAACxG,GACb,OACE,2BAAK7B,IAAK6B,EAAK0Q,GAAIvR,UAAU,8BAC3B,oBAAC4wB,EAAD,CAAkB/vB,KAAMA,EAAM8O,YAAY,a,KAgBtDihB,E,YAAN,qC,sCAIE/uB,MAAQ,CACNiuB,YAAY,EACZkB,cAAc,GAGhB,EAAAjvB,YAAc,WACZ,EAAKG,SAAS,CAAE4tB,YAAY,KAG9B,EAAAhR,cAAgB,SAAC9c,GACfA,EAAGC,iBACH,EAAKlC,MAAM+e,cAAc,EAAK/e,MAAMc,OAGtC,EAAAowB,kBAAoB,WACd,EAAKlxB,MAAM4P,YACb,EAAKzN,SAAS,CAAE8uB,cAAc,KAIlC,EAAAE,mBAAqB,WACnB,EAAKhvB,SAAS,CAAE8uB,cAAc,KAGhC,EAAA9oB,SAAW,SAACoW,GACV,EAAKve,MAAMqI,OAAO,EAAKrI,MAAMc,KAAMyd,EAAS,wBAAwB5O,KAAK,WACvE,EAAKxN,SAAS,CAAE4tB,YAAY,OAIhC,EAAAqB,oBAAsB,SAACpqB,GACrB,EAAKhH,MAAMqI,OAAO,EAAKrI,MAAMc,KAAM,CAAE6Y,GAAI3S,GAAU,iBAAmBA,EAAS,QAGjF,EAAAqqB,aAAe,SAAC3B,GACd,IAAMnR,EAAe,CAAE+S,QAAS5B,EAAO5d,MACnC4d,EAAO1oB,SACTuX,EAAQ5E,GAAK+V,EAAO1oB,QAGtB,EAAKhH,MAAMqI,OAAO,EAAKrI,MAAMc,KAAMyd,EAAS,2BAA2B5O,KAAK,WAC1E,EAAKxN,SAAS,CAAE8uB,cAAc,OA7CpC,E,WAA+B,EAAA5tB,e,oCAiDvB,WACIvC,EAASf,KAAKC,MAAdc,KACR,OACE,+BACGf,KAAKC,MAAM4P,YACV,oBAAC,EAAAwe,uBAAD,CACE7oB,QAAS,CACP+oB,OAAQ,CAAEvtB,MAAO,WAAY4E,SAAU5F,KAAKgf,cAAerZ,WAAY,sBAI7E,2BAAKzF,UAAU,mBACb,2BAAKA,UAAU,aACb,4BAAMA,UAAU,YAAhB,SAAkCa,EAAK5C,MACvC,oBAAC,EAAA2E,4BAAD,CAA6BC,MAAOhC,EAAMX,KAAK,WAEjD,oBAAC,EAAAouB,eAAD,CACE3nB,iBAAiB,uBACjBI,OAAQlG,EAAKkG,QAAU,aACvB/G,UAAU,OACV4G,WAAS,KAIb,2BAAK5G,UAAU,eACb,yBAAGsxB,cAAY,OAAOtxB,UAAU,yBAAyBmC,MAAO,CAAEovB,MAAO,UACzE,2BAAKvxB,UAAU,WACb,2BAAKA,UAAU,UACZa,EAAK2wB,QAAQzwB,KAAK9C,KACnB,2BAAK+B,UAAU,0BACZkB,KAAKnC,OAAO8B,EAAK2wB,QAAQrwB,IAAIC,OAAO,sCAM5CtB,KAAKC,MAAM4P,YAAc7P,KAAK+B,MAAMiuB,WACnC,oBAAC2B,EAAD,CAAkB5wB,KAAMA,EAAMgvB,SAAU/vB,KAAKoI,WAE7C,oBAAC,EAAAnE,SAAD,KACE,yBACEvB,QAAS1C,KAAKmxB,kBACd9uB,MAAO,CAAEuvB,WAAY,OACrBljB,wBAAyB,CAAEC,OAAQ5N,EAAKmQ,YAAY7E,QAAQ,MAAO,YAErE,2BAAKnM,WAAW,aAAG,kCAAmC,CAAE2xB,MAAgC,GAAzBrxB,EAAEJ,KAAKW,EAAK+wB,aACxE9xB,KAAK+B,MAAMmvB,cACV,0BAAIhxB,WAAW,aAAG,YAAa,CAAE6xB,SAAmC,GAAzBvxB,EAAEJ,KAAKW,EAAK+wB,aAAvD,eAEDtxB,EAAEoB,IAAIb,EAAK+wB,SAAU,SAACP,GACrB,OACE,2BAAKrxB,UAAU,UAAUhB,IAAKqyB,EAAQ9f,GAAI/O,QAAS,EAAKyuB,mBACtD,2BAAKjxB,UAAU,UACb,yBACEA,WAAW,aAAG,mBAAoB,CAChC8xB,MAAyB,cAAlBT,EAAQtqB,OACfgrB,MAAyB,YAAlBV,EAAQtqB,YAIrB,2BAAK/G,UAAU,WACb,2BAAKA,UAAU,UAAUqxB,EAAQG,QAAQzwB,KAAK9C,MAC9C,2BAAK+B,UAAU,YACZkB,KAAKnC,OAAOsyB,EAAQG,QAAQrwB,IAAIC,OAAO,oCAE1C,2BAAKpB,UAAU,QACb,yBAAGwO,wBAAyB,CAAEC,OAAQ4iB,EAAQW,oBAOzDlyB,KAAK+B,MAAMmvB,cAAgBlxB,KAAKC,MAAM4P,WACrC,oBAACsiB,EAAD,CAAwBC,WAAYrxB,EAAMuH,OAAQtI,KAAKsxB,aAAcnoB,SAAUnJ,KAAKoxB,qBAEpFpxB,KAAKC,MAAM4P,YACT,2BAAK3P,UAAU,mBACb,2BAAKA,UAAU,WACb,2BAAKA,UAAU,iBACb,8BAAQA,UAAU,mCAAmCwC,QAAS1C,KAAKmxB,mBAAnE,cAIF,2BAAKjxB,UAAU,+BACb,8BACEA,UAAU,sCACVwC,QAAS,kBAAM,EAAK2uB,oBAAoB,gBAExC,yBAAGnxB,UAAU,eAJf,cAOA,oBAAC,UAAD,CACES,SAAmC,MAAzBI,EAAKkC,iBACf/C,UAAU,eACVgG,GAAG,QACHkB,OAAK,EACLxE,QAAQ,8EACRrB,QACE,2BAAKrB,UAAU,kBACb,8BACEA,UAAU,+BACVS,SAAmC,MAAzBI,EAAKkC,iBACfP,QAAS,kBACkB,MAAzB3B,EAAKkC,sBAA2B,EAAS,EAAKouB,oBAAoB,cAEpE,yBAAGnxB,UAAU,sBACb,yBAAGA,UAAU,eAPf,yB,KAiCtByxB,E,YACJ,WAAY1xB,GAA4B,wBACtC,wBAAMA,KAMRmI,SAAW,SAAClG,GACV,EAAKE,SAAS,CAAExD,MAAQsD,EAAGiW,OAAevZ,SAG5C,EAAAmxB,SAAW,SAAC9oB,GACV,GAAoC,IAAhCzG,EAAEuG,IAAIuD,KAAK,EAAKvI,MAAMnD,OAA1B,CAKA,IAAM4f,EAAe,CAAEoR,cAAepvB,EAAEuG,IAAIuD,KAAK,EAAKvI,MAAMnD,QACxDqI,IACFuX,EAAQ5E,GAAK3S,GAEf,EAAKhH,MAAM8vB,SAASvR,QARlBhU,QAAQ8lB,WAAW,8CAXrB,EAAKvuB,MAAQ,CACXnD,MAAO,EAAKqB,MAAMc,KAAKmQ,aAHa,E,WADX,EAAA5N,e,oCAyBvB,WACJ,OACE,oBAAC,EAAAW,SAAD,KACE,oBAAC,UAAD,CACEssB,QAAS,EACTC,QAAS,EACTpoB,SAAUpI,KAAKoI,SACfxJ,MAAOoB,KAAK+B,MAAMnD,MAClByD,MAAO,CAAE6gB,MAAO,OAChBvH,YAAY,qCAGd,2BAAKtZ,MAAO,CAAE8S,UAAW,EAAGD,UAAW,UACrC,8BAAQhV,UAAU,sCAAsCwC,QAAS,kBAAM,EAAKqtB,aAA5E,WAIA,8BAAQ7vB,UAAU,sCAAsCwC,QAAS,kBAAM,EAAKqtB,SAAS,gBACnF,yBAAG7vB,UAAU,eADf,cAIA,oBAAC,UAAD,CACES,SAA8C,MAApCX,KAAKC,MAAMc,KAAKkC,iBAC1B/C,UAAU,eACVgG,GAAG,QACHkB,OAAK,EACLxE,QAAQ,8EACRrB,QACE,2BAAKrB,UAAU,kBACb,8BACEA,UAAU,+BACVS,SAA8C,MAApCX,KAAKC,MAAMc,KAAKkC,iBAC1BP,QAAS,kBAA2C,MAApC,EAAKzC,MAAMc,KAAKkC,sBAA2B,EAAS,EAAK8sB,SAAS,cAElF,yBAAG7vB,UAAU,sBACb,yBAAGA,UAAU,eANf,sB,KAsBViyB,E,YAAN,qC,sCACEE,cAAwB,KAExB,EAAAtwB,MAAQ,CACNnD,MAAO,IAGT,EAAAwJ,SAAW,SAAClG,GACV,EAAKE,SAAS,CAAExD,MAAQsD,EAAGiW,OAAevZ,SAG5C,EAAAqxB,kBAAoB,SAAC/tB,GACD,IAAdA,EAAGguB,UAEL,EAAKjwB,MAAMkJ,WACX,EAAKkpB,cAAgB,OAGlBnwB,EAAGiuB,UAAWjuB,EAAGkuB,SAA2B,IAAdluB,EAAGguB,SAA+B,IAAdhuB,EAAGguB,SAExD,EAAKH,YAIT,EAAAA,SAAW,SAAC9oB,IAC0B,IAAhCzG,EAAEuG,IAAIuD,KAAK,EAAKvI,MAAMnD,QAAiBqI,KAIjB,MAAtB,EAAKorB,gBACP5yB,OAAOqJ,aAAa,EAAKupB,eACzB,EAAKA,cAAgB,MAGvB,EAAKpyB,MAAMqI,OAAO,CAAEyJ,KAAMvR,EAAEuG,IAAIuD,KAAK,EAAKvI,MAAMnD,OAAQqI,aAG1D,EAAA4Z,OAAS,WACP,EAAKwR,cAAgB5yB,OAAOkJ,WAAW,WACrC,EAAK1I,MAAMkJ,YACV,MAxCP,E,WAAqC,EAAA7F,e,oCA2C7B,WACJ,OACE,2BAAKjB,MAAO,CAAE8N,aAAc,KAC1B,oBAAC,UAAD,CACEogB,QAAS,EACTC,QAAS,EACTC,WAAS,EACT7xB,MAAOoB,KAAK+B,MAAMnD,MAClBwJ,SAAUpI,KAAKoI,SACfsoB,UAAW1wB,KAAKiwB,kBAChBtU,YAAY,6BACZtZ,MAAO,CAAE6gB,MAAO,OAChBrC,OAAQ,kBAAM,EAAKA,YAGrB,2BAAKxe,MAAO,CAAE6S,UAAW,QAASC,UAAW,IAC3C,8BAAQjV,UAAU,6CAA6CwC,QAAS,kBAAM,EAAKqtB,aAAnF,UAIA,8BAAQ7vB,UAAU,sCAAsCwC,QAAS,kBAAM,EAAKqtB,SAAS,gBACnF,yBAAG7vB,UAAU,eADf,cAIA,oBAAC,UAAD,CACES,SAAoD,MAA1CX,KAAKC,MAAMmyB,WAAWnvB,iBAChC/C,UAAU,eACVgG,GAAG,QACHkB,OAAK,EACLxE,QAAQ,8EACRrB,QACE,2BAAKrB,UAAU,kBACb,8BACEA,UAAU,+BACVS,SAAoD,MAA1CX,KAAKC,MAAMmyB,WAAWnvB,iBAChCP,QAAS,kBAAiD,MAA1C,EAAKzC,MAAMmyB,WAAWnvB,sBAA2B,EAAS,EAAK8sB,SAAS,cAExF,yBAAG7vB,UAAU,sBACb,yBAAGA,UAAU,eANf,sB,oeCzaHsrB,E,4EAgBHvrB,GAAgD,MACvBA,EAAMiQ,aAA7BoD,EAD8C,EAC9CA,QAASE,EADqC,EACrCA,UAEjB,OAAO,IAAIsZ,QAAQ,SAACC,GAClB9nB,EAAEyG,QAAQ4mB,SAAS,8BAAD,OAA+Bhf,EAA/B,mBAAiDE,EAAjD,oBAA6E5H,KAAK,SAACC,GACnGkhB,EAAQvsB,EAAEqiB,QAAQhX,EAAIC,UAAY,GAAKD,EAAIC,gB,iCAKtC7L,EAAkDnE,GAAS,MACrCmE,EAAMiQ,aAA7BoD,EAD4D,EAC5DA,QAASE,EADmD,EACnDA,UACXpI,EAAMknB,SAAS,8BAAD,OAA+Bhf,EAA/B,mBAAiDE,EAAjD,cAEpB,OAAO,IAAIsZ,QAA0B,SAACC,GACpC9nB,EAAE+nB,KAAK5hB,EAAK,CAAEtP,SAAQ8P,KAAK,SAACC,GAC1BkhB,EAAQlhB,EAAIC,SAASxF,c,+BAKlBrG,EAAkDc,EAAWjF,GACpE,IAAIsP,EAEFA,EADE5K,EAAE8uB,QAAQxzB,EAAM,CAAEmL,OAAQ,eACtB,uEACGzG,EAAE8uB,QAAQxzB,EAAM,CAAEmL,OAAQ,aAC7B,uEAEA,qEAPqE,MAU9ChH,EAAMiQ,aAA7BoD,EAVqE,EAUrEA,QAASE,EAV4D,EAU5DA,UAEjB,OAAO,IAAIsZ,QAA0B,SAACC,GACpC9nB,EAAE+nB,KAAKsF,SAASlnB,EAAK,CAAEkI,UAASE,YAAW/B,GAAI1Q,EAAK0Q,KAAO,CAAE3V,SAAQ8P,KAAK,SAACC,GACzEkhB,EAAQlhB,EAAIC,SAASxF,c,iCAKhBrG,EAAkDc,GAAS,MACrCd,EAAMiQ,aAA7BoD,EAD4D,EAC5DA,QAASE,EADmD,EACnDA,UAGjB,OAAO,IAAIsZ,QAAc,SAACC,GACxB9nB,EAAEkO,KAAK,CAAE/H,IAAKknB,SAHJ,qEAGkB,CAAEhf,UAASE,YAAW/B,GAAI1Q,EAAK0Q,KAAO2B,KAAM,WAAYxH,KAAK,SAACC,GACtE,GAAdA,EAAI5E,QACN8lB,U,iCAMGxlB,GACT,OAAOA,K,qCA9DP,OAJKikB,EAAgC+G,WACnC/G,EAAgC+G,SAAW,IAAIvyB,MAG1CwrB,EAAgC+G,a,6CAkE9BzG,E,4EAmBH7rB,GAAoD,aAC3BA,EAAMiQ,aAA7BoD,EADkD,EAClDA,QAASE,EADyC,EACzCA,UAEjB,OAAO,IAAIsZ,QAAQ,SAACC,GAClB9nB,EAAEyG,QAAQ4mB,SAAS,8BAAD,OAA+Bhf,EAA/B,mBAAiDE,EAAjD,eAAwE5H,KAAK,SAACC,GAC9FkhB,EAAQvsB,EAAEqiB,QAAQhX,EAAIC,SAASqO,YAAc,GAAK,EAAKuV,WAAW7jB,EAAIC,SAASqO,mB,iCAK1Ela,EAAsDnE,GAAS,aACzCmE,EAAMiQ,aAA7BoD,EADgE,EAChEA,QAASE,EADuD,EACvDA,UACXpI,EAAMknB,SAAS,8BAAD,OAA+Bhf,EAA/B,mBAAiDE,EAAjD,cAEpB,OAAO,IAAIsZ,QAA8B,SAACC,GACxC9nB,EAAE+nB,KAAK5hB,EAAKtP,GAAM8P,KAAK,SAACC,GACtBkhB,EAAQlhB,EAAIC,SAAS+jB,UAErB,EAAK/V,aAAatG,EAAW3H,EAAIC,SAAS0mB,mB,+BAKvCvyB,EAAsDc,EAAWjF,GAAS,aAClDmE,EAAMiQ,aAA7BsD,EADyE,EACzEA,UAAWF,EAD8D,EAC9DA,QACblI,EAAMknB,SAAS,8BAAD,OAA+Bhf,EAA/B,mBAAiDE,EAAjD,qBAAuEzS,EAAK0Q,KAEhG,OAAO,IAAIqb,QAA8B,SAACC,GACxC9nB,EAAE+nB,KAAK5hB,EAAKtP,GAAM8P,KAAK,SAACC,GACtBkhB,EAAQlhB,EAAIC,SAAS+jB,UAErB,EAAK/V,aAAatG,EAAW3H,EAAIC,SAAS0mB,mB,iCAKrCvyB,EAAsDc,GAAS,aACzCd,EAAMiQ,aAA7BoD,EADgE,EAChEA,QAASE,EADuD,EACvDA,UAGjB,OAAO,IAAIsZ,QAAc,SAACC,GACxB9nB,EAAEkO,KAAK,CAAE/H,IAAKknB,SAHJ,0EAGkB,CAAEhf,UAASE,YAAWif,QAAS1xB,EAAK0Q,KAAO2B,KAAM,WAAYxH,KAAK,SAACC,GAC7FkhB,IAEA,EAAKjT,aAAatG,EAAW3H,EAAIC,SAAS0mB,mB,iCAKrCjrB,GACT,OAAOA,I,mCAGIiM,EAA6BgL,GAAY,MACnBxe,KAAK0yB,mBAA9BnjB,EAD4C,EAC5CA,aAAcC,EAD8B,EAC9BA,OAElB0M,EAAoB3f,OAAOyP,OAAO,GAAIuD,GAE1C2M,EAAkBvB,QAAUna,EAAE2b,UAAUD,EAAkBvB,QAAS,SAAC5Z,GAIlE,OAHIA,EAAKyS,WAAaA,IACpBzS,EAAOxE,OAAOyP,OAAO,GAAIjL,EAAMyd,IAE1Bzd,IAGTyO,EAAO0M,M,mCA/EUwW,GAMjB,OALK5G,EAAgCyG,WACnCzG,EAAgCyG,SAAW,IAAIvyB,KAC/C8rB,EAAgCyG,SAASG,mBAAqBA,GAGzD5G,EAAgCyG,a,6ICrF3C,WACA,YACA,SAEA,WAEA,SAEA,SACA,Y,81BAUqBI,E,YACnB,WAAY1yB,GAA0B,O,4FAAA,UACpC,wBAAMA,KAgBRylB,YAAc,SAACtQ,GACb,EAAKhT,SAAS,CAAEujB,YAAavQ,IAC7B,IAAMxE,EAASpQ,EAAEmK,KAAK,EAAK5I,MAAMwN,aAAaoL,QAAS,CAAEvF,UACzDnK,IAAIC,KAAK0a,iBAAmBhV,EAAO4C,UACnCvO,EAAE,+BAAD,OAAgC2L,EAAOa,KAAMa,WAAW,WAG3D,EAAA0T,eAAiB,SAACpV,GAChB,EAAKxO,SAAS,SAACL,GACb,IAAIwN,EAAehT,OAAOyP,OAAO,GAAIjK,EAAMwN,cAQ3C,OAPAA,EAAaoL,QAAUna,EAAEoB,IAAI2N,EAAaoL,QAAS,SAAC5Z,GAClD,OAAIA,EAAKqU,MAAQ,IAAMxE,EAAOwE,MAAQ,GAC7BxE,EAEA7P,IAGJ,CAAEwO,mBAIb,EAAA0W,YAAc,SAACnqB,GACb,EAAKsG,SAAS,SAACL,GAGb,MAAO,CAAEwN,aAFUhT,OAAOyP,OAAO,GAAIjK,EAAMwN,aAAczT,OAM7D,EAAA82B,qBAAuB,SAAC1wB,EAAoBuD,EAAwCmL,GAElF,OADA1O,EAAGC,iBACKsD,GACN,IAAK,SACH+E,QAAQqoB,OACN,CAAE5sB,OAAQ,gBAAiBrD,QAAS,6DACpC,WACA,QACA,SAACnE,GACC,GAAKA,GAAsB,IAAjB+B,EAAEuG,IAAIuD,KAAK7L,GAArB,CAGA,IAAM2M,EAAM,EAAKub,UAAU,WAE3B1hB,EAAEsI,QAAQ8L,+BAA+B,0BAEzCpU,EAAEkO,KAAK/H,EAAK,CACVgI,KAAM,OACNtX,KAAM,CAAEwX,QAAS,EAAKvR,MAAMwN,aAAagE,KAAK9B,GAAItT,KAAMqC,EAAEuG,IAAIuD,KAAK7L,IACnEgV,SAAU,SACT7H,KAAK,SAACC,GACFA,EAAIgO,UAQPrP,QAAQC,MAAMoB,EAAI2B,SAPlB,EAAKpL,SAAS,SAACL,GACb,IAAIwN,EAAexN,EAAMwN,aAGzB,OAFAA,EAAaoL,QAAQ9O,EAAIC,SAAS0H,WAAa3H,EAAIC,SAE5C,CAAEyD,eAAcoW,YAAa9Z,EAAIC,SAASsJ,SAKrDnQ,EAAEqI,gBAGN,IAEFrI,EAAE,kBAAkB6tB,SAAS,YAC7B,MACF,IAAK,SACHtoB,QAAQqoB,OACN,CAAE5sB,OAAQ,oBAAqBrD,QAAS,yDACxC,WACA,UACA,SAACnE,GACC,GAAKA,GAAsB,IAAjB+B,EAAEuG,IAAIuD,KAAK7L,GAArB,CAIAwG,EAAEsI,QAAQ8L,+BAA+B,sBACzC,IAAMjO,EAAMG,QAAQ,YAAD,OACL,EAAKxJ,MAAMwN,aAAa2D,SAASzB,GAD5B,2CACiEb,EAAO4C,YAG3FvO,EAAEkO,KAAK/H,EAAK,CACVgI,KAAM,OACNtX,KAAM,CAAEqC,KAAMqC,EAAEuG,IAAIuD,KAAK7L,IACzBgV,SAAU,SACT7H,KAAK,SAACC,GACFA,EAAIgO,WACP,EAAKzX,SAAS,SAACL,GACb,IAAIwN,EAAexN,EAAMwN,aAQzB,OAPAA,EAAaoL,QAAUna,EAAEoB,IAAI2N,EAAaoL,QAAS,SAAS5Z,GAI1D,OAHIA,EAAKyS,WAAa5C,EAAO4C,YAC3BzS,EAAKC,MAAQR,EAAEuG,IAAIuD,KAAK7L,IAEnBsC,IAGF,CAAEwO,kBAGbtK,EAAEqI,gBAGNsD,EAAO5P,OAETiE,EAAE,kBAAkB6tB,SAAS,YAC7B,MACF,IAAK,SACHtoB,QAAQ6L,eAAe,gCAAiC,KAAM,uBAAwB,SAAC5X,GACrF,GAAIA,EAAG,CACLwG,EAAEsI,QAAQ8L,+BAA+B,uBAAD,OAAwBzI,EAAO5P,MAA/B,OACxC,IAAMoK,EAAMG,QAAQ,YAAD,OACL,EAAKxJ,MAAMwN,aAAa2D,SAASzB,GAD5B,2CACiEb,EAAO4C,YAG3FvO,EAAEkO,KAAK/H,EAAK,CACVgI,KAAM,OACNK,SAAU,SACT7H,KAAK,SAACC,GACP5G,EAAEqI,YACGzB,EAAIgO,WACP,EAAKzX,SAAS,SAACL,GACb,IAAIwN,EAAexN,EAAMwN,aACzBA,EAAaoL,QAAUna,EAAEgd,OAAOjO,EAAaoL,QAAS,SAAS5Z,GAC7D,OAAOA,EAAKyS,WAAa5C,EAAO4C,YAGlC,IAAImS,EAAc5jB,EAAM4jB,YAKxB,OAJIA,GAAe/U,EAAOwE,QACxBuQ,EAAcnlB,EAAEuyB,KAAKxjB,EAAaoL,SAASvF,OAGtC,CAAE7F,eAAcoW,wBAlJrC,IAAMO,EAAiB1lB,EAAEmK,KAAK,EAAK1K,MAAMsP,aAAaoL,QAAS,CAAEyL,YAAY,IACvET,EAAcO,EAAiBA,EAAe9Q,MAAQ,KAJxB,OAMhC8Q,IACFjb,IAAIC,KAAK0a,iBAAmBM,EAAe1S,WAG7C,EAAKzR,MAAQ,CACX4jB,cACAlL,eAAe,EACflL,aAAc,EAAKtP,MAAMsP,cAbS,E,sPADA,EAAAzP,W,6CA+Jf8Q,GAoBrB,OAJApQ,EAAEkM,QAf+C,CAC/CsmB,MAAO,MACPC,QAAS,MACTC,MAAO,MACPC,MAAO,MACPC,KAAM,MACNC,MAAO,MACPC,MAAO,MACPC,OAAQ,MACRC,WAAY,OACZC,QAAS,MACTC,UAAW,MACXC,UAAW,OAGc,SAASC,EAAIC,GACtCjjB,EAASA,EAAOvE,QAAQ,IAAI4J,OAAO4d,EAAM,MAAOD,KAG3ChjB,M,mCAGC4V,GACR,OAAOjb,QAAQ,YAAD,OACAvL,KAAKC,MAAMsP,aAAa2D,SAASzB,GADjC,8BACyDzR,KAAKC,MAAMsP,aAAagE,KAC1F9B,GAFS,YAEH+U,M,+CAKX,QAAK9gB,yBAAyB,0BAIzB1F,KAAK+B,MAAMwN,aAAa2D,SAASwT,aAAtC,I,gCAKQ9V,EAA4B/O,GACpC,IAAIgX,EAAe,KAEfjI,EAAO3J,SACT4R,EACE,oBAAC,UAAD,CACExW,MAAO,CAAEyW,gBAAiBlI,EAAOmI,cACjC7Y,UAAS,sCAAiCM,EAAEuG,IAAIiS,YAAYpI,EAAO3J,SACnE7G,KAAK,QAEJwQ,EAAO3J,SAKd,IAAMjE,EACJ4N,EAAO3N,kBACP2N,EAAO1N,gBACP9B,KAAKnC,OAAO2R,EAAO3N,kBAAoB7B,KAAKnC,OAAO2R,EAAO1N,gBACtD,iCACA,KAEN,OACE,oBAAC,EAAA4wB,IAAD,CAAK50B,IAAK0R,EAAOa,GAAIvR,UAAU,gCAC7B,4BAAMA,UAAU,WAAWyyB,EAAWoB,gBAAgBnjB,EAAO5P,QAC7D,2BAAKd,UAAU,2BACb,oBAAC,EAAAL,cAAD,CAAeY,IAAKmQ,EAAOzN,UAAWhF,KAAK,gBAAgB6C,MAAM,IAAIN,UAAU,UAC/E,oBAAC,EAAAb,cAAD,CACEY,IAAKmQ,EAAOxN,YACZjF,KAAK,eACL6C,MAAM,IACNN,UAAU,QACVE,UAAWoC,KAGd6V,K,kCAIKjI,EAA4B/O,GACtC,OACE,oBAAC,EAAAmyB,MAAD,CAAO90B,IAAK0R,EAAOa,IACjB,oBAAC,UAAD,CACEwM,IAAKrN,EAAOwE,MACZ7S,OAAQvC,KAAK+B,MAAM4jB,aAAe/U,EAAOwE,MACzCxE,OAAQA,EACRwC,KAAK,UACLvD,WAAY7P,KAAK+B,MAAMwN,aAAa2D,SAASwT,OAC7Cte,SAAUpI,KAAKgmB,eACfC,YAAajmB,KAAKimB,iB,2CAMR,WAChB,IAAKjmB,KAAK+B,MAAMwN,aAAa2D,SAASwT,OACpC,OAAO,KAGT,IACI/L,EAAgCna,EAAE8U,OADzBtV,KACqC+B,MAAMwN,aAAaoL,SACrEA,EAAUna,EAAEyzB,OAAOtZ,EAAS,YAE5B,IAAMuZ,GAAa,IAAAC,gBAAe,kBAAM,4BAAMj0B,UAAU,6BAElDk0B,GAAc,IAAAC,iBAAgB,YAA+C,IAA5CzjB,EAA4C,EAA5CA,OACrC,OACE,0BAAI1Q,UAAU,4BAA4BuR,GAAE,oBAAeb,EAAOa,KAC/D/L,yBAAyB,sBAAwB,oBAACwuB,EAAD,MAClD,gCAAOtjB,EAAO5P,OAEd,2BAAKd,UAAU,cACZwF,yBAAyB,sBAAwB,CAChD,yBACEH,KAAK,IACLrG,IAAI,SACJgB,UAAU,oBACVwC,QAAS,SAACR,GAAD,OAAQ,EAAK0wB,qBAAqB1wB,EAAI,SAAU0O,KAJ3D,kBAQA,IACA,yBACErL,KAAK,IACLrG,IAAI,SACJgB,UAAU,2BACVwC,QAAS,SAACR,GAAD,OAAQ,EAAK0wB,qBAAqB1wB,EAAI,SAAU0O,KAJ3D,iBAcJ0jB,GAAe,IAAAC,mBAAkB,YAAmD,IAAhD5Z,EAAgD,EAAhDA,QACxC,OACE,0BAAIlJ,GAAG,wBAAwBvR,UAAU,qBAAqBmC,MAAO,CAAE6U,WAAY,IAChF1W,EAAEoB,IAAI+Y,EAAS,SAAC/J,EAAQwE,GAAT,OACd,oBAACgf,EAAD,CAAaxjB,OAAQA,EAAQ1R,IAAG,oBAAe0R,EAAOa,IAAM2D,MAAOA,SA+C3E,OACE,2BAAK/S,MAAO,CAAEsV,QAAS,aACrB,yBAAGzX,UAAU,oBAAb,8CAEA,oBAACo0B,EAAD,CACE3Z,QAASA,EACT6Z,SAAS,IACTC,YAAY,uBACZC,eAAa,EACbC,UAlDY,SAAC,GAAkE,IAAhEC,EAAgE,EAAhEA,SAAUC,EAAsD,EAAtDA,SAW7B,EAAKzyB,SACH,SAACL,GACC,IAAIwN,EAAexN,EAAMwN,aACrBoL,EAAgCna,EAAE8U,OAAO/F,EAAaoL,SAC1DA,EAAUna,EAAEyzB,OAAOtZ,EAAS,YAC5B,IAXema,EAAcjB,EAAcD,EAWvCmB,GAXyBlB,EAWGe,EAXWhB,EAWDiB,EAftB,SAACC,EAAcjB,EAAcD,GACnDkB,EAAMt3B,OAAOo2B,EAAK,EAAIkB,EAAMx4B,OAASs3B,EAAKA,EAAI,EAAGkB,EAAMt3B,OAAOq2B,EAAM,GAAG,IAKvEmB,CADAF,GADiBA,EAWQna,GAVXhb,QACSk0B,EAAMD,GACtBkB,GAeL,OANAC,EAASv0B,EAAEoB,IAAImzB,EAAQ,SAASh0B,EAAMc,GAEpC,OADAd,EAAKS,SAAWK,EACTd,IAETwO,EAAaoL,QAAUoa,EAEhB,CAAExlB,iBAEX,WACE,IAAI0lB,EAAoC,GACxCz0B,EAAEkM,QAAQ,EAAK3K,MAAMwN,aAAaoL,QAAS,SAAS5Z,GAClDk0B,EAASl0B,EAAKS,UAAYT,EAAKyS,YAGjC,IAAMpI,EAAMG,QAAQ,YAAD,OAAa,EAAKxJ,MAAMwN,aAAa2D,SAASzB,GAA9C,kCACnBxM,EAAEkO,KAAK/H,EAAK,CACVgI,KAAM,OACNtX,KAAM,CAAEuX,KAAM4hB,GACdxhB,SAAU,YAgBZyhB,gBAAiB,kBAAM3P,SAASC,eAAe,4BAGjD,2BAAKnjB,MAAO,CAAE8yB,OAAQ,OAAQjgB,UAAW,WACvC,8BAAQhV,UAAU,kBAAkBwC,QAAS,SAACR,GAAD,OAAQ,EAAK0wB,qBAAqB1wB,EAAI,YACjF,4BAAMhC,UAAU,cADlB,mBAIF,kC,+BAKA,WACE6L,EAAO/L,KACT2a,EAAgCna,EAAE8U,OAAOvJ,EAAKhK,MAAMwN,aAAaoL,SAErE,OAAuB,GAAnBna,EAAEJ,KAAKua,GAEP,2BAAKlJ,GAAG,cAAcvR,UAAS,oBAAeF,KAAK+B,MAAMwN,aAAagE,KAAKQ,KAA5C,kBAC7B,2BAAK7T,UAAU,+BACb,8CACA,6BACE,4BAAMA,UAAU,sBADlB,4CAGCwF,yBAAyB,sBACxB,8BACExF,UAAU,kBACVwC,QAAS,SAACR,GAAD,OAAQ,EAAK0wB,qBAAqB1wB,EAAI,WAC/CG,MAAO,CAAE8S,UAAW,SAEpB,4BAAMjV,UAAU,cALlB,qBAaVya,EAAUna,EAAEyzB,OAAOtZ,EAAS,YAG1B,oBAAC,UAAmBsM,SAApB,CAA6BroB,MAAO,CAAE2Q,aAAcvP,KAAK+B,MAAMwN,aAAcC,OAAQxP,KAAKimB,cACxF,2BAAKxU,GAAG,cAAcvR,UAAS,oBAAeF,KAAK+B,MAAMwN,aAAagE,KAAKQ,KAA5C,kBAC7B,oBAAC,EAAAqhB,KAAD,CACEzP,YAAa3lB,KAAK+B,MAAM4jB,YACxB0P,YAAar1B,KAAK0lB,YAClB4P,gBAAiBt1B,KAAK+B,MAAMwN,aAAa2D,SAASwT,OAClD6O,YAAY,6BACZC,aAAcx1B,KAAKy1B,sBAEnB,oBAAC,EAAAC,QAAD,CAASx1B,UAAU,mBAChBM,EAAEoB,IAAI+Y,EAAS,SAAC/J,EAAQ/O,GAEvB,OADA+O,EAAOqC,YAAclH,EAAKhK,MAAMwN,aACzB,EAAKomB,UAAU/kB,EAAQ/O,MAGlC,oBAAC,EAAA+zB,UAAD,KACGp1B,EAAEoB,IAAI+Y,EAAS,SAAC/J,EAAQ/O,GAEvB,OADA+O,EAAOqC,YAAclH,EAAKhK,MAAMwN,aACzB,EAAKsmB,YAAYjlB,EAAQ/O,e","file":"proyecto__hoja_trabajo.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonpwebpackLibs\"] = window[\"webpackJsonpwebpackLibs\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([371,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = React;","/// <reference path=\"../@types/global/AuthorIconLog.d.ts\" />\r\n\r\nimport { Component } from 'react'\r\nimport classnames from 'classnames'\r\n\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader/Loader'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer/Dimmer'\r\n\r\nexport class AuthorIconLog extends Component<AuthorIconLogProps, {}> {\r\n  render() {\r\n    let classes: string | string[] = [ 'author-icon-log' ]\r\n\r\n    if (this.props.className) {\r\n      classes.push(this.props.className)\r\n    }\r\n    if (this.props.inline) {\r\n      classes.push('inline')\r\n    }\r\n\r\n    classes = classnames(classes, this.props.size)\r\n\r\n    let icon = (\r\n      <Icon\r\n        name='user circle'\r\n        size={this.props.size}\r\n        color={_.size(this.props.log) == 0 ? null : this.props.iconColor}\r\n        disabled={_.size(this.props.log) == 0}\r\n      />\r\n    )\r\n    if (this.props.alertText) {\r\n      icon = (\r\n        <Icon.Group>\r\n          {icon}\r\n          <Icon corner='top right' color='red' name='warning circle' />\r\n        </Icon.Group>\r\n      )\r\n    }\r\n\r\n    let iconComp\r\n    if (!this.props.inline) {\r\n      iconComp = (\r\n        <div>\r\n          {this.props.label && <span className='lb'>{this.props.label}</span>}\r\n          {icon}\r\n        </div>\r\n      )\r\n    } else {\r\n      const item = this.props.log == null ? null : this.props.log[0]\r\n      iconComp = (\r\n        <div>\r\n          {this.props.label && <span className='lb'>{this.props.label}</span>}\r\n          {icon}\r\n          {this.props.alertText && (\r\n            <span className='alert-text'>\r\n              <Icon color='red' name='warning circle' /> {this.props.alertText}\r\n            </span>\r\n          )}\r\n          {item && (\r\n            <div className='content user-info'>\r\n              <div className='user-sigla'>{item.User.sigla}</div>\r\n              <time dateTime={Date.create(item.ts).format('{year}-{MM}-{dd}')}>\r\n                {Date.create(item.ts).format('{year}-{MM}-{dd}')}\r\n              </time>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className={classes}>\r\n        <Popup\r\n          trigger={iconComp}\r\n          position='bottom center'\r\n          className='author-icon-log-popup'\r\n          pinned\r\n          size={this.props.size}\r\n        >\r\n          <Popup.Header>\r\n            {this.props.name}\r\n            {this.props.alertText && (\r\n              <div className='alert-text'>\r\n                <Icon color='red' name='warning circle' /> {this.props.alertText}\r\n              </div>\r\n            )}\r\n          </Popup.Header>\r\n          <Popup.Content>\r\n            {this.props.log == null ? (\r\n              <div className='label'>Sin Especificar</div>\r\n            ) : (\r\n              <table className='table nowrap'>\r\n                <tbody>\r\n                  {this.props.log.map((item, k) => {\r\n                    return (\r\n                      <tr key={k}>\r\n                        <td>\r\n                          {icon} {item.User.name} ({item.User.sigla})\r\n                        </td>\r\n                        <td>\r\n                          <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                        </td>\r\n                      </tr>\r\n                    )\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </Popup.Content>\r\n        </Popup>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport class AuthorIconLogEditable extends Component<AuthorIconLogEditableProps, AuthorIconLogEditableState> {\r\n  state = {\r\n    isLoading: false\r\n  }\r\n\r\n  static defaultProps = {\r\n    disableEdit: false\r\n  }\r\n\r\n  onClickEdit = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isLoading: true })\r\n    this.props.onClickEdit()\r\n  }\r\n\r\n  render() {\r\n    let classes: string | string[] = [ 'author-icon-log' ]\r\n\r\n    if (this.props.className) {\r\n      classes.push(this.props.className)\r\n    }\r\n\r\n    classes = classnames(classes, this.props.size)\r\n\r\n    const icon = (\r\n      <Icon\r\n        name='user circle'\r\n        size={this.props.size}\r\n        color={this.props.log == null ? null : this.props.iconColor}\r\n        disabled={this.props.log == null}\r\n      />\r\n    )\r\n\r\n    const iconComp = (\r\n      <div style={{ position: 'relative' }}>\r\n        <Dimmer inverted active={this.state.isLoading}>\r\n          <Loader inverted />\r\n        </Dimmer>\r\n        {this.props.label && <span className='lb'>{this.props.label}</span>}\r\n        {icon}\r\n        <Button\r\n          className='action edit'\r\n          disabled={this.props.disableEdit}\r\n          compact\r\n          size='mini'\r\n          color={this.props.iconColor}\r\n          onClick={this.onClickEdit}\r\n        >\r\n          {this.props.editText}\r\n        </Button>\r\n      </div>\r\n    )\r\n\r\n    return (\r\n      <div className={classes}>\r\n        <Popup trigger={iconComp} position='bottom center' pinned size={this.props.size}>\r\n          <Popup.Header content={this.props.name} />\r\n          <Popup.Content>\r\n            {this.props.log == null ? (\r\n              <div className='label'>Sin Especificar</div>\r\n            ) : (\r\n              <table className='table nowrap'>\r\n                <tbody>\r\n                  {this.props.log.map((item, k) => {\r\n                    return (\r\n                      <tr key={k}>\r\n                        <td>\r\n                          {icon} {item.User.name} ({item.User.sigla})\r\n                        </td>\r\n                        <td>\r\n                          <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                        </td>\r\n                      </tr>\r\n                    )\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </Popup.Content>\r\n        </Popup>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype AuthorIconLogDefaultWrapperProps = {\r\n  model: Partial<IAuthorLog>\r\n  size?: 'huge' | 'large' | 'small' | 'mini' | 'tiny'\r\n  className?: string\r\n}\r\n\r\nexport class AuthorIconLogDefaultWrapper extends Component<AuthorIconLogDefaultWrapperProps> {\r\n  render() {\r\n    const { model } = this.props\r\n\r\n    const alertTextRevisado =\r\n      model.fecha_completado &&\r\n      model.fecha_revision &&\r\n      Date.create(model.fecha_completado) > Date.create(model.fecha_revision)\r\n        ? 'Modificado despues de Revisado'\r\n        : null\r\n\r\n    return (\r\n      <div className={classnames('author-icon-log-wrapper', this.props.size, this.props.className)}>\r\n        <AuthorIconLog log={model.UpdateLog} name='Preparado por' label='P' iconColor='green' size={this.props.size} />\r\n        <AuthorIconLog\r\n          log={model.RevisionLog}\r\n          name='Revisado por'\r\n          label='R'\r\n          iconColor='olive'\r\n          size={this.props.size}\r\n          alertText={alertTextRevisado}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, Fragment, SyntheticEvent, createRef } from 'react'\r\n\r\nimport Transition from 'semantic-ui-react/dist/commonjs/modules/Transition/Transition'\r\nimport cx from 'classnames'\r\nimport { SidebarPanelHeader } from './panel_header'\r\nimport { DefaultErrorHandler } from '../../global/ErrorHandler'\r\n\r\ntype BaseMenuItemProps = {\r\n  open: boolean\r\n  image: string\r\n  counter: number\r\n  onClick: () => void\r\n  title: string\r\n}\r\n\r\nexport class BaseMenuItem extends PureComponent<BaseMenuItemProps> {\r\n  render() {\r\n    const image_path = public_path('images/sidebar_right/')\r\n\r\n    return (\r\n      <a\r\n        className={cx('item badged', !this.props.open || 'active')}\r\n        title={this.props.title}\r\n        onClick={this.props.onClick}\r\n      >\r\n        <img src={`${image_path}${this.props.image}.svg`} className='ui large image' /> {' '}\r\n        <div className={cx('ui mini circular floating label right', this.props.counter == 0 ? 'green' : 'red')}>\r\n          {this.props.counter}\r\n        </div>\r\n      </a>\r\n    )\r\n  }\r\n}\r\n\r\ntype BaseMenuElementProps = {\r\n  name: string\r\n  counter: number\r\n  title: string\r\n  icon: string\r\n  open: boolean\r\n  onToggle: (item: string) => void\r\n  onMountPanel?: () => void\r\n}\r\n\r\nexport class BaseMenuElement extends PureComponent<BaseMenuElementProps> {\r\n  onToggle = () => {\r\n    this.props.onToggle(this.props.open ? null : this.props.name)\r\n  }\r\n\r\n  onClose = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onToggle(null)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <DefaultErrorHandler>\r\n          <BaseMenuItem\r\n            counter={this.props.counter}\r\n            open={this.props.open}\r\n            title={this.props.title}\r\n            image={this.props.icon}\r\n            onClick={this.onToggle}\r\n          />\r\n          {this.props.open && (\r\n            <Transition.Group animation='slide right' duration={1500}>\r\n              <div\r\n                className={`sidebar-fixed-content ui vertical right fixed menu menu-${this.props.name}`}\r\n                style={{ right: 45 }}\r\n              >\r\n                <SidebarPanelHeader title={this.props.title} onClose={this.onClose} onMount={this.props.onMountPanel} />\r\n                {this.props.children}\r\n              </div>\r\n            </Transition.Group>\r\n          )}\r\n        </DefaultErrorHandler>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport class MenuElementListPanel extends PureComponent<{ className?: string }> {\r\n  listRef = createRef<HTMLDivElement>()\r\n  listHeight: number = null\r\n\r\n  componentDidMount() {\r\n    if (this.listRef.current) {\r\n      this.calculateHeight()\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.listRef.current && !this.listHeight) {\r\n      this.calculateHeight()\r\n    }\r\n  }\r\n\r\n  calculateHeight() {\r\n    const $list = $(this.listRef.current)\r\n    this.listHeight = window.innerHeight - $list.position().top - 30\r\n    $list.height(this.listHeight)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={`main-list ${this.props.className}`} ref={this.listRef}>\r\n        {this.props.children}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype MenuElementListActionsProps = {\r\n  actions: {\r\n    [s: string]: {\r\n      label: string\r\n      permission: string\r\n      callback: (ev: SyntheticEvent) => void\r\n    }\r\n  }\r\n}\r\nexport const MenuElementListActions = (props: MenuElementListActionsProps) => {\r\n  return (\r\n    <div className='pull-right sf_admin_td_actions'>\r\n      <div className='btn-group dropdown-modern'>\r\n        <a className='btn btn-mini dropdown-toggle' data-toggle='dropdown' href='#'>\r\n          <span className='icon-tc-ellipsis-v' />\r\n        </a>\r\n\r\n        <ul className='dropdown-menu pull-right'>\r\n          {_.map(props.actions, (action, key) => {\r\n            return (\r\n              user_has_role_permission(action.permission) && (\r\n                <li key={key}>\r\n                  <a href='#' onClick={action.callback}>\r\n                    {action.label}\r\n                  </a>\r\n                </li>\r\n              )\r\n            )\r\n          })}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { PureComponent } from 'react'\r\n\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\n\r\nimport cx from 'classnames'\r\n\r\ntype ButtonActionProps = {\r\n  onClick: () => void\r\n  disableText?: string\r\n  showAlert?: boolean\r\n  record?: {\r\n    fecha_completado?: string\r\n    fecha_revision?: string\r\n  }\r\n}\r\n\r\nexport class CompletadoButtonAction extends PureComponent<ButtonActionProps> {\r\n  render() {\r\n    const completado_disabled_text = this.props.disableText\r\n\r\n    return (\r\n      <Popup\r\n        trigger={\r\n          <div className='button-wrapper'>\r\n            <Button primary icon compact onClick={this.props.onClick} disabled={completado_disabled_text != null}>\r\n              {' '}\r\n              <i className='icon check' /> Completado\r\n            </Button>\r\n          </div>\r\n        }\r\n        content={completado_disabled_text}\r\n        header='Marcar como Completado | Opción deshabilitada'\r\n        disabled={completado_disabled_text == null}\r\n        className='disable-text'\r\n        on='hover'\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\nexport class RevisadoButtonAction extends PureComponent<ButtonActionProps> {\r\n  render() {\r\n    let revisado_disabled_text = this.props.disableText\r\n    if (\r\n      (revisado_disabled_text === null || typeof revisado_disabled_text === 'undefined') &&\r\n      this.props.record &&\r\n      !this.props.record.fecha_completado\r\n    ) {\r\n      revisado_disabled_text = 'Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO.'\r\n    }\r\n\r\n    let showAlert: boolean\r\n    if ((this.props.showAlert === null || typeof this.props.showAlert === 'undefined') && this.props.record) {\r\n      const record = this.props.record\r\n      showAlert =\r\n        record.fecha_completado &&\r\n        record.fecha_revision &&\r\n        Date.create(record.fecha_completado) > Date.create(record.fecha_revision)\r\n    } else {\r\n      showAlert = this.props.showAlert\r\n    }\r\n\r\n    const icon_revisado_alert = showAlert ? (\r\n      <Popup\r\n        trigger={<i className='icon warning circle red' />}\r\n        content={'Ha recibido modificaciones después de su última revisión.'}\r\n      />\r\n    ) : null\r\n\r\n    return (\r\n      <Popup\r\n        trigger={\r\n          <div className='button-wrapper'>\r\n            <Button color='olive' icon compact onClick={this.props.onClick} disabled={revisado_disabled_text != null}>\r\n              {' '}\r\n              <i className='icon check fitted' />\r\n              <i className='icon check' /> Revisado {icon_revisado_alert}\r\n            </Button>\r\n          </div>\r\n        }\r\n        content={revisado_disabled_text}\r\n        header='Marcar como Revisado | Opción deshabilitada'\r\n        disabled={revisado_disabled_text == null}\r\n        className='disable-text'\r\n        on='hover'\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\ntype ButtonActionsProps = {\r\n  prepend?: JSX.Element\r\n  append?: JSX.Element\r\n  completado: { permission: string } & ButtonActionProps\r\n  revisado: { permission: string } & ButtonActionProps\r\n}\r\n\r\nexport class StatusButtonGroupActions extends PureComponent<ButtonActionsProps> {\r\n  render() {\r\n    return (\r\n      <div className='actions ab-status-actions'>\r\n        {this.props.prepend}\r\n        {user_has_role_permission(this.props.completado.permission) && (\r\n          <CompletadoButtonAction {...this.props.completado} />\r\n        )}\r\n        {user_has_role_permission(this.props.revisado.permission) && <RevisadoButtonAction {...this.props.revisado} />}\r\n        {this.props.append}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype StatusDivBlockProps = {\r\n  status: string\r\n  className?: string\r\n  wrapperClassName?: string\r\n  hideLabel?: boolean\r\n}\r\n\r\nexport const StatusDivBlock = (props: StatusDivBlockProps) => {\r\n  return (\r\n    <div className={cx('lb-status-wrapper', props.wrapperClassName)}>\r\n      {!props.hideLabel && 'Estado:'}\r\n      <div className={cx(props.className, 'lb-status', `lb-status-${_.str.dasherize(props.status.toLowerCase())}`)}>\r\n        {props.status || ''}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { PureComponent, Fragment, createRef, SyntheticEvent } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\n\r\nimport { instance as eventStack } from '@semantic-ui-react/event-stack'\r\nimport keyboardKey from 'keyboard-key'\r\nimport CKeditor from 'ckeditor4-react'\r\nimport cx from 'classnames'\r\n\r\nimport ButtonEdit from './ButtonEdit'\r\nimport { AttachmentListPanel, cleanAttachmentFrom } from '../proyecto__hoja_trabajo/Attachments'\r\n\r\ndeclare var app: any\r\n\r\nconst CKEDITOR_OPTIONS: any = {\r\n  basic: {\r\n    height: 150,\r\n    toolbar: [\r\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic' ] },\r\n      {\r\n        name: 'paragraph',\r\n        groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ],\r\n        items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'TextColor' ]\r\n      }\r\n    ],\r\n    autoParagraph: false,\r\n    removePlugins: 'elementspath, uploadfile, uploadfileab, resize',\r\n    extraPlugins: 'openlink'\r\n  }\r\n}\r\n\r\nexport default class EditorPreview extends PureComponent<EditorPreviewProps, EditorPreviewState> {\r\n  private ckeditorComp: React.RefObject<CKeditorComp>\r\n  private _cachedEditor: CKEDITOR.editor\r\n\r\n  private previewRef = createRef<HTMLDivElement>()\r\n\r\n  private autosaveId: NodeJS.Timeout\r\n\r\n  static AUTOSAVE_DELAY: number = 60\r\n\r\n  static defaultProps = {\r\n    open: false,\r\n    autosave: false,\r\n    required: false,\r\n    editable: true,\r\n    openOnClickPreview: true,\r\n    ckeditorOptions: {}\r\n  }\r\n\r\n  constructor(props: EditorPreviewProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isModalEditOpen: this.props.open,\r\n      isAutosaving: false,\r\n      isLoading: true,\r\n      attachments: null,\r\n      isLoadingAttachments: false\r\n    }\r\n  }\r\n\r\n  handleEscape = (e: Event) => {\r\n    if (keyboardKey.getCode(e) !== keyboardKey.Escape) return\r\n\r\n    if (typeof CKEDITOR !== 'undefined' && CKEDITOR.dialog.getCurrent() != null) {\r\n      // si existe un CKEditor dialog abierto, no cerrar el modal.\r\n      return\r\n    }\r\n\r\n    this.onClose()\r\n  }\r\n\r\n  getEditor(): CKEDITOR.editor {\r\n    if (this.ckeditorComp != null) {\r\n      return (this.ckeditorComp as any).editor\r\n    }\r\n\r\n    if (this._cachedEditor) {\r\n      return this._cachedEditor\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  onChange = (evt: any) => {\r\n    if (this.props.inline) {\r\n      this.props.onSave(evt.editor, false, false)\r\n    }\r\n\r\n    if (!this._cachedEditor) {\r\n      this._cachedEditor = evt.editor\r\n    }\r\n\r\n    if (!this.props.autosave) {\r\n      return\r\n    }\r\n\r\n    if (!this.autosaveId) {\r\n      this.autosaveId = setTimeout(this.autosave, EditorPreview.AUTOSAVE_DELAY * 1000)\r\n    }\r\n  }\r\n\r\n  onClickEdit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isModalEditOpen: true, isLoading: true })\r\n  }\r\n\r\n  onSave = () => {\r\n    if (this.autosaveId) {\r\n      clearTimeout(this.autosaveId)\r\n      this.autosaveId = null\r\n    }\r\n\r\n    if ($.isFunction(this.props.onSave)) {\r\n      this.props.onSave(this.getEditor(), true, false, () => {\r\n        this.setState({ isAutosaving: false })\r\n        this.fetchAttachments()\r\n      })\r\n\r\n      this.setState({ isModalEditOpen: false })\r\n    } else {\r\n      this.setState({ isModalEditOpen: false, isAutosaving: false })\r\n      this.fetchAttachments()\r\n    }\r\n  }\r\n\r\n  onCancel = () => {\r\n    this.setState({ isModalEditOpen: false })\r\n    if ($.isFunction(this.props.onClose)) {\r\n      this.props.onClose()\r\n    }\r\n  }\r\n\r\n  onClose = () => {\r\n    if (this.autosaveId) {\r\n      clearInterval(this.autosaveId)\r\n      this.autosaveId = null\r\n    }\r\n\r\n    this.setState({ isModalEditOpen: false })\r\n    if ($.isFunction(this.props.onClose)) {\r\n      this.props.onClose()\r\n    }\r\n  }\r\n\r\n  onModalMount = () => {\r\n    eventStack.sub('keydown', this.handleEscape, { pool: 'default' })\r\n\r\n    if (this.state.attachments == null) {\r\n      this.fetchAttachments()\r\n    }\r\n  }\r\n\r\n  autosave = () => {\r\n    this.setState({ isAutosaving: true })\r\n    let ckeditor = this.getEditor()\r\n    if (ckeditor != null) {\r\n      this.props.onSave(ckeditor, false, true, () => this.setState({ isAutosaving: false }))\r\n      this.fetchAttachments()\r\n    }\r\n\r\n    if (this.autosaveId) {\r\n      clearInterval(this.autosaveId)\r\n      this.autosaveId = null\r\n    }\r\n  }\r\n\r\n  assertRequired() {\r\n    if (!this.props.editable) {\r\n      return false\r\n    }\r\n    if (!this.props.required) {\r\n      return false\r\n    }\r\n\r\n    const ckeditor = this.getEditor()\r\n\r\n    if (_.trim(ckeditor.getData()) != '') {\r\n      return false\r\n    }\r\n\r\n    bootbox.alert('Esta campo es requerido, por lo tanto no puede quedar vacío.')\r\n\r\n    return true\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps: EditorPreviewProps) {\r\n    if (nextProps.open && !this.state.isModalEditOpen) {\r\n      this.setState({ isModalEditOpen: true })\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    $(this.previewRef.current).find('a[href]').each(function() {\r\n      $(this).attr('target', '_blank')\r\n    })\r\n  }\r\n\r\n  onClickPreview = (ev: SyntheticEvent) => {\r\n    if (this.props.onClickPreview) {\r\n      this.props.onClickPreview(ev)\r\n    }\r\n\r\n    if (this.props.openOnClickPreview) {\r\n      this.setState({ isModalEditOpen: true })\r\n    }\r\n  }\r\n\r\n  parseCkeditorOptions() {\r\n    let { ckeditorOptions } = this.props\r\n\r\n    if (typeof ckeditorOptions == 'string') {\r\n      ckeditorOptions = CKEDITOR_OPTIONS[ckeditorOptions]\r\n    }\r\n\r\n    if (typeof this.props.ckeditorUploadOptions !== 'undefined') {\r\n      const defaultUrl = 'proyecto/' + app.vars.idproyecto + '/adjunto/upload'\r\n      const { url = defaultUrl, model, modelId } = this.props.ckeditorUploadOptions\r\n\r\n      if (modelId === null || modelId === undefined) {\r\n        ckeditorOptions.removePlugins = 'elementspath,uploadimage,uploadfile,uploadfileab'\r\n      } else {\r\n        ckeditorOptions.uploadUrl = url_for(`${url}?model=${model}&model_id=${modelId}`)\r\n        ckeditorOptions.imageUploadUrl = url_for(`${url}?model=${model}&model_id=${modelId}`)\r\n        ckeditorOptions.filebrowserUploadUrl = url_for(`${url}?model=${model}&model_id=${modelId}&n=attachment`)\r\n      }\r\n    }\r\n\r\n    return ckeditorOptions\r\n  }\r\n\r\n  fetchAttachments() {\r\n    if (typeof this.props.ckeditorUploadOptions === 'undefined') {\r\n      return\r\n    }\r\n\r\n    const { model, modelId } = this.props.ckeditorUploadOptions\r\n\r\n    this.setState({ isLoadingAttachments: true })\r\n    $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/adjunto/json`), {\r\n      model: model,\r\n      model_id: modelId\r\n    }).done((res) => {\r\n      this.setState({ attachments: res.response, isLoadingAttachments: false })\r\n    })\r\n  }\r\n\r\n  onUpdateAttachment = () => {\r\n    this.fetchAttachments()\r\n  }\r\n\r\n  onDeleteAttachment = (adjunto: ProyectoAttachment, cb: () => void) => {\r\n    this.setState({ isLoadingAttachments: true })\r\n\r\n    const data = cleanAttachmentFrom(this.props.data, adjunto)\r\n\r\n    if ($.isFunction(cb)) {\r\n      cb()\r\n    }\r\n\r\n    let ckeditor = this.getEditor()\r\n    if (ckeditor) {\r\n      ckeditor.setData(data)\r\n      this.autosave()\r\n    }\r\n  }\r\n\r\n  getCkeditorOptions() {\r\n    const self = this\r\n\r\n    let ckeditorOptions = Object.assign(\r\n      {\r\n        height: 200,\r\n        toolbar: [\r\n          { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', '-', 'Undo', 'Redo' ] },\r\n          { name: 'links', items: [ 'Link', 'pasolink', 'muestreolink', 'Attachments' ] },\r\n          { name: 'insert', items: [ 'Table', 'SpecialChar' ] },\r\n          { name: 'tools', items: [ 'Maximize' ] },\r\n          { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline' ] },\r\n          {\r\n            name: 'paragraph',\r\n            items: [\r\n              'NumberedList',\r\n              'BulletedList',\r\n              '-',\r\n              'Outdent',\r\n              'Indent',\r\n              '-',\r\n              'JustifyLeft',\r\n              'JustifyCenter',\r\n              'JustifyRight',\r\n              'JustifyBlock',\r\n              '-',\r\n              'TextColor'\r\n            ]\r\n          },\r\n          { name: 'styles', items: [ 'Styles', 'Format' ] }\r\n        ],\r\n        autoParagraph: false,\r\n        enterMode: CKEDITOR.ENTER_BR,\r\n        removePlugins: 'elementspath',\r\n        extraPlugins:\r\n          'uploadimage,pastebase64,uploadfileab,openlink,attach,justify,colorbutton,pastefromexcel,colordialog,pasolink',\r\n        openlink_modifier: 0,\r\n        onAttachmentUpload: function(response: string, editor: CKEDITOR.editor) {\r\n          response = response\r\n            .replace('<pre>', '')\r\n            .replace('<pre style=\"word-wrap: break-word; white-space: pre-wrap;\">', '')\r\n            .replace('</pre>', '')\r\n          var rs = JSON.parse(response)\r\n          console.log(rs)\r\n          _.forEach(rs, function(r) {\r\n            if (r.uploaded) {\r\n              editor.insertHtml(\r\n                \"<a href='\" + r.url + \"' target='_blank' class='proyecto-attachment' >\" + r.fileName + '</a><br> '\r\n              )\r\n            } else {\r\n              alert(r.error)\r\n            }\r\n          })\r\n          CKEDITOR.dialog.getCurrent().hide()\r\n          if (self.props.onUpload) {\r\n            self.props.onUpload()\r\n          }\r\n          self.fetchAttachments()\r\n          const ckeditor_comp = self.getEditor()\r\n          if (ckeditor_comp) {\r\n            self.props.onSave(ckeditor_comp, false, false)\r\n          }\r\n        }\r\n      },\r\n      this.parseCkeditorOptions()\r\n    )\r\n\r\n    ckeditorOptions.on = Object.assign(\r\n      {\r\n        fileUploadRequest: function(ev: any) {\r\n          const loader = ev.data.fileLoader\r\n          loader.on('abort', function() {\r\n            $.unblockUI()\r\n          })\r\n          loader.on('error', function() {\r\n            console.log(loader)\r\n            $.unblockUI()\r\n          })\r\n          $.blockUI({\r\n            message:\r\n              '<div class=\"ajax-loader-snake-32  _a-center\"></div><h3 class=\"loading-block-text\">Cargando archivo al servidor.<br> Por favor Espere ...</h3>'\r\n          })\r\n        },\r\n        fileUploadResponse: function() {\r\n          $.unblockUI()\r\n          this.fire('change')\r\n        },\r\n        paste: (evt: any) => {\r\n          evt.data.dataValue = evt.data.dataValue.replace(/(min-)?width:.+?;/g, '') // remove width\r\n        }\r\n      },\r\n      ckeditorOptions.on || {}\r\n    )\r\n\r\n    return ckeditorOptions\r\n  }\r\n\r\n  renderFooter() {\r\n    const { footer } = this.props\r\n\r\n    if (footer === 'AttachmentList') {\r\n      return (\r\n        <AttachmentListPanel\r\n          isLoading={this.state.isLoadingAttachments}\r\n          attachments={this.state.attachments}\r\n          onUpdateItem={this.onUpdateAttachment}\r\n          onDeleteItem={this.onDeleteAttachment}\r\n        />\r\n      )\r\n    }\r\n\r\n    return footer\r\n  }\r\n\r\n  renderModal() {\r\n    if (!this.state.isModalEditOpen) {\r\n      return\r\n    }\r\n\r\n    let classNames = cx([ 'editor-preview-modal', this.props.className ? this.props.className + '-modal' : false ])\r\n\r\n    return (\r\n      <Modal\r\n        className={classNames}\r\n        open\r\n        closeIcon\r\n        closeOnDimmerClick={false}\r\n        dimmer='inverted'\r\n        onClose={this.onClose}\r\n        closeOnEscape={false}\r\n        onMount={this.onModalMount}\r\n        size='large'\r\n      >\r\n        <Modal.Content>{this.renderEditor()}</Modal.Content>\r\n        {this.props.editable ? (\r\n          <Modal.Actions>\r\n            {this.props.leftActions}\r\n            <button className='ui button negative' onClick={this.onCancel}>\r\n              Cancelar\r\n            </button>\r\n            <button className='ui button primary' onClick={this.onSave}>\r\n              Guardar\r\n            </button>\r\n          </Modal.Actions>\r\n        ) : (\r\n          <Modal.Actions>\r\n            {this.props.leftActions}\r\n            <button className='ui button negative' onClick={this.onCancel}>\r\n              Cerrar\r\n            </button>\r\n          </Modal.Actions>\r\n        )}\r\n      </Modal>\r\n    )\r\n  }\r\n\r\n  renderEditor() {\r\n    let label\r\n    if (this.props.label || this.props.labelTitle) {\r\n      label =\r\n        '<div class=\"editor-label\"> <strong class=\"editor-label-title\">' +\r\n        (this.props.labelTitle || '') +\r\n        '</strong> ' +\r\n        (this.props.label || '') +\r\n        ' </div>'\r\n    }\r\n\r\n    return (\r\n      <Fragment>\r\n        {label && <div dangerouslySetInnerHTML={{ __html: label }} />}\r\n        <div style={{ minHeight: '200px' }}>\r\n          <div className='loading'>\r\n            <div className={this.state.isAutosaving ? '' : 'ui-helper-hidden'}>\r\n              <span className='ajax-loader-snake' /> Guardando...\r\n            </div>\r\n          </div>\r\n          <div className={cx('ui dimmer inverted', { active: this.state.isLoading })}>\r\n            <div className='ui loader'>Cargando...</div>\r\n          </div>\r\n          <CKeditor\r\n            ref={(c: React.RefObject<CKeditorComp>) => (this.ckeditorComp = c)}\r\n            data={this.props.data}\r\n            config={this.getCkeditorOptions()}\r\n            onChange={this.onChange}\r\n            onInstanceReady={() => this.setState({ isLoading: false })}\r\n            readOnly={!this.props.editable}\r\n          />\r\n        </div>\r\n        {this.renderFooter()}\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    if (this.props.inline) {\r\n      return <div className='editor-inline'> {this.renderEditor()}</div>\r\n    }\r\n\r\n    let preview = this.props.preview == null ? this.props.data || '' : this.props.preview\r\n\r\n    let classNames = cx([ 'editor-preview', this.props.className, preview ? 'text-non-empty' : 'text-empty' ])\r\n\r\n    if (this.props.prefixPreview) {\r\n      preview = '<strong class=\"editor-preview-title\" >' + this.props.prefixPreview + '</strong> ' + preview\r\n    }\r\n\r\n    preview = preview.replace(/(min-)?width:.+?;/g, '')\r\n\r\n    return (\r\n      <Fragment>\r\n        <div className={cx('editor-preview-wrapper', this.props.wrapperClassName)} onClick={this.onClickPreview}>\r\n          <div\r\n            ref={this.previewRef}\r\n            className={classNames}\r\n            dangerouslySetInnerHTML={{ __html: preview }}\r\n            style={this.props.previewStyle}\r\n          />\r\n          {this.props.editable && (\r\n            <div className='action-list'>\r\n              <ButtonEdit onClick={this.onClickEdit} />\r\n            </div>\r\n          )}\r\n        </div>\r\n        {this.renderModal()}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","import { createContext } from 'react'\r\n\r\nexport default createContext<HojaTrabajoContextType>({ hoja_trabajo: null, update: (data) => {} })\r\n","import { PureComponent } from 'react'\r\n\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\n\r\ntype MenuItemNewProps = {\r\n  isEditable: boolean\r\n  headerText: string\r\n  buttonText: string\r\n  onSave: (data: any) => Promise<null>\r\n  moduleParams: any\r\n  item: any\r\n  contentAs: React.ComponentType<MenuItemModalType>\r\n}\r\n\r\ntype MenuItemModalType = {\r\n  item: any\r\n  isEditable: boolean\r\n  moduleParams: any\r\n  onSave: (item: any) => void\r\n}\r\n\r\nexport class MenuItemNew extends PureComponent<MenuItemNewProps, { modalOpen: boolean }> {\r\n  state = {\r\n    modalOpen: false\r\n  }\r\n\r\n  onClick = () => {\r\n    this.setState({ modalOpen: true })\r\n  }\r\n\r\n  onCloseModal = () => {\r\n    this.setState({ modalOpen: false })\r\n  }\r\n\r\n  onSave = (data: ProyectoHallazgo) => {\r\n    this.props.onSave(data).then(() => {\r\n      this.onCloseModal()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.isEditable) {\r\n      return\r\n    }\r\n\r\n    const MenuItemModal = this.props.contentAs\r\n\r\n    return (\r\n      <div className='_a-center'>\r\n        <button className='button ui right tiny compact plain green rounded' onClick={this.onClick}>\r\n          {this.props.buttonText} <i className='icon plus' />\r\n        </button>\r\n        {this.state.modalOpen && (\r\n          <Modal\r\n            open\r\n            dimmer='inverted'\r\n            className='modal-ab modal-sidebarmenuitem'\r\n            size='large'\r\n            closeIcon\r\n            closeOnDimmerClick={false}\r\n            closeOnEscape={false}\r\n            onClose={this.onCloseModal}\r\n          >\r\n            <Modal.Header>{this.props.headerText}</Modal.Header>\r\n            <MenuItemModal\r\n              onSave={this.onSave}\r\n              moduleParams={this.props.moduleParams}\r\n              isEditable={this.props.isEditable}\r\n              item={this.props.item}\r\n            />\r\n          </Modal>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype MenuItemNewHeaderProps = {\r\n  item: {\r\n    label: string\r\n    status: ProyectoModuleStatusEnum\r\n  } & IAuthorLog\r\n}\r\n\r\nexport const MenuItemNewHeader = (props: MenuItemNewHeaderProps) => {\r\n  const status = props.item.status || 'EN PROCESO'\r\n  return (\r\n    <div className='ui grid padded' style={{ marginBottom: 0 }}>\r\n      <div className='row' style={{ paddingTop: 0 }}>\r\n        <div className='column four wide'>\r\n          <strong style={{ fontWeight: 600 }}>{props.item.label}</strong>\r\n        </div>\r\n        <div className='column four wide'>\r\n          <span>Estado: </span>\r\n          <div className='lb-status-wrapper'>\r\n            <div className={`lb-status lb-status-${_.str.dasherize(status.toLowerCase())}`}>{status}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className='column four wide'>\r\n          <AuthorIconLogDefaultWrapper model={props.item} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","export namespace HallazgoUtils {\r\n  export function formatName(name: string) {\r\n    return ('' + name).match(/^\\d+$/) ? 'Hallazgo #' + name : name\r\n  }\r\n}\r\n","module.exports = ReactDOM;","import Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Tab from 'semantic-ui-react/dist/commonjs/modules/Tab/Tab'\r\nimport Progress from 'semantic-ui-react/dist/commonjs/modules/Progress/Progress'\r\nimport Table from 'semantic-ui-react/dist/commonjs/collections/Table/Table'\r\n\r\nimport TableRowInstruccion from './TableRowInstruccion'\r\nimport { PasoObjetivoPane } from './AppVisitaTab'\r\nimport TabPaneVisitaBase from './TabPaneVisitaBase'\r\nimport MenuSidebarVisita from './MenuSidebarVisita'\r\n\r\nimport * as uuid from 'uuid'\r\nimport { DefaultErrorHandler } from '../global/ErrorHandler'\r\n\r\nexport default class TabPaneVisita extends TabPaneVisitaBase<TabPaneVisitaProps, TabPaneVisitaState> {\r\n  constructor(props: TabPaneVisitaProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      progress: this.calculateProgress(),\r\n      id_status: '' + props.visita.id_status,\r\n\r\n      openAsignarUsuarioModal: false\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    const $table = $(`#table-visita-instrucciones-${this.props.visita.id}`)\r\n\r\n    $table.floatThead()\r\n\r\n    if (this.props.isEditable && this.isAllowedAddInstructions() && user_has_role_permission('instruccion_edit')) {\r\n      $table.tableDnD({\r\n        dragHandle: '.sort-handler',\r\n        onDragClass: 'dragging',\r\n        onDragStop: (table: any) => {\r\n          let serialize = []\r\n          const rows = table.rows\r\n\r\n          for (let i: number = 1; i < rows.length; i++) {\r\n            let rowId = rows[i].id.substr(18)\r\n            serialize.push(rowId)\r\n            $(rows[i]).find('.instruction-iteration').text(_.padLeft('' + i, 3, '0') + '.')\r\n          }\r\n\r\n          const url = url_for(`proyecto/${this.props.visita.HojaTrabajo.proyecto.id}/master_data/instruccion/sort`)\r\n          $.ajax(url, {\r\n            type: 'POST',\r\n            data: {\r\n              sort: serialize,\r\n              id_paso: this.props.visita.HojaTrabajo.paso.id,\r\n              id_visita: this.props.visita.id_visita\r\n            },\r\n            dataType: 'json'\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    $(`#table-visita-instrucciones-${this.props.visita.id}`).floatThead('destroy')\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    const $table = $(`#table-visita-instrucciones-${this.props.visita.id}`)\r\n\r\n    setTimeout(function() {\r\n      $table.floatThead('reflow')\r\n    }, 1000)\r\n  }\r\n\r\n  onClickAddInstruccion = () => {\r\n    this.props.visita.instructions.push({\r\n      local_id: uuid.v1(),\r\n      category: null,\r\n      description: null,\r\n      Attachments: [],\r\n      is_done: false,\r\n      Visita: this.props.visita,\r\n      updated_at: null\r\n    })\r\n    this.props.visita.updated_at = Date.create().format('{year}-{MM}-{dd} {hh}:{mm}:{ss}')\r\n\r\n    this.recalculateProgress()\r\n\r\n    if (this.props.isEditable && this.isAllowedSortInstructions() && user_has_role_permission('instruccion_edit')) {\r\n      setTimeout(() => {\r\n        $(`#table-visita-instrucciones-${this.props.visita.id}`).tableDnDUpdate()\r\n      }, 300)\r\n    }\r\n  }\r\n\r\n  calculateProgress() {\r\n    const done_count = this.props.visita.instructions.filter((_item) => _item.is_done).length\r\n    return this.props.visita.instructions.length == 0\r\n      ? 0\r\n      : Math.round(100 * done_count / this.props.visita.instructions.length)\r\n  }\r\n\r\n  isAllowedAddInstructions() {\r\n    return !_.includes([ '2A4', '2A3' ], this.props.visita.HojaTrabajo.paso.code)\r\n  }\r\n\r\n  isAllowedSortInstructions() {\r\n    return !_.includes([ '2A4', '2A3' ], this.props.visita.HojaTrabajo.paso.code)\r\n  }\r\n\r\n  recalculateProgress() {\r\n    const progress = this.calculateProgress()\r\n\r\n    this.setState({ progress })\r\n  }\r\n\r\n  onUpdateInstruccion = (instruccion: Instruccion, key: number) => {\r\n    this.props.visita.instructions[key] = instruccion\r\n    this.recalculateProgress()\r\n  }\r\n\r\n  onRemoveInstruccion = (key: number) => {\r\n    this.props.visita.instructions = this.props.visita.instructions.filter((_, i) => i !== key)\r\n    this.recalculateProgress()\r\n\r\n    $(`#table-visita-instrucciones-${this.props.visita.id} tbody tr`).each(function(i) {\r\n      $(this).find('.instruction-iteration').text(_.padLeft('' + (i + 1), 3, '0') + '.')\r\n    })\r\n  }\r\n\r\n  getCompletadoDisabledText(): string | null {\r\n    if (this.state.progress < 100) {\r\n      return 'Para completar esta hoja de trabajo, es necesario que TODAS las instrucciones estén atendidas.'\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  render() {\r\n    const { active, visita } = this.props\r\n\r\n    const menuSidebarActionItems = {\r\n      _ajustes: this.props.type != 'PERIODO',\r\n      _history: this.props.type != 'PERIODO',\r\n      instructions_add:\r\n        this.props.isEditable && this.isAllowedAddInstructions() && user_has_role_permission('instruccion_create')\r\n          ? {\r\n              link: true,\r\n              icon: { name: 'plus', size: 'large' },\r\n              title: 'Añadir Instrucción',\r\n              onClick: this.onClickAddInstruccion\r\n            }\r\n          : null\r\n    }\r\n\r\n    return (\r\n      <Tab.Pane active={active}>\r\n        <div className='visita-progress-container'>\r\n          <Progress className='visita-progress' size='tiny' color='green' percent={this.state.progress} />\r\n          <div className='visita-progress-label'>{`${this.state.progress}%`}</div>\r\n        </div>\r\n\r\n        <DefaultErrorHandler>\r\n          <MenuSidebarVisita visita={visita} actionItems={menuSidebarActionItems} />\r\n        </DefaultErrorHandler>\r\n\r\n        <PasoObjetivoPane isEditable={this.props.isEditable} />\r\n\r\n        <Table stackable className='table-visita-instrucciones' id={`table-visita-instrucciones-${visita.id}`}>\r\n          <Table.Header>\r\n            <Table.Row>\r\n              <Table.HeaderCell className='th-instruccion' colSpan='2'>\r\n                Instrucciones\r\n              </Table.HeaderCell>\r\n              <Table.HeaderCell className='th-accion'>Acción</Table.HeaderCell>\r\n              <Table.HeaderCell className='th-observaciones'>Observaciones/Evidencia</Table.HeaderCell>\r\n              <Table.HeaderCell className='th-adjuntos'>Adjuntos</Table.HeaderCell>\r\n              <Table.HeaderCell className='th-actions computer'>&nbsp;</Table.HeaderCell>\r\n            </Table.Row>\r\n          </Table.Header>\r\n          <Table.Body>{this.renderInstrucciones(visita)}</Table.Body>\r\n        </Table>\r\n\r\n        <div>\r\n          {_.size(visita.instructions) > 0 &&\r\n          this.props.isEditable &&\r\n          this.isAllowedAddInstructions() &&\r\n          user_has_role_permission('instruccion_create') && (\r\n            <div className='ab-actions-group compact-actions'>\r\n              <Button\r\n                primary\r\n                floated='left'\r\n                compact\r\n                icon='plus'\r\n                content='Añadir Instrucción'\r\n                onClick={this.onClickAddInstruccion}\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {_.size(visita.instructions) > 0 && this.renderStatusActions()}\r\n        </div>\r\n      </Tab.Pane>\r\n    )\r\n  }\r\n\r\n  renderInstrucciones(visita: ProyectoPasoVisita) {\r\n    if (_.size(visita.instructions) == 0) {\r\n      return (\r\n        <Table.Row>\r\n          <Table.Cell colSpan='6' style={{ textAlign: 'center' }}>\r\n            <div className='alert alert-block nocontent'>\r\n              <h3>Sin instrucciones </h3>\r\n              <p>\r\n                <span className='icon-warning-sign' />Esta hoja de trabajo aún no tiene instrucciones registradas.{' '}\r\n              </p>\r\n              {this.props.isEditable &&\r\n              user_has_role_permission('instruccion_create') && [\r\n                <Button\r\n                  key='button'\r\n                  content='Agregar instrucción'\r\n                  color='green'\r\n                  compact\r\n                  icon='info circle'\r\n                  onClick={this.onClickAddInstruccion}\r\n                  style={{ marginTop: '30px' }}\r\n                />\r\n              ]}\r\n            </div>\r\n          </Table.Cell>\r\n        </Table.Row>\r\n      )\r\n    }\r\n\r\n    let instructions = _.map(visita.instructions, function(item, k) {\r\n      item.index = k\r\n      return item\r\n    })\r\n    let instructionGroups = _.values(\r\n      _.map(_.groupBy(instructions, 'category'), function(item, k) {\r\n        return { text: k, instructions: item }\r\n      })\r\n    )\r\n\r\n    let rows: JSX.Element[] = []\r\n    instructionGroups.forEach((instruccionGroup: { text: string; instructions: Instruccion[] }, i: number) => {\r\n      if (instruccionGroup.text != '' && instruccionGroup.text != 'null' && instruccionGroup.text != null) {\r\n        rows.push(\r\n          <tr key={i} className='macroinstruccion-row nodrag nodrop'>\r\n            <td colSpan={6}>{instruccionGroup.text}</td>\r\n          </tr>\r\n        )\r\n      }\r\n\r\n      instruccionGroup.instructions.forEach((instruccion: Instruccion, j: number) => {\r\n        instruccion.Visita = visita\r\n        rows.push(\r\n          <TableRowInstruccion\r\n            key={instruccion.local_id}\r\n            index={instruccion.index}\r\n            iteration={j}\r\n            instruccion={instruccion}\r\n            isEditable={this.props.isEditable}\r\n            isSortable={this.props.isEditable && this.isAllowedSortInstructions()}\r\n            onUpdate={this.onUpdateInstruccion}\r\n            onRemove={this.onRemoveInstruccion}\r\n            onUpdateVisita={this.onUpdate}\r\n          />\r\n        )\r\n      })\r\n    })\r\n\r\n    return rows\r\n  }\r\n}\r\n","import { Component } from 'react'\r\n\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon'\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label'\r\nimport List from 'semantic-ui-react/dist/commonjs/elements/List'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer/Dimmer'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader/Loader'\r\n\r\nexport class AttachmentListItem extends Component<AttachmentListItemProps> {\r\n  private static getFileExtension(filename: string): string {\r\n    return filename.split('.').pop()\r\n  }\r\n\r\n  private static getFileIconUrl(file: string): string {\r\n    const extension = AttachmentListItem.getFileExtension(file)\r\n\r\n    const file_icon = function() {\r\n      switch (extension) {\r\n        case 'xls':\r\n        case 'xlsx':\r\n        case 'xlsm':\r\n        case 'xlsxm':\r\n          return 'excel'\r\n        case 'doc':\r\n        case 'docx':\r\n          return 'word'\r\n        case 'pdf':\r\n          return 'pdf'\r\n        case 'png':\r\n        case 'jpg':\r\n        case 'jpeg':\r\n        case 'bmp':\r\n        case 'gif':\r\n          return 'image'\r\n        case 'zip':\r\n        case 'rar':\r\n          return 'zip'\r\n        default:\r\n          return 'default'\r\n      }\r\n    }\r\n\r\n    return public_path(`images/file_icons/${file_icon()}.png`)\r\n  }\r\n\r\n  changeStatus(e: React.SyntheticEvent, status: 'completado' | 'revisado') {\r\n    e.preventDefault()\r\n\r\n    const url: string = url_for(\r\n      `proyecto/${this.props.attachment.id_proyecto}/adjunto/${this.props.attachment.id}/${status}`\r\n    )\r\n    $.blockUI({\r\n      message:\r\n        '<div class=\"ajax-loader-snake-32  _a-center\"></div><h3 class=\"loading-block-text\">Marcando archivo como ' +\r\n        _.str.capitalize(status) +\r\n        '.<br> Por favor Espere ...</h3>'\r\n    })\r\n\r\n    $.ajax(url, { type: 'POST', data: {}, dataType: 'json' })\r\n      .done((res) => {\r\n        this.props.onUpdate(res.response.record)\r\n        $.unblockUI()\r\n      })\r\n      .fail(() => {\r\n        $.pnotify({ text: 'El archivo no pudo ser actualizado.', type: 'error' })\r\n        $.unblockUI()\r\n      })\r\n  }\r\n\r\n  onRemove = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n\r\n    const url: string = url_for(\r\n      `proyecto/${this.props.attachment.id_proyecto}/adjunto/${this.props.attachment.id}/remove`\r\n    )\r\n    bootbox.warningConfirm(\r\n      '¿Esta seguro de querer borrar este archivo?<br><br>Tenga en cuenta que el sistema intentará borrar automáticamente los enlaces existentes a este archivo.',\r\n      'Cancelar',\r\n      'Aceptar',\r\n      (r) => {\r\n        if (r) {\r\n          $.blockUI({\r\n            message:\r\n              '<div class=\"ajax-loader-snake-32  _a-center\"></div><h3 class=\"loading-block-text\">Borrando archivo.<br> Por favor Espere ...</h3>'\r\n          })\r\n          $.ajax(url, { type: 'POST', data: {}, dataType: 'json' })\r\n            .done(() => {\r\n              this.props.onDelete(this.props.attachment, () => $.unblockUI())\r\n            })\r\n            .fail(() => {\r\n              $.pnotify({ text: 'El archivo no pudo ser borrado.', type: 'error' })\r\n              $.unblockUI()\r\n            })\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const { attachment } = this.props\r\n\r\n    let completadoComp\r\n    if (attachment.fecha_completado) {\r\n      completadoComp = (\r\n        <div style={{ display: 'inline-block' }}>\r\n          <strong className='title'>(P) </strong>\r\n          <div\r\n            style={{ display: 'inline-block', minWidth: 20, textAlign: 'center', marginRight: 2 }}\r\n            title={`Preparado por: ${attachment.UpdateLog[0].User.name}`}\r\n          >\r\n            {attachment.UpdateLog[0].User.sigla}&nbsp;\r\n          </div>\r\n          <div style={{ display: 'inline-block' }} title={attachment.fecha_completado}>\r\n            <span className='icon-moon-calendar' />{' '}\r\n            {Date.create(attachment.fecha_completado).format('{year}-{MM}-{dd}')}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    let revisadoComp\r\n    if (attachment.fecha_revisado) {\r\n      revisadoComp = (\r\n        <div style={{ display: 'inline-block' }}>\r\n          <strong className='title'>(R) </strong>\r\n          <div\r\n            style={{ display: 'inline-block', minWidth: 20, textAlign: 'center', marginRight: 2 }}\r\n            title={`Revisado por: ${attachment.RevisionLog[0].User.name}`}\r\n          >\r\n            {attachment.RevisionLog[0].User.sigla}&nbsp;\r\n          </div>\r\n          <div style={{ display: 'inline-block' }} title={attachment.fecha_revisado}>\r\n            <span className='icon-moon-calendar' /> {Date.create(attachment.fecha_revisado).format('{year}-{MM}-{dd}')}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    let revisadoLink\r\n    if (user_has_role([ 'PM', 'SR' ])) {\r\n      if (attachment.fecha_completado) {\r\n        revisadoLink = (\r\n          <button style={{ marginLeft: '8px' }} onClick={(e) => this.changeStatus(e, 'revisado')} className='act'>\r\n            <span className='icon-moon-checkmark-8' /> Revisar\r\n          </button>\r\n        )\r\n      } else {\r\n        revisadoLink = (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <button style={{ marginLeft: '8px' }} className='act disabled'>\r\n                  <span className='icon-moon-checkmark-8' /> Revisar\r\n                </button>\r\n              </div>\r\n            }\r\n            content='Esta archivo adjunto debe estar primero en estado COMPLETADO, para poder ser marcado como REVISADO'\r\n            header='Marcar como Revisado | Opción deshabilitada'\r\n            className='disable-text'\r\n            on='hover'\r\n          />\r\n        )\r\n      }\r\n    }\r\n\r\n    return (\r\n      <li key={attachment.id} style={{ marginBottom: 2 }}>\r\n        <div style={{ background: '#f5f9f8', borderRadius: 6, border: '1px solid #aecec7' }}>\r\n          <div className='col-md-1' style={{ marginTop: 5, borderRight: '1px inset #d7e1e2' }}>\r\n            <img src={AttachmentListItem.getFileIconUrl(attachment.filename)} alt='Icono' />\r\n          </div>\r\n          <div className='col-md-11' style={{ padding: '3px 10px' }}>\r\n            <div\r\n              className='noqtip'\r\n              title={attachment.filename}\r\n              style={{\r\n                fontWeight: 'bold',\r\n                fontSize: '12px',\r\n                maxWidth: 400,\r\n                whiteSpace: 'nowrap',\r\n                overflow: 'hidden',\r\n                textOverflow: 'ellipsis'\r\n              }}\r\n            >\r\n              {attachment.filename}\r\n            </div>\r\n            <div style={{ fontSize: '12px' }}>\r\n              <span\r\n                style={{ fontStyle: 'italic' }}\r\n                className='noqtip'\r\n                title={`Peso del archivo: ${attachment.filesize_human}`}\r\n              >\r\n                {attachment.filesize_human}\r\n              </span>{' '}\r\n              |\r\n              <div className='attachment-actionsbar'>\r\n                <div className='section-a'>\r\n                  <a\r\n                    href={public_path(`uploads/proyecto_adjunto/${attachment.filepath}`)}\r\n                    target='_blank'\r\n                    className='act'\r\n                    style={{ color: '#777' }}\r\n                  >\r\n                    <span className='icon-moon-download' style={{ fontSize: '10px' }} /> Descargar\r\n                  </a>\r\n                </div>\r\n\r\n                {user_has_role([ 'PM', 'SR', 'JR' ]) && (\r\n                  <div className='section-a'>\r\n                    <a href='#' className='act' onClick={this.onRemove}>\r\n                      <span className='icon-tc-trash' /> Borrar\r\n                    </a>\r\n                  </div>\r\n                )}\r\n\r\n                <div className='section-a' style={{ minWidth: 90 }}>\r\n                  {attachment.fecha_completado ? (\r\n                    <Popup trigger={completadoComp} position='bottom center'>\r\n                      <Popup.Header content='Preparado por' />\r\n                      <Popup.Content>\r\n                        <table className='table nowrap'>\r\n                          <tbody>\r\n                            {attachment.UpdateLog.map((item, k) => {\r\n                              return (\r\n                                <tr key={k}>\r\n                                  <td>\r\n                                    <Icon name='user circle' color='green' /> {item.User.name} ({item.User.sigla})\r\n                                  </td>\r\n                                  <td>\r\n                                    <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                                  </td>\r\n                                </tr>\r\n                              )\r\n                            })}\r\n                          </tbody>\r\n                        </table>\r\n                      </Popup.Content>\r\n                    </Popup>\r\n                  ) : (\r\n                    user_has_role([ 'PM', 'SR', 'JR' ]) && (\r\n                      <button\r\n                        style={{ marginLeft: '8px' }}\r\n                        onClick={(e) => this.changeStatus(e, 'completado')}\r\n                        className='act'\r\n                      >\r\n                        <span className='icon-moon-checkmark-8' /> Completar\r\n                      </button>\r\n                    )\r\n                  )}\r\n                </div>\r\n\r\n                <div className='section-a'>\r\n                  {attachment.fecha_revisado && (\r\n                    <Popup trigger={revisadoComp} position='bottom center'>\r\n                      <Popup.Header content='Revisado por' />\r\n                      <Popup.Content>\r\n                        <table className='table nowrap'>\r\n                          <tbody>\r\n                            {attachment.RevisionLog.map((item, k) => {\r\n                              return (\r\n                                <tr key={k}>\r\n                                  <td>\r\n                                    <Icon name='user circle' color='olive' /> {item.User.name} ({item.User.sigla})\r\n                                  </td>\r\n                                  <td>\r\n                                    <em>{Date.create(item.ts).format('{year}-{MM}-{dd}')}</em>\r\n                                  </td>\r\n                                </tr>\r\n                              )\r\n                            })}\r\n                          </tbody>\r\n                        </table>\r\n                      </Popup.Content>\r\n                    </Popup>\r\n                  )}\r\n                  {revisadoLink}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div />\r\n          </div>\r\n          <div className='clearfix' />\r\n        </div>\r\n      </li>\r\n    )\r\n  }\r\n}\r\n\r\nexport class AttachmentListPanel extends Component<AttachmentListPanelProps> {\r\n  static defaultProps = {\r\n    isLoading: false\r\n  }\r\n  render() {\r\n    let { isLoading, attachments } = this.props\r\n\r\n    return (\r\n      <div className='attachment-list-panel dimmable' style={{ minHeight: 40 }}>\r\n        {isLoading && (\r\n          <Dimmer inverted active>\r\n            <Loader inverted active className='elastic grey' />\r\n          </Dimmer>\r\n        )}\r\n        <h3 className='panel-title'>\r\n          Adjuntos:\r\n          <Label circular color='green'>\r\n            {_.size(attachments)}\r\n          </Label>\r\n        </h3>\r\n        {_.size(attachments) > 0 && (\r\n          <List divided className='attachment-list'>\r\n            {_.map(attachments, (attachment: ProyectoAttachment, i) => {\r\n              return (\r\n                <AttachmentListItem\r\n                  key={attachment.id}\r\n                  attachment={attachment}\r\n                  onUpdate={this.props.onUpdateItem}\r\n                  onDelete={this.props.onDeleteItem}\r\n                />\r\n              )\r\n            })}\r\n          </List>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport function cleanAttachmentFrom(value: string, adjunto: ProyectoAttachment) {\r\n  const h = public_path(`uploads/proyecto_adjunto/${adjunto.filepath}`, true).replace(/\\./g, '.').replace(/\\\\/g, '/')\r\n  const t = '<a .*href=\"' + h + '\"(.+?)/a>\\\\s*(<br\\\\s?/?>)?'\r\n  const re = new RegExp(t, 'g')\r\n\r\n  return value.replace(re, '')\r\n}\r\n","import { Component, Fragment, ReactNode } from 'react'\r\n\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\n\r\nimport EditorPreview from '../global/EditorPreview'\r\nimport { AuthorIconLogDefaultWrapper } from '../global/AuthorIconLog'\r\nimport HojaTrabajoContext from './HojaTrabajoContext'\r\nimport { HojaTrabajoUpdateUtils } from './utils'\r\n\r\nimport DualListBox from 'react-dual-listbox'\r\nimport Divider from 'semantic-ui-react/dist/commonjs/elements/Divider/Divider'\r\nimport Accordion from 'semantic-ui-react/dist/commonjs/modules/Accordion/Accordion'\r\nimport Form from 'semantic-ui-react/dist/commonjs/collections/Form/Form'\r\n\r\ntype AppVisitaDefaultTabProps = {\r\n  visita: ProyectoPasoVisita\r\n}\r\n\r\nexport class AppVisitaDefaultTab extends Component<AppVisitaDefaultTabProps> {\r\n  getStatusLabel() {\r\n    const { visita } = this.props\r\n\r\n    let status_label = null\r\n\r\n    if (visita.status) {\r\n      status_label = (\r\n        <Label\r\n          style={{ backgroundColor: visita.status_color }}\r\n          className={`visita-status visita-status-${_.str.underscored(visita.status)}`}\r\n          size='mini'\r\n        >\r\n          {visita.status}\r\n        </Label>\r\n      )\r\n    }\r\n\r\n    return status_label\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n\r\n    return (\r\n      <Fragment>\r\n        <span className='tabname' title={visita.label}>\r\n          {visita.label}\r\n        </span>\r\n        <AuthorIconLogDefaultWrapper model={visita} />\r\n        {this.getStatusLabel()}\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype PasoObjetivoPaneProps = {\r\n  isEditable: boolean\r\n}\r\n\r\nexport class PasoObjetivoPane extends Component<PasoObjetivoPaneProps> {\r\n  static contextType = HojaTrabajoContext\r\n\r\n  static defaultProps: PasoObjetivoPaneProps = {\r\n    isEditable: false\r\n  }\r\n\r\n  context: HojaTrabajoContextType\r\n\r\n  onChangeValue = (editor: CKEDITOR.editor) => {\r\n    const objetivo = editor.getData()\r\n    const { hoja_trabajo, update } = this.context\r\n\r\n    $.blockUI(create_blockUI_loading_message('Guardando Cambios'))\r\n    const url = url_for(`proyecto/${hoja_trabajo.proyecto.id}/master_data/paso/${hoja_trabajo.paso.id}/objetivo`)\r\n    $.ajax(url, { type: 'POST', data: { objetivo }, dataType: 'json' }).done(() => {\r\n      let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateField(hoja_trabajo, 'paso', { objetivo })\r\n      update(hoja_trabajo_new)\r\n      $.unblockUI()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    let { hoja_trabajo }: { hoja_trabajo: HojaTrabajo } = this.context\r\n    const ckeditorOptions = {\r\n      height: 150,\r\n      toolbar: [\r\n        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic' ] },\r\n        {\r\n          name: 'paragraph',\r\n          groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ],\r\n          items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'TextColor' ]\r\n        }\r\n      ],\r\n      autoParagraph: false,\r\n      removePlugins: 'elementspath, uploadfile, resize',\r\n      extraPlugins: 'openlink'\r\n    }\r\n\r\n    return (\r\n      <div className='hoja-trabajo-objetivo hoverable-actions'>\r\n        <EditorPreview\r\n          className='objetivo-text-editor'\r\n          ckeditorOptions={ckeditorOptions}\r\n          prefixPreview='Objetivo:'\r\n          label=' '\r\n          labelTitle='Objetivo: '\r\n          data={hoja_trabajo.paso.objetivo}\r\n          editable={this.props.isEditable && user_has_role_permission('paso_objetivo_edit')}\r\n          onSave={this.onChangeValue}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype PasoVisitaStatusActionsProps = {\r\n  visita: ProyectoPasoVisita\r\n  revisadoDisabledText?: string\r\n  completadoDisabledText?: string\r\n}\r\n\r\nexport class PasoVisitaStatusActions extends Component<PasoVisitaStatusActionsProps> {\r\n  static contextType = HojaTrabajoContext\r\n  context: HojaTrabajoContextType\r\n\r\n  onClickCompletado = () => {\r\n    const { hoja_trabajo } = this.context\r\n    const url = url_for(\r\n      `proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita/${this.props.visita\r\n        .id_visita}/save`\r\n    )\r\n\r\n    let loadingMessage = 'Marcando como Completado...'\r\n    $.blockUI(create_blockUI_loading_message(loadingMessage))\r\n    $.ajax(url, { type: 'POST', data: { op: 'c' }, dataType: 'json' }).done((res) => {\r\n      if (res.hasErrors) {\r\n        $.unblockUI()\r\n        bootbox.alert(res.message)\r\n      } else {\r\n        this.updateVisita(res.response.record)\r\n        $.unblockUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  onClickRevisado = () => {\r\n    const { hoja_trabajo } = this.context\r\n    const url = url_for(\r\n      `proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita/${this.props.visita\r\n        .id_visita}/save`\r\n    )\r\n\r\n    let loadingMessage = 'Marcando como Revisado...'\r\n    $.blockUI(create_blockUI_loading_message(loadingMessage))\r\n    $.ajax(url, { type: 'POST', data: { op: 'r' }, dataType: 'json' }).done((res) => {\r\n      if (res.hasErrors) {\r\n        $.unblockUI()\r\n        bootbox.alert(res.message)\r\n      } else {\r\n        this.updateVisita(res.response.record)\r\n        $.unblockUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  getRevisadoDisabledText() {\r\n    if (_.include([ '1', '2', '3' ], this.props.visita.id_status) || this.props.completadoDisabledText) {\r\n      return 'Esta visita debe estar primero en estado COMPLETADO, para poder marcar esta hoja de trabajo como REVISADA.'\r\n    } else if (_.include([ '6' ], this.props.visita.id_status)) {\r\n      return 'Esta visita  tiene Notas de Revisión que deben primero ser atendidas para poder marcar esta hoja de trabajo como REVISADA.'\r\n    } else if (this.props.visita.additionals.revisiones > 0) {\r\n      return 'Esta visita tiene Notas de Revisión pendientes por revisar que deben primero ser revisadas para poder marcar esta hoja de trabajo como REVISADA.'\r\n    }\r\n\r\n    return this.props.revisadoDisabledText\r\n  }\r\n\r\n  updateVisita(_visita: any) {\r\n    const { hoja_trabajo, update } = this.context\r\n    let hoja_trabajo_new = HojaTrabajoUpdateUtils.updateVisita(hoja_trabajo, this.props.visita, _visita)\r\n    update(hoja_trabajo_new)\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n    const revisadoDisabledText = this.getRevisadoDisabledText()\r\n\r\n    let icon_revisado_alert\r\n    if (\r\n      visita.fecha_revision && // Tiene fecha de revision\r\n      ((visita.fecha_completado && Date.create(visita.fecha_completado) > Date.create(visita.fecha_revision)) || // Fue completado despues de revisado\r\n        !_.includes([ '5', '6' ], '' + visita.id_status)) // No esta en estado Revisado o Notas de Revision\r\n    ) {\r\n      icon_revisado_alert = (\r\n        <Popup\r\n          trigger={<Icon color='red' name='warning circle' />}\r\n          content={'Esta visita ha recibido modificaciones después de su última revisión.'}\r\n        />\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className='actions ab-status-actions'>\r\n        {user_has_role_permission('paso_completado') && (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <Button\r\n                  primary\r\n                  icon\r\n                  compact\r\n                  onClick={this.onClickCompletado}\r\n                  disabled={this.props.completadoDisabledText != null}\r\n                >\r\n                  {' '}\r\n                  <Icon name='check' /> Completado\r\n                </Button>\r\n              </div>\r\n            }\r\n            content={this.props.completadoDisabledText}\r\n            header='Marcar como Completado | Opción deshabilitada'\r\n            disabled={this.props.completadoDisabledText == null}\r\n            className='disable-text'\r\n            on='hover'\r\n          />\r\n        )}\r\n        {user_has_role_permission([ 'paso_revisado' ]) && (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <Button\r\n                  color='olive'\r\n                  icon\r\n                  compact\r\n                  onClick={this.onClickRevisado}\r\n                  disabled={revisadoDisabledText != null}\r\n                >\r\n                  {' '}\r\n                  <Icon name='check' fitted />\r\n                  <Icon name='check' /> Revisado {icon_revisado_alert}\r\n                </Button>\r\n              </div>\r\n            }\r\n            content={revisadoDisabledText}\r\n            header='Marcar como Revisado | Opción deshabilitada'\r\n            disabled={revisadoDisabledText == null}\r\n            className='disable-text'\r\n            on='hover'\r\n            position='top right'\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype PasoVisitaAssocProps = {\r\n  hoja_trabajo: HojaTrabajo\r\n  trigger: ReactNode\r\n}\r\ntype PasoVisitaAssocState = {\r\n  open: boolean\r\n  newVisitaOpen: boolean\r\n  selectedVisitas: number[]\r\n}\r\n\r\nexport class PasoVisitaAssoc extends Component<PasoVisitaAssocProps, PasoVisitaAssocState> {\r\n  constructor(props: PasoVisitaAssocProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      open: false,\r\n      newVisitaOpen: false,\r\n      selectedVisitas: _.filter(_.map(this.props.hoja_trabajo.visitas, (item, id) => (item.id ? id : null)))\r\n    }\r\n  }\r\n\r\n  getModal() {\r\n    if (!this.state.open) {\r\n      return null\r\n    }\r\n\r\n    const icons = {\r\n      moveLeft: <i className='icon angle left' />,\r\n      moveAllLeft: <i className='icon angle double left' />,\r\n      moveRight: <i className='icon angle right' />,\r\n      moveAllRight: <i className='icon angle double right' />,\r\n      moveDown: <i className='icon angle down' />,\r\n      moveUp: <i className='icon angle up' />\r\n    }\r\n\r\n    const { hoja_trabajo } = this.props\r\n\r\n    const visitas = hoja_trabajo.visitas\r\n    let options: { value: number; label: string }[] = []\r\n\r\n    _.forEach(visitas, function(visita, id) {\r\n      options.push({\r\n        value: id,\r\n        label: visita.label\r\n      })\r\n    })\r\n\r\n    const onChange = (selectedVisitas: number[]) => {\r\n      this.setState({ selectedVisitas })\r\n    }\r\n\r\n    const onClose = () => {\r\n      this.setState({ open: false })\r\n    }\r\n\r\n    const onToggle = () => {\r\n      this.setState((state) => {\r\n        return { newVisitaOpen: !state.newVisitaOpen }\r\n      })\r\n    }\r\n\r\n    return (\r\n      <Modal key='modal-assoc' open closeIcon dimmer='inverted' size='small' onClose={onClose} className='modal-ab'>\r\n        <Modal.Header> Asociación de Visitas a este Paso</Modal.Header>\r\n        <Modal.Content>\r\n          <form\r\n            method='post'\r\n            className='ui form'\r\n            action={url_for(`proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita`)}\r\n          >\r\n            <div style={{ marginBottom: '15px' }}>Asocie las visitas a relacionar con este paso: </div> <br />\r\n            <DualListBox\r\n              name='visitas'\r\n              options={options}\r\n              availableLabel='Por asociar'\r\n              selectedLabel='Asociadas'\r\n              selected={this.state.selectedVisitas}\r\n              icons={icons}\r\n              onChange={onChange}\r\n            />\r\n            <Divider horizontal>O</Divider>\r\n            <Accordion>\r\n              <Accordion.Title active={this.state.newVisitaOpen} onClick={onToggle}>\r\n                <Icon name='caret right' /> Crear Nueva Visita\r\n              </Accordion.Title>\r\n              <Accordion.Content active={this.state.newVisitaOpen}>\r\n                <Form.Field inline>\r\n                  <label>Nombre de la visita</label>\r\n                  <div className='ui input'>\r\n                    <input placeholder='Nombre de la visita' name='visita_name' type='text' />\r\n                  </div>\r\n                </Form.Field>\r\n              </Accordion.Content>\r\n            </Accordion>\r\n            <button className='primary small ui button right floated'>Guardar</button>\r\n            <button className='negative small ui button right floated' type='button' onClick={onClose}>\r\n              Cancelar\r\n            </button>\r\n            <div className='clearfix' />\r\n          </form>\r\n        </Modal.Content>\r\n      </Modal>\r\n    )\r\n  }\r\n  render() {\r\n    return [\r\n      <div key='trigger' onClick={() => this.setState({ open: true })}>\r\n        {this.props.trigger}\r\n      </div>,\r\n      this.getModal()\r\n    ]\r\n  }\r\n}\r\n","export namespace HojaTrabajoUtils {\r\n  export function getAllVisitasAfter(hoja_trabajo: HojaTrabajo, visitaPivot: ProyectoPasoVisita) {\r\n    let visitas: ProyectoPasoVisita[] = []\r\n    let found: boolean = false\r\n\r\n    _.forEach(hoja_trabajo.visitas, function(visita) {\r\n      if (found) {\r\n        visitas.push(visita)\r\n        return\r\n      }\r\n      if (visita.id == visitaPivot.id) {\r\n        found = true\r\n      }\r\n    })\r\n\r\n    return visitas\r\n  }\r\n}\r\n\r\nexport namespace HojaTrabajoUpdateUtils {\r\n  /**\r\n   *\r\n   * @param hoja_trabajo Hoja de trabajo a actualizar\r\n   * @param visita Visita a actualizar\r\n   * @param new_data Datos actualizados a aplicar a la visita\r\n   */\r\n  export function updateVisita(\r\n    hoja_trabajo: HojaTrabajo,\r\n    visita: ProyectoPasoVisita | { id: string },\r\n    new_data: Partial<ProyectoPasoVisita>\r\n  ) {\r\n    let hoja_trabajo_copy = Object.assign({}, hoja_trabajo)\r\n\r\n    hoja_trabajo_copy.visitas = _.mapValues(hoja_trabajo_copy.visitas, (item) => {\r\n      if (item.id == visita.id) {\r\n        item = Object.assign({}, item, new_data)\r\n      }\r\n      return item\r\n    })\r\n\r\n    return hoja_trabajo_copy\r\n  }\r\n\r\n  export function updateVisitas(\r\n    hoja_trabajo: HojaTrabajo,\r\n    new_data: { [id_visita: string]: Partial<ProyectoPasoVisita> }\r\n  ) {\r\n    _.forEach(new_data, (visita_new_data, id_visita) => {\r\n      const visita = _.findWhere(hoja_trabajo.visitas, { id_visita })\r\n      hoja_trabajo = updateVisita(hoja_trabajo, visita, visita_new_data)\r\n    })\r\n\r\n    return hoja_trabajo\r\n  }\r\n\r\n  export function updateField(hoja_trabajo: HojaTrabajo, field: keyof HojaTrabajo, new_data: any) {\r\n    let hoja_trabajo_copy = Object.assign({}, hoja_trabajo)\r\n\r\n    hoja_trabajo_copy[field] = Object.assign({}, hoja_trabajo_copy[field], new_data)\r\n\r\n    return hoja_trabajo_copy\r\n  }\r\n}\r\n","import { Component } from 'react'\r\n\r\ntype DefaultErrorHandlerProps = {\r\n  errorMessage?: string | JSX.Element\r\n}\r\n\r\nexport class DefaultErrorHandler extends Component<DefaultErrorHandlerProps> {\r\n  state = {\r\n    hasError: false\r\n  }\r\n\r\n  static defaultProps: Partial<DefaultErrorHandlerProps> = {\r\n    errorMessage: null\r\n  }\r\n\r\n  static getDerivedStateFromError(error: any) {\r\n    return { hasError: true }\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    if (this.isLocalhost()) {\r\n      alert('ERROR: ' + error.message)\r\n    }\r\n  }\r\n\r\n  isLocalhost() {\r\n    return window.location.host === 'auditbrain.local'\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return this.props.errorMessage\r\n    }\r\n\r\n    return this.props.children\r\n  }\r\n}\r\n","import { PureComponent, Fragment, SyntheticEvent } from 'react'\r\nimport { MenuItemNewHeader } from './menuitem__new'\r\nimport EditorPreview from '../../global/EditorPreview'\r\nimport InputAutoNumeric from '../../global/InputAutoNumeric'\r\nimport MenuItemAjusteContext from './menuitem_ajuste_context'\r\nimport Autocomplete from 'react-autocomplete'\r\nimport { getNombreCuenta } from '../utils_ajuste'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\nimport { StatusButtonGroupActions } from '../../global/StatusButtonAction'\r\nimport cx from 'classnames'\r\nimport { GenericTooltip } from '../../global/Tooltip'\r\n\r\ndeclare var app: any\r\n\r\ntype AjusteModalProps = {\r\n  moduleParams: any\r\n  item: ProyectoAjusteGroup\r\n  isEditable: boolean\r\n  onSave: (changes: any, blockingText?: string) => void\r\n  onClickDelete?: (ev: SyntheticEvent) => void\r\n}\r\n\r\ntype AjusteModalState = {\r\n  descripcion: string\r\n  items: ProyectoAjuste[]\r\n  status: ProyectoModuleStatusEnum\r\n  aplicado: number\r\n}\r\n\r\nexport class AjusteModal extends PureComponent<AjusteModalProps, AjusteModalState> {\r\n  constructor(props: AjusteModalProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      descripcion: props.item.descripcion,\r\n      items: props.item.items || [],\r\n      status: props.item.status,\r\n      aplicado: props.item.aplicado\r\n    }\r\n  }\r\n\r\n  isNewItem() {\r\n    return !this.props.item.idx\r\n  }\r\n\r\n  esPlanillaDescuadrada() {\r\n    const { items } = this.state\r\n\r\n    if (!items) {\r\n      return false\r\n    }\r\n\r\n    const totalD = _.reduce(items, (acc, curr) => num(curr.debe) + acc, 0)\r\n    const totalH = _.reduce(items, (acc, curr) => num(curr.haber) + acc, 0)\r\n\r\n    return totalD != totalH\r\n  }\r\n\r\n  validateItems() {\r\n    return (\r\n      _.size(this.state.items) > 0 &&\r\n      !_.any(this.state.items, (item) => {\r\n        return item['cuenta'] == '' || item['nombre_cuenta'] == '' || (!item['debe'] && !item['haber'])\r\n      })\r\n    )\r\n  }\r\n\r\n  onChangeAplicado = (ev: SyntheticEvent) => {\r\n    this.setState({ aplicado: (ev.target as any).value })\r\n    if (!this.isNewItem()) {\r\n      this.props.onSave({ aplicado: (ev.target as any).value })\r\n    }\r\n  }\r\n\r\n  onChangeDescripcion = (ckeditor: CKEDITOR.editor) => {\r\n    this.setState({ descripcion: ckeditor.getData() })\r\n    if (!this.isNewItem()) {\r\n      this.props.onSave({ descripcion: ckeditor.getData() })\r\n    }\r\n  }\r\n\r\n  onAddItem = () => {\r\n    this.setState((prevState) => {\r\n      const items = [ ...prevState.items, createAjusteEmpty() ]\r\n\r\n      return { items }\r\n    })\r\n  }\r\n\r\n  onDeleteItem = (item: ProyectoAjuste, itemIndex: number) => {\r\n    this.setState(\r\n      (prevState) => {\r\n        const items = _.reject(prevState.items, (_item, k: number) => k == itemIndex)\r\n\r\n        return { items }\r\n      },\r\n      () => {\r\n        if (!this.isNewItem()) {\r\n          this.props.onSave({ items: this.state.items })\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  onUpdateItem = (item: ProyectoAjuste, itemIndex: number, notify: boolean = true) => {\r\n    this.setState(\r\n      (prevState) => {\r\n        let items\r\n        if (typeof prevState.items[itemIndex] === 'undefined') {\r\n          items = [ ...prevState.items ]\r\n          items.push(item)\r\n        } else {\r\n          items = _.map(prevState.items, (_item, k) => {\r\n            if (k == itemIndex) {\r\n              return Object.assign({}, _item, item)\r\n            } else {\r\n              return _item\r\n            }\r\n          })\r\n        }\r\n\r\n        return { items }\r\n      },\r\n      () => {\r\n        if (notify && !this.isNewItem()) {\r\n          const blockingText = _.any(this.state.items, (_item) => !_item.id) ? 'Guardando cambios' : null\r\n          this.props.onSave({ items: this.state.items }, blockingText)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  _onCreate(changes: any, blockingText?: string) {\r\n    if (!this.validateItems()) {\r\n      bootbox.alert('Ingrese el codigo de la cuenta y valor del ajuste para cada una de las filas del ajuste contable.')\r\n      return\r\n    }\r\n    this.props.onSave(Object.assign({}, this.state, changes), blockingText)\r\n  }\r\n\r\n  onCreate = () => {\r\n    this._onCreate({ status: 'EN PROCESO' }, 'Creando Ajuste')\r\n  }\r\n\r\n  onCreateAndCompletado = () => {\r\n    this._onCreate({ status: 'COMPLETADO' }, 'Creando Ajuste')\r\n  }\r\n\r\n  onCompletado = () => {\r\n    this.props.onSave({ status: 'COMPLETADO' }, 'Marcando como COMPLETADO')\r\n  }\r\n\r\n  onRevisado = () => {\r\n    this.props.onSave({ status: 'REVISADO' }, 'Marcando como REVISASO')\r\n  }\r\n\r\n  renderItemHeader() {\r\n    const item = Object.assign(\r\n      { label: this.props.item.idx ? `Ajuste #${this.props.item.idx}` : 'Ajuste Nuevo' },\r\n      this.props.item\r\n    )\r\n\r\n    return <MenuItemNewHeader item={item} />\r\n  }\r\n\r\n  renderRows() {\r\n    let items = this.state.items\r\n\r\n    return (\r\n      <Fragment>\r\n        <MenuItemAjusteContext.Consumer>\r\n          {(cuentas) =>\r\n            _.map(items, (row, k) => {\r\n              return (\r\n                <AjusteTableRow\r\n                  item={row}\r\n                  key={k}\r\n                  itemIndex={k}\r\n                  cuentas={cuentas}\r\n                  isEditable={this.props.isEditable}\r\n                  canRemove={_.size(items) > 1}\r\n                  onUpdate={this.onUpdateItem}\r\n                  onClickDelete={this.onDeleteItem}\r\n                />\r\n              )\r\n            })}\r\n        </MenuItemAjusteContext.Consumer>\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  renderActions() {\r\n    const { item } = this.props\r\n\r\n    const esPlanillaDescuadrada = this.esPlanillaDescuadrada()\r\n\r\n    let revisadoDisableText = null\r\n    if (esPlanillaDescuadrada) {\r\n      revisadoDisableText =\r\n        'No es posible guardar los cambios realizados en este ajuste mientras la planilla esté descuadrada.'\r\n    } else if (!item.fecha_completado) {\r\n      revisadoDisableText = 'Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO.'\r\n    }\r\n\r\n    const rightActions = !this.isNewItem() && (\r\n      <button className='ui button compact negative left floated' onClick={this.props.onClickDelete}>\r\n        <i className='icon trash' /> Eliminar\r\n      </button>\r\n    )\r\n\r\n    return this.isNewItem() ? (\r\n      <div className='actions ab-status-actions'>\r\n        <Popup\r\n          content='No es posible guardar este ajuste mientras la planilla esté descuadrada.'\r\n          disabled={!esPlanillaDescuadrada}\r\n          className='disable-text'\r\n          trigger={\r\n            <div className='button-wrapper'>\r\n              <button className='ui button compact green' onClick={this.onCreate} disabled={esPlanillaDescuadrada}>\r\n                Crear\r\n              </button>\r\n            </div>\r\n          }\r\n        />\r\n\r\n        <Popup\r\n          content='No es posible guardar este ajuste mientras la planilla esté descuadrada.'\r\n          disabled={!esPlanillaDescuadrada}\r\n          className='disable-text'\r\n          trigger={\r\n            <div className='button-wrapper'>\r\n              <button\r\n                className='ui button compact green'\r\n                onClick={this.onCreateAndCompletado}\r\n                disabled={esPlanillaDescuadrada}\r\n              >\r\n                Crear y Completar\r\n              </button>\r\n            </div>\r\n          }\r\n        />\r\n      </div>\r\n    ) : (\r\n      <Fragment>\r\n        {rightActions}\r\n        <StatusButtonGroupActions\r\n          completado={{\r\n            permission: 'hallazgo_completado',\r\n            onClick: this.onCompletado,\r\n            disableText: esPlanillaDescuadrada\r\n              ? 'No es posible guardar los cambios realizados en este ajuste mientras la planilla esté descuadrada.'\r\n              : null\r\n          }}\r\n          revisado={{\r\n            permission: 'hallazgo_revisado',\r\n            onClick: this.onRevisado,\r\n            record: item,\r\n            disableText: revisadoDisableText\r\n          }}\r\n        />\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <div className='content'>\r\n          {this.renderItemHeader()}\r\n          <table className='ui table compact'>\r\n            <thead>\r\n              <tr>\r\n                <th>Código de la Cuenta</th>\r\n                <th>Nombre de la Cuenta</th>\r\n                <th>Debe</th>\r\n                <th>Haber</th>\r\n                <th />\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.renderRows()}\r\n              {this.props.isEditable && (\r\n                <tr>\r\n                  <td colSpan={5}>\r\n                    <button type='button' className='ui button olive fluid icon' onClick={this.onAddItem}>\r\n                      Añadir Fila <i className='icon plus' />\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n          {this.esPlanillaDescuadrada() && (\r\n            <div className='ui red tiny message _a-center m1 '>\r\n              <i className='icon exclamation triangle yellow' /> Alerta: Planilla descuadrada\r\n            </div>\r\n          )}\r\n          <div className='ui segment'>\r\n            <EditorPreview\r\n              prefixPreview='Descripción del Ajuste'\r\n              labelTitle='Descripción del Ajuste'\r\n              ckeditorOptions='basic'\r\n              editable={this.props.isEditable}\r\n              data={this.state.descripcion}\r\n              onSave={this.onChangeDescripcion}\r\n            />\r\n          </div>\r\n\r\n          <div className='ui segment basic nopad pull-left' style={{ marginTop: 5 }}>\r\n            <label style={{ marginRight: 10, display: 'inline-block', fontWeight: 600 }}>Error Tolerable:</label>\r\n            {accounting.formatNumber(app.vars.error_tolerable[this.props.moduleParams.id_visita])}\r\n          </div>\r\n\r\n          <div className='ui right aligned segment basic nopad'>\r\n            <label style={{ marginRight: 10, display: 'inline-block', fontWeight: 600 }}>\r\n              ¿Ajuste Registrado? <GenericTooltip text='@tooltip.ajustes.aplicado' /> :\r\n            </label>\r\n            <select\r\n              className='raw-select'\r\n              value={'' + this.state.aplicado == '1' ? '1' : '0'}\r\n              onChange={this.onChangeAplicado}\r\n            >\r\n              <option value='1'>Sí</option>\r\n              <option value='0'>No</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        <div className='actions'>\r\n          {this.renderActions()}\r\n          <div className='clearfix' />\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype AjusteTableRowProps = {\r\n  item: ProyectoAjuste\r\n  itemIndex: number\r\n  cuentas: ProyectoAjusteCuenta[]\r\n  isEditable: boolean\r\n  canRemove: boolean\r\n  onUpdate: (item: ProyectoAjuste, itemIndex: number, notify: boolean) => void\r\n  onClickDelete: (item: ProyectoAjuste, itemIndex: number) => void\r\n}\r\n\r\ntype AjusteTableRowState = {\r\n  cuenta: string\r\n  nombre_cuenta: string\r\n  debe: number\r\n  haber: number\r\n}\r\n\r\nclass AjusteTableRow extends PureComponent<AjusteTableRowProps, AjusteTableRowState> {\r\n  constructor(props: AjusteTableRowProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      cuenta: props.item.cuenta,\r\n      nombre_cuenta: props.item.nombre_cuenta,\r\n      debe: props.item.debe,\r\n      haber: props.item.haber\r\n    }\r\n  }\r\n\r\n  notifyUpdate(notify: boolean = true) {\r\n    const changes = Object.assign({}, this.props.item, this.state)\r\n    if (changes['cuenta'] == '' || changes['nombre_cuenta'] == '' || (!changes['debe'] && !changes['haber'])) {\r\n      return\r\n    }\r\n\r\n    this.props.onUpdate(changes, this.props.itemIndex, notify)\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    if (!this.props.canRemove) {\r\n      return\r\n    }\r\n\r\n    bootbox.confirm(\r\n      '¿Desea eliminar esta fila de su ajuste contable?',\r\n      'Cancelar',\r\n      'Sí, eliminar fila',\r\n      (r: boolean) => {\r\n        if (!r) {\r\n          return\r\n        }\r\n\r\n        this.props.onClickDelete(this.props.item, this.props.itemIndex)\r\n      }\r\n    )\r\n  }\r\n\r\n  onSelectCuenta = (value: string, item: ProyectoAjuste) => {\r\n    this.setState({ cuenta: item.cuenta, nombre_cuenta: item.nombre_cuenta }, () => {\r\n      this.notifyUpdate()\r\n    })\r\n  }\r\n\r\n  onChangeCuenta = (ev: SyntheticEvent, value: string) => {\r\n    this.setState({ cuenta: value, nombre_cuenta: '' })\r\n  }\r\n\r\n  onChangeNombreCuenta = (ev: SyntheticEvent, value: string) => {\r\n    this.setState({ nombre_cuenta: value, cuenta: '' })\r\n  }\r\n\r\n  onBlurCuenta = () => {\r\n    const { cuentas } = this.props\r\n\r\n    this.setState(\r\n      (prevState) => {\r\n        if (prevState.cuenta == '' && prevState.nombre_cuenta == '') {\r\n          return null\r\n        }\r\n\r\n        if (prevState.cuenta != '' && prevState.nombre_cuenta != '') {\r\n          return null\r\n        }\r\n\r\n        if (prevState.cuenta != '') {\r\n          const nombre_cuenta: string = getNombreCuenta(cuentas, prevState.cuenta)\r\n\r\n          return { cuenta: prevState.cuenta, nombre_cuenta }\r\n        }\r\n\r\n        if (prevState.nombre_cuenta != '') {\r\n          const cuenta = _.find(\r\n            cuentas,\r\n            (item) => item.nombre_cuenta.toUpperCase() == prevState.nombre_cuenta.toUpperCase()\r\n          )\r\n\r\n          return { cuenta: cuenta ? cuenta.cuenta : '', nombre_cuenta: prevState.nombre_cuenta }\r\n        }\r\n      },\r\n      () => this.notifyUpdate()\r\n    )\r\n  }\r\n\r\n  onChangeInput = (field: 'debe' | 'haber', value: number, persist: boolean) => {\r\n    if (field == 'debe') {\r\n      this.setState({ debe: value }, () => this.notifyUpdate(persist))\r\n    } else {\r\n      this.setState({ haber: value }, () => this.notifyUpdate(persist))\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <tr>\r\n        <td>\r\n          <Autocomplete\r\n            items={this.props.cuentas}\r\n            getItemValue={(item) => item.cuenta}\r\n            renderItem={(item, isHighlighted) => {\r\n              return (\r\n                <div key={item.id} className={'item ' + (isHighlighted ? 'item-highlighted' : '')}>\r\n                  <div>{item.cuenta}</div>\r\n                  <div className='description'>{item.nombre_cuenta}</div>\r\n                </div>\r\n              )\r\n            }}\r\n            value={this.state.cuenta}\r\n            onChange={this.onChangeCuenta}\r\n            onSelect={this.onSelectCuenta}\r\n            inputProps={{ type: 'text', spellCheck: false, required: true, onBlur: this.onBlurCuenta }}\r\n            shouldItemRender={(item, value) => {\r\n              return item.cuenta.replace(/\\D/g, '').startsWith(value.replace(/\\D/g, ''))\r\n            }}\r\n            renderMenu={(items) => {\r\n              return (\r\n                <div className='autocomplete-menu' style={{ position: 'absolute', zIndex: 1002 }} children={items} />\r\n              )\r\n            }}\r\n            wrapperProps={{ className: cx({ error: !this.state.cuenta }) }}\r\n            wrapperStyle={{ display: 'inline-block', position: 'relative' }}\r\n          />\r\n          {!this.state.cuenta && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          <Autocomplete\r\n            items={this.props.cuentas}\r\n            getItemValue={(item) => item.nombre_cuenta}\r\n            renderItem={(item, isHighlighted) => {\r\n              return (\r\n                <div key={item.id} className={'item ' + (isHighlighted ? 'item-highlighted' : '')}>\r\n                  <div>{item.nombre_cuenta}</div>\r\n                  <div className='description'>{item.cuenta}</div>\r\n                </div>\r\n              )\r\n            }}\r\n            value={this.state.nombre_cuenta}\r\n            onChange={this.onChangeNombreCuenta}\r\n            onSelect={this.onSelectCuenta}\r\n            inputProps={{ type: 'text', spellCheck: false, required: true }}\r\n            shouldItemRender={(item, value) => {\r\n              const text = item.nombre_cuenta.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').toUpperCase()\r\n              return _.str.contains(text, value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').toUpperCase())\r\n            }}\r\n            renderMenu={(items) => {\r\n              return (\r\n                <div className='autocomplete-menu' style={{ position: 'absolute', zIndex: 1002 }} children={items} />\r\n              )\r\n            }}\r\n            wrapperProps={{ className: cx({ error: !this.state.nombre_cuenta }) }}\r\n            wrapperStyle={{ display: 'inline-block', position: 'relative' }}\r\n          />\r\n          {!this.state.nombre_cuenta && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          <div className={cx({ error: !this.state.debe && !this.state.haber })}>\r\n            <InputAutoNumeric\r\n              isEditable={this.props.isEditable}\r\n              value={this.state.debe}\r\n              disabled={!!this.state.haber}\r\n              onChange={(ev: SyntheticEvent, value: number) => this.onChangeInput('debe', value, false)}\r\n              onBlur={(ev: SyntheticEvent, value: number) => this.onChangeInput('debe', value, true)}\r\n            />\r\n          </div>\r\n          {!this.state.debe &&\r\n          !this.state.haber && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          <div className={cx({ error: !this.state.haber && !this.state.debe })}>\r\n            <InputAutoNumeric\r\n              isEditable={this.props.isEditable}\r\n              value={this.state.haber}\r\n              disabled={!!this.state.debe}\r\n              onChange={(ev: SyntheticEvent, value: number) => this.onChangeInput('haber', value, false)}\r\n              onBlur={(ev: SyntheticEvent, value: number) => this.onChangeInput('haber', value, true)}\r\n            />\r\n          </div>\r\n          {!this.state.haber &&\r\n          !this.state.debe && <div className='ui pointing above prompt mini label'>Requerido</div>}\r\n        </td>\r\n        <td>\r\n          {this.props.isEditable && (\r\n            <Popup\r\n              disabled={this.props.canRemove}\r\n              content='Todo ajuste contable debe tener un mínimo de 1 cuenta (fila).'\r\n              trigger={\r\n                <a href='#' onClick={this.onClickDelete} title='Eliminar Fila'>\r\n                  <i className='icon cancel red' />\r\n                </a>\r\n              }\r\n              header='Eliminar fila | Opción deshabilitada'\r\n              className='disable-text'\r\n            />\r\n          )}\r\n        </td>\r\n      </tr>\r\n    )\r\n  }\r\n}\r\n\r\nconst num = (input: any) => {\r\n  const v = parseFloat(input)\r\n  return isNaN(v) ? 0 : v\r\n}\r\n\r\nconst createAjusteEmpty = (): ProyectoAjuste => {\r\n  return {\r\n    cuenta: '',\r\n    debe: null,\r\n    haber: null,\r\n    nombre_cuenta: ''\r\n  }\r\n}\r\n","import { createContext } from 'react'\r\n\r\nexport default createContext([])\r\n","export const getNombreCuenta = (cuentas: ProyectoAjusteCuenta[], cuenta: string) => {\r\n  let found = _.findWhere(cuentas, { cuenta })\r\n\r\n  if (found) {\r\n    return found.nombre_cuenta\r\n  }\r\n\r\n  const cleanCuenta = function(c: string) {\r\n    return c.replace(/\\D/g, '')\r\n  }\r\n\r\n  found = _.findWhere(\r\n    _.map(cuentas, function(item) {\r\n      return { cuenta: cleanCuenta(item.cuenta), cuenta_real: item.cuenta_real, nombre_cuenta: item.nombre_cuenta }\r\n    }),\r\n    { cuenta: cleanCuenta(cuenta) }\r\n  )\r\n\r\n  return found ? found.nombre_cuenta : ''\r\n}\r\n","import htmlTruncate from 'html-truncate'\r\n\r\nexport function cleanSpacesFromHtml(text: string) {\r\n  if (text == null) {\r\n    return text\r\n  }\r\n\r\n  text = text.trim().replace(/\\r?\\n|\\r/g, '')\r\n  text = text.replace(/>\\s+</g, '><')\r\n  text = text.replace(/\\s{2,}/g, ' ')\r\n\r\n  return text\r\n}\r\n\r\nexport function truncateText(text: string, length: number = 300) {\r\n  if (text == null) {\r\n    return text\r\n  }\r\n\r\n  text = cleanSpacesFromHtml(text)\r\n  text = text.replace(/<table.*\\/table>/g, '<img src=\"/images/icon_tabular.png\" title=\"Tabla\" />') // Remove all tables\r\n\r\n  let html = htmlTruncate('' + text, length, { keepImageTag: true })\r\n\r\n  html = html.replace(/(min-)?width:.+?;/g, '')\r\n  html = html.replace(/(min-)?height:.+?;/g, '')\r\n  html = html.replace(/style=\".+?\"/g, '')\r\n\r\n  return html.trim()\r\n}\r\n","import React, { PureComponent, Fragment, SyntheticEvent } from 'react'\r\n\r\nimport EditorPreview from '../../global/EditorPreview'\r\nimport { StatusButtonGroupActions } from '../../global/StatusButtonAction'\r\nimport DatePicker, { registerLocale } from 'react-datepicker'\r\nimport datepickerEs from 'date-fns/locale/es'\r\nimport { format as formatDate, parseISO as parseDate, isValid as isValidDate } from 'date-fns'\r\nimport { MentionsInput, Mention } from 'react-mentions'\r\nimport { HallazgoUtils } from '../utils_hallazgo'\r\nimport cx from 'classnames'\r\nimport { MenuItemNewHeader } from './menuitem__new'\r\n\r\ndeclare var app: any\r\n\r\nregisterLocale('es', datepickerEs)\r\n\r\ntype HallazgoModalProps = {\r\n  moduleParams: any\r\n  item: ProyectoHallazgo\r\n  isEditable: boolean\r\n  onSave: (item: Partial<ProyectoHallazgo>) => void\r\n  onClickDelete?: (ev: SyntheticEvent) => void\r\n}\r\n\r\ntype HallazgoModalState = {\r\n  value: Partial<ProyectoHallazgo>\r\n}\r\n\r\nexport class HallazgoModal extends PureComponent<HallazgoModalProps, HallazgoModalState> {\r\n  constructor(props: HallazgoModalProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: props.item\r\n    }\r\n  }\r\n\r\n  private handlers: { [s: string]: any } = {}\r\n\r\n  attachHandler(field: string, handler: any) {\r\n    if (!this.handlers[field]) {\r\n      this.handlers[field] = handler\r\n    }\r\n\r\n    return this.handlers[field]\r\n  }\r\n\r\n  isNewItem() {\r\n    return this.props.item.id == null\r\n  }\r\n\r\n  updateModel(changes: any) {\r\n    this.setState((prevState) => {\r\n      return { value: Object.assign({}, prevState.value, changes) }\r\n    })\r\n\r\n    if (!this.isNewItem()) {\r\n      this.props.onSave(changes)\r\n    }\r\n  }\r\n\r\n  getDate(date: string): Date {\r\n    if (!date) {\r\n      return null\r\n    }\r\n\r\n    const d = parseDate(date)\r\n\r\n    return isValidDate(d) ? d : null\r\n  }\r\n\r\n  formatImplementadoChoice(implementado: string | boolean) {\r\n    if (implementado === null || implementado === '') {\r\n      return ''\r\n    }\r\n\r\n    return implementado === true || implementado === '1' ? '1' : '0'\r\n  }\r\n\r\n  _onCreate(changes: any) {\r\n    if (_.isEmpty(this.state.value.hallazgo)) {\r\n      bootbox.alert('La descripción del hallazgo NO puede ser un campo vacío.')\r\n      return\r\n    }\r\n\r\n    this.props.onSave(Object.assign({}, this.state.value, changes))\r\n  }\r\n\r\n  onCreate = () => {\r\n    this._onCreate({ status: 'EN PROCESO' })\r\n  }\r\n\r\n  onCreateAndCompletado = () => {\r\n    this._onCreate({ status: 'COMPLETADO' })\r\n  }\r\n\r\n  onCompletado = () => {\r\n    this.props.onSave({ status: 'COMPLETADO' })\r\n  }\r\n\r\n  onRevisado = () => {\r\n    this.props.onSave({ status: 'REVISADO' })\r\n  }\r\n\r\n  onEditorChange = (field: keyof ProyectoHallazgo) => {\r\n    const handler = (editor: CKEDITOR.editor, closeModal: boolean, autosave: boolean, cb: () => void) => {\r\n      const value = editor.getData()\r\n      if (field == 'hallazgo' && !this.isNewItem() && _.size(_.str.trim(value)) == 0) {\r\n        bootbox.alert('La descripción del hallazgo NO puede ser un campo vacío.')\r\n        return\r\n      }\r\n\r\n      this.updateModel({ [field]: value })\r\n      if ($.isFunction(cb)) {\r\n        cb()\r\n      }\r\n    }\r\n\r\n    return this.attachHandler(field, handler)\r\n  }\r\n\r\n  onInputChange = (field: keyof ProyectoHallazgo) => {\r\n    return this.attachHandler(field, (ev: SyntheticEvent) => {\r\n      this.updateModel({ [field]: (ev.target as any).value })\r\n    })\r\n  }\r\n\r\n  onDateChange = (field: keyof ProyectoHallazgo) => {\r\n    return this.attachHandler(field, (value: Date) => {\r\n      this.updateModel({ [field]: formatDate(value, 'yyyy-MM-dd') })\r\n    })\r\n  }\r\n  onValueChange = (field: keyof ProyectoHallazgo) => {\r\n    return this.attachHandler(field, (value: string) => {\r\n      this.updateModel({ [field]: value })\r\n    })\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    if ($.isFunction(this.props.onClickDelete)) {\r\n      this.props.onClickDelete(ev)\r\n    }\r\n  }\r\n\r\n  renderActions() {\r\n    const { item } = this.props\r\n\r\n    const rightActions = item.id !== null && (\r\n      <button className='ui button compact negative left floated' onClick={this.onClickDelete}>\r\n        <i className='icon trash' /> Eliminar\r\n      </button>\r\n    )\r\n\r\n    return item.id === null ? (\r\n      <div className='actions ab-status-actions'>\r\n        <button className='ui button compact green' onClick={this.onCreate}>\r\n          Crear\r\n        </button>\r\n\r\n        <button className='ui button compact green' onClick={this.onCreateAndCompletado}>\r\n          Crear y Completar\r\n        </button>\r\n      </div>\r\n    ) : (\r\n      <Fragment>\r\n        {rightActions}\r\n        <StatusButtonGroupActions\r\n          completado={{ permission: 'hallazgo_completado', onClick: this.onCompletado }}\r\n          revisado={{ permission: 'hallazgo_revisado', onClick: this.onRevisado, record: item }}\r\n        />\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  renderItemHeader() {\r\n    const item = Object.assign(\r\n      { label: this.props.item.id ? HallazgoUtils.formatName(this.props.item.name) : 'Hallazgo Nuevo' },\r\n      this.props.item\r\n    )\r\n\r\n    return <MenuItemNewHeader item={item} />\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n    const { value } = this.state\r\n\r\n    return (\r\n      <Fragment>\r\n        <div className='content'>\r\n          {this.renderItemHeader()}\r\n\r\n          {item.id && (\r\n            <div className='description-text'>\r\n              <strong>NOTA:</strong> El hallazgo debe describir la situación actual, causa, impacto y recomendación.\r\n            </div>\r\n          )}\r\n          <EditorPreview\r\n            className={'editor-preview-hallazgo'}\r\n            wrapperClassName={cx(!item.id || 'ui segment')}\r\n            data={value.hallazgo}\r\n            inline={item.id == null}\r\n            ckeditorOptions={{\r\n              attach_disableText:\r\n                'Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo.',\r\n              height: item.id ? 300 : 150\r\n            }}\r\n            ckeditorUploadOptions={{ model: `${this.props.moduleParams.model}__hallazgo`, modelId: item.id }}\r\n            footer='AttachmentList'\r\n            onSave={this.onEditorChange('hallazgo')}\r\n            previewStyle={{ overflowY: 'auto', maxHeight: 200, width: '100%' }}\r\n            label='<div class=\"description-text\"><strong>NOTA:</strong> El hallazgo debe describir la situación actual, causa, impacto y recomendación</div>'\r\n          />\r\n\r\n          <hr />\r\n\r\n          <div className='ui segment'>\r\n            <EditorPreview\r\n              data={value.plan_accion}\r\n              prefixPreview='Descripción Plan de Acción: '\r\n              labelTitle='Descripción Plan de Acción:'\r\n              ckeditorOptions={{\r\n                attach_disableText:\r\n                  'Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo.'\r\n              }}\r\n              ckeditorUploadOptions={{ model: `${this.props.moduleParams.model}__plan_accion`, modelId: item.id }}\r\n              footer='AttachmentList'\r\n              onSave={this.onEditorChange('plan_accion')}\r\n            />\r\n          </div>\r\n\r\n          <div className='ui three column grid'>\r\n            <div className='column'>\r\n              <label htmlFor='hallazgo_modal__responsable'>Responsable del Plan Acción: </label>\r\n              <HallazgoResponsableInput\r\n                value={value.responsable}\r\n                onChange={this.onValueChange('responsable')}\r\n                attrs={{ placeholder: 'Escriba el Nombre', style: { display: 'inline-block' } }}\r\n              />\r\n            </div>\r\n\r\n            <div className='column'>\r\n              <label htmlFor='hallazgo_modal__fecha_implementado'>Fecha Implementación: </label>\r\n              <DatePicker\r\n                id='hallazgo_modal__fecha_implementado'\r\n                dateFormat='yyyy-MM-dd'\r\n                locale='es'\r\n                fixedHeight\r\n                placeholderText='AAAA-mm-dd'\r\n                className='react-datepicker--input'\r\n                selected={this.getDate(value.fecha_implementado)}\r\n                onChange={this.onDateChange('fecha_implementado')}\r\n              />\r\n            </div>\r\n\r\n            <div className='column right aligned'>\r\n              <label htmlFor='hallazgo_modal__implementado'>Estado Implementación: </label>\r\n              <select\r\n                id='hallazgo_modal__implementado'\r\n                value={this.formatImplementadoChoice(value.implementado)}\r\n                onChange={this.onInputChange('implementado')}\r\n              >\r\n                <option value=''>Pendiente</option>\r\n                <option value='0'>En Proceso</option>\r\n                <option value='1'>Hecho</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className='actions'>\r\n          {this.renderActions()}\r\n          <div className='clearfix' />\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype HallazgoResponsableInputProps = {\r\n  value: string\r\n  onChange: (newValue: string) => void\r\n  attrs?: any\r\n}\r\n\r\nclass HallazgoResponsableInput extends PureComponent<HallazgoResponsableInputProps, { value: string }> {\r\n  users: { id: string; display: string }[]\r\n\r\n  mentionStyle = {\r\n    display: 'inline-block',\r\n    minWidth: '200px',\r\n    suggestions: {\r\n      list: {\r\n        backgroundColor: 'white',\r\n        border: '1px solid rgba(0,0,0,0.15)',\r\n        fontSize: 14\r\n      },\r\n      item: {\r\n        padding: '5px 15px',\r\n        borderBottom: '1px solid rgba(0,0,0,0.15)',\r\n        '&focused': {\r\n          backgroundColor: '#cee4e5'\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(props: HallazgoResponsableInputProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      value: props.value\r\n    }\r\n\r\n    this.users = _.map(app.vars.proyecto_equipo, (user: any) => {\r\n      return {\r\n        id: user.user_id,\r\n        display: user.name\r\n      }\r\n    })\r\n  }\r\n\r\n  onChange = (event: SyntheticEvent, newValue: string, newPlainTextValue: string, mentions: any) => {\r\n    this.setState({ value: newValue })\r\n    this.props.onChange(newValue)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <MentionsInput\r\n        singleLine\r\n        type='text'\r\n        value={this.state.value == null ? '' : this.state.value}\r\n        onChange={this.onChange}\r\n        allowSpaceInQuery\r\n        {...this.props.attrs}\r\n        className='mentions-input'\r\n        style={this.mentionStyle}\r\n      >\r\n        <Mention trigger='@' data={this.users} appendSpaceOnAdd />\r\n      </MentionsInput>\r\n    )\r\n  }\r\n}\r\n","import { render } from 'react-dom'\r\nimport App from './App'\r\nimport AppPeriodo from './AppPeriodo'\r\n\r\ndeclare var app: any\r\n\r\naccounting.settings.number.precision = 0\r\naccounting.settings.number.thousand = '.'\r\naccounting.settings.number.decimal = ','\r\n\r\nif (app.vars.hoja_trabajo.paso.tipo == 'PERIODO') {\r\n  render(<AppPeriodo hoja_trabajo={app.vars.hoja_trabajo} />, document.getElementById('root'))\r\n} else {\r\n  render(<App hoja_trabajo={app.vars.hoja_trabajo} />, document.getElementById('root'))\r\n}\r\n","import { Component } from 'react'\r\nimport TabPaneVisita from './TabPaneVisita'\r\n\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon'\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Divider from 'semantic-ui-react/dist/commonjs/elements/Divider'\r\nimport Menu from 'semantic-ui-react/dist/commonjs/collections/Menu'\r\nimport Form from 'semantic-ui-react/dist/commonjs/collections/Form'\r\nimport Tab from 'semantic-ui-react/dist/commonjs/modules/Tab'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal'\r\nimport Accordion from 'semantic-ui-react/dist/commonjs/modules/Accordion/Accordion'\r\n\r\nimport { AppVisitaDefaultTab } from './AppVisitaTab'\r\nimport _ from 'lodash'\r\n\r\nimport DualListBox from 'react-dual-listbox'\r\nimport HojaTrabajoContext from './HojaTrabajoContext'\r\n\r\ndeclare var app: any\r\n\r\nexport default class App extends Component<HojaTrabajoAppProps, HojaTrabajoAppState> {\r\n  private panes: HojaTrabajoAppPane[]\r\n  constructor(props: HojaTrabajoAppProps) {\r\n    super(props)\r\n\r\n    const locationHash = window.location.hash.replace(/^#!vis-/, '')\r\n\r\n    let activeIndex: number\r\n    let visita_current\r\n    if (locationHash) {\r\n      activeIndex = +locationHash\r\n      visita_current = _.find(this.props.hoja_trabajo.visitas, { index: activeIndex })\r\n    } else {\r\n      visita_current = _.find(this.props.hoja_trabajo.visitas, { is_current: true })\r\n      activeIndex = visita_current ? visita_current.index : null\r\n    }\r\n\r\n    if (visita_current) {\r\n      app.vars.current_idvisita = visita_current.id_visita\r\n    }\r\n\r\n    this.state = {\r\n      activeIndex,\r\n      selectedVisitas: _.filter(_.map(this.props.hoja_trabajo.visitas, (item, id) => (item.id ? id : null))),\r\n      newVisitaOpen: false,\r\n      assocModalOpen: false,\r\n      hoja_trabajo: this.props.hoja_trabajo\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    /**\r\n     * Ancho de la tab.\r\n     */\r\n    const tabWidth: number = 90 / _.size(_.filter(this.panes, { type: 'sheet' }))\r\n    $('#visita-tabs').find('.menu>a.visita-tab').css({ width: tabWidth + '%' })\r\n  }\r\n\r\n  handleClick = (e: React.SyntheticEvent, { index }: { index: number }) => {\r\n    this.setState({ activeIndex: index })\r\n    const visita = _.find(this.state.hoja_trabajo.visitas, { index })\r\n    app.vars.current_idvisita = visita.id_visita\r\n    $(`#table-visita-instrucciones-${visita.id}`).floatThead('reflow')\r\n    window.location.hash = '#!vis-' + index\r\n  }\r\n\r\n  showModal = () => {\r\n    this.setState({ assocModalOpen: true })\r\n  }\r\n\r\n  onChangeVisita = (visita: ProyectoPasoVisita) => {\r\n    this.setState((state: HojaTrabajoAppState) => {\r\n      let hoja_trabajo = Object.assign({}, state.hoja_trabajo)\r\n      hoja_trabajo.visitas = _.map(hoja_trabajo.visitas, (item) => {\r\n        if (item.index + '' == visita.index + '') {\r\n          return visita\r\n        } else {\r\n          return item\r\n        }\r\n      })\r\n      return { hoja_trabajo }\r\n    })\r\n  }\r\n\r\n  onChangeApp = (data: any) => {\r\n    this.setState((state: HojaTrabajoAppState) => {\r\n      let hoja_trabajo = Object.assign({}, state.hoja_trabajo, data)\r\n\r\n      return { hoja_trabajo }\r\n    })\r\n  }\r\n\r\n  getUrlFor(urlToAppend: string) {\r\n    return url_for(\r\n      `proyecto/${this.props.hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${this.props.hoja_trabajo.paso\r\n        .id}/${urlToAppend}`\r\n    )\r\n  }\r\n\r\n  isAllowedAsociarVisita() {\r\n    if (!user_has_role_permission('paso_asociar_visita')) {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  getAssocModal() {\r\n    if (!this.isAllowedAsociarVisita()) {\r\n      return null\r\n    }\r\n\r\n    if (!this.state.hoja_trabajo.proyecto.isOpen) {\r\n      return null\r\n    }\r\n\r\n    const { assocModalOpen, selectedVisitas, newVisitaOpen } = this.state\r\n\r\n    const icons = {\r\n      moveLeft: <i className='icon angle left' />,\r\n      moveAllLeft: <i className='icon angle double left' />,\r\n      moveRight: <i className='icon angle right' />,\r\n      moveAllRight: <i className='icon angle double right' />,\r\n      moveDown: <i className='icon angle down' />,\r\n      moveUp: <i className='icon angle up' />\r\n    }\r\n\r\n    const visitas = this.props.hoja_trabajo.visitas\r\n    let options: { value: number; label: string }[] = []\r\n\r\n    _.forEach(visitas, function(visita, id) {\r\n      options.push({\r\n        value: id,\r\n        label: visita.label\r\n      })\r\n    })\r\n\r\n    const onChange = (selectedVisitas: number[]) => {\r\n      this.setState({ selectedVisitas })\r\n    }\r\n\r\n    const onClose = () => {\r\n      this.setState({ assocModalOpen: false })\r\n    }\r\n\r\n    const onToggle = () => {\r\n      this.setState((state) => {\r\n        return { newVisitaOpen: !state.newVisitaOpen }\r\n      })\r\n    }\r\n\r\n    return (\r\n      <Modal open={assocModalOpen} closeIcon dimmer='inverted' size='small' onClose={onClose} className='modal-ab'>\r\n        <Modal.Header> Asociación de Visitas a este Paso</Modal.Header>\r\n        <Modal.Content>\r\n          <form method='post' className='ui form' action={this.getUrlFor('visita')}>\r\n            <div style={{ marginBottom: '15px' }}>Asocie las visitas a relacionar con este paso: </div> <br />\r\n            <DualListBox\r\n              name='visitas'\r\n              options={options}\r\n              availableLabel='Por asociar'\r\n              selectedLabel='Asociadas'\r\n              selected={selectedVisitas}\r\n              icons={icons}\r\n              onChange={onChange}\r\n            />\r\n            <Divider horizontal>O</Divider>\r\n            <Accordion>\r\n              <Accordion.Title active={newVisitaOpen} onClick={onToggle}>\r\n                <Icon name='caret right' /> Crear Nueva Visita\r\n              </Accordion.Title>\r\n              <Accordion.Content active={newVisitaOpen}>\r\n                <Form.Field inline>\r\n                  <label>Nombre de la visita</label>\r\n                  <div className='ui input'>\r\n                    {' '}\r\n                    <input placeholder='Nombre de la visita' name='visita_name' type='text' />{' '}\r\n                  </div>\r\n                </Form.Field>\r\n              </Accordion.Content>\r\n            </Accordion>\r\n            <button className='primary small ui button right floated'>Guardar</button>\r\n            <button className='negative small ui button right floated' type='button' onClick={onClose}>\r\n              Cancelar\r\n            </button>\r\n            <div className='clearfix' />\r\n          </form>\r\n        </Modal.Content>\r\n      </Modal>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const self = this\r\n\r\n    const { activeIndex } = this.state\r\n\r\n    const assocModal = this.getAssocModal()\r\n\r\n    this.panes = []\r\n\r\n    let visitas: ProyectoPasoVisita[] = _.values(self.state.hoja_trabajo.visitas)\r\n    visitas = _.sortBy(visitas, 'position')\r\n\r\n    _.forEach(visitas, function(visita, k) {\r\n      if (visita.id == null) {\r\n        return\r\n      }\r\n\r\n      visita.HojaTrabajo = self.state.hoja_trabajo\r\n\r\n      self.panes.push({\r\n        type: 'sheet',\r\n        menuItem: () => {\r\n          return (\r\n            <Menu.Item\r\n              key={visita.id}\r\n              index={visita.index}\r\n              className='tab-nav-item visita-tab'\r\n              name={visita.label}\r\n              onClick={self.handleClick}\r\n              active={activeIndex == visita.index}\r\n            >\r\n              <AppVisitaDefaultTab visita={visita} />\r\n            </Menu.Item>\r\n          )\r\n        },\r\n        pane: () => (\r\n          <TabPaneVisita\r\n            key={visita.id}\r\n            idx={visita.index}\r\n            active={activeIndex == visita.index}\r\n            visita={visita}\r\n            isEditable={self.state.hoja_trabajo.proyecto.isOpen}\r\n            onChange={self.onChangeVisita}\r\n            onChangeApp={self.onChangeApp}\r\n          />\r\n        )\r\n      })\r\n    })\r\n\r\n    if (self.panes.length == 0) {\r\n      return (\r\n        <div className='alert alert-block nocontent'>\r\n          <h3>Sin visitas</h3>\r\n          <p>\r\n            <span className='icon-warning-sign' />Este paso aun no tiene visitas asociadas.{' '}\r\n          </p>\r\n          {self.state.hoja_trabajo.proyecto.isOpen &&\r\n          this.isAllowedAsociarVisita() && [\r\n            <Button\r\n              key='button'\r\n              content='Asociar visitas'\r\n              color='green'\r\n              compact\r\n              icon='info circle'\r\n              onClick={this.showModal}\r\n              style={{ marginTop: '30px' }}\r\n            />,\r\n            <div key='modal'>{assocModal}</div>\r\n          ]}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (this.isAllowedAsociarVisita() && self.state.hoja_trabajo.proyecto.isOpen) {\r\n      self.panes.push({\r\n        type: 'action',\r\n        menuItem: () => {\r\n          return (\r\n            <Menu.Item\r\n              key='plus'\r\n              className='tab-nav-item tab-add'\r\n              title='Asociar/Desasociar visitas a este paso'\r\n              onClick={this.showModal}\r\n            >\r\n              <Icon name='plus' />\r\n            </Menu.Item>\r\n          )\r\n        }\r\n      })\r\n    }\r\n\r\n    return (\r\n      <HojaTrabajoContext.Provider value={{ hoja_trabajo: this.state.hoja_trabajo, update: this.onChangeApp }}>\r\n        <div id='visita-tabs' className={`paso-code-${this.state.hoja_trabajo.paso.code}  paso-default`}>\r\n          <Tab panes={this.panes} activeIndex={activeIndex} renderActiveOnly={false} />\r\n\r\n          {assocModal}\r\n        </div>\r\n      </HojaTrabajoContext.Provider>\r\n    )\r\n  }\r\n}\r\n","import { Component } from 'react'\r\n\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader'\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label'\r\nimport Table from 'semantic-ui-react/dist/commonjs/collections/Table'\r\nimport Dropdown from 'semantic-ui-react/dist/commonjs/modules/Dropdown'\r\nimport Dimmer from 'semantic-ui-react/dist/commonjs/modules/Dimmer'\r\nimport Select from 'semantic-ui-react/dist/commonjs/addons/Select'\r\n\r\nimport EditorPreview from '../global/EditorPreview'\r\nimport { AttachmentListPanel } from './Attachments'\r\n\r\nexport default class TableRowInstruccion extends Component<TableRowInstruccionProps, TableRowInstruccionState> {\r\n  constructor(props: TableRowInstruccionProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      instruccion: props.instruccion,\r\n      isEditorOpen: false,\r\n      isLoadingAttachments: false\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps: TableRowInstruccionProps, prevState: TableRowInstruccionState) {\r\n    if (nextProps.instruccion.updated_at != prevState.instruccion.updated_at) {\r\n      return { instruccion: nextProps.instruccion }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  // Static methods\r\n\r\n  evalIsDone = (instruccion: Instruccion) => {\r\n    if (instruccion.answer) {\r\n      return true\r\n    }\r\n\r\n    if (instruccion.observations) {\r\n      return true\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  checkIsDoneDisabled = (instruccion: Instruccion) => {\r\n    if (!user_has_role_permission('hoja_trabajo_edit')) {\r\n      return true\r\n    }\r\n    if (!this.props.isEditable) {\r\n      return true\r\n    }\r\n    if (instruccion.answer) {\r\n      return false\r\n    }\r\n\r\n    if (instruccion.observations) {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  onChecked = (event: React.SyntheticEvent) => {\r\n    const checked = (event.target as any).checked\r\n    this.setState(\r\n      (state: TableRowInstruccionState) => {\r\n        let instruccion = Object.assign({}, state.instruccion)\r\n        instruccion.is_done = checked\r\n\r\n        return { instruccion }\r\n      },\r\n      () => this.props.onUpdate(this.state.instruccion, this.props.index)\r\n    )\r\n  }\r\n\r\n  onActionChanged = (event: React.SyntheticEvent, data: any) => {\r\n    this.updateModel('answer', data.value)\r\n  }\r\n\r\n  onChangeEditor = (field: 'observations' | 'description') => (\r\n    editor: CKEDITOR.editor,\r\n    closeModal: boolean = false,\r\n    autosave: boolean = false,\r\n    cb: () => void\r\n  ) => {\r\n    if (field == 'description') {\r\n      $.blockUI(create_blockUI_loading_message('Guardando los cambios... Por Favor Espere'))\r\n      this.updateModel(field, editor.getData(), () => {\r\n        if ($.isFunction(cb)) {\r\n          cb()\r\n        }\r\n        $.unblockUI()\r\n      })\r\n    } else {\r\n      this.updateModel(field, editor.getData(), cb)\r\n    }\r\n    if (closeModal) {\r\n      this.setState({ isEditorOpen: false })\r\n    }\r\n  }\r\n\r\n  onRemove = () => {\r\n    bootbox.warningConfirm('¿Desea eliminar permanentemente esta instruccion ?', 'Cancelar', 'Aceptar', (r) => {\r\n      if (r) {\r\n        $.blockUI(create_blockUI_loading_message('Eliminando instrucción...'))\r\n        this.props.onRemove(this.props.index)\r\n\r\n        if (this.props.instruccion.id) {\r\n          const url = url_for(\r\n            `proyecto/${this.state.instruccion.Visita.HojaTrabajo.proyecto.id}/hoja-trabajo/instruccion/remove`\r\n          )\r\n          $.ajax(url, {\r\n            type: 'POST',\r\n            data: { id: { local_id: this.props.instruccion.local_id } },\r\n            dataType: 'json'\r\n          }).done((res) => {\r\n            if (res.response.record) {\r\n              this.props.onUpdateVisita([ res.response.record ])\r\n            }\r\n            $.unblockUI()\r\n          })\r\n        } else {\r\n          $.unblockUI()\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  onUpload = () => {\r\n    this.fetchAttachments()\r\n  }\r\n\r\n  onClickAttachmentCell = (ev: React.SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isEditorOpen: true })\r\n  }\r\n\r\n  onUpdateAttachment = () => {\r\n    this.fetchAttachments()\r\n  }\r\n\r\n  onDeleteAttachment = (adjunto: ProyectoAttachment, cb: () => void) => {\r\n    this.fetchAttachments()\r\n    this.setState(\r\n      (state) => {\r\n        let instruccion: Instruccion = Object.assign({}, state.instruccion)\r\n\r\n        // ------ Try to remove links to file\r\n        const h = public_path(`uploads/proyecto_adjunto/${adjunto.filepath}`, true)\r\n          .replace(/\\./g, '.')\r\n          .replace(/\\\\/g, '/')\r\n        const t = '<a .*href=\"' + h + '\"(.+?)/a>\\\\s*(<br\\\\s?/?>)?'\r\n        const re = new RegExp(t, 'g')\r\n        instruccion.observations = instruccion.observations.replace(re, '')\r\n\r\n        this.updateModel('observations', instruccion.observations)\r\n\r\n        return { instruccion }\r\n      },\r\n      () => {\r\n        if ($.isFunction(cb)) {\r\n          cb()\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  // Class methods\r\n\r\n  getFormattedIteration() {\r\n    return _.padLeft(String(this.props.iteration + 1), 3, '0')\r\n  }\r\n\r\n  getFormattedDescription() {\r\n    let instruccion = this.state.instruccion.description\r\n    if (instruccion == null) {\r\n      return ''\r\n    }\r\n\r\n    instruccion = instruccion.replace(/(?!^)\\([a-z]\\)/gs, '<br/>&nbsp;&nbsp;$& ')\r\n\r\n    return (\r\n      '<span key=\"instruction-iteration\" class=\"instruction-iteration\">' +\r\n      this.getFormattedIteration() +\r\n      '.</span> ' +\r\n      instruccion\r\n    )\r\n  }\r\n\r\n  getFormattedObservations() {\r\n    let observaciones = this.state.instruccion.observations\r\n\r\n    if (!observaciones) {\r\n      return ''\r\n    }\r\n\r\n    observaciones = observaciones.trim()\r\n\r\n    var cleanHtml = observaciones.replace(/<img.*?>/gs, ' [** IMAGEN ó TABLA **] ')\r\n\r\n    cleanHtml = cleanHtml.replace(/<table.*?\\/table>/gs, '[** TABLA **]')\r\n    cleanHtml = cleanHtml.replace(/<figure.*?\\/figure>/gs, '[** IMAGEN **]')\r\n    cleanHtml = cleanHtml.replace(/<\\/p>/g, '<br>')\r\n    cleanHtml = cleanHtml.replace(/<\\/h\\d>/g, '<br>')\r\n    cleanHtml = cleanHtml.replace(/&nbsp;/g, '')\r\n\r\n    cleanHtml = cleanHtml.replace(/<(?!(br)\\s*\\/?)[^>]+>/gs, '')\r\n    cleanHtml = cleanHtml.replace(/<br>\\s*<br>/gs, '<br>')\r\n\r\n    cleanHtml = cleanHtml.replace(/\\[\\*\\*(.+?)\\*\\*\\]/gs, '<span class=\"special-tag\">$&</span>')\r\n\r\n    return cleanHtml\r\n  }\r\n\r\n  doUpdateModel(\r\n    field: TableRowInstruccionUpdatableField,\r\n    value: any,\r\n    cb?: (modified_data: TableRowInstruccionServerDataParamData[]) => void\r\n  ) {\r\n    let modified_data: TableRowInstruccionServerDataParamData[] = []\r\n    this.setState(\r\n      (state) => {\r\n        let instruccion: Instruccion = Object.assign({}, state.instruccion)\r\n        if (_.str.trim(value) == '') {\r\n          value = null\r\n        }\r\n        if (field == 'is_done') {\r\n          instruccion[field] = !!value\r\n        } else {\r\n          instruccion[field] = value\r\n        }\r\n\r\n        modified_data.push({ field, value })\r\n\r\n        if (field != 'description') {\r\n          instruccion.is_done = this.evalIsDone(instruccion)\r\n          modified_data.push({ field: 'is_done', value: instruccion.is_done ? 1 : 0 })\r\n        }\r\n\r\n        if (\r\n          field == 'observations' &&\r\n          instruccion.observations != null &&\r\n          instruccion.observations != '' &&\r\n          !instruccion.answer\r\n        ) {\r\n          instruccion.answer = 'Hecho'\r\n          modified_data.push({ field: 'answer', value: 'Hecho' })\r\n        }\r\n\r\n        return { instruccion }\r\n      },\r\n      () => {\r\n        this.props.onUpdate(this.state.instruccion, this.props.index)\r\n        if ($.isFunction(cb)) {\r\n          cb(modified_data)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  updateModel(field: TableRowInstruccionUpdatableField, value: any, cb?: () => void) {\r\n    this.doUpdateModel(field, value, (modified_data: TableRowInstruccionServerDataParamData[]) => {\r\n      this.sendInstructionToServer(modified_data, () => {\r\n        this.fetchAttachments(false)\r\n        if ($.isFunction(cb)) {\r\n          cb()\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  sendInstructionToServer(data: TableRowInstruccionServerDataParamData[], cb: () => void = null) {\r\n    const params_data: TableRowInstruccionServerDataParams = {\r\n      id: { local_id: this.state.instruccion.local_id },\r\n      id_paso: this.state.instruccion.Visita.HojaTrabajo.paso.id,\r\n      id_visita: this.state.instruccion.Visita.id_visita,\r\n      data\r\n    }\r\n    const url = url_for(`proyecto/${this.state.instruccion.Visita.HojaTrabajo.proyecto.id}/hoja-trabajo/instruccion`)\r\n    if (!this.state.instruccion.id) {\r\n      $.blockUI(create_blockUI_loading_message('Creando instrucción...'))\r\n    }\r\n    $.ajax(url, { type: 'POST', data: params_data, dataType: 'json' }).done((res) => {\r\n      if (res.response.new) {\r\n        this.setState({ instruccion: Object.assign({}, this.state.instruccion, res.response.record) })\r\n        $.unblockUI()\r\n      }\r\n\r\n      this.props.onUpdateVisita(res.response.visitas, res.response.changed)\r\n      if ($.isFunction(cb)) {\r\n        cb()\r\n      }\r\n    })\r\n  }\r\n\r\n  fetchAttachments(showLoading: boolean = true) {\r\n    if (showLoading) {\r\n      this.setState({ isLoadingAttachments: true })\r\n    }\r\n\r\n    const url = url_for(\r\n      `proyecto/${this.state.instruccion.Visita.HojaTrabajo.proyecto.id}/hoja-trabajo/instruccion/attachments`\r\n    )\r\n    $.ajax(url, { type: 'GET', data: { local_id: this.state.instruccion.local_id }, dataType: 'json' }).done((res) => {\r\n      this.doUpdateModel('Attachments', res.response.Attachments)\r\n      this.setState({ isLoadingAttachments: false })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { instruccion } = this.state\r\n\r\n    let actionChoices: any[] = [ 'Hecho', 'Sí', 'No', 'Cumple', 'No Cumple', 'Aplica', 'No Aplica' ]\r\n    actionChoices = actionChoices.map((_item) => ({ key: _item, value: _item, text: _item }))\r\n\r\n    const formattedDescription = this.getFormattedDescription()\r\n    const ckeditorOptionsInstr = {\r\n      uploadUrl: url_for(\r\n        'proyecto/' +\r\n          instruccion.Visita.HojaTrabajo.proyecto.id +\r\n          '/master_data/paso/' +\r\n          instruccion.Visita.HojaTrabajo.paso.id +\r\n          '/upload?id_visita=' +\r\n          instruccion.Visita.id_visita +\r\n          '&model=instruccion_item__instr&model_id=' +\r\n          instruccion.local_id\r\n      ),\r\n      imageUploadUrl: url_for(\r\n        'proyecto/' +\r\n          instruccion.Visita.HojaTrabajo.proyecto.id +\r\n          '/master_data/paso/' +\r\n          instruccion.Visita.HojaTrabajo.paso.id +\r\n          '/upload?id_visita=' +\r\n          instruccion.Visita.id_visita +\r\n          '&model=instruccion_item__instr&model_id=' +\r\n          instruccion.local_id\r\n      ),\r\n      filebrowserUploadUrl: url_for(\r\n        'proyecto/' +\r\n          instruccion.Visita.HojaTrabajo.proyecto.id +\r\n          '/master_data/paso/' +\r\n          instruccion.Visita.HojaTrabajo.paso.id +\r\n          '/upload?id_visita=' +\r\n          instruccion.Visita.id_visita +\r\n          '&n=attachment&model=instruccion_item__instr&model_id=' +\r\n          instruccion.local_id\r\n      ),\r\n      link_to_muestreo_enabled: true\r\n    }\r\n\r\n    const ckeditorOptionsObs = {\r\n      uploadUrl: url_for(\r\n        'proyecto/' +\r\n          instruccion.Visita.HojaTrabajo.proyecto.id +\r\n          '/master_data/paso/' +\r\n          instruccion.Visita.HojaTrabajo.paso.id +\r\n          '/upload?id_visita=' +\r\n          instruccion.Visita.id_visita +\r\n          '&model=instruccion_item__obs&model_id=' +\r\n          instruccion.local_id\r\n      ),\r\n      imageUploadUrl: url_for(\r\n        'proyecto/' +\r\n          instruccion.Visita.HojaTrabajo.proyecto.id +\r\n          '/master_data/paso/' +\r\n          instruccion.Visita.HojaTrabajo.paso.id +\r\n          '/upload?id_visita=' +\r\n          instruccion.Visita.id_visita +\r\n          '&model=instruccion_item__obs&model_id=' +\r\n          instruccion.local_id\r\n      ),\r\n      filebrowserUploadUrl: url_for(\r\n        'proyecto/' +\r\n          instruccion.Visita.HojaTrabajo.proyecto.id +\r\n          '/master_data/paso/' +\r\n          instruccion.Visita.HojaTrabajo.paso.id +\r\n          '/upload?id_visita=' +\r\n          instruccion.Visita.id_visita +\r\n          '&n=attachment&model=instruccion_item__obs&model_id=' +\r\n          instruccion.local_id\r\n      ),\r\n      link_to_muestreo_enabled: true\r\n    }\r\n\r\n    const attachmentsList = (\r\n      <div style={{ position: 'relative' }}>\r\n        <Dimmer inverted active={this.state.isLoadingAttachments}>\r\n          <Loader inverted />\r\n        </Dimmer>\r\n        <AttachmentListPanel\r\n          attachments={instruccion.Attachments}\r\n          onUpdateItem={this.onUpdateAttachment}\r\n          onDeleteItem={this.onDeleteAttachment}\r\n        />\r\n      </div>\r\n    )\r\n\r\n    let modalLeftActions = null\r\n    if (this.props.isEditable && user_has_role_permission('instruccion_delete')) {\r\n      modalLeftActions = (\r\n        <Button\r\n          negative\r\n          floated='left'\r\n          icon='trash alternate outline'\r\n          content='Eliminar instrucción'\r\n          onClick={this.onRemove}\r\n        />\r\n      )\r\n    }\r\n\r\n    return (\r\n      <Table.Row\r\n        className={`hoverable-actions instruccion-row ${this.props.iteration % 2 ? 'even' : 'odd'}`}\r\n        id={`table-instruccion-${instruccion.local_id}`}\r\n      >\r\n        <Table.Cell className='td-chk' collapsing>\r\n          <label className='container-checkbox'>\r\n            <input\r\n              id={`checkbox-${instruccion.id}`}\r\n              type='checkbox'\r\n              checked={instruccion.is_done}\r\n              disabled={this.checkIsDoneDisabled(instruccion)}\r\n              value='1'\r\n              onChange={this.onChecked}\r\n            />\r\n            <span className='checkmark' />\r\n          </label>\r\n          {this.props.isEditable &&\r\n          this.props.isSortable &&\r\n          user_has_role_permission('hoja_trabajo_edit') && (\r\n            <div className='action-list'>\r\n              <div className='drag-icon sort-handler' />\r\n            </div>\r\n          )}\r\n        </Table.Cell>\r\n        <Table.Cell width='6' className='instruction-text'>\r\n          <EditorPreview\r\n            className='instruction-text-editor'\r\n            ckeditorOptions={ckeditorOptionsInstr}\r\n            preview={formattedDescription}\r\n            data={instruccion.description}\r\n            required\r\n            label=' '\r\n            labelTitle='Descripción de la instrucción'\r\n            open={!instruccion.id && !instruccion.description}\r\n            editable={this.props.isEditable && user_has_role_permission('instruccion_edit')}\r\n            leftActions={modalLeftActions}\r\n            autosave\r\n            onSave={this.onChangeEditor('description')}\r\n          />\r\n        </Table.Cell>\r\n        <Table.Cell style={{ width: 'auto' }}>\r\n          {this.props.isEditable && user_has_role_permission('hoja_trabajo_edit') ? (\r\n            <Select\r\n              placeholder='Seleccione...'\r\n              className='instruccion-action'\r\n              value={instruccion.answer}\r\n              clearable\r\n              onChange={this.onActionChanged}\r\n              options={actionChoices}\r\n            />\r\n          ) : (\r\n            <span>{instruccion.answer}</span>\r\n          )}\r\n        </Table.Cell>\r\n        <Table.Cell width='7' className='observations-text'>\r\n          <EditorPreview\r\n            className='observations-text-editor'\r\n            ckeditorOptions={ckeditorOptionsObs}\r\n            preview={this.getFormattedObservations()}\r\n            data={instruccion.observations}\r\n            label={formattedDescription}\r\n            open={this.state.isEditorOpen}\r\n            editable={this.props.isEditable && user_has_role_permission('hoja_trabajo_edit')}\r\n            autosave\r\n            onSave={this.onChangeEditor('observations')}\r\n            onClose={() => this.setState({ isEditorOpen: false })}\r\n            onUpload={this.onUpload}\r\n            onClickPreview={this.onClickAttachmentCell}\r\n            footer={attachmentsList}\r\n          />\r\n        </Table.Cell>\r\n        <Table.Cell className='attachments'>\r\n          <div>\r\n            <a href='#' className='btn-attach' onClick={this.onClickAttachmentCell}>\r\n              <Label circular floating color='green' size='mini'>\r\n                {_.size(instruccion.Attachments)}\r\n              </Label>\r\n              <Icon name='copy outline' className='attachments-icon' />\r\n            </a>\r\n          </div>\r\n        </Table.Cell>\r\n        <Table.Cell textAlign='right' collapsing className='computer'>\r\n          {this.props.isEditable &&\r\n          user_has_role_permission('instruccion_delete') && (\r\n            <Dropdown\r\n              className='action'\r\n              inline\r\n              direction='left'\r\n              icon={false}\r\n              trigger={<Icon name='ellipsis vertical' color='grey' />}\r\n            >\r\n              <Dropdown.Menu>\r\n                <Dropdown.Item icon='trash alternate outline' content='Eliminar instrucción' onClick={this.onRemove} />\r\n              </Dropdown.Menu>\r\n            </Dropdown>\r\n          )}\r\n        </Table.Cell>\r\n      </Table.Row>\r\n    )\r\n  }\r\n}\r\n","import Button from 'semantic-ui-react/dist/commonjs/elements/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport cx from 'classnames'\r\n\r\nconst ButtonEdit = (props: any) => {\r\n  let { children, ...buttonProps } = props\r\n  buttonProps.className = cx(buttonProps.className, 'action')\r\n  buttonProps = { icon: true, basic: true, compact: true, size: 'mini', title: 'Editar', ...buttonProps }\r\n\r\n  if (typeof children == 'undefined') {\r\n    children = <Icon name='pencil square' color='green' size='large' />\r\n  }\r\n\r\n  return (\r\n    <Button {...buttonProps} type='button'>\r\n      {children}\r\n    </Button>\r\n  )\r\n}\r\n\r\nexport default ButtonEdit\r\n","import { Component } from 'react'\r\n\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\n\r\nclass TabPaneVisitaBase<P extends TabPaneVisitaProps, S extends TabPaneVisitaState> extends Component<P, S> {\r\n  static defaultProps = {\r\n    type: 'DEFAULT'\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps: TabPaneVisitaProps, prevState: TabPaneVisitaState) {\r\n    if (nextProps.visita.id_status != prevState.id_status) {\r\n      return { id_status: '' + nextProps.visita.id_status }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  onClickCompletado = () => {\r\n    const url = url_for(\r\n      `proyecto/${this.props.visita.HojaTrabajo.proyecto.id}/hoja-trabajo/paso/${this.props.visita.HojaTrabajo.paso\r\n        .id}/visita/${this.props.visita.id_visita}/save`\r\n    )\r\n    let loadingMessage =\r\n      this.props.type == 'PERIODO' ? 'Marcando periodo como Completado...' : 'Marcando visita como Completada...'\r\n    $.blockUI(create_blockUI_loading_message(loadingMessage))\r\n    $.ajax(url, { type: 'POST', data: { op: 'c' }, dataType: 'json' }).done((res) => {\r\n      if (res.hasErrors) {\r\n        $.unblockUI()\r\n        bootbox.alert(res.message)\r\n      } else {\r\n        this.updateVisita(res.response.record)\r\n        $.unblockUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  onClickRevisado = () => {\r\n    const url = url_for(\r\n      `proyecto/${this.props.visita.HojaTrabajo.proyecto.id}/hoja-trabajo/paso/${this.props.visita.HojaTrabajo.paso\r\n        .id}/visita/${this.props.visita.id_visita}/save`\r\n    )\r\n    let loadingMessage =\r\n      this.props.type == 'PERIODO' ? 'Marcando periodo como Revisado...' : 'Marcando visita como Revisada...'\r\n    $.blockUI(create_blockUI_loading_message(loadingMessage))\r\n    $.ajax(url, { type: 'POST', data: { op: 'r' }, dataType: 'json' }).done((res) => {\r\n      if (res.hasErrors) {\r\n        $.unblockUI()\r\n        bootbox.alert(res.message)\r\n      } else {\r\n        this.updateVisita(res.response.record)\r\n        $.unblockUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  updateVisita(_visita: any) {\r\n    let visita: ProyectoPasoVisita = Object.assign(this.props.visita, _visita)\r\n    this.props.onChange(visita)\r\n    this.setState({ id_status: '' + visita.id_status })\r\n  }\r\n\r\n  onUpdate = (visitas: ProyectoPasoVisita[], instrucciones?: InstruccionDataModifiedSchema[]) => {\r\n    if (!$.isArray(visitas)) {\r\n      visitas = [ visitas ]\r\n    }\r\n    this.updateVisita(visitas[0])\r\n\r\n    // Actualizar el estado de las demas visitas afectadas\r\n    visitas = _.rest(visitas)\r\n    if (_.size(visitas)) {\r\n      _.forEach(visitas, (visita: ProyectoPasoVisita) => {\r\n        let _visita = _.find(this.props.visita.HojaTrabajo.visitas, { id_visita: visita.id_visita })\r\n        _visita = Object.assign(_visita, visita)\r\n      })\r\n    }\r\n\r\n    // Actualizar la informacion de las instrucciones afectadas\r\n\r\n    if (instrucciones) {\r\n      _.forEach(instrucciones, (instruccion_mdata: InstruccionDataModifiedSchema) => {\r\n        let visita = _.find(this.props.visita.HojaTrabajo.visitas, { id_visita: instruccion_mdata.id_visita })\r\n\r\n        switch (instruccion_mdata.cmd) {\r\n          case 'CREATE':\r\n            visita.instructions.push(instruccion_mdata.data)\r\n            break\r\n          case 'UPDATE':\r\n            visita.instructions = _.map(visita.instructions, function(instruccion) {\r\n              if (instruccion.local_id == instruccion_mdata.data.local_id) {\r\n                return Object.assign(instruccion, instruccion_mdata.data)\r\n              } else {\r\n                return instruccion\r\n              }\r\n            })\r\n            break\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  getCompletadoDisabledText(): string | null {\r\n    return null\r\n  }\r\n\r\n  getRevisadoDisabledText(): string | null {\r\n    let modelLabel = this.props.type == 'PERIODO' ? 'Este periodo' : 'Esta visita'\r\n    if (_.includes([ '1', '2', '3' ], this.state.id_status) || this.getCompletadoDisabledText()) {\r\n      return (\r\n        modelLabel + ' debe estar primero en estado COMPLETADO, para poder marcar esta hoja de trabajo como REVISADA.'\r\n      )\r\n    } else if (_.includes([ '6' ], this.state.id_status)) {\r\n      return (\r\n        modelLabel +\r\n        ' tiene Notas de Revisión que deben primero ser atendidas para poder marcar esta hoja de trabajo como REVISADA.'\r\n      )\r\n    } else if (this.props.visita.additionals.revisiones > 0) {\r\n      return (\r\n        modelLabel +\r\n        ' tiene Notas de Revisión pendientes por revisar que deben primero ser revisadas para poder marcar esta hoja de trabajo como REVISADA.'\r\n      )\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  renderStatusActions() {\r\n    if (!this.props.isEditable) {\r\n      return null\r\n    }\r\n\r\n    const revisado_disabled_text = this.getRevisadoDisabledText()\r\n\r\n    let icon_revisado_alert\r\n    const visita = this.props.visita\r\n    if (\r\n      visita.fecha_completado &&\r\n      visita.fecha_revision &&\r\n      Date.create(visita.fecha_completado) > Date.create(visita.fecha_revision)\r\n    ) {\r\n      let modelLabel = this.props.type == 'PERIODO' ? 'Este periodo' : 'Esta visita'\r\n      icon_revisado_alert = (\r\n        <Popup\r\n          trigger={<Icon color='red' name='warning circle' />}\r\n          content={modelLabel + ' ha recibido modificaciones después de su última revisión.'}\r\n        />\r\n      )\r\n    }\r\n\r\n    const completado_disabled_text = this.getCompletadoDisabledText()\r\n\r\n    return (\r\n      <div className='actions ab-status-actions'>\r\n        {user_has_role_permission('paso_completado') && (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <Button\r\n                  primary\r\n                  icon\r\n                  compact\r\n                  onClick={this.onClickCompletado}\r\n                  disabled={completado_disabled_text != null}\r\n                >\r\n                  {' '}\r\n                  <Icon name='check' /> Completado\r\n                </Button>\r\n              </div>\r\n            }\r\n            content={completado_disabled_text}\r\n            header='Marcar como Completado | Opción deshabilitada'\r\n            disabled={completado_disabled_text == null}\r\n            className='disable-text'\r\n            on='hover'\r\n          />\r\n        )}\r\n        {user_has_role_permission([ 'paso_revisado' ]) && (\r\n          <Popup\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <Button\r\n                  color='olive'\r\n                  icon\r\n                  compact\r\n                  onClick={this.onClickRevisado}\r\n                  disabled={revisado_disabled_text != null}\r\n                >\r\n                  {' '}\r\n                  <Icon name='check' fitted />\r\n                  <Icon name='check' /> Revisado {icon_revisado_alert}\r\n                </Button>\r\n              </div>\r\n            }\r\n            content={revisado_disabled_text}\r\n            header='Marcar como Revisado | Opción deshabilitada'\r\n            disabled={revisado_disabled_text == null}\r\n            className='disable-text'\r\n            on='hover'\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default TabPaneVisitaBase\r\n","import { Component, Fragment } from 'react'\r\n\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label/Label'\r\nimport Menu from 'semantic-ui-react/dist/commonjs/collections/Menu/Menu'\r\nimport Image from 'semantic-ui-react/dist/commonjs/elements/Image/Image'\r\nimport { MenuItemProps } from 'semantic-ui-react/dist/commonjs/collections/Menu/MenuItem'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\n\r\nimport { HojaTrabajoHistoryModal, HojaTrabajoAsignarVisitaModal } from './TabPaneVisitaModals'\r\nimport HojaTrabajoContext from './HojaTrabajoContext'\r\nimport { HojaTrabajoUpdateUtils } from './utils'\r\nimport { MenuItemAjuste } from './sidebar/menuitem_ajuste'\r\nimport { MenuItemHallazgo } from './sidebar/menuitem_hallazgo'\r\nimport { MenuItemRevision } from './sidebar/menuitem_revision'\r\n\r\nimport { HallazgoHojaTrabajoModelManager, RevisionHojaTrabajoModelManager } from './sidebar/menuitem__model_manager'\r\n\r\nimport cx from 'classnames'\r\n\r\ntype MenuSidebarVisitaProps = {\r\n  visita: ProyectoPasoVisita\r\n  actionItems?: { [s: string]: boolean | MenuItemProps }\r\n}\r\n\r\ntype MenuSidebarVisitaState = {\r\n  panelOpen: string\r\n  openAsignarUsuarioModal: boolean\r\n}\r\n\r\nexport default class MenuSidebarVisita extends Component<MenuSidebarVisitaProps, MenuSidebarVisitaState> {\r\n  static contextType = HojaTrabajoContext\r\n  static defaultProps = {\r\n    actionItems: {}\r\n  }\r\n\r\n  context: HojaTrabajoContextType\r\n\r\n  state: MenuSidebarVisitaState = {\r\n    panelOpen: null,\r\n    openAsignarUsuarioModal: false\r\n  }\r\n\r\n  isActionItemEnabled(action: string) {\r\n    return typeof this.props.actionItems[`_${action}`] === 'undefined' || this.props.actionItems[`_${action}`]\r\n  }\r\n\r\n  onItemOpen = (item: string) => {\r\n    this.setState({ panelOpen: item })\r\n  }\r\n\r\n  closeAllPanel = () => {\r\n    this.setState({ panelOpen: null })\r\n  }\r\n\r\n  renderAsignUserModal() {\r\n    if (this.state.openAsignarUsuarioModal) {\r\n      const { hoja_trabajo, update } = this.context\r\n      const onSaveAsignarVisita = (id_asignado: string) => {\r\n        const url = url_for(\r\n          `proyecto/${hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${hoja_trabajo.paso.id}/visita/${this.props.visita\r\n            .id_visita}/save`\r\n        )\r\n        $.blockUI(create_blockUI_loading_message('Guardando asignado...'))\r\n\r\n        $.ajax(url, { type: 'POST', data: { op: 'a', paso_id_usuario: id_asignado }, dataType: 'json' }).done((res) => {\r\n          let hoja_trabajo_copy = HojaTrabajoUpdateUtils.updateVisita(\r\n            hoja_trabajo,\r\n            this.props.visita,\r\n            res.response.record\r\n          )\r\n          update(hoja_trabajo_copy)\r\n          $.unblockUI()\r\n        })\r\n\r\n        this.setState({ openAsignarUsuarioModal: false })\r\n      }\r\n\r\n      return (\r\n        <HojaTrabajoAsignarVisitaModal\r\n          visita={this.props.visita}\r\n          onSave={onSaveAsignarVisita}\r\n          onClose={() => this.setState({ openAsignarUsuarioModal: false })}\r\n        />\r\n      )\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const id_proyecto = this.props.visita.HojaTrabajo.proyecto.id\r\n    const id_paso = this.props.visita.HojaTrabajo.paso.id\r\n    const id_visita = this.props.visita.id_visita\r\n    const has_parent = this.props.visita.HojaTrabajo.proyecto.id_parent != null\r\n\r\n    const url_base = `proyecto/${id_proyecto}/paso/${id_paso}/visita/${id_visita}/`\r\n\r\n    const counters = this.props.visita.additionals\r\n\r\n    const image_path = public_path('images/sidebar_right/')\r\n\r\n    return (\r\n      <Fragment>\r\n        <div\r\n          className={cx('sidebar-fixed-overlay ui page dimmer inverted', { active: this.state.panelOpen != null })}\r\n          onClick={() => this.closeAllPanel()}\r\n        />\r\n        <Menu fixed='right' vertical compact icon className='visita-sidebar right-sidebar' id='app-right-sidebar'>\r\n          <Menu.Menu>\r\n            {_.map(this.props.actionItems, (actionItem: MenuItemProps, key: string) => {\r\n              if (key.substr(0, 1) == '_' || actionItem === null) {\r\n                return null\r\n              }\r\n\r\n              const _onClick = actionItem.onClick\r\n              actionItem.onClick = (ev: any, data: any) => {\r\n                this.closeAllPanel()\r\n                _onClick(ev, data)\r\n              }\r\n              return <Menu.Item key={key} {...actionItem} />\r\n            })}\r\n\r\n            {this.props.visita.HojaTrabajo.proyecto.isOpen &&\r\n            user_has_role_permission('paso_asignar_usuario') &&\r\n            this.isActionItemEnabled('assign_user') && (\r\n              <Menu.Item\r\n                link\r\n                title='Asignar usuario a esta visita'\r\n                onClick={(ev) => {\r\n                  this.closeAllPanel()\r\n                  this.setState({ openAsignarUsuarioModal: true })\r\n                }}\r\n              >\r\n                <Icon.Group size='large'>\r\n                  <Icon name='user outline' />\r\n                  <Icon corner name='plus' />\r\n                </Icon.Group>\r\n              </Menu.Item>\r\n            )}\r\n            {this.renderAsignUserModal()}\r\n\r\n            {has_parent &&\r\n            this.isActionItemEnabled('history') && (\r\n              <HojaTrabajoHistoryModal\r\n                trigger={\r\n                  <Menu.Item\r\n                    title='Hoja Trabajo Año Anterior '\r\n                    icon={{ name: 'history', size: 'large' }}\r\n                    onClick={this.closeAllPanel}\r\n                  />\r\n                }\r\n                url={url_for(url_base + 'prev')}\r\n              />\r\n            )}\r\n          </Menu.Menu>\r\n\r\n          <Menu.Menu>\r\n            {this.isActionItemEnabled('ajustes') && (\r\n              <MenuItemAjuste\r\n                counter={counters.ajustes}\r\n                moduleParams={{ id_paso, id_visita, model: 'ajuste' }}\r\n                open={this.state.panelOpen == 'ajuste'}\r\n                onOpen={this.onItemOpen}\r\n                modelManager={null}\r\n              />\r\n            )}\r\n            {this.isActionItemEnabled('hallazgo') && (\r\n              <MenuItemHallazgo\r\n                modelManager={HallazgoHojaTrabajoModelManager.getInstance()}\r\n                counter={counters.hallazgos}\r\n                moduleParams={{ id_paso, id_visita, model: 'hallazgo' }}\r\n                open={this.state.panelOpen == 'hallazgo'}\r\n                onOpen={this.onItemOpen}\r\n              />\r\n            )}\r\n            {this.isActionItemEnabled('muestreo') && (\r\n              <Menu.Item\r\n                as='a'\r\n                className='badged'\r\n                href={url_for(url_base + 'muestreo')}\r\n                title='Muestreo'\r\n                onClick={this.closeAllPanel}\r\n              >\r\n                <Image src={image_path + 'muestreo.svg'} size='large' /> {' '}\r\n                <Label\r\n                  size='mini'\r\n                  className='right'\r\n                  floating\r\n                  circular\r\n                  content={counters.muestreos}\r\n                  color={counters.muestreos == 0 ? 'green' : 'red'}\r\n                />\r\n              </Menu.Item>\r\n            )}\r\n            {this.isActionItemEnabled('revision') && (\r\n              <MenuItemRevision\r\n                counter={counters.revisiones}\r\n                moduleParams={{ id_paso, id_visita, model: 'revision' }}\r\n                modelManager={RevisionHojaTrabajoModelManager.getInstance(this.context)}\r\n                open={this.state.panelOpen == 'revision'}\r\n                onOpen={this.onItemOpen}\r\n              />\r\n            )}\r\n          </Menu.Menu>\r\n          {this.isActionItemEnabled('pdf') && (\r\n            <Menu.Menu>\r\n              <Menu.Item\r\n                as='a'\r\n                href={url_for(url_base + 'pdf.pdf')}\r\n                target='_blank'\r\n                title='Exportar como PDF'\r\n                content={<Image src={image_path + 'exportar_pdf.svg'} size='large' />}\r\n              />\r\n            </Menu.Menu>\r\n          )}\r\n        </Menu>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n","import { Component } from 'react'\r\nimport CKeditor from 'ckeditor4-react'\r\n\r\nimport Button from 'semantic-ui-react/dist/commonjs/elements/Button/Button'\r\nimport Loader from 'semantic-ui-react/dist/commonjs/elements/Loader'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal'\r\nimport Dropdown from 'semantic-ui-react/dist/commonjs/modules/Dropdown'\r\n\r\nexport class HojaTrabajoHistoryModal extends Component<{ trigger: any; url: string }> {\r\n  state = {\r\n    content: ''\r\n  }\r\n\r\n  onOpen = () => {\r\n    if (this.state.content == '') {\r\n      const ckeditorOptions = {\r\n        height: 350,\r\n        removePlugins: 'elementspath, uploadfile',\r\n        toolbar: [ {} ]\r\n      }\r\n\r\n      this.setState({ content: <Loader active /> })\r\n      $.ajax(this.props.url, { dataType: 'json' }).done((res) => {\r\n        if (res.hasErrors) {\r\n          this.setState({\r\n            content: (\r\n              <div style={{ color: 'red', textAlign: 'center', fontSize: '18px', fontWeight: 'bold', marginTop: 25 }}>\r\n                Hoja de Trabajo NO disponible\r\n              </div>\r\n            )\r\n          })\r\n        } else {\r\n          let content = `&nbsp;<div class='watermark-text' style='color:#08828a33; font-size:70px; font-weight: bold; transform:rotate(340deg); -webkit-transform:rotate(340deg); left: 35%; position: absolute; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;  '>Hoja Trabajo<br>Año Anterior</div>\r\n          <div class='watermarked-content' style='position:absolute; z-index:1;  margin-right: 20px; '>${res.response\r\n            .content}</div>&nbsp;`\r\n          this.setState({ content: <CKeditor data={content} readOnly config={ckeditorOptions} /> })\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        closeIcon\r\n        trigger={this.props.trigger}\r\n        content={this.state.content}\r\n        header='Hoja de Trabajo - Año Anterior'\r\n        closeOnDimmerClick={false}\r\n        onOpen={this.onOpen}\r\n        size='fullscreen'\r\n        dimmer='inverted'\r\n        style={{ minHeight: 400 }}\r\n        className='modal-ab'\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\ninterface HojaTrabajoAsignarVisitaModalProps {\r\n  visita: ProyectoPasoVisita\r\n  onSave: (id_usuario_asignado: string) => void\r\n  onClose: () => void\r\n}\r\n\r\nexport class HojaTrabajoAsignarVisitaModal extends Component<\r\n  HojaTrabajoAsignarVisitaModalProps,\r\n  { id_asignado: string }\r\n> {\r\n  constructor(props: HojaTrabajoAsignarVisitaModalProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      id_asignado: props.visita.id_usuario_asignado\r\n    }\r\n  }\r\n\r\n  onChange = (ev: React.SyntheticEvent, data: any) => {\r\n    this.setState({ id_asignado: data.value })\r\n  }\r\n\r\n  onSave = () => {\r\n    this.props.onSave(this.state.id_asignado)\r\n    this.props.onClose()\r\n  }\r\n\r\n  onClose = () => {\r\n    this.props.onClose()\r\n  }\r\n\r\n  render() {\r\n    const { visita } = this.props\r\n\r\n    let equipo = _.filter(visita.HojaTrabajo.equipo, function(item) {\r\n      return item.rol.is_assignable\r\n    })\r\n\r\n    const equipoOptions: any = _.map(equipo, function(item) {\r\n      return {\r\n        key: item.user_id,\r\n        text: item.name,\r\n        value: item.user_id,\r\n        description: item.rol.name,\r\n        label: { content: item.sigla, circular: true, color: 'green' }\r\n      }\r\n    })\r\n\r\n    return (\r\n      <Modal\r\n        closeIcon\r\n        open\r\n        closeOnDimmerClick={false}\r\n        size='tiny'\r\n        dimmer='inverted'\r\n        className='modal-ab'\r\n        onClose={this.onClose}\r\n      >\r\n        <Modal.Header>Asignar/Reasignar visita a usuario</Modal.Header>\r\n        <Modal.Content>\r\n          <blockquote>\r\n            <strong>Visita: </strong> {visita.label}\r\n          </blockquote>\r\n          <Dropdown\r\n            placeholder='Seleccione el usuario'\r\n            defaultValue={visita.id_usuario_asignado}\r\n            selection\r\n            clearable\r\n            fluid\r\n            options={equipoOptions}\r\n            onChange={this.onChange}\r\n          />\r\n        </Modal.Content>\r\n        <Modal.Actions>\r\n          <Button primary content='Aceptar' onClick={this.onSave} />\r\n        </Modal.Actions>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent } from 'react'\r\n\r\nimport { BaseMenuElement } from './menuitem'\r\nimport { MenuItemNew } from './menuitem__new'\r\nimport { AjusteModal } from './ajuste_modal'\r\nimport { AjusteList } from './ajuste_list'\r\nimport MenuItemAjusteContext from './menuitem_ajuste_context'\r\nimport { getNombreCuenta } from '../utils_ajuste'\r\n\r\ntype MenuItemAjusteState = {\r\n  items: ProyectoAjusteGroup[]\r\n}\r\n\r\ndeclare var app: any\r\n\r\nexport class MenuItemAjuste extends PureComponent<DefaultMenuElementProps<ProyectoAjusteGroup>, MenuItemAjusteState> {\r\n  cuentas: ProyectoAjusteCuenta[] = null\r\n\r\n  state: MenuItemAjusteState = {\r\n    items: null\r\n  }\r\n\r\n  parseAjustes = (input: any[]): ProyectoAjusteGroup[] => {\r\n    const self = this\r\n    let ajustes = _.groupBy(input, 'idx')\r\n\r\n    return _.map(ajustes, function(_row, idx) {\r\n      const row = _.map(_row, function(item) {\r\n        return {\r\n          id: item.id,\r\n          cuenta: item.cuenta,\r\n          debe: item.col == 'DEBE' ? item.valor : '',\r\n          haber: item.col == 'HABER' ? item.valor : '',\r\n          nombre_cuenta: self.getNombreCuenta(item.cuenta)\r\n        }\r\n      })\r\n\r\n      return Object.assign(\r\n        {},\r\n        {\r\n          idx,\r\n          items: row,\r\n          status: _row[0].status,\r\n          descripcion: _row[0].description,\r\n          id_visita: _row[0].id_proyecto_visita\r\n        },\r\n        _.pick(_row[0], [ 'fecha_completado', 'aplicado', 'fecha_revision', 'UpdateLog', 'RevisionLog' ])\r\n      )\r\n    })\r\n  }\r\n\r\n  getNombreCuenta(cuenta: string) {\r\n    return getNombreCuenta(this.cuentas, cuenta)\r\n  }\r\n\r\n  onCreateItem = (data: any) => {\r\n    return new Promise<null>((resolve) => {\r\n      $.blockUI(create_blockUI_loading_message('Creando ajuste'))\r\n      const { id_visita, id_paso } = this.props.moduleParams\r\n      $.post(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste`), {\r\n        changes: data,\r\n        id_paso,\r\n        v: 2\r\n      }).done((res) => {\r\n        this.setState((prevState) => {\r\n          const items = [ ...prevState.items ]\r\n          items.push(this.parseAjustes(res.response.ajustes)[0])\r\n\r\n          return { items }\r\n        })\r\n\r\n        $.unblockUI()\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  onMountPanel = () => {\r\n    if (this.state.items === null) {\r\n      const { id_visita } = this.props.moduleParams\r\n      $.getJSON(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste`)).done((res) => {\r\n        this.cuentas = _.isEmpty(res.response.cuentas) ? [] : res.response.cuentas\r\n        app.vars.error_tolerable[id_visita] = res.response.error_tolerable\r\n\r\n        this.setState({\r\n          items: _.isEmpty(res.response.ajustes) ? [] : this.parseAjustes(res.response.ajustes)\r\n        })\r\n      })\r\n    }\r\n  }\r\n\r\n  onSaveItem = (item: ProyectoAjusteGroup, changes: any, blockingText?: string) => {\r\n    return new Promise<ProyectoAjusteGroup>((resolve) => {\r\n      const { id_visita, id_paso } = this.props.moduleParams\r\n      if (blockingText) {\r\n        setTimeout(() => $.blockUI(create_blockUI_loading_message(blockingText)), 1000 * 0.1)\r\n      }\r\n\r\n      $.post(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste`), {\r\n        idx: item.idx,\r\n        changes,\r\n        id_paso,\r\n        v: 2\r\n      }).done((res) => {\r\n        const ajustes = this.parseAjustes(res.response.ajustes)\r\n        this.setState((prevState) => {\r\n          const items = _.map(prevState.items, (item) => {\r\n            if (item.idx == ajustes[0].idx) {\r\n              return ajustes[0]\r\n            } else {\r\n              return item\r\n            }\r\n          })\r\n          return { items }\r\n        })\r\n\r\n        if (blockingText) {\r\n          $.unblockUI()\r\n        }\r\n\r\n        resolve(ajustes[0])\r\n      })\r\n    })\r\n  }\r\n\r\n  onClickDeleteItem = (item: ProyectoAjusteGroup) => {\r\n    bootbox.warningConfirm(\r\n      `¿Desea eliminar el <strong>Ajuste #${item.idx}</strong>,\r\n      el cual contiene un total de ${_.size(item.items)} registros contables?`,\r\n      'No',\r\n      'Sí, Eliminar',\r\n      (r) => {\r\n        if (!r) {\r\n          return\r\n        }\r\n\r\n        const { id_visita } = this.props.moduleParams\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando ajustes'))\r\n        $.ajax(url_for(`proyecto/${app.vars.idproyecto}/visita/${id_visita}/cifra-ajuste/${item.idx}`), {\r\n          type: 'delete'\r\n        }).done((res) => {\r\n          this.setState((prevState) => {\r\n            const items = _.reject(prevState.items, { idx: item.idx })\r\n\r\n            return { items }\r\n          })\r\n\r\n          $.unblockUI()\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  renderContent() {\r\n    const itemNew: ProyectoAjusteGroup = {\r\n      idx: null,\r\n      status: 'NUEVO',\r\n      descripcion: '',\r\n      id_visita: this.props.moduleParams.id_visita,\r\n      items: _.fill(new Array(2), { cuenta: '', debe: null, haber: null, nombre_cuenta: '' }, 0, 2)\r\n    }\r\n\r\n    return (\r\n      <div className='content'>\r\n        {_.size(this.cuentas) > 0 && (\r\n          <MenuItemNew\r\n            moduleParams={this.props.moduleParams}\r\n            buttonText='Crear Ajuste'\r\n            headerText='Nuevo Ajuste'\r\n            isEditable={user_has_role_permission('ajustes_edit')}\r\n            onSave={this.onCreateItem}\r\n            item={itemNew}\r\n            contentAs={AjusteModal}\r\n          />\r\n        )}\r\n        {_.isArray(this.cuentas) && _.size(this.cuentas) == 0 ? (\r\n          <div className='ui message error' style={{ marginTop: 40 }}>\r\n            <i className='icon warning sign' />\r\n            <strong>Advertencia: </strong> Al parecer aún no se han cargado sumarias a esta visita.\r\n          </div>\r\n        ) : (\r\n          <AjusteList\r\n            items={this.state.items}\r\n            moduleParams={this.props.moduleParams}\r\n            isEditable={es_proyecto_editable() && user_has_role_permission('ajustes_edit')}\r\n            onSaveItem={this.onSaveItem}\r\n            onClickDeleteItem={this.onClickDeleteItem}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BaseMenuElement\r\n        name='ajuste'\r\n        counter={this.state.items === null ? this.props.counter : _.size(this.state.items)}\r\n        icon='ajustes'\r\n        title='Ajustes'\r\n        open={this.props.open}\r\n        onToggle={this.props.onOpen}\r\n        onMountPanel={this.onMountPanel}\r\n      >\r\n        <MenuItemAjusteContext.Provider value={this.cuentas}>{this.renderContent()}</MenuItemAjusteContext.Provider>\r\n      </BaseMenuElement>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent } from 'react'\r\nimport { invoke } from 'lodash'\r\n\r\ntype SidebarPanelHeaderProps = {\r\n  title: string\r\n  onClose: (ev: SyntheticEvent) => void\r\n  onMount?: () => void\r\n}\r\n\r\nexport class SidebarPanelHeader extends PureComponent<SidebarPanelHeaderProps> {\r\n  componentDidMount() {\r\n    invoke(this.props, 'onMount')\r\n  }\r\n  render() {\r\n    return (\r\n      <header>\r\n        <a href='#' className='close-link' onClick={this.props.onClose}>\r\n          <i className='ui icon close green' />\r\n        </a>\r\n        <div className='title'>{this.props.title}</div>\r\n      </header>\r\n    )\r\n  }\r\n}\r\n","import ReactNumeric from 'react-numeric'\r\nimport AutoNumeric from 'autonumeric'\r\n\r\nconst defaultProps = {\r\n  decimalPlaces: 2,\r\n  decimalCharacter: ',',\r\n  decimalCharacterAlternative: '.',\r\n  digitGroupSeparator: '.',\r\n  allowDecimalPadding: false,\r\n  selectOnFocus: false\r\n}\r\n\r\nexport default function InputAutoNumeric(props: any) {\r\n  props = Object.assign({}, props, defaultProps)\r\n\r\n  if (typeof props.value != 'undefined' && _.size(props.value) > 0) {\r\n    props.value = +props.value\r\n  }\r\n\r\n  if (typeof props.isEditable == 'undefined' || props.isEditable) {\r\n    return <ReactNumeric {...props} />\r\n  } else {\r\n    return <span className='autonumeric non-editable value'>{AutoNumeric.format(props.value, props)}</span>\r\n  }\r\n}\r\n","import { SFC, ReactNode } from 'react'\r\n\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport Icon from 'semantic-ui-react/dist/commonjs/elements/Icon/Icon'\r\nimport { SemanticCOLORS } from 'semantic-ui-react/dist/commonjs/generic'\r\nimport getvalue from 'get-value'\r\n\r\ndeclare var app: any\r\n\r\ntype TooltipProps = {\r\n  title?: string\r\n  text: string | ReactNode\r\n  wide?: boolean | 'very'\r\n  iconColor?: SemanticCOLORS\r\n  iconSize?: 'mini' | 'tiny' | 'small' | 'large' | 'big' | 'huge' | 'massive'\r\n}\r\n\r\nexport const GenericTooltip: SFC<TooltipProps> = (props): JSX.Element => {\r\n  let content\r\n  if (typeof props.text == 'object') {\r\n    content = <div className='content'>{props.text}</div>\r\n  } else if (typeof props.text == 'string') {\r\n    if (props.text.substr(0, 1) == '@') {\r\n      content = getvalue(app.vars.texts, props.text.substr(1))\r\n    } else {\r\n      content = props.text\r\n    }\r\n\r\n    if (!content) {\r\n      return null\r\n    }\r\n\r\n    content = <div dangerouslySetInnerHTML={{ __html: content }} />\r\n  }\r\n\r\n  return (\r\n    <Popup\r\n      size='tiny'\r\n      wide={props.wide}\r\n      trigger={<Icon color={props.iconColor} size={props.iconSize} name='question circle' className='tooltip-icon' />}\r\n      header={props.title}\r\n      content={content}\r\n    />\r\n  )\r\n}\r\n\r\nGenericTooltip.defaultProps = {\r\n  iconColor: 'blue',\r\n  iconSize: 'small',\r\n  wide: false\r\n}\r\n","import { PureComponent, SyntheticEvent, Fragment } from 'react'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport { MenuElementListPanel, MenuElementListActions } from './menuitem'\r\nimport { AjusteModal } from './ajuste_modal'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\nimport { StatusDivBlock } from '../../global/StatusButtonAction'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup/Popup'\r\nimport { truncateText } from '../utils_truncate'\r\n\r\nexport class AjusteList extends PureComponent<DefaultMenuItemListProps<ProyectoAjusteGroup>> {\r\n  render() {\r\n    if (this.props.items === null) {\r\n      return (\r\n        <div style={{ height: 300, position: 'relative' }}>\r\n          <div className='ui active inverted text loader elastic olive'>Cargando Listado de Ajustes</div>\r\n        </div>\r\n      )\r\n    } else if (_.size(this.props.items) == 0) {\r\n      return <div className='empty nocontent'>0 Ajustes</div>\r\n    } else {\r\n      const { items } = this.props\r\n      return (\r\n        <MenuElementListPanel className='ajustes-list'>\r\n          {_.map(items, (item: ProyectoAjusteGroup) => {\r\n            return (\r\n              <div key={item.idx} className='listitem ajuste-listitem'>\r\n                <AjusteListItem\r\n                  item={item}\r\n                  isEditable={this.props.isEditable}\r\n                  onSave={this.props.onSaveItem}\r\n                  onClickDelete={this.props.onClickDeleteItem}\r\n                />\r\n              </div>\r\n            )\r\n          })}\r\n        </MenuElementListPanel>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\ntype AjusteListItemProps = {\r\n  item: ProyectoAjusteGroup\r\n  onSave: (item: ProyectoAjusteGroup, changes: any, blockingText?: string) => void\r\n  onClickDelete: (item: ProyectoAjusteGroup) => void\r\n  isEditable: boolean\r\n}\r\n\r\nclass AjusteListItem extends PureComponent<AjusteListItemProps, { isModalEdit: boolean }> {\r\n  state = {\r\n    isModalEdit: false\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onClickDelete(this.props.item)\r\n  }\r\n\r\n  onClickEdit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isModalEdit: true })\r\n  }\r\n\r\n  onCloseEdit = () => {\r\n    this.setState({ isModalEdit: false })\r\n  }\r\n\r\n  onSave = (item: ProyectoAjusteGroup, changes: any, blockingText?: string) => {\r\n    this.props.onSave(item, changes, blockingText)\r\n  }\r\n  render() {\r\n    const { item } = this.props\r\n    return (\r\n      <div>\r\n        {this.props.isEditable && (\r\n          <MenuElementListActions\r\n            actions={{\r\n              edit: { label: 'Editar', callback: this.onClickEdit, permission: 'ajustes_edit' },\r\n              delete: { label: 'Eliminar', callback: this.onClickDelete, permission: 'ajustes_delete' }\r\n            }}\r\n          />\r\n        )}\r\n        <div onClick={this.onClickEdit}>\r\n          <div className='row r1'>\r\n            <div className='pull-left r1_1'>\r\n              <span className='title-h1'> Ajuste #{item.idx}</span>\r\n              <AuthorIconLogDefaultWrapper model={item} size='small' />\r\n              <div className='r1_2'>\r\n                <strong>Ajuste Registrado: </strong> {'' + item.aplicado == '1' ? 'Sí' : 'No'}\r\n              </div>\r\n            </div>\r\n            <StatusDivBlock\r\n              wrapperClassName='pull-right text-mini'\r\n              status={item.status || 'EN PROCESO'}\r\n              className='mini'\r\n              hideLabel\r\n            />\r\n          </div>\r\n          <table className='ui compact very basic celled striped small table table-ajustes'>\r\n            <thead>\r\n              <tr>\r\n                <th>Cuenta</th>\r\n                <th>Debe</th>\r\n                <th>Haber</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {_.map(item.items, (subitem) => {\r\n                return (\r\n                  <Fragment key={subitem.id}>\r\n                    {!isEmpty(subitem.debe) && (\r\n                      <tr>\r\n                        <td>\r\n                          <Popup\r\n                            trigger={<span>{subitem.cuenta}</span>}\r\n                            content={subitem.nombre_cuenta}\r\n                            header={subitem.cuenta}\r\n                            size='mini'\r\n                          />\r\n                        </td>\r\n                        <td className='right aligned'>{accounting.formatNumber(subitem.debe)}</td>\r\n                        <td>&nbsp;</td>\r\n                      </tr>\r\n                    )}\r\n                    {!isEmpty(subitem.haber) && (\r\n                      <tr>\r\n                        <td>\r\n                          <Popup\r\n                            trigger={<span>{subitem.cuenta}</span>}\r\n                            content={subitem.nombre_cuenta}\r\n                            header={subitem.cuenta}\r\n                            size='mini'\r\n                          />\r\n                        </td>\r\n                        <td>&nbsp;</td>\r\n                        <td className='right aligned'>{accounting.formatNumber(subitem.haber)}</td>\r\n                      </tr>\r\n                    )}\r\n                  </Fragment>\r\n                )\r\n              })}\r\n            </tbody>\r\n          </table>\r\n          {item.descripcion && (\r\n            <div className='item-description'>\r\n              <div className='editor-preview' dangerouslySetInnerHTML={{ __html: truncateText(item.descripcion) }} />\r\n            </div>\r\n          )}\r\n        </div>\r\n        {this.state.isModalEdit && (\r\n          <AjusteModalEdit\r\n            item={item}\r\n            onSave={this.onSave}\r\n            onClickDelete={this.onClickDelete}\r\n            onClose={this.onCloseEdit}\r\n            isEditable={this.props.isEditable}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype AjusteModalEditProps = {\r\n  item: ProyectoAjusteGroup\r\n  onSave: (item: ProyectoAjusteGroup, data: ProyectoAjusteGroup, blockingText?: string) => void\r\n  onClickDelete: (ev: SyntheticEvent) => void\r\n  onClose: () => void\r\n  isEditable: boolean\r\n}\r\n\r\nclass AjusteModalEdit extends PureComponent<AjusteModalEditProps> {\r\n  onSave = (data: any, blockingText?: string) => {\r\n    this.props.onSave(this.props.item, data, blockingText)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        open\r\n        dimmer='inverted'\r\n        className='modal-ab modal-sidebarmenuitem'\r\n        size='large'\r\n        closeIcon\r\n        onClose={this.props.onClose}\r\n        closeOnEscape={false}\r\n        closeOnDimmerClick={false}\r\n      >\r\n        <Modal.Header>Editar Ajuste</Modal.Header>\r\n\r\n        <AjusteModal\r\n          moduleParams={{ id_visita: this.props.item.id_visita, model: 'ajuste' }}\r\n          item={this.props.item}\r\n          isEditable={this.props.isEditable}\r\n          onSave={this.onSave}\r\n          onClickDelete={this.props.onClickDelete}\r\n        />\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n\r\nconst isEmpty = (value: any) => {\r\n  if (_.isNumber(value)) {\r\n    return false\r\n  }\r\n\r\n  return _.size(value) == 0\r\n}\r\n","import React, { PureComponent } from 'react'\r\n\r\nimport { BaseMenuElement } from './menuitem'\r\nimport { MenuItemNew } from './menuitem__new'\r\nimport { HallazgoList } from './hallazgo_list'\r\nimport { HallazgoUtils } from '../utils_hallazgo'\r\nimport { HallazgoModal } from './hallazgo_modal'\r\n\r\ntype MenuItemHallazgoState = {\r\n  items: ProyectoHallazgo[]\r\n}\r\n\r\nexport class MenuItemHallazgo extends PureComponent<DefaultMenuElementProps<ProyectoHallazgo>, MenuItemHallazgoState> {\r\n  state: MenuItemHallazgoState = {\r\n    items: null\r\n  }\r\n\r\n  addItem(data: any) {\r\n    this.setState((prevState) => {\r\n      const copy = [ ...prevState.items, data ]\r\n\r\n      return { items: copy }\r\n    })\r\n  }\r\n\r\n  updateItem(item: ProyectoHallazgo, data: any) {\r\n    this.setState((prevState) => {\r\n      const copy = _.map(prevState.items, (_item) => {\r\n        if (_item.id == item.id) {\r\n          return Object.assign({}, _item, data)\r\n        } else {\r\n          return _item\r\n        }\r\n      })\r\n\r\n      return { items: copy }\r\n    })\r\n  }\r\n\r\n  deleteItem(item: ProyectoHallazgo) {\r\n    this.setState((prevState) => {\r\n      const copy = _.reject(prevState.items, { id: item.id })\r\n\r\n      return { items: copy }\r\n    })\r\n  }\r\n\r\n  onMountPanel = () => {\r\n    if (this.state.items === null) {\r\n      this.props.modelManager.getJson(this.props).then((items) => {\r\n        this.setState({ items })\r\n      })\r\n    }\r\n  }\r\n\r\n  onCreateItem = (data: ProyectoHallazgo) => {\r\n    return new Promise<null>((resolve) => {\r\n      $.blockUI(create_blockUI_loading_message('Creando Hallazgo'))\r\n\r\n      this.props.modelManager.createItem(this.props, data).then((item) => {\r\n        this.addItem(item)\r\n        $.unblockUI()\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  onSaveItem = (item: ProyectoHallazgo, changes: any, blockingText?: string) => {\r\n    return new Promise<ProyectoHallazgo>((resolve) => {\r\n      if (blockingText) {\r\n        $.blockUI(create_blockUI_loading_message(blockingText))\r\n      } else {\r\n        this.updateItem(item, changes)\r\n      }\r\n\r\n      this.props.modelManager.saveItem(this.props, item, changes).then((updatedItem) => {\r\n        this.updateItem(item, updatedItem)\r\n        if (blockingText) {\r\n          $.unblockUI()\r\n        }\r\n\r\n        resolve(updatedItem)\r\n      })\r\n    })\r\n  }\r\n\r\n  onClickDeleteItem = (item: ProyectoHallazgo) => {\r\n    bootbox.warningConfirm(\r\n      `¿Desea eliminar el hallazgo <strong>${HallazgoUtils.formatName(item.name)}</strong> ?`,\r\n      'No',\r\n      'Sí, Eliminar',\r\n      (answer: boolean) => {\r\n        if (!answer) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Hallazgo'))\r\n\r\n        this.props.modelManager.deleteItem(this.props, item).then(() => {\r\n          this.deleteItem(item)\r\n          $.unblockUI()\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BaseMenuElement\r\n        name='hallazgo'\r\n        counter={this.state.items === null ? this.props.counter : _.size(this.state.items)}\r\n        icon='hallazgos'\r\n        title='Hallazgos'\r\n        open={this.props.open}\r\n        onToggle={this.props.onOpen}\r\n        onMountPanel={this.onMountPanel}\r\n      >\r\n        <div className='content'>\r\n          <MenuItemNew\r\n            moduleParams={this.props.moduleParams}\r\n            buttonText='Crear Hallazgo'\r\n            headerText='Nuevo Hallazgo'\r\n            isEditable={es_proyecto_editable() && user_has_role_permission('hallazgo_create')}\r\n            item={createNewHallazgo()}\r\n            onSave={this.onCreateItem}\r\n            contentAs={HallazgoModal}\r\n          />\r\n          <HallazgoList\r\n            isEditable={es_proyecto_editable() && user_has_role_permission('hallazgo_edit')}\r\n            moduleParams={this.props.moduleParams}\r\n            items={this.state.items}\r\n            onSaveItem={this.onSaveItem}\r\n            onClickDeleteItem={this.onClickDeleteItem}\r\n          />\r\n        </div>\r\n      </BaseMenuElement>\r\n    )\r\n  }\r\n}\r\n\r\nfunction createNewHallazgo(): ProyectoHallazgo {\r\n  return {\r\n    id: null,\r\n    status: 'NUEVO',\r\n    implementado: null,\r\n    hallazgo: '',\r\n    RevisionLog: [],\r\n    UpdateLog: []\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent } from 'react'\r\nimport { HallazgoUtils } from '../utils_hallazgo'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\nimport { HallazgoModalEdit } from './hallazgo_edit'\r\nimport { MenuElementListPanel, MenuElementListActions } from './menuitem'\r\nimport { StatusDivBlock } from '../../global/StatusButtonAction'\r\nimport { truncateText } from '../utils_truncate'\r\n\r\nexport class HallazgoList extends PureComponent<DefaultMenuItemListProps<ProyectoHallazgo>> {\r\n  render() {\r\n    if (this.props.items === null) {\r\n      return (\r\n        <div style={{ height: 300, position: 'relative' }}>\r\n          <div className='ui active inverted text loader elastic olive'>Cargando Listado de Hallazgos</div>\r\n        </div>\r\n      )\r\n    } else if (_.size(this.props.items) == 0) {\r\n      return <div className='empty nocontent'>0 Hallazgos</div>\r\n    } else {\r\n      const { items } = this.props\r\n      return (\r\n        <MenuElementListPanel>\r\n          {_.map(items, (item) => {\r\n            return (\r\n              <div key={item.id} className='listitem hallazgo-listitem'>\r\n                <HallazgoListItem\r\n                  item={item}\r\n                  moduleParams={this.props.moduleParams}\r\n                  onSave={this.props.onSaveItem}\r\n                  onClickDelete={this.props.onClickDeleteItem}\r\n                />\r\n              </div>\r\n            )\r\n          })}\r\n        </MenuElementListPanel>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\ntype HallazgoListItemProps = {\r\n  moduleParams: any\r\n  item: ProyectoHallazgo\r\n  onSave: (item: ProyectoHallazgo, changes: any, blockingText?: string) => void\r\n  onClickDelete: (item: ProyectoHallazgo) => void\r\n}\r\n\r\nexport class HallazgoListItem extends PureComponent<HallazgoListItemProps, { isModalEdit: boolean }> {\r\n  state = {\r\n    isModalEdit: false\r\n  }\r\n\r\n  renderDescripcion() {\r\n    const { item } = this.props\r\n    let html = truncateText(item.hallazgo)\r\n\r\n    return <div dangerouslySetInnerHTML={{ __html: html }} />\r\n  }\r\n\r\n  renderEstadoImplementacion() {\r\n    const { item } = this.props\r\n\r\n    if (item.implementado == null || '' + item.implementado == '') {\r\n      return 'Pendiente'\r\n    } else if (item.implementado == '0') {\r\n      return 'En Proceso'\r\n    } else {\r\n      return 'Hecho'\r\n    }\r\n  }\r\n\r\n  onClickEdit = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.setState({ isModalEdit: true })\r\n  }\r\n\r\n  onCloseEdit = () => {\r\n    this.setState({ isModalEdit: false })\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onClickDelete(this.props.item)\r\n  }\r\n\r\n  onSave = (item: ProyectoHallazgo, changes: any) => {\r\n    let blockingText = null\r\n    if (_.isEqual(changes, { status: 'COMPLETADO' })) {\r\n      blockingText = 'Marcando como COMPLETADO'\r\n    } else if (_.isEqual(changes, { status: 'REVISADO' })) {\r\n      blockingText = 'Marcando como REVISADO'\r\n    }\r\n\r\n    this.props.onSave(item, changes, blockingText)\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n\r\n    return (\r\n      <div>\r\n        <MenuElementListActions\r\n          actions={{\r\n            edit: { label: 'Editar', callback: this.onClickEdit, permission: 'hallazgo_edit' },\r\n            delete: { label: 'Eliminar', callback: this.onClickDelete, permission: 'hallazgo_delete' }\r\n          }}\r\n        />\r\n        <div onClick={() => this.setState({ isModalEdit: true })}>\r\n          <div className='row r1'>\r\n            <div className='pull-left r1_1'>\r\n              <span className='title-h1'>{HallazgoUtils.formatName(item.name)}</span>\r\n              <AuthorIconLogDefaultWrapper model={item} size='small' />\r\n              <div className='r1_2'>\r\n                <strong>Implementación: </strong> {this.renderEstadoImplementacion()}\r\n              </div>\r\n            </div>\r\n            <StatusDivBlock wrapperClassName='pull-right text-mini' status={item.status} className='mini' hideLabel />\r\n          </div>\r\n          <div className='row'>\r\n            <div className='editor-preview'>{this.renderDescripcion()}</div>\r\n          </div>\r\n          <div className='row' />\r\n        </div>\r\n        {this.state.isModalEdit && (\r\n          <HallazgoModalEdit\r\n            item={item}\r\n            moduleParams={this.props.moduleParams}\r\n            onSave={this.onSave}\r\n            onClickDelete={this.onClickDelete}\r\n            onClose={this.onCloseEdit}\r\n          />\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { SyntheticEvent, PureComponent } from 'react'\r\nimport Modal from 'semantic-ui-react/dist/commonjs/modules/Modal/Modal'\r\nimport { HallazgoModal } from './hallazgo_modal'\r\n\r\ntype HallazgoModalEditProps = {\r\n  moduleParams: any\r\n  item: ProyectoHallazgo\r\n  onSave: (item: ProyectoHallazgo, data: ProyectoHallazgo) => void\r\n  onClickDelete: (ev: SyntheticEvent) => void\r\n  onClose: () => void\r\n}\r\nexport class HallazgoModalEdit extends PureComponent<HallazgoModalEditProps> {\r\n  onSave = (data: ProyectoHallazgo) => {\r\n    this.props.onSave(this.props.item, data)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        open\r\n        dimmer='inverted'\r\n        className='modal-ab modal-sidebarmenuitem'\r\n        size='large'\r\n        closeIcon\r\n        onClose={this.props.onClose}\r\n      >\r\n        <Modal.Header>Editar Hallazgo</Modal.Header>\r\n\r\n        <HallazgoModal\r\n          moduleParams={this.props.moduleParams}\r\n          item={this.props.item}\r\n          isEditable={user_has_role_permission('hallazgo_edit')}\r\n          onSave={this.onSave}\r\n          onClickDelete={this.props.onClickDelete}\r\n        />\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent } from 'react'\r\n\r\nimport { BaseMenuElement } from './menuitem'\r\nimport RevisionList from './revision_list'\r\n\r\nimport Textarea from 'react-textarea-autosize'\r\n\r\ntype MenuItemRevisionState = {\r\n  items: ProyectoRevisionTree[]\r\n}\r\n\r\nexport class MenuItemRevision extends PureComponent<\r\n  DefaultMenuElementProps<ProyectoRevisionTree>,\r\n  MenuItemRevisionState\r\n> {\r\n  state: MenuItemRevisionState = {\r\n    items: null\r\n  }\r\n\r\n  parseItems = (input: any[]): ProyectoRevisionTree[] => {\r\n    return input\r\n  }\r\n\r\n  onMountPanel = () => {\r\n    if (this.state.items === null) {\r\n      this.props.modelManager.getJson(this.props).then((items) => {\r\n        this.setState({ items })\r\n      })\r\n    }\r\n  }\r\n\r\n  onCreateItem = (params: { text: string; status: 'NUEVO' | 'COMPLETADO' }, cb: () => void) => {\r\n    $.blockUI(create_blockUI_loading_message('Creando Nota de Revisión'))\r\n\r\n    this.props.modelManager\r\n      .createItem(this.props, { revision_text: params.text, op: params.status })\r\n      .then((revision) => {\r\n        this.setState((prevState) => {\r\n          const items = [ ...prevState.items ]\r\n          items.push(revision)\r\n\r\n          return { items }\r\n        })\r\n\r\n        cb()\r\n        $.unblockUI()\r\n      })\r\n  }\r\n\r\n  onSaveItem = (item: ProyectoRevisionTree, changes: any, blockingText?: string) => {\r\n    return new Promise<ProyectoRevisionTree>((resolve) => {\r\n      if (blockingText) {\r\n        setTimeout(() => $.blockUI(create_blockUI_loading_message(blockingText)), 1000 * 0.1)\r\n      }\r\n\r\n      this.props.modelManager.saveItem(this.props, item, changes).then((revision) => {\r\n        this.setState((prevState) => {\r\n          const items = _.map(prevState.items, (item) => {\r\n            return item.id == revision.id ? revision : item\r\n          })\r\n\r\n          return { items }\r\n        })\r\n\r\n        if (blockingText) {\r\n          $.unblockUI()\r\n        }\r\n\r\n        resolve(revision)\r\n      })\r\n    })\r\n  }\r\n\r\n  onClickDeleteItem = (item: ProyectoRevisionTree) => {\r\n    bootbox.warningConfirm(\r\n      `¿Desea eliminar esta Nota de Revisión <b>#${item.name}</b> ?`,\r\n      'No',\r\n      'Sí, Eliminar',\r\n      (r) => {\r\n        if (!r) {\r\n          return\r\n        }\r\n\r\n        $.blockUI(create_blockUI_loading_message('Eliminando Nota de Revisión'))\r\n\r\n        this.props.modelManager.deleteItem(this.props, item).then(() => {\r\n          this.setState((prevState) => {\r\n            const items = _.reject(prevState.items, { id: item.id })\r\n\r\n            return { items }\r\n          })\r\n          $.unblockUI()\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  renderContent() {\r\n    return (\r\n      <div className='content'>\r\n        <RevisionNewForm onSubmit={this.onCreateItem} />\r\n        <RevisionList\r\n          items={this.state.items}\r\n          moduleParams={this.props.moduleParams}\r\n          isEditable={es_proyecto_editable() && user_has_role_permission('revision_edit')}\r\n          onSaveItem={this.onSaveItem}\r\n          onClickDeleteItem={this.onClickDeleteItem}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BaseMenuElement\r\n        name='revision'\r\n        counter={\r\n          this.state.items === null ? this.props.counter : _.size(_.reject(this.state.items, { status: 'REVISADO' }))\r\n        }\r\n        icon='notas_de_revision'\r\n        title='Notas de Revisión'\r\n        open={this.props.open}\r\n        onToggle={this.props.onOpen}\r\n        onMountPanel={this.onMountPanel}\r\n      >\r\n        {this.renderContent()}\r\n      </BaseMenuElement>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionNewFormProps = {\r\n  onSubmit: (params: { text: string; status: 'NUEVO' | 'COMPLETADO' }, cb: () => void) => void\r\n}\r\n\r\nclass RevisionNewForm extends PureComponent<RevisionNewFormProps, { text: string; isEditMode: boolean }> {\r\n  state = {\r\n    text: '',\r\n    isEditMode: false\r\n  }\r\n\r\n  onChange = (ev: SyntheticEvent) => {\r\n    this.setState({ text: (ev.target as any).value })\r\n  }\r\n\r\n  onTextareaKeyDown = (ev: React.KeyboardEvent) => {\r\n    if (ev.keyCode == 27) {\r\n      // on press Esc\r\n      this.onCancel()\r\n    }\r\n\r\n    if ((ev.ctrlKey || ev.metaKey) && (ev.keyCode == 13 || ev.keyCode == 10)) {\r\n      // on press ctrl + Enter\r\n      this.onSubmit('NUEVO')\r\n    }\r\n  }\r\n\r\n  onClickNew = () => {\r\n    this.setState({ isEditMode: true })\r\n  }\r\n\r\n  onCancel = () => {\r\n    this.setState({ isEditMode: false, text: '' })\r\n  }\r\n\r\n  onSubmit = (status: 'NUEVO' | 'COMPLETADO') => {\r\n    if (_.str.trim(this.state.text) == '') {\r\n      bootbox.alertError('La Nota de Revisión no puede estar vacía.')\r\n      return\r\n    }\r\n\r\n    this.props.onSubmit({ text: _.str.trim(this.state.text), status }, () => {\r\n      this.setState({ text: '', isEditMode: false })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    if (!es_proyecto_editable() || !user_has_role_permission('revision_edit')) {\r\n      return null\r\n    }\r\n\r\n    return !this.state.isEditMode ? (\r\n      <div style={{ textAlign: 'center' }}>\r\n        <button className='ui button primary mini compact' onClick={this.onClickNew}>\r\n          Crear Nota\r\n        </button>\r\n      </div>\r\n    ) : (\r\n      <div>\r\n        <Textarea\r\n          minRows={2}\r\n          maxRows={8}\r\n          autoFocus\r\n          onChange={this.onChange}\r\n          value={this.state.text}\r\n          style={{ width: '98%' }}\r\n          onKeyDown={this.onTextareaKeyDown}\r\n          placeholder='Escriba aquí su Nota de Revisión'\r\n        />\r\n        <div style={{ marginTop: 8, textAlign: 'right' }}>\r\n          <button className='ui button negative mini compact' onClick={this.onCancel}>\r\n            Cancelar\r\n          </button>\r\n          <button className='ui button primary mini compact' onClick={() => this.onSubmit('NUEVO')}>\r\n            Guardar\r\n          </button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { PureComponent, SyntheticEvent, Fragment } from 'react'\r\nimport { MenuElementListPanel, MenuElementListActions } from './menuitem'\r\nimport { AuthorIconLogDefaultWrapper } from '../../global/AuthorIconLog'\r\nimport { StatusDivBlock } from '../../global/StatusButtonAction'\r\nimport Textarea from 'react-textarea-autosize'\r\nimport cx from 'classnames'\r\nimport Popup from 'semantic-ui-react/dist/commonjs/modules/Popup'\r\n\r\nexport default class RevisionList extends PureComponent<DefaultMenuItemListProps<ProyectoRevisionTree>> {\r\n  render() {\r\n    if (this.props.items === null) {\r\n      return (\r\n        <div style={{ height: 300, position: 'relative' }}>\r\n          <div className='ui active inverted text loader elastic olive'>Cargando Notas de Revisión</div>\r\n        </div>\r\n      )\r\n    } else if (_.size(this.props.items) == 0) {\r\n      return <div className='empty nocontent'>0 Notas de Revisión</div>\r\n    } else {\r\n      const { items } = this.props\r\n\r\n      const porRevisarItems = _.reject(items, { status: 'REVISADO' })\r\n      const revisadoItems = _.filter(items, { status: 'REVISADO' })\r\n\r\n      return (\r\n        <MenuElementListPanel className='revision-list'>\r\n          {_.size(porRevisarItems) == 0 ? (\r\n            <div className='empty nocontent'>0 Notas de Revisión Abiertas</div>\r\n          ) : (\r\n            _.map(porRevisarItems, (item: ProyectoRevisionTree) => {\r\n              return (\r\n                <div key={item.id} className='listitem revision-listitem'>\r\n                  <RevisionListItem\r\n                    item={item}\r\n                    isEditable={this.props.isEditable}\r\n                    onSave={this.props.onSaveItem}\r\n                    onClickDelete={this.props.onClickDeleteItem}\r\n                  />\r\n                </div>\r\n              )\r\n            })\r\n          )}\r\n\r\n          {_.size(revisadoItems) > 0 && <RevisionDisabledList items={revisadoItems} />}\r\n        </MenuElementListPanel>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nclass RevisionDisabledList extends PureComponent<{ items: ProyectoRevisionTree[] }, { collapsed: boolean }> {\r\n  state = {\r\n    collapsed: true\r\n  }\r\n\r\n  toggle = () => {\r\n    this.setState((prevState) => {\r\n      return { collapsed: !prevState.collapsed }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { items } = this.props\r\n\r\n    return (\r\n      <div style={{ marginTop: 20, marginBottom: 20, padding: '0 10px' }}>\r\n        <h4 className='row clickable' onClick={this.toggle}>\r\n          <i className={cx('icon caret', !this.state.collapsed ? 'down' : 'right')} /> Notas Revisadas\r\n          <span className='toggle-action'>[{this.state.collapsed ? 'Mostrar' : 'Ocultar'}]</span>\r\n          <span className='ui mini circular green label pull-right'>{_.size(items)}</span>\r\n        </h4>\r\n        {!this.state.collapsed && (\r\n          <div className='revision-list-closed'>\r\n            {_.map(items, (item: ProyectoRevisionTree) => {\r\n              return (\r\n                <div key={item.id} className='listitem revision-listitem'>\r\n                  <RevisionListItem item={item} isEditable={false} />\r\n                </div>\r\n              )\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionListItemState = {\r\n  isEditMode: boolean\r\n  isThreadOpen: boolean\r\n}\r\n\r\nclass RevisionListItem extends PureComponent<\r\n  DefaultMenuItemListItemProps<ProyectoRevisionTree>,\r\n  RevisionListItemState\r\n> {\r\n  state = {\r\n    isEditMode: false,\r\n    isThreadOpen: false\r\n  }\r\n\r\n  onClickEdit = () => {\r\n    this.setState({ isEditMode: true })\r\n  }\r\n\r\n  onClickDelete = (ev: SyntheticEvent) => {\r\n    ev.preventDefault()\r\n    this.props.onClickDelete(this.props.item)\r\n  }\r\n\r\n  onClickNewComment = () => {\r\n    if (this.props.isEditable) {\r\n      this.setState({ isThreadOpen: true })\r\n    }\r\n  }\r\n\r\n  onCancelNewComment = () => {\r\n    this.setState({ isThreadOpen: false })\r\n  }\r\n\r\n  onChange = (changes: any) => {\r\n    this.props.onSave(this.props.item, changes, 'Guardando cambios...').then(() => {\r\n      this.setState({ isEditMode: false })\r\n    })\r\n  }\r\n\r\n  onClickChangeStatus = (status: any) => {\r\n    this.props.onSave(this.props.item, { op: status }, 'Marcando como ' + status + '...')\r\n  }\r\n\r\n  onAddComment = (params: { text: string; status: string }) => {\r\n    const changes: any = { comment: params.text }\r\n    if (params.status) {\r\n      changes.op = params.status\r\n    }\r\n\r\n    this.props.onSave(this.props.item, changes, 'Guardando comentario...').then(() => {\r\n      this.setState({ isThreadOpen: false })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { item } = this.props\r\n    return (\r\n      <div>\r\n        {this.props.isEditable && (\r\n          <MenuElementListActions\r\n            actions={{\r\n              delete: { label: 'Eliminar', callback: this.onClickDelete, permission: 'revision_delete' }\r\n            }}\r\n          />\r\n        )}\r\n        <div className='row header-item'>\r\n          <div className='pull-left'>\r\n            <span className='title-h1'>Nota #{item.name}</span>\r\n            <AuthorIconLogDefaultWrapper model={item} size='small' />\r\n          </div>\r\n          <StatusDivBlock\r\n            wrapperClassName='pull-right text-mini'\r\n            status={item.status || 'EN PROCESO'}\r\n            className='mini'\r\n            hideLabel\r\n          />\r\n        </div>\r\n\r\n        <div className='author-info'>\r\n          <i aria-hidden='true' className='user circle icon olive' style={{ float: 'left' }} />\r\n          <div className='content'>\r\n            <div className='header'>\r\n              {item.Creator.User.name}\r\n              <div className='pull-right description'>\r\n                {Date.create(item.Creator.ts).format('{d} {Mon} {year} {h}:{mm} {tt}')}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {this.props.isEditable && this.state.isEditMode ? (\r\n          <RevisionEditForm item={item} onSubmit={this.onChange} />\r\n        ) : (\r\n          <Fragment>\r\n            <p\r\n              onClick={this.onClickNewComment}\r\n              style={{ lineHeight: '1em' }}\r\n              dangerouslySetInnerHTML={{ __html: item.description.replace(/\\n/g, '<br/>') }}\r\n            />\r\n            <div className={cx('threadlist ui threaded comments', { empty: _.size(item.Comments) == 0 })}>\r\n              {this.state.isThreadOpen && (\r\n                <h5 className={cx('ui header', { dividing: _.size(item.Comments) == 0 })}>Comentarios</h5>\r\n              )}\r\n              {_.map(item.Comments, (comment) => {\r\n                return (\r\n                  <div className='comment' key={comment.id} onClick={this.onClickNewComment}>\r\n                    <div className='avatar'>\r\n                      <i\r\n                        className={cx('icon user circle', {\r\n                          green: comment.status == 'COMPLETADO',\r\n                          olive: comment.status == 'REVISADO'\r\n                        })}\r\n                      />\r\n                    </div>\r\n                    <div className='content'>\r\n                      <div className='author'>{comment.Creator.User.name}</div>\r\n                      <div className='metadata'>\r\n                        {Date.create(comment.Creator.ts).format('{d} {Mon} {year}  {h}:{mm} {tt}')}\r\n                      </div>\r\n                      <div className='text'>\r\n                        <p dangerouslySetInnerHTML={{ __html: comment.comentario }} />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )\r\n              })}\r\n            </div>\r\n            {this.state.isThreadOpen && this.props.isEditable ? (\r\n              <RevisionComentarioForm parentItem={item} onSave={this.onAddComment} onCancel={this.onCancelNewComment} />\r\n            ) : (\r\n              this.props.isEditable && (\r\n                <div className='actions-wrapper'>\r\n                  <div className='actions'>\r\n                    <div className='group-actions'>\r\n                      <button className='ui button icon blue mini compact' onClick={this.onClickNewComment}>\r\n                        Responder\r\n                      </button>\r\n                    </div>\r\n                    <div className='group-actions right-actions'>\r\n                      <button\r\n                        className='ui button icon primary mini compact'\r\n                        onClick={() => this.onClickChangeStatus('COMPLETADO')}\r\n                      >\r\n                        <i className='icon check' /> Completar\r\n                      </button>\r\n\r\n                      <Popup\r\n                        disabled={item.fecha_completado != null}\r\n                        className='disable-text'\r\n                        on='hover'\r\n                        basic\r\n                        content='Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.'\r\n                        trigger={\r\n                          <div className='button-wrapper'>\r\n                            <button\r\n                              className='ui button mini compact olive'\r\n                              disabled={item.fecha_completado == null}\r\n                              onClick={() =>\r\n                                item.fecha_completado == null ? void 0 : this.onClickChangeStatus('REVISADO')}\r\n                            >\r\n                              <i className='icon check fitted' />\r\n                              <i className='icon check' /> Revisado\r\n                            </button>\r\n                          </div>\r\n                        }\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            )}\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionEditFormProps = {\r\n  item: ProyectoRevisionTree\r\n  onSubmit: (changes: { revision_text: string; op?: 'COMPLETADO' | 'REVISADO' }) => void\r\n}\r\n\r\ntype RevisionEditFormState = {\r\n  value: string\r\n}\r\n\r\nclass RevisionEditForm extends PureComponent<RevisionEditFormProps, RevisionEditFormState> {\r\n  constructor(props: RevisionEditFormProps) {\r\n    super(props)\r\n    this.state = {\r\n      value: this.props.item.description\r\n    }\r\n  }\r\n\r\n  onChange = (ev: SyntheticEvent) => {\r\n    this.setState({ value: (ev.target as any).value })\r\n  }\r\n\r\n  onSubmit = (status?: 'COMPLETADO' | 'REVISADO') => {\r\n    if (_.str.trim(this.state.value) == '') {\r\n      bootbox.alertError('La Nota de Revisión no puede estar vacía.')\r\n      return\r\n    }\r\n\r\n    const changes: any = { revision_text: _.str.trim(this.state.value) }\r\n    if (status) {\r\n      changes.op = status\r\n    }\r\n    this.props.onSubmit(changes)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <Textarea\r\n          minRows={2}\r\n          maxRows={8}\r\n          onChange={this.onChange}\r\n          value={this.state.value}\r\n          style={{ width: '98%' }}\r\n          placeholder='Escriba aquí su Nota de Revisión'\r\n        />\r\n\r\n        <div style={{ marginTop: 8, textAlign: 'right' }}>\r\n          <button className='ui button icon primary mini compact' onClick={() => this.onSubmit()}>\r\n            Guardar\r\n          </button>\r\n\r\n          <button className='ui button icon primary mini compact' onClick={() => this.onSubmit('COMPLETADO')}>\r\n            <i className='icon check' /> Completar\r\n          </button>\r\n\r\n          <Popup\r\n            disabled={this.props.item.fecha_completado != null}\r\n            className='disable-text'\r\n            on='hover'\r\n            basic\r\n            content='Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.'\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <button\r\n                  className='ui button mini compact olive'\r\n                  disabled={this.props.item.fecha_completado == null}\r\n                  onClick={() => (this.props.item.fecha_completado == null ? void 0 : this.onSubmit('REVISADO'))}\r\n                >\r\n                  <i className='icon check fitted' />\r\n                  <i className='icon check' /> Revisado\r\n                </button>\r\n              </div>\r\n            }\r\n          />\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  }\r\n}\r\n\r\ntype RevisionComentarioFormProps = {\r\n  parentItem: ProyectoRevisionTree\r\n  onSave: (params: { text: string; status: string }) => void\r\n  onCancel: () => void\r\n}\r\nclass RevisionComentarioForm extends PureComponent<RevisionComentarioFormProps> {\r\n  cancelTimeout: number = null\r\n\r\n  state = {\r\n    value: ''\r\n  }\r\n\r\n  onChange = (ev: SyntheticEvent) => {\r\n    this.setState({ value: (ev.target as any).value })\r\n  }\r\n\r\n  onTextareaKeyDown = (ev: React.KeyboardEvent) => {\r\n    if (ev.keyCode == 27) {\r\n      // on press Esc\r\n      this.props.onCancel()\r\n      this.cancelTimeout = null\r\n    }\r\n\r\n    if ((ev.ctrlKey || ev.metaKey) && (ev.keyCode == 13 || ev.keyCode == 10)) {\r\n      // on press ctrl + Enter\r\n      this.onSubmit()\r\n    }\r\n  }\r\n\r\n  onSubmit = (status?: 'COMPLETADO' | 'REVISADO') => {\r\n    if (_.str.trim(this.state.value) == '' && !status) {\r\n      return\r\n    }\r\n\r\n    if (this.cancelTimeout != null) {\r\n      window.clearTimeout(this.cancelTimeout)\r\n      this.cancelTimeout = null\r\n    }\r\n\r\n    this.props.onSave({ text: _.str.trim(this.state.value), status })\r\n  }\r\n\r\n  onBlur = () => {\r\n    this.cancelTimeout = window.setTimeout(() => {\r\n      this.props.onCancel()\r\n    }, 1000 * 0.5)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div style={{ marginBottom: 30 }}>\r\n        <Textarea\r\n          minRows={2}\r\n          maxRows={5}\r\n          autoFocus\r\n          value={this.state.value}\r\n          onChange={this.onChange}\r\n          onKeyDown={this.onTextareaKeyDown}\r\n          placeholder='Escriba aquí su comentario'\r\n          style={{ width: '95%' }}\r\n          onBlur={() => this.onBlur()}\r\n        />\r\n\r\n        <div style={{ textAlign: 'right', marginTop: 5 }}>\r\n          <button className='ui button icon blue mini compact pull-left' onClick={() => this.onSubmit()}>\r\n            Enviar\r\n          </button>\r\n\r\n          <button className='ui button icon primary mini compact' onClick={() => this.onSubmit('COMPLETADO')}>\r\n            <i className='icon check' /> Completar\r\n          </button>\r\n\r\n          <Popup\r\n            disabled={this.props.parentItem.fecha_completado != null}\r\n            className='disable-text'\r\n            on='hover'\r\n            basic\r\n            content='Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.'\r\n            trigger={\r\n              <div className='button-wrapper'>\r\n                <button\r\n                  className='ui button mini compact olive'\r\n                  disabled={this.props.parentItem.fecha_completado == null}\r\n                  onClick={() => (this.props.parentItem.fecha_completado == null ? void 0 : this.onSubmit('REVISADO'))}\r\n                >\r\n                  <i className='icon check fitted' />\r\n                  <i className='icon check' /> Revisado\r\n                </button>\r\n              </div>\r\n            }\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","export class HallazgoHojaTrabajoModelManager implements MenuElementModelManager<ProyectoHallazgo> {\r\n  private static instance: HallazgoHojaTrabajoModelManager\r\n\r\n  static getInstance(): HallazgoHojaTrabajoModelManager {\r\n    if (!HallazgoHojaTrabajoModelManager.instance) {\r\n      HallazgoHojaTrabajoModelManager.instance = new this()\r\n    }\r\n\r\n    return HallazgoHojaTrabajoModelManager.instance\r\n  }\r\n\r\n  /**\r\n   * Descarga el listado de los hallazgos.\r\n   *\r\n   * @param props\r\n   */\r\n  getJson(props: DefaultMenuElementProps<ProyectoHallazgo>): Promise<ProyectoHallazgo[]> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n\r\n    return new Promise((resolve) => {\r\n      $.getJSON(url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/hallazgo/json`)).done((res) => {\r\n        resolve(_.isEmpty(res.response) ? [] : res.response)\r\n      })\r\n    })\r\n  }\r\n\r\n  createItem(props: DefaultMenuElementProps<ProyectoHallazgo>, data: any): Promise<ProyectoHallazgo> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/hallazgo`)\r\n\r\n    return new Promise<ProyectoHallazgo>((resolve) => {\r\n      $.post(url, { data }).done((res) => {\r\n        resolve(res.response.record)\r\n      })\r\n    })\r\n  }\r\n\r\n  saveItem(props: DefaultMenuElementProps<ProyectoHallazgo>, item: any, data: any): Promise<ProyectoHallazgo> {\r\n    let url: string\r\n    if (_.isEqual(data, { status: 'COMPLETADO' })) {\r\n      url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id/c`\r\n    } else if (_.isEqual(data, { status: 'REVISADO' })) {\r\n      url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id/r`\r\n    } else {\r\n      url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id`\r\n    }\r\n\r\n    const { id_paso, id_visita } = props.moduleParams\r\n\r\n    return new Promise<ProyectoHallazgo>((resolve) => {\r\n      $.post(url_for2(url, { id_paso, id_visita, id: item.id }), { data }).done((res) => {\r\n        resolve(res.response.record)\r\n      })\r\n    })\r\n  }\r\n\r\n  deleteItem(props: DefaultMenuElementProps<ProyectoHallazgo>, item: any): Promise<null> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id`\r\n\r\n    return new Promise<null>((resolve) => {\r\n      $.ajax({ url: url_for2(url, { id_paso, id_visita, id: item.id }), type: 'DELETE' }).done((res) => {\r\n        if (res.status == 1) {\r\n          resolve()\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  parseItems(items: any): any {\r\n    return items\r\n  }\r\n}\r\n\r\nexport class RevisionHojaTrabajoModelManager implements MenuElementModelManager<ProyectoRevisionTree> {\r\n  private static instance: RevisionHojaTrabajoModelManager\r\n\r\n  private hojaTrabajoContext: HojaTrabajoContextType\r\n\r\n  static getInstance(hojaTrabajoContext: HojaTrabajoContextType): RevisionHojaTrabajoModelManager {\r\n    if (!RevisionHojaTrabajoModelManager.instance) {\r\n      RevisionHojaTrabajoModelManager.instance = new this()\r\n      RevisionHojaTrabajoModelManager.instance.hojaTrabajoContext = hojaTrabajoContext\r\n    }\r\n\r\n    return RevisionHojaTrabajoModelManager.instance\r\n  }\r\n\r\n  /**\r\n   * Descarga el listado de los notas de revision.\r\n   *\r\n   * @param props\r\n   */\r\n  getJson(props: DefaultMenuElementProps<ProyectoRevisionTree>): Promise<ProyectoRevisionTree[]> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n\r\n    return new Promise((resolve) => {\r\n      $.getJSON(url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/revision`)).done((res) => {\r\n        resolve(_.isEmpty(res.response.revisiones) ? [] : this.parseItems(res.response.revisiones))\r\n      })\r\n    })\r\n  }\r\n\r\n  createItem(props: DefaultMenuElementProps<ProyectoRevisionTree>, data: any): Promise<ProyectoRevisionTree> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/revision`)\r\n\r\n    return new Promise<ProyectoRevisionTree>((resolve) => {\r\n      $.post(url, data).done((res) => {\r\n        resolve(res.response.revision)\r\n\r\n        this.updateVisita(id_visita, res.response.paso_visita)\r\n      })\r\n    })\r\n  }\r\n\r\n  saveItem(props: DefaultMenuElementProps<ProyectoRevisionTree>, item: any, data: any): Promise<ProyectoRevisionTree> {\r\n    const { id_visita, id_paso } = props.moduleParams\r\n    const url = url_for2(`proyecto/:id_proyecto/paso/${id_paso}/visita/${id_visita}/revision/${item.id}`)\r\n\r\n    return new Promise<ProyectoRevisionTree>((resolve) => {\r\n      $.post(url, data).done((res) => {\r\n        resolve(res.response.revision)\r\n\r\n        this.updateVisita(id_visita, res.response.paso_visita)\r\n      })\r\n    })\r\n  }\r\n\r\n  deleteItem(props: DefaultMenuElementProps<ProyectoRevisionTree>, item: any): Promise<null> {\r\n    const { id_paso, id_visita } = props.moduleParams\r\n    const url = `proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/revision/:item_id`\r\n\r\n    return new Promise<null>((resolve) => {\r\n      $.ajax({ url: url_for2(url, { id_paso, id_visita, item_id: item.id }), type: 'DELETE' }).done((res) => {\r\n        resolve()\r\n\r\n        this.updateVisita(id_visita, res.response.paso_visita)\r\n      })\r\n    })\r\n  }\r\n\r\n  parseItems(items: any): any {\r\n    return items\r\n  }\r\n\r\n  updateVisita(id_visita: Readonly<string>, changes: any) {\r\n    const { hoja_trabajo, update } = this.hojaTrabajoContext\r\n\r\n    let hoja_trabajo_copy = Object.assign({}, hoja_trabajo)\r\n\r\n    hoja_trabajo_copy.visitas = _.mapValues(hoja_trabajo_copy.visitas, (item: ProyectoPasoVisita) => {\r\n      if (item.id_visita == id_visita) {\r\n        item = Object.assign({}, item, changes)\r\n      }\r\n      return item\r\n    })\r\n\r\n    update(hoja_trabajo_copy)\r\n  }\r\n}\r\n","import { Component, SyntheticEvent } from 'react'\r\nimport TabPaneVisita from './TabPaneVisita'\r\nimport { AuthorIconLog } from './../global/AuthorIconLog'\r\n\r\nimport Label from 'semantic-ui-react/dist/commonjs/elements/Label'\r\n\r\nimport { Tabs, TabList, Tab, PanelList, Panel } from 'react-tabtab'\r\n\r\nimport { SortableContainer, SortableElement, SortableHandle } from 'react-sortable-hoc'\r\nimport HojaTrabajoContext from './HojaTrabajoContext'\r\n\r\ndeclare var app: any\r\n\r\ndeclare type HojaTrabajoAppPeriodoState = {\r\n  activeIndex: number\r\n  newVisitaOpen: boolean\r\n  hoja_trabajo: HojaTrabajo\r\n}\r\n\r\nexport default class AppPeriodo extends Component<HojaTrabajoAppProps, HojaTrabajoAppPeriodoState> {\r\n  constructor(props: HojaTrabajoAppProps) {\r\n    super(props)\r\n\r\n    const visita_current = _.find(this.props.hoja_trabajo.visitas, { is_current: true })\r\n    const activeIndex = visita_current ? visita_current.index : null\r\n\r\n    if (visita_current) {\r\n      app.vars.current_idvisita = visita_current.id_visita\r\n    }\r\n\r\n    this.state = {\r\n      activeIndex,\r\n      newVisitaOpen: false,\r\n      hoja_trabajo: this.props.hoja_trabajo\r\n    }\r\n  }\r\n\r\n  handleClick = (index: number) => {\r\n    this.setState({ activeIndex: index })\r\n    const visita = _.find(this.state.hoja_trabajo.visitas, { index })\r\n    app.vars.current_idvisita = visita.id_visita\r\n    $(`#table-visita-instrucciones-${visita.id}`).floatThead('reflow')\r\n  }\r\n\r\n  onChangeVisita = (visita: ProyectoPasoVisita) => {\r\n    this.setState((state: HojaTrabajoAppState) => {\r\n      let hoja_trabajo = Object.assign({}, state.hoja_trabajo)\r\n      hoja_trabajo.visitas = _.map(hoja_trabajo.visitas, (item) => {\r\n        if (item.index + '' == visita.index + '') {\r\n          return visita\r\n        } else {\r\n          return item\r\n        }\r\n      })\r\n      return { hoja_trabajo }\r\n    })\r\n  }\r\n\r\n  onChangeApp = (data: any) => {\r\n    this.setState((state: HojaTrabajoAppState) => {\r\n      let hoja_trabajo = Object.assign({}, state.hoja_trabajo, data)\r\n\r\n      return { hoja_trabajo }\r\n    })\r\n  }\r\n\r\n  onClickActionElement = (ev: SyntheticEvent, action: 'CREATE' | 'RENAME' | 'DELETE', visita?: ProyectoPasoVisita) => {\r\n    ev.preventDefault()\r\n    switch (action) {\r\n      case 'CREATE':\r\n        bootbox.prompt(\r\n          { header: 'Nuevo Periodo', content: '<div>Escriba el nombre del periodo que desea crear.</div>' },\r\n          'Cancelar',\r\n          'Crear',\r\n          (r: string) => {\r\n            if (!r || _.str.trim(r) == '') {\r\n              return\r\n            }\r\n            const url = this.getUrlFor('periodo')\r\n\r\n            $.blockUI(create_blockUI_loading_message('Creando Nuevo Periodo'))\r\n\r\n            $.ajax(url, {\r\n              type: 'POST',\r\n              data: { id_paso: this.state.hoja_trabajo.paso.id, name: _.str.trim(r) },\r\n              dataType: 'json'\r\n            }).done((res) => {\r\n              if (!res.hasErrors) {\r\n                this.setState((state) => {\r\n                  let hoja_trabajo = state.hoja_trabajo\r\n                  hoja_trabajo.visitas[res.response.id_visita] = res.response\r\n\r\n                  return { hoja_trabajo, activeIndex: res.response.index }\r\n                })\r\n              } else {\r\n                bootbox.alert(res.message)\r\n              }\r\n              $.unblockUI()\r\n            })\r\n          },\r\n          ''\r\n        )\r\n        $('.bootbox.modal').addClass('modal-ab')\r\n        break\r\n      case 'RENAME':\r\n        bootbox.prompt(\r\n          { header: 'Renombrar Periodo', content: 'Escriba el nombre que desea asignarle a este periodo.' },\r\n          'Cancelar',\r\n          'Aceptar',\r\n          (r: string) => {\r\n            if (!r || _.str.trim(r) == '') {\r\n              return\r\n            }\r\n\r\n            $.blockUI(create_blockUI_loading_message('Guardando cambios'))\r\n            const url = url_for(\r\n              `proyecto/${this.state.hoja_trabajo.proyecto.id}/master_data/paso-visita/rename/${visita.id_visita}`\r\n            )\r\n\r\n            $.ajax(url, {\r\n              type: 'POST',\r\n              data: { name: _.str.trim(r) },\r\n              dataType: 'json'\r\n            }).done((res) => {\r\n              if (!res.hasErrors) {\r\n                this.setState((state) => {\r\n                  let hoja_trabajo = state.hoja_trabajo\r\n                  hoja_trabajo.visitas = _.map(hoja_trabajo.visitas, function(item) {\r\n                    if (item.id_visita == visita.id_visita) {\r\n                      item.label = _.str.trim(r)\r\n                    }\r\n                    return item\r\n                  })\r\n\r\n                  return { hoja_trabajo }\r\n                })\r\n              }\r\n              $.unblockUI()\r\n            })\r\n          },\r\n          visita.label\r\n        )\r\n        $('.bootbox.modal').addClass('modal-ab')\r\n        break\r\n      case 'DELETE':\r\n        bootbox.warningConfirm('¿Desea eliminar este periodo?', 'No', 'Sí, Eliminar periodo', (r) => {\r\n          if (r) {\r\n            $.blockUI(create_blockUI_loading_message(`Eliminando Periodo \"${visita.label}\"`))\r\n            const url = url_for(\r\n              `proyecto/${this.state.hoja_trabajo.proyecto.id}/master_data/paso-visita/delete/${visita.id_visita}`\r\n            )\r\n\r\n            $.ajax(url, {\r\n              type: 'POST',\r\n              dataType: 'json'\r\n            }).done((res) => {\r\n              $.unblockUI()\r\n              if (!res.hasErrors) {\r\n                this.setState((state) => {\r\n                  let hoja_trabajo = state.hoja_trabajo\r\n                  hoja_trabajo.visitas = _.reject(hoja_trabajo.visitas, function(item) {\r\n                    return item.id_visita == visita.id_visita\r\n                  })\r\n\r\n                  let activeIndex = state.activeIndex\r\n                  if (activeIndex == visita.index) {\r\n                    activeIndex = _.head(hoja_trabajo.visitas).index\r\n                  }\r\n\r\n                  return { hoja_trabajo, activeIndex }\r\n                })\r\n              }\r\n            })\r\n          }\r\n        })\r\n    }\r\n  }\r\n\r\n  static shortVisitaName(visita: string): string {\r\n    const transformations: { [s: string]: string } = {\r\n      Enero: 'Ene',\r\n      Febrero: 'Feb',\r\n      Marzo: 'Mar',\r\n      Abril: 'Abr',\r\n      Mayo: 'May',\r\n      Junio: 'Jun',\r\n      Julio: 'Jul',\r\n      Agosto: 'Ago',\r\n      Septiembre: 'Sept',\r\n      Octubre: 'Oct',\r\n      Noviembre: 'Nov',\r\n      Diciembre: 'Dic'\r\n    }\r\n\r\n    _.forEach(transformations, function(to, from) {\r\n      visita = visita.replace(new RegExp(from, 'gi'), to)\r\n    })\r\n\r\n    return visita\r\n  }\r\n\r\n  getUrlFor(urlToAppend: string) {\r\n    return url_for(\r\n      `proyecto/${this.props.hoja_trabajo.proyecto.id}/hoja-trabajo/paso/${this.props.hoja_trabajo.paso\r\n        .id}/${urlToAppend}`\r\n    )\r\n  }\r\n\r\n  isAllowedAsociarVisita() {\r\n    if (!user_has_role_permission('paso_asociar_visita')) {\r\n      return false\r\n    }\r\n\r\n    if (!this.state.hoja_trabajo.proyecto.isOpen) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  renderTab(visita: ProyectoPasoVisita, k: number) {\r\n    let status_label = null\r\n\r\n    if (visita.status) {\r\n      status_label = (\r\n        <Label\r\n          style={{ backgroundColor: visita.status_color }}\r\n          className={`visita-status visita-status-${_.str.underscored(visita.status)}`}\r\n          size='mini'\r\n        >\r\n          {visita.status}\r\n        </Label>\r\n      )\r\n    }\r\n\r\n    const alertTextRevisado =\r\n      visita.fecha_completado &&\r\n      visita.fecha_revision &&\r\n      Date.create(visita.fecha_completado) > Date.create(visita.fecha_revision)\r\n        ? 'Modificado despues de Revisado'\r\n        : null\r\n\r\n    return (\r\n      <Tab key={visita.id} className='item tab-nav-item visita-tab'>\r\n        <span className='tabname'>{AppPeriodo.shortVisitaName(visita.label)}</span>\r\n        <div className='author-icon-log-wrapper'>\r\n          <AuthorIconLog log={visita.UpdateLog} name='Preparado por' label='P' iconColor='green' />\r\n          <AuthorIconLog\r\n            log={visita.RevisionLog}\r\n            name='Revisado por'\r\n            label='R'\r\n            iconColor='olive'\r\n            alertText={alertTextRevisado}\r\n          />\r\n        </div>\r\n        {status_label}\r\n      </Tab>\r\n    )\r\n  }\r\n  renderPanel(visita: ProyectoPasoVisita, k: number) {\r\n    return (\r\n      <Panel key={visita.id}>\r\n        <TabPaneVisita\r\n          idx={visita.index}\r\n          active={this.state.activeIndex == visita.index}\r\n          visita={visita}\r\n          type='PERIODO'\r\n          isEditable={this.state.hoja_trabajo.proyecto.isOpen}\r\n          onChange={this.onChangeVisita}\r\n          onChangeApp={this.onChangeApp}\r\n        />\r\n      </Panel>\r\n    )\r\n  }\r\n\r\n  renderModalContent() {\r\n    if (!this.state.hoja_trabajo.proyecto.isOpen) {\r\n      return null\r\n    }\r\n\r\n    const self = this\r\n    let visitas: ProyectoPasoVisita[] = _.values(self.state.hoja_trabajo.visitas)\r\n    visitas = _.sortBy(visitas, 'position')\r\n\r\n    const DragHandle = SortableHandle(() => <span className='sort-handler drag-icon' />)\r\n\r\n    const SortElement = SortableElement(({ visita }: { visita: ProyectoPasoVisita }) => {\r\n      return (\r\n        <li className='list-group-item visita-li' id={`visita-li-${visita.id}`}>\r\n          {user_has_role_permission('hoja_trabajo_edit') && <DragHandle />}\r\n          <span>{visita.label}</span>\r\n\r\n          <div className='pull-right'>\r\n            {user_has_role_permission('hoja_trabajo_edit') && [\r\n              <a\r\n                href='#'\r\n                key='rename'\r\n                className='btn-mini btn-link'\r\n                onClick={(ev) => this.onClickActionElement(ev, 'RENAME', visita)}\r\n              >\r\n                Cambiar nombre\r\n              </a>,\r\n              '|',\r\n              <a\r\n                href='#'\r\n                key='delete'\r\n                className='btn-link btn-mini delete'\r\n                onClick={(ev) => this.onClickActionElement(ev, 'DELETE', visita)}\r\n              >\r\n                Eliminar\r\n              </a>\r\n            ]}\r\n          </div>\r\n        </li>\r\n      )\r\n    })\r\n\r\n    const SortableList = SortableContainer(({ visitas }: { visitas: ProyectoPasoVisita[] }) => {\r\n      return (\r\n        <ul id='paso-periodo-sortlist' className='list-group compact' style={{ marginLeft: 0 }}>\r\n          {_.map(visitas, (visita, index: number) => (\r\n            <SortElement visita={visita} key={`visita-li-${visita.id}`} index={index} />\r\n          ))}\r\n        </ul>\r\n      )\r\n    })\r\n\r\n    const onSortEnd = ({ oldIndex, newIndex }: { oldIndex: number; newIndex: number }) => {\r\n      const arrayMoveMutate = (array: any[], from: number, to: number) => {\r\n        array.splice(to < 0 ? array.length + to : to, 0, array.splice(from, 1)[0])\r\n      }\r\n\r\n      const arrayMove = (array: any[], from: number, to: number) => {\r\n        array = array.slice()\r\n        arrayMoveMutate(array, from, to)\r\n        return array\r\n      }\r\n\r\n      this.setState(\r\n        (state) => {\r\n          let hoja_trabajo = state.hoja_trabajo\r\n          let visitas: ProyectoPasoVisita[] = _.values(hoja_trabajo.visitas)\r\n          visitas = _.sortBy(visitas, 'position')\r\n          let sorted = arrayMove(visitas, oldIndex, newIndex)\r\n          sorted = _.map(sorted, function(item, k: number) {\r\n            item.position = k\r\n            return item\r\n          })\r\n          hoja_trabajo.visitas = sorted\r\n\r\n          return { hoja_trabajo }\r\n        },\r\n        () => {\r\n          let neworder: { [s: number]: string } = {}\r\n          _.forEach(this.state.hoja_trabajo.visitas, function(item) {\r\n            neworder[item.position] = item.id_visita\r\n          })\r\n\r\n          const url = url_for(`proyecto/${this.state.hoja_trabajo.proyecto.id}/master_data/paso-visita/sort`)\r\n          $.ajax(url, {\r\n            type: 'POST',\r\n            data: { sort: neworder },\r\n            dataType: 'json'\r\n          })\r\n        }\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div style={{ padding: '5px 20px' }}>\r\n        <p className='description-text'>Listado de periodos asociados a este paso.</p>\r\n\r\n        <SortableList\r\n          visitas={visitas}\r\n          lockAxis='y'\r\n          helperClass='sortable_placeholder'\r\n          useDragHandle\r\n          onSortEnd={onSortEnd}\r\n          helperContainer={() => document.getElementById('paso-periodo-sortlist')}\r\n        />\r\n\r\n        <div style={{ margin: 'auto', textAlign: 'center' }}>\r\n          <button className='btn btn-primary' onClick={(ev) => this.onClickActionElement(ev, 'CREATE')}>\r\n            <span className='icon-plus' /> Nuevo Periodo\r\n          </button>\r\n        </div>\r\n        <br />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const self = this\r\n    let visitas: ProyectoPasoVisita[] = _.values(self.state.hoja_trabajo.visitas)\r\n\r\n    if (_.size(visitas) == 0) {\r\n      return (\r\n        <div id='visita-tabs' className={`paso-code-${this.state.hoja_trabajo.paso.code} paso-periodo`}>\r\n          <div className='alert alert-block nocontent'>\r\n            <h3>Sin Periodos</h3>\r\n            <p>\r\n              <span className='icon-warning-sign' />Este paso aun no tiene periodos creados.\r\n            </p>\r\n            {user_has_role_permission('hoja_trabajo_edit') && (\r\n              <button\r\n                className='btn btn-primary'\r\n                onClick={(ev) => this.onClickActionElement(ev, 'CREATE')}\r\n                style={{ marginTop: '30px' }}\r\n              >\r\n                <span className='icon-plus' /> Nuevo periodo\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    visitas = _.sortBy(visitas, 'position')\r\n\r\n    return (\r\n      <HojaTrabajoContext.Provider value={{ hoja_trabajo: this.state.hoja_trabajo, update: this.onChangeApp }}>\r\n        <div id='visita-tabs' className={`paso-code-${this.state.hoja_trabajo.paso.code} paso-periodo`}>\r\n          <Tabs\r\n            activeIndex={this.state.activeIndex}\r\n            onTabChange={this.handleClick}\r\n            showModalButton={this.state.hoja_trabajo.proyecto.isOpen}\r\n            modalHeader='Administración de Periodos'\r\n            modalContent={this.renderModalContent()}\r\n          >\r\n            <TabList className='ui tabular menu'>\r\n              {_.map(visitas, (visita, k) => {\r\n                visita.HojaTrabajo = self.state.hoja_trabajo\r\n                return this.renderTab(visita, k)\r\n              })}\r\n            </TabList>\r\n            <PanelList>\r\n              {_.map(visitas, (visita, k) => {\r\n                visita.HojaTrabajo = self.state.hoja_trabajo\r\n                return this.renderPanel(visita, k)\r\n              })}\r\n            </PanelList>\r\n          </Tabs>\r\n        </div>\r\n      </HojaTrabajoContext.Provider>\r\n    )\r\n  }\r\n}\r\n"],"sourceRoot":""}