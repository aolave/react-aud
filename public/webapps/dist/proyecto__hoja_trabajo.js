var webpackLibs=function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],p=0,d=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&d.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(u&&u(t);d.length;)d.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,s=1;s<a.length;s++){var c=a[s];0!==o[c]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},o={0:0},r=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonpwebpackLibs=window.webpackJsonpwebpackLibs||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;return r.push([371,1]),a()}({1:function(e,t){e.exports=React},100:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthorIconLogDefaultWrapper=t.AuthorIconLogEditable=t.AuthorIconLog=void 0;var n=a(1),o=u(a(9)),r=u(a(64)),i=u(a(55)),s=u(a(222)),c=u(a(99)),l=u(a(217));function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,a){return t&&m(e.prototype,t),a&&m(e,a),e}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){return d(this,t),h(this,b(t).apply(this,arguments))}return v(t,n.Component),f(t,[{key:"render",value:function(){var e=["author-icon-log"];this.props.className&&e.push(this.props.className),this.props.inline&&e.push("inline"),e=(0,o.default)(e,this.props.size);var t,a=React.createElement(r.default,{name:"user circle",size:this.props.size,color:0==_.size(this.props.log)?null:this.props.iconColor,disabled:0==_.size(this.props.log)});if(this.props.alertText&&(a=React.createElement(r.default.Group,null,a,React.createElement(r.default,{corner:"top right",color:"red",name:"warning circle"}))),this.props.inline){var n=null==this.props.log?null:this.props.log[0];t=React.createElement("div",null,this.props.label&&React.createElement("span",{className:"lb"},this.props.label),a,this.props.alertText&&React.createElement("span",{className:"alert-text"},React.createElement(r.default,{color:"red",name:"warning circle"})," ",this.props.alertText),n&&React.createElement("div",{className:"content user-info"},React.createElement("div",{className:"user-sigla"},n.User.sigla),React.createElement("time",{dateTime:Date.create(n.ts).format("{year}-{MM}-{dd}")},Date.create(n.ts).format("{year}-{MM}-{dd}"))))}else t=React.createElement("div",null,this.props.label&&React.createElement("span",{className:"lb"},this.props.label),a);return React.createElement("div",{className:e},React.createElement(c.default,{trigger:t,position:"bottom center",className:"author-icon-log-popup",pinned:!0,size:this.props.size},React.createElement(c.default.Header,null,this.props.name,this.props.alertText&&React.createElement("div",{className:"alert-text"},React.createElement(r.default,{color:"red",name:"warning circle"})," ",this.props.alertText)),React.createElement(c.default.Content,null,null==this.props.log?React.createElement("div",{className:"label"},"Sin Especificar"):React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,this.props.log.map(function(e,t){return React.createElement("tr",{key:t},React.createElement("td",null,a," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))))}}]),t}();t.AuthorIconLog=g;var E=function(e){function t(){var e;return d(this,t),(e=h(this,b(t).apply(this,arguments))).state={isLoading:!1},e.onClickEdit=function(t){t.preventDefault(),e.setState({isLoading:!0}),e.props.onClickEdit()},e}return v(t,n.Component),f(t,[{key:"render",value:function(){var e=["author-icon-log"];this.props.className&&e.push(this.props.className),e=(0,o.default)(e,this.props.size);var t=React.createElement(r.default,{name:"user circle",size:this.props.size,color:null==this.props.log?null:this.props.iconColor,disabled:null==this.props.log}),a=React.createElement("div",{style:{position:"relative"}},React.createElement(l.default,{inverted:!0,active:this.state.isLoading},React.createElement(s.default,{inverted:!0})),this.props.label&&React.createElement("span",{className:"lb"},this.props.label),t,React.createElement(i.default,{className:"action edit",disabled:this.props.disableEdit,compact:!0,size:"mini",color:this.props.iconColor,onClick:this.onClickEdit},this.props.editText));return React.createElement("div",{className:e},React.createElement(c.default,{trigger:a,position:"bottom center",pinned:!0,size:this.props.size},React.createElement(c.default.Header,{content:this.props.name}),React.createElement(c.default.Content,null,null==this.props.log?React.createElement("div",{className:"label"},"Sin Especificar"):React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,this.props.log.map(function(e,a){return React.createElement("tr",{key:a},React.createElement("td",null,t," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))))}}]),t}();t.AuthorIconLogEditable=E,E.defaultProps={disableEdit:!1};var R=function(e){function t(){return d(this,t),h(this,b(t).apply(this,arguments))}return v(t,n.Component),f(t,[{key:"render",value:function(){var e=this.props.model,t=e.fecha_completado&&e.fecha_revision&&Date.create(e.fecha_completado)>Date.create(e.fecha_revision)?"Modificado despues de Revisado":null;return React.createElement("div",{className:(0,o.default)("author-icon-log-wrapper",this.props.size,this.props.className)},React.createElement(g,{log:e.UpdateLog,name:"Preparado por",label:"P",iconColor:"green",size:this.props.size}),React.createElement(g,{log:e.RevisionLog,name:"Revisado por",label:"R",iconColor:"olive",size:this.props.size,alertText:t}))}}]),t}();t.AuthorIconLogDefaultWrapper=R},101:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuElementListActions=t.MenuElementListPanel=t.BaseMenuElement=t.BaseMenuItem=void 0;var n=a(1),o=c(a(343)),r=c(a(9)),i=a(688),s=a(344);function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,a){return t&&p(e.prototype,t),a&&p(e,a),e}function m(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){return u(this,t),m(this,f(t).apply(this,arguments))}return h(t,n.PureComponent),d(t,[{key:"render",value:function(){var e=public_path("images/sidebar_right/");return React.createElement("a",{className:(0,r.default)("item badged",!this.props.open||"active"),title:this.props.title,onClick:this.props.onClick},React.createElement("img",{src:"".concat(e).concat(this.props.image,".svg"),className:"ui large image"})," "," ",React.createElement("div",{className:(0,r.default)("ui mini circular floating label right",0==this.props.counter?"green":"red")},this.props.counter))}}]),t}();t.BaseMenuItem=v;var y=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).onToggle=function(){e.props.onToggle(e.props.open?null:e.props.name)},e.onClose=function(t){t.preventDefault(),e.props.onToggle(null)},e}return h(t,n.PureComponent),d(t,[{key:"render",value:function(){return React.createElement(n.Fragment,null,React.createElement(s.DefaultErrorHandler,null,React.createElement(v,{counter:this.props.counter,open:this.props.open,title:this.props.title,image:this.props.icon,onClick:this.onToggle}),this.props.open&&React.createElement(o.default.Group,{animation:"slide right",duration:1500},React.createElement("div",{className:"sidebar-fixed-content ui vertical right fixed menu menu-".concat(this.props.name),style:{right:45}},React.createElement(i.SidebarPanelHeader,{title:this.props.title,onClose:this.onClose,onMount:this.props.onMountPanel}),this.props.children))))}}]),t}();t.BaseMenuElement=y;var g=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).listRef=(0,n.createRef)(),e.listHeight=null,e}return h(t,n.PureComponent),d(t,[{key:"componentDidMount",value:function(){this.listRef.current&&this.calculateHeight()}},{key:"componentDidUpdate",value:function(){this.listRef.current&&!this.listHeight&&this.calculateHeight()}},{key:"calculateHeight",value:function(){var e=$(this.listRef.current);this.listHeight=window.innerHeight-e.position().top-30,e.height(this.listHeight)}},{key:"render",value:function(){return React.createElement("div",{className:"main-list ".concat(this.props.className),ref:this.listRef},this.props.children)}}]),t}();t.MenuElementListPanel=g;t.MenuElementListActions=function(e){return React.createElement("div",{className:"pull-right sf_admin_td_actions"},React.createElement("div",{className:"btn-group dropdown-modern"},React.createElement("a",{className:"btn btn-mini dropdown-toggle","data-toggle":"dropdown",href:"#"},React.createElement("span",{className:"icon-tc-ellipsis-v"})),React.createElement("ul",{className:"dropdown-menu pull-right"},_.map(e.actions,function(e,t){return user_has_role_permission(e.permission)&&React.createElement("li",{key:t},React.createElement("a",{href:"#",onClick:e.callback},e.label))}))))}},122:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusDivBlock=t.StatusButtonGroupActions=t.RevisadoButtonAction=t.CompletadoButtonAction=void 0;var n=a(1),o=s(a(99)),r=s(a(55)),i=s(a(9));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,a){return t&&u(e.prototype,t),a&&u(e,a),e}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return f(t,n.PureComponent),p(t,[{key:"render",value:function(){var e=this.props.disableText;return React.createElement(o.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(r.default,{primary:!0,icon:!0,compact:!0,onClick:this.props.onClick,disabled:null!=e}," ",React.createElement("i",{className:"icon check"})," Completado")),content:e,header:"Marcar como Completado | Opción deshabilitada",disabled:null==e,className:"disable-text",on:"hover"})}}]),t}();t.CompletadoButtonAction=b;var v=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return f(t,n.PureComponent),p(t,[{key:"render",value:function(){var e,t=this.props.disableText;if(null==t&&this.props.record&&!this.props.record.fecha_completado&&(t="Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO."),null!==this.props.showAlert&&void 0!==this.props.showAlert||!this.props.record)e=this.props.showAlert;else{var a=this.props.record;e=a.fecha_completado&&a.fecha_revision&&Date.create(a.fecha_completado)>Date.create(a.fecha_revision)}var n=e?React.createElement(o.default,{trigger:React.createElement("i",{className:"icon warning circle red"}),content:"Ha recibido modificaciones después de su última revisión."}):null;return React.createElement(o.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(r.default,{color:"olive",icon:!0,compact:!0,onClick:this.props.onClick,disabled:null!=t}," ",React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado ",n)),content:t,header:"Marcar como Revisado | Opción deshabilitada",disabled:null==t,className:"disable-text",on:"hover"})}}]),t}();t.RevisadoButtonAction=v;var y=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return f(t,n.PureComponent),p(t,[{key:"render",value:function(){return React.createElement("div",{className:"actions ab-status-actions"},this.props.prepend,user_has_role_permission(this.props.completado.permission)&&React.createElement(b,this.props.completado),user_has_role_permission(this.props.revisado.permission)&&React.createElement(v,this.props.revisado),this.props.append)}}]),t}();t.StatusButtonGroupActions=y;t.StatusDivBlock=function(e){return React.createElement("div",{className:(0,i.default)("lb-status-wrapper",e.wrapperClassName)},!e.hideLabel&&"Estado:",React.createElement("div",{className:(0,i.default)(e.className,"lb-status","lb-status-".concat(_.str.dasherize(e.status.toLowerCase())))},e.status||""))}},177:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),o=p(a(98)),r=a(120),i=p(a(219)),s=p(a(326)),c=p(a(9)),l=p(a(646)),u=a(327);function p(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v={basic:{height:150,toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","TextColor"]}],autoParagraph:!1,removePlugins:"elementspath, uploadfile, uploadfileab, resize",extraPlugins:"openlink"}},y=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=f(this,h(t).call(this,e))).previewRef=(0,n.createRef)(),a.handleEscape=function(e){i.default.getCode(e)===i.default.Escape&&("undefined"!=typeof CKEDITOR&&null!=CKEDITOR.dialog.getCurrent()||a.onClose())},a.onChange=function(e){a.props.inline&&a.props.onSave(e.editor,!1,!1),a._cachedEditor||(a._cachedEditor=e.editor),a.props.autosave&&(a.autosaveId||(a.autosaveId=setTimeout(a.autosave,1e3*t.AUTOSAVE_DELAY)))},a.onClickEdit=function(e){e.preventDefault(),a.setState({isModalEditOpen:!0,isLoading:!0})},a.onSave=function(){a.autosaveId&&(clearTimeout(a.autosaveId),a.autosaveId=null),$.isFunction(a.props.onSave)?(a.props.onSave(a.getEditor(),!0,!1,function(){a.setState({isAutosaving:!1}),a.fetchAttachments()}),a.setState({isModalEditOpen:!1})):(a.setState({isModalEditOpen:!1,isAutosaving:!1}),a.fetchAttachments())},a.onCancel=function(){a.setState({isModalEditOpen:!1}),$.isFunction(a.props.onClose)&&a.props.onClose()},a.onClose=function(){a.autosaveId&&(clearInterval(a.autosaveId),a.autosaveId=null),a.setState({isModalEditOpen:!1}),$.isFunction(a.props.onClose)&&a.props.onClose()},a.onModalMount=function(){r.instance.sub("keydown",a.handleEscape,{pool:"default"}),null==a.state.attachments&&a.fetchAttachments()},a.autosave=function(){a.setState({isAutosaving:!0});var e=a.getEditor();null!=e&&(a.props.onSave(e,!1,!0,function(){return a.setState({isAutosaving:!1})}),a.fetchAttachments()),a.autosaveId&&(clearInterval(a.autosaveId),a.autosaveId=null)},a.onClickPreview=function(e){a.props.onClickPreview&&a.props.onClickPreview(e),a.props.openOnClickPreview&&a.setState({isModalEditOpen:!0})},a.onUpdateAttachment=function(){a.fetchAttachments()},a.onDeleteAttachment=function(e,t){a.setState({isLoadingAttachments:!0});var n=(0,u.cleanAttachmentFrom)(a.props.data,e);$.isFunction(t)&&t();var o=a.getEditor();o&&(o.setData(n),a.autosave())},a.state={isModalEditOpen:a.props.open,isAutosaving:!1,isLoading:!0,attachments:null,isLoadingAttachments:!1},a}var a,p,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,n.PureComponent),a=t,(p=[{key:"getEditor",value:function(){return null!=this.ckeditorComp?this.ckeditorComp.editor:this._cachedEditor?this._cachedEditor:null}},{key:"assertRequired",value:function(){if(!this.props.editable)return!1;if(!this.props.required)return!1;var e=this.getEditor();return""==_.trim(e.getData())&&(bootbox.alert("Esta campo es requerido, por lo tanto no puede quedar vacío."),!0)}},{key:"componentWillReceiveProps",value:function(e){e.open&&!this.state.isModalEditOpen&&this.setState({isModalEditOpen:!0})}},{key:"componentDidMount",value:function(){$(this.previewRef.current).find("a[href]").each(function(){$(this).attr("target","_blank")})}},{key:"parseCkeditorOptions",value:function(){var e=this.props.ckeditorOptions;if("string"==typeof e&&(e=v[e]),void 0!==this.props.ckeditorUploadOptions){var t="proyecto/"+app.vars.idproyecto+"/adjunto/upload",a=this.props.ckeditorUploadOptions,n=a.url,o=void 0===n?t:n,r=a.model,i=a.modelId;null==i?e.removePlugins="elementspath,uploadimage,uploadfile,uploadfileab":(e.uploadUrl=url_for("".concat(o,"?model=").concat(r,"&model_id=").concat(i)),e.imageUploadUrl=url_for("".concat(o,"?model=").concat(r,"&model_id=").concat(i)),e.filebrowserUploadUrl=url_for("".concat(o,"?model=").concat(r,"&model_id=").concat(i,"&n=attachment")))}return e}},{key:"fetchAttachments",value:function(){var e=this;if(void 0!==this.props.ckeditorUploadOptions){var t=this.props.ckeditorUploadOptions,a=t.model,n=t.modelId;this.setState({isLoadingAttachments:!0}),$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/adjunto/json")),{model:a,model_id:n}).done(function(t){e.setState({attachments:t.response,isLoadingAttachments:!1})})}}},{key:"getCkeditorOptions",value:function(){var e=this,t=Object.assign({height:200,toolbar:[{name:"clipboard",items:["Cut","Copy","Paste","-","Undo","Redo"]},{name:"links",items:["Link","pasolink","muestreolink","Attachments"]},{name:"insert",items:["Table","SpecialChar"]},{name:"tools",items:["Maximize"]},{name:"basicstyles",items:["Bold","Italic","Underline"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","TextColor"]},{name:"styles",items:["Styles","Format"]}],autoParagraph:!1,enterMode:CKEDITOR.ENTER_BR,removePlugins:"elementspath",extraPlugins:"uploadimage,pastebase64,uploadfileab,openlink,attach,justify,colorbutton,pastefromexcel,colordialog,pasolink",openlink_modifier:0,onAttachmentUpload:function(t,a){t=t.replace("<pre>","").replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"").replace("</pre>","");var n=JSON.parse(t);console.log(n),_.forEach(n,function(e){e.uploaded?a.insertHtml("<a href='"+e.url+"' target='_blank' class='proyecto-attachment' >"+e.fileName+"</a><br> "):alert(e.error)}),CKEDITOR.dialog.getCurrent().hide(),e.props.onUpload&&e.props.onUpload(),e.fetchAttachments();var o=e.getEditor();o&&e.props.onSave(o,!1,!1)}},this.parseCkeditorOptions());return t.on=Object.assign({fileUploadRequest:function(e){var t=e.data.fileLoader;t.on("abort",function(){$.unblockUI()}),t.on("error",function(){console.log(t),$.unblockUI()}),$.blockUI({message:'<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">Cargando archivo al servidor.<br> Por favor Espere ...</h3>'})},fileUploadResponse:function(){$.unblockUI(),this.fire("change")},paste:function(e){e.data.dataValue=e.data.dataValue.replace(/(min-)?width:.+?;/g,"")}},t.on||{}),t}},{key:"renderFooter",value:function(){var e=this.props.footer;return"AttachmentList"===e?React.createElement(u.AttachmentListPanel,{isLoading:this.state.isLoadingAttachments,attachments:this.state.attachments,onUpdateItem:this.onUpdateAttachment,onDeleteItem:this.onDeleteAttachment}):e}},{key:"renderModal",value:function(){if(this.state.isModalEditOpen){var e=(0,c.default)(["editor-preview-modal",!!this.props.className&&this.props.className+"-modal"]);return React.createElement(o.default,{className:e,open:!0,closeIcon:!0,closeOnDimmerClick:!1,dimmer:"inverted",onClose:this.onClose,closeOnEscape:!1,onMount:this.onModalMount,size:"large"},React.createElement(o.default.Content,null,this.renderEditor()),this.props.editable?React.createElement(o.default.Actions,null,this.props.leftActions,React.createElement("button",{className:"ui button negative",onClick:this.onCancel},"Cancelar"),React.createElement("button",{className:"ui button primary",onClick:this.onSave},"Guardar")):React.createElement(o.default.Actions,null,this.props.leftActions,React.createElement("button",{className:"ui button negative",onClick:this.onCancel},"Cerrar")))}}},{key:"renderEditor",value:function(){var e,t=this;return(this.props.label||this.props.labelTitle)&&(e='<div class="editor-label"> <strong class="editor-label-title">'+(this.props.labelTitle||"")+"</strong> "+(this.props.label||"")+" </div>"),React.createElement(n.Fragment,null,e&&React.createElement("div",{dangerouslySetInnerHTML:{__html:e}}),React.createElement("div",{style:{minHeight:"200px"}},React.createElement("div",{className:"loading"},React.createElement("div",{className:this.state.isAutosaving?"":"ui-helper-hidden"},React.createElement("span",{className:"ajax-loader-snake"})," Guardando...")),React.createElement("div",{className:(0,c.default)("ui dimmer inverted",{active:this.state.isLoading})},React.createElement("div",{className:"ui loader"},"Cargando...")),React.createElement(s.default,{ref:function(e){return t.ckeditorComp=e},data:this.props.data,config:this.getCkeditorOptions(),onChange:this.onChange,onInstanceReady:function(){return t.setState({isLoading:!1})},readOnly:!this.props.editable})),this.renderFooter())}},{key:"render",value:function(){if(this.props.inline)return React.createElement("div",{className:"editor-inline"}," ",this.renderEditor());var e=null==this.props.preview?this.props.data||"":this.props.preview,t=(0,c.default)(["editor-preview",this.props.className,e?"text-non-empty":"text-empty"]);return this.props.prefixPreview&&(e='<strong class="editor-preview-title" >'+this.props.prefixPreview+"</strong> "+e),e=e.replace(/(min-)?width:.+?;/g,""),React.createElement(n.Fragment,null,React.createElement("div",{className:(0,c.default)("editor-preview-wrapper",this.props.wrapperClassName),onClick:this.onClickPreview},React.createElement("div",{ref:this.previewRef,className:t,dangerouslySetInnerHTML:{__html:e},style:this.props.previewStyle}),this.props.editable&&React.createElement("div",{className:"action-list"},React.createElement(l.default,{onClick:this.onClickEdit}))),this.renderModal())}}])&&m(a.prototype,p),d&&m(a,d),t}();t.default=y,y.AUTOSAVE_DELAY=60,y.defaultProps={open:!1,autosave:!1,required:!1,editable:!0,openOnClickPreview:!0,ckeditorOptions:{}}},180:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,a(1).createContext)({hoja_trabajo:null,update:function(e){}});t.default=n},181:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemNewHeader=t.MenuItemNew=void 0;var n,o=a(1),r=(n=a(98))&&n.__esModule?n:{default:n},i=a(100);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=l(this,u(t).apply(this,arguments))).state={modalOpen:!1},e.onClick=function(){e.setState({modalOpen:!0})},e.onCloseModal=function(){e.setState({modalOpen:!1})},e.onSave=function(t){e.props.onSave(t).then(function(){e.onCloseModal()})},e}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,o.PureComponent),a=t,(n=[{key:"render",value:function(){if(this.props.isEditable){var e=this.props.contentAs;return React.createElement("div",{className:"_a-center"},React.createElement("button",{className:"button ui right tiny compact plain green rounded",onClick:this.onClick},this.props.buttonText," ",React.createElement("i",{className:"icon plus"})),this.state.modalOpen&&React.createElement(r.default,{open:!0,dimmer:"inverted",className:"modal-ab modal-sidebarmenuitem",size:"large",closeIcon:!0,closeOnDimmerClick:!1,closeOnEscape:!1,onClose:this.onCloseModal},React.createElement(r.default.Header,null,this.props.headerText),React.createElement(e,{onSave:this.onSave,moduleParams:this.props.moduleParams,isEditable:this.props.isEditable,item:this.props.item})))}}}])&&c(a.prototype,n),i&&c(a,i),t}();t.MenuItemNew=d;t.MenuItemNewHeader=function(e){var t=e.item.status||"EN PROCESO";return React.createElement("div",{className:"ui grid padded",style:{marginBottom:0}},React.createElement("div",{className:"row",style:{paddingTop:0}},React.createElement("div",{className:"column four wide"},React.createElement("strong",{style:{fontWeight:600}},e.item.label)),React.createElement("div",{className:"column four wide"},React.createElement("span",null,"Estado: "),React.createElement("div",{className:"lb-status-wrapper"},React.createElement("div",{className:"lb-status lb-status-".concat(_.str.dasherize(t.toLowerCase()))},t))),React.createElement("div",{className:"column four wide"},React.createElement(i.AuthorIconLogDefaultWrapper,{model:e.item}))))}},229:function(e,t,a){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoUtils=void 0,t.HallazgoUtils=n,function(e){e.formatName=function(e){return(""+e).match(/^\d+$/)?"Hallazgo #"+e:e}}(n||(t.HallazgoUtils=n={}))},25:function(e,t){e.exports=ReactDOM},286:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=m(a(55)),o=m(a(317)),r=m(a(594)),i=m(a(321)),s=m(a(602)),c=a(333),l=m(a(682)),u=m(a(683)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};n.get||n.set?Object.defineProperty(t,a,n):t[a]=e[a]}return t.default=e,t}(a(726)),d=a(344);function m(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=b(this,v(t).call(this,e))).onClickAddInstruccion=function(){a.props.visita.instructions.push({local_id:p.v1(),category:null,description:null,Attachments:[],is_done:!1,Visita:a.props.visita,updated_at:null}),a.props.visita.updated_at=Date.create().format("{year}-{MM}-{dd} {hh}:{mm}:{ss}"),a.recalculateProgress(),a.props.isEditable&&a.isAllowedSortInstructions()&&user_has_role_permission("instruccion_edit")&&setTimeout(function(){$("#table-visita-instrucciones-".concat(a.props.visita.id)).tableDnDUpdate()},300)},a.onUpdateInstruccion=function(e,t){a.props.visita.instructions[t]=e,a.recalculateProgress()},a.onRemoveInstruccion=function(e){a.props.visita.instructions=a.props.visita.instructions.filter(function(t,a){return a!==e}),a.recalculateProgress(),$("#table-visita-instrucciones-".concat(a.props.visita.id," tbody tr")).each(function(e){$(this).find(".instruction-iteration").text(_.padLeft(""+(e+1),3,"0")+".")})},a.state={progress:a.calculateProgress(),id_status:""+e.visita.id_status,openAsignarUsuarioModal:!1},a}var a,m,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,l["default"]),a=t,(m=[{key:"componentDidMount",value:function(){var e=this,t=$("#table-visita-instrucciones-".concat(this.props.visita.id));t.floatThead(),this.props.isEditable&&this.isAllowedAddInstructions()&&user_has_role_permission("instruccion_edit")&&t.tableDnD({dragHandle:".sort-handler",onDragClass:"dragging",onDragStop:function(t){for(var a=[],n=t.rows,o=1;o<n.length;o++){var r=n[o].id.substr(18);a.push(r),$(n[o]).find(".instruction-iteration").text(_.padLeft(""+o,3,"0")+".")}var i=url_for("proyecto/".concat(e.props.visita.HojaTrabajo.proyecto.id,"/master_data/instruccion/sort"));$.ajax(i,{type:"POST",data:{sort:a,id_paso:e.props.visita.HojaTrabajo.paso.id,id_visita:e.props.visita.id_visita},dataType:"json"})}})}},{key:"componentWillUnmount",value:function(){$("#table-visita-instrucciones-".concat(this.props.visita.id)).floatThead("destroy")}},{key:"componentDidUpdate",value:function(){var e=$("#table-visita-instrucciones-".concat(this.props.visita.id));setTimeout(function(){e.floatThead("reflow")},1e3)}},{key:"calculateProgress",value:function(){var e=this.props.visita.instructions.filter(function(e){return e.is_done}).length;return 0==this.props.visita.instructions.length?0:Math.round(100*e/this.props.visita.instructions.length)}},{key:"isAllowedAddInstructions",value:function(){return!_.includes(["2A4","2A3"],this.props.visita.HojaTrabajo.paso.code)}},{key:"isAllowedSortInstructions",value:function(){return!_.includes(["2A4","2A3"],this.props.visita.HojaTrabajo.paso.code)}},{key:"recalculateProgress",value:function(){var e=this.calculateProgress();this.setState({progress:e})}},{key:"getCompletadoDisabledText",value:function(){return this.state.progress<100?"Para completar esta hoja de trabajo, es necesario que TODAS las instrucciones estén atendidas.":null}},{key:"render",value:function(){var e=this.props,t=e.active,a=e.visita,s={_ajustes:"PERIODO"!=this.props.type,_history:"PERIODO"!=this.props.type,instructions_add:this.props.isEditable&&this.isAllowedAddInstructions()&&user_has_role_permission("instruccion_create")?{link:!0,icon:{name:"plus",size:"large"},title:"Añadir Instrucción",onClick:this.onClickAddInstruccion}:null};return React.createElement(o.default.Pane,{active:t},React.createElement("div",{className:"visita-progress-container"},React.createElement(r.default,{className:"visita-progress",size:"tiny",color:"green",percent:this.state.progress}),React.createElement("div",{className:"visita-progress-label"},"".concat(this.state.progress,"%"))),React.createElement(d.DefaultErrorHandler,null,React.createElement(u.default,{visita:a,actionItems:s})),React.createElement(c.PasoObjetivoPane,{isEditable:this.props.isEditable}),React.createElement(i.default,{stackable:!0,className:"table-visita-instrucciones",id:"table-visita-instrucciones-".concat(a.id)},React.createElement(i.default.Header,null,React.createElement(i.default.Row,null,React.createElement(i.default.HeaderCell,{className:"th-instruccion",colSpan:"2"},"Instrucciones"),React.createElement(i.default.HeaderCell,{className:"th-accion"},"Acción"),React.createElement(i.default.HeaderCell,{className:"th-observaciones"},"Observaciones/Evidencia"),React.createElement(i.default.HeaderCell,{className:"th-adjuntos"},"Adjuntos"),React.createElement(i.default.HeaderCell,{className:"th-actions computer"}," "))),React.createElement(i.default.Body,null,this.renderInstrucciones(a))),React.createElement("div",null,_.size(a.instructions)>0&&this.props.isEditable&&this.isAllowedAddInstructions()&&user_has_role_permission("instruccion_create")&&React.createElement("div",{className:"ab-actions-group compact-actions"},React.createElement(n.default,{primary:!0,floated:"left",compact:!0,icon:"plus",content:"Añadir Instrucción",onClick:this.onClickAddInstruccion})),_.size(a.instructions)>0&&this.renderStatusActions()))}},{key:"renderInstrucciones",value:function(e){var t=this;if(0==_.size(e.instructions))return React.createElement(i.default.Row,null,React.createElement(i.default.Cell,{colSpan:"6",style:{textAlign:"center"}},React.createElement("div",{className:"alert alert-block nocontent"},React.createElement("h3",null,"Sin instrucciones "),React.createElement("p",null,React.createElement("span",{className:"icon-warning-sign"}),"Esta hoja de trabajo aún no tiene instrucciones registradas."," "),this.props.isEditable&&user_has_role_permission("instruccion_create")&&[React.createElement(n.default,{key:"button",content:"Agregar instrucción",color:"green",compact:!0,icon:"info circle",onClick:this.onClickAddInstruccion,style:{marginTop:"30px"}})])));var a=_.map(e.instructions,function(e,t){return e.index=t,e}),o=_.values(_.map(_.groupBy(a,"category"),function(e,t){return{text:t,instructions:e}})),r=[];return o.forEach(function(a,n){""!=a.text&&"null"!=a.text&&null!=a.text&&r.push(React.createElement("tr",{key:n,className:"macroinstruccion-row nodrag nodrop"},React.createElement("td",{colSpan:6},a.text))),a.instructions.forEach(function(a,n){a.Visita=e,r.push(React.createElement(s.default,{key:a.local_id,index:a.index,iteration:n,instruccion:a,isEditable:t.props.isEditable,isSortable:t.props.isEditable&&t.isAllowedSortInstructions(),onUpdate:t.onUpdateInstruccion,onRemove:t.onRemoveInstruccion,onUpdateVisita:t.onUpdate}))})}),r}}])&&h(a.prototype,m),f&&h(a,f),t}();t.default=g},327:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanAttachmentFrom=function(e,t){var a=public_path("uploads/proyecto_adjunto/".concat(t.filepath),!0).replace(/\./g,".").replace(/\\/g,"/"),n=new RegExp('<a .*href="'+a+'"(.+?)/a>\\s*(<br\\s?/?>)?',"g");return e.replace(n,"")},t.AttachmentListPanel=t.AttachmentListItem=void 0;var n=a(1),o=u(a(39)),r=u(a(75)),i=u(a(647)),s=u(a(179)),c=u(a(217)),l=u(a(222));function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,a){return t&&m(e.prototype,t),a&&m(e,a),e}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e;return d(this,t),(e=h(this,b(t).apply(this,arguments))).onRemove=function(t){t.preventDefault();var a=url_for("proyecto/".concat(e.props.attachment.id_proyecto,"/adjunto/").concat(e.props.attachment.id,"/remove"));bootbox.warningConfirm("¿Esta seguro de querer borrar este archivo?<br><br>Tenga en cuenta que el sistema intentará borrar automáticamente los enlaces existentes a este archivo.","Cancelar","Aceptar",function(t){t&&($.blockUI({message:'<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">Borrando archivo.<br> Por favor Espere ...</h3>'}),$.ajax(a,{type:"POST",data:{},dataType:"json"}).done(function(){e.props.onDelete(e.props.attachment,function(){return $.unblockUI()})}).fail(function(){$.pnotify({text:"El archivo no pudo ser borrado.",type:"error"}),$.unblockUI()}))})},e}return v(t,n.Component),f(t,[{key:"changeStatus",value:function(e,t){var a=this;e.preventDefault();var n=url_for("proyecto/".concat(this.props.attachment.id_proyecto,"/adjunto/").concat(this.props.attachment.id,"/").concat(t));$.blockUI({message:'<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">Marcando archivo como '+_.str.capitalize(t)+".<br> Por favor Espere ...</h3>"}),$.ajax(n,{type:"POST",data:{},dataType:"json"}).done(function(e){a.props.onUpdate(e.response.record),$.unblockUI()}).fail(function(){$.pnotify({text:"El archivo no pudo ser actualizado.",type:"error"}),$.unblockUI()})}},{key:"render",value:function(){var e,a,n,r=this,i=this.props.attachment;return i.fecha_completado&&(e=React.createElement("div",{style:{display:"inline-block"}},React.createElement("strong",{className:"title"},"(P) "),React.createElement("div",{style:{display:"inline-block",minWidth:20,textAlign:"center",marginRight:2},title:"Preparado por: ".concat(i.UpdateLog[0].User.name)},i.UpdateLog[0].User.sigla," "),React.createElement("div",{style:{display:"inline-block"},title:i.fecha_completado},React.createElement("span",{className:"icon-moon-calendar"})," ",Date.create(i.fecha_completado).format("{year}-{MM}-{dd}")))),i.fecha_revisado&&(a=React.createElement("div",{style:{display:"inline-block"}},React.createElement("strong",{className:"title"},"(R) "),React.createElement("div",{style:{display:"inline-block",minWidth:20,textAlign:"center",marginRight:2},title:"Revisado por: ".concat(i.RevisionLog[0].User.name)},i.RevisionLog[0].User.sigla," "),React.createElement("div",{style:{display:"inline-block"},title:i.fecha_revisado},React.createElement("span",{className:"icon-moon-calendar"})," ",Date.create(i.fecha_revisado).format("{year}-{MM}-{dd}")))),user_has_role(["PM","SR"])&&(n=i.fecha_completado?React.createElement("button",{style:{marginLeft:"8px"},onClick:function(e){return r.changeStatus(e,"revisado")},className:"act"},React.createElement("span",{className:"icon-moon-checkmark-8"})," Revisar"):React.createElement(s.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{style:{marginLeft:"8px"},className:"act disabled"},React.createElement("span",{className:"icon-moon-checkmark-8"})," Revisar")),content:"Esta archivo adjunto debe estar primero en estado COMPLETADO, para poder ser marcado como REVISADO",header:"Marcar como Revisado | Opción deshabilitada",className:"disable-text",on:"hover"})),React.createElement("li",{key:i.id,style:{marginBottom:2}},React.createElement("div",{style:{background:"#f5f9f8",borderRadius:6,border:"1px solid #aecec7"}},React.createElement("div",{className:"col-md-1",style:{marginTop:5,borderRight:"1px inset #d7e1e2"}},React.createElement("img",{src:t.getFileIconUrl(i.filename),alt:"Icono"})),React.createElement("div",{className:"col-md-11",style:{padding:"3px 10px"}},React.createElement("div",{className:"noqtip",title:i.filename,style:{fontWeight:"bold",fontSize:"12px",maxWidth:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},i.filename),React.createElement("div",{style:{fontSize:"12px"}},React.createElement("span",{style:{fontStyle:"italic"},className:"noqtip",title:"Peso del archivo: ".concat(i.filesize_human)},i.filesize_human)," ","|",React.createElement("div",{className:"attachment-actionsbar"},React.createElement("div",{className:"section-a"},React.createElement("a",{href:public_path("uploads/proyecto_adjunto/".concat(i.filepath)),target:"_blank",className:"act",style:{color:"#777"}},React.createElement("span",{className:"icon-moon-download",style:{fontSize:"10px"}})," Descargar")),user_has_role(["PM","SR","JR"])&&React.createElement("div",{className:"section-a"},React.createElement("a",{href:"#",className:"act",onClick:this.onRemove},React.createElement("span",{className:"icon-tc-trash"})," Borrar")),React.createElement("div",{className:"section-a",style:{minWidth:90}},i.fecha_completado?React.createElement(s.default,{trigger:e,position:"bottom center"},React.createElement(s.default.Header,{content:"Preparado por"}),React.createElement(s.default.Content,null,React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,i.UpdateLog.map(function(e,t){return React.createElement("tr",{key:t},React.createElement("td",null,React.createElement(o.default,{name:"user circle",color:"green"})," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))):user_has_role(["PM","SR","JR"])&&React.createElement("button",{style:{marginLeft:"8px"},onClick:function(e){return r.changeStatus(e,"completado")},className:"act"},React.createElement("span",{className:"icon-moon-checkmark-8"})," Completar")),React.createElement("div",{className:"section-a"},i.fecha_revisado&&React.createElement(s.default,{trigger:a,position:"bottom center"},React.createElement(s.default.Header,{content:"Revisado por"}),React.createElement(s.default.Content,null,React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,i.RevisionLog.map(function(e,t){return React.createElement("tr",{key:t},React.createElement("td",null,React.createElement(o.default,{name:"user circle",color:"olive"})," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))),n))),React.createElement("div",null)),React.createElement("div",{className:"clearfix"})))}}],[{key:"getFileExtension",value:function(e){return e.split(".").pop()}},{key:"getFileIconUrl",value:function(e){var a=t.getFileExtension(e);return public_path("images/file_icons/".concat(function(){switch(a){case"xls":case"xlsx":case"xlsm":case"xlsxm":return"excel";case"doc":case"docx":return"word";case"pdf":return"pdf";case"png":case"jpg":case"jpeg":case"bmp":case"gif":return"image";case"zip":case"rar":return"zip";default:return"default"}}(),".png"))}}]),t}();t.AttachmentListItem=g;var E=function(e){function t(){return d(this,t),h(this,b(t).apply(this,arguments))}return v(t,n.Component),f(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.isLoading,n=t.attachments;return React.createElement("div",{className:"attachment-list-panel dimmable",style:{minHeight:40}},a&&React.createElement(c.default,{inverted:!0,active:!0},React.createElement(l.default,{inverted:!0,active:!0,className:"elastic grey"})),React.createElement("h3",{className:"panel-title"},"Adjuntos:",React.createElement(r.default,{circular:!0,color:"green"},_.size(n))),_.size(n)>0&&React.createElement(i.default,{divided:!0,className:"attachment-list"},_.map(n,function(t,a){return React.createElement(g,{key:t.id,attachment:t,onUpdate:e.props.onUpdateItem,onDelete:e.props.onDeleteItem})})))}}]),t}();t.AttachmentListPanel=E,E.defaultProps={isLoading:!1}},333:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasoVisitaAssoc=t.PasoVisitaStatusActions=t.PasoObjetivoPane=t.AppVisitaDefaultTab=void 0;var n=a(1),o=v(a(75)),r=v(a(99)),i=v(a(55)),s=v(a(64)),c=v(a(98)),l=v(a(177)),u=a(100),p=v(a(180)),d=a(334),m=v(a(335)),f=v(a(336)),h=v(a(337)),b=v(a(341));function v(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t,a){return t&&E(e.prototype,t),a&&E(e,a),e}function j(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=function(e){function t(){return g(this,t),j(this,C(t).apply(this,arguments))}return O(t,n.Component),R(t,[{key:"getStatusLabel",value:function(){var e=this.props.visita,t=null;return e.status&&(t=React.createElement(o.default,{style:{backgroundColor:e.status_color},className:"visita-status visita-status-".concat(_.str.underscored(e.status)),size:"mini"},e.status)),t}},{key:"render",value:function(){var e=this.props.visita;return React.createElement(n.Fragment,null,React.createElement("span",{className:"tabname",title:e.label},e.label),React.createElement(u.AuthorIconLogDefaultWrapper,{model:e}),this.getStatusLabel())}}]),t}();t.AppVisitaDefaultTab=S;var w=function(e){function t(){var e;return g(this,t),(e=j(this,C(t).apply(this,arguments))).onChangeValue=function(t){var a=t.getData(),n=e.context,o=n.hoja_trabajo,r=n.update;$.blockUI(create_blockUI_loading_message("Guardando Cambios"));var i=url_for("proyecto/".concat(o.proyecto.id,"/master_data/paso/").concat(o.paso.id,"/objetivo"));$.ajax(i,{type:"POST",data:{objetivo:a},dataType:"json"}).done(function(){var e=d.HojaTrabajoUpdateUtils.updateField(o,"paso",{objetivo:a});r(e),$.unblockUI()})},e}return O(t,n.Component),R(t,[{key:"render",value:function(){var e=this.context.hoja_trabajo;return React.createElement("div",{className:"hoja-trabajo-objetivo hoverable-actions"},React.createElement(l.default,{className:"objetivo-text-editor",ckeditorOptions:{height:150,toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","TextColor"]}],autoParagraph:!1,removePlugins:"elementspath, uploadfile, resize",extraPlugins:"openlink"},prefixPreview:"Objetivo:",label:" ",labelTitle:"Objetivo: ",data:e.paso.objetivo,editable:this.props.isEditable&&user_has_role_permission("paso_objetivo_edit"),onSave:this.onChangeValue}))}}]),t}();t.PasoObjetivoPane=w,w.contextType=p.default,w.defaultProps={isEditable:!1};var N=function(e){function t(){var e;return g(this,t),(e=j(this,C(t).apply(this,arguments))).onClickCompletado=function(){var t=e.context.hoja_trabajo,a=url_for("proyecto/".concat(t.proyecto.id,"/hoja-trabajo/paso/").concat(t.paso.id,"/visita/").concat(e.props.visita.id_visita,"/save"));$.blockUI(create_blockUI_loading_message("Marcando como Completado...")),$.ajax(a,{type:"POST",data:{op:"c"},dataType:"json"}).done(function(t){t.hasErrors?($.unblockUI(),bootbox.alert(t.message)):(e.updateVisita(t.response.record),$.unblockUI())})},e.onClickRevisado=function(){var t=e.context.hoja_trabajo,a=url_for("proyecto/".concat(t.proyecto.id,"/hoja-trabajo/paso/").concat(t.paso.id,"/visita/").concat(e.props.visita.id_visita,"/save"));$.blockUI(create_blockUI_loading_message("Marcando como Revisado...")),$.ajax(a,{type:"POST",data:{op:"r"},dataType:"json"}).done(function(t){t.hasErrors?($.unblockUI(),bootbox.alert(t.message)):(e.updateVisita(t.response.record),$.unblockUI())})},e}return O(t,n.Component),R(t,[{key:"getRevisadoDisabledText",value:function(){return _.include(["1","2","3"],this.props.visita.id_status)||this.props.completadoDisabledText?"Esta visita debe estar primero en estado COMPLETADO, para poder marcar esta hoja de trabajo como REVISADA.":_.include(["6"],this.props.visita.id_status)?"Esta visita  tiene Notas de Revisión que deben primero ser atendidas para poder marcar esta hoja de trabajo como REVISADA.":this.props.visita.additionals.revisiones>0?"Esta visita tiene Notas de Revisión pendientes por revisar que deben primero ser revisadas para poder marcar esta hoja de trabajo como REVISADA.":this.props.revisadoDisabledText}},{key:"updateVisita",value:function(e){var t=this.context,a=t.hoja_trabajo;(0,t.update)(d.HojaTrabajoUpdateUtils.updateVisita(a,this.props.visita,e))}},{key:"render",value:function(){var e,t=this.props.visita,a=this.getRevisadoDisabledText();return t.fecha_revision&&(t.fecha_completado&&Date.create(t.fecha_completado)>Date.create(t.fecha_revision)||!_.includes(["5","6"],""+t.id_status))&&(e=React.createElement(r.default,{trigger:React.createElement(s.default,{color:"red",name:"warning circle"}),content:"Esta visita ha recibido modificaciones después de su última revisión."})),React.createElement("div",{className:"actions ab-status-actions"},user_has_role_permission("paso_completado")&&React.createElement(r.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(i.default,{primary:!0,icon:!0,compact:!0,onClick:this.onClickCompletado,disabled:null!=this.props.completadoDisabledText}," ",React.createElement(s.default,{name:"check"})," Completado")),content:this.props.completadoDisabledText,header:"Marcar como Completado | Opción deshabilitada",disabled:null==this.props.completadoDisabledText,className:"disable-text",on:"hover"}),user_has_role_permission(["paso_revisado"])&&React.createElement(r.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(i.default,{color:"olive",icon:!0,compact:!0,onClick:this.onClickRevisado,disabled:null!=a}," ",React.createElement(s.default,{name:"check",fitted:!0}),React.createElement(s.default,{name:"check"})," Revisado ",e)),content:a,header:"Marcar como Revisado | Opción deshabilitada",disabled:null==a,className:"disable-text",on:"hover",position:"top right"}))}}]),t}();t.PasoVisitaStatusActions=N,N.contextType=p.default;var P=function(e){function t(e){var a;return g(this,t),(a=j(this,C(t).call(this,e))).state={open:!1,newVisitaOpen:!1,selectedVisitas:_.filter(_.map(a.props.hoja_trabajo.visitas,function(e,t){return e.id?t:null}))},a}return O(t,n.Component),R(t,[{key:"getModal",value:function(){var e=this;if(!this.state.open)return null;var t={moveLeft:React.createElement("i",{className:"icon angle left"}),moveAllLeft:React.createElement("i",{className:"icon angle double left"}),moveRight:React.createElement("i",{className:"icon angle right"}),moveAllRight:React.createElement("i",{className:"icon angle double right"}),moveDown:React.createElement("i",{className:"icon angle down"}),moveUp:React.createElement("i",{className:"icon angle up"})},a=this.props.hoja_trabajo,n=a.visitas,o=[];_.forEach(n,function(e,t){o.push({value:t,label:e.label})});var r=function(){e.setState({open:!1})};return React.createElement(c.default,{key:"modal-assoc",open:!0,closeIcon:!0,dimmer:"inverted",size:"small",onClose:r,className:"modal-ab"},React.createElement(c.default.Header,null," Asociación de Visitas a este Paso"),React.createElement(c.default.Content,null,React.createElement("form",{method:"post",className:"ui form",action:url_for("proyecto/".concat(a.proyecto.id,"/hoja-trabajo/paso/").concat(a.paso.id,"/visita"))},React.createElement("div",{style:{marginBottom:"15px"}},"Asocie las visitas a relacionar con este paso: ")," ",React.createElement("br",null),React.createElement(m.default,{name:"visitas",options:o,availableLabel:"Por asociar",selectedLabel:"Asociadas",selected:this.state.selectedVisitas,icons:t,onChange:function(t){e.setState({selectedVisitas:t})}}),React.createElement(f.default,{horizontal:!0},"O"),React.createElement(h.default,null,React.createElement(h.default.Title,{active:this.state.newVisitaOpen,onClick:function(){e.setState(function(e){return{newVisitaOpen:!e.newVisitaOpen}})}},React.createElement(s.default,{name:"caret right"})," Crear Nueva Visita"),React.createElement(h.default.Content,{active:this.state.newVisitaOpen},React.createElement(b.default.Field,{inline:!0},React.createElement("label",null,"Nombre de la visita"),React.createElement("div",{className:"ui input"},React.createElement("input",{placeholder:"Nombre de la visita",name:"visita_name",type:"text"}))))),React.createElement("button",{className:"primary small ui button right floated"},"Guardar"),React.createElement("button",{className:"negative small ui button right floated",type:"button",onClick:r},"Cancelar"),React.createElement("div",{className:"clearfix"}))))}},{key:"render",value:function(){var e=this;return[React.createElement("div",{key:"trigger",onClick:function(){return e.setState({open:!0})}},this.props.trigger),this.getModal()]}}]),t}();t.PasoVisitaAssoc=P},334:function(e,t,a){"use strict";var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.HojaTrabajoUpdateUtils=t.HojaTrabajoUtils=void 0,t.HojaTrabajoUtils=n,function(e){e.getAllVisitasAfter=function(e,t){var a=[],n=!1;return _.forEach(e.visitas,function(e){n?a.push(e):e.id==t.id&&(n=!0)}),a}}(n||(t.HojaTrabajoUtils=n={})),t.HojaTrabajoUpdateUtils=o,function(e){function t(e,t,a){var n=Object.assign({},e);return n.visitas=_.mapValues(n.visitas,function(e){return e.id==t.id&&(e=Object.assign({},e,a)),e}),n}e.updateVisita=t,e.updateVisitas=function(e,a){return _.forEach(a,function(a,n){var o=_.findWhere(e.visitas,{id_visita:n});e=t(e,o,a)}),e},e.updateField=function(e,t,a){var n=Object.assign({},e);return n[t]=Object.assign({},n[t],a),n}}(o||(t.HojaTrabajoUpdateUtils=o={}))},344:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultErrorHandler=void 0;var n=a(1);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=i(this,s(t).apply(this,arguments))).state={hasError:!1},e}var a,o,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n.Component),a=t,l=[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}],(o=[{key:"componentDidCatch",value:function(e,t){this.isLocalhost()&&alert("ERROR: "+e.message)}},{key:"isLocalhost",value:function(){return"auditbrain.local"===window.location.host}},{key:"render",value:function(){return this.state.hasError?this.props.errorMessage:this.props.children}}])&&r(a.prototype,o),l&&r(a,l),t}();t.DefaultErrorHandler=l,l.defaultProps={errorMessage:null}},345:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AjusteModal=void 0;var n=a(1),o=a(181),r=f(a(177)),i=f(a(689)),s=f(a(347)),c=f(a(691)),l=a(348),u=f(a(179)),p=a(122),d=f(a(9)),m=a(695);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,a){return t&&y(e.prototype,t),a&&y(e,a),e}function E(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=function(e){function t(e){var a;return v(this,t),(a=E(this,R(t).call(this,e))).onChangeAplicado=function(e){a.setState({aplicado:e.target.value}),a.isNewItem()||a.props.onSave({aplicado:e.target.value})},a.onChangeDescripcion=function(e){a.setState({descripcion:e.getData()}),a.isNewItem()||a.props.onSave({descripcion:e.getData()})},a.onAddItem=function(){a.setState(function(e){return{items:[].concat(b(e.items),[w()])}})},a.onDeleteItem=function(e,t){a.setState(function(e){return{items:_.reject(e.items,function(e,a){return a==t})}},function(){a.isNewItem()||a.props.onSave({items:a.state.items})})},a.onUpdateItem=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];a.setState(function(a){var n;return void 0===a.items[t]?(n=b(a.items)).push(e):n=_.map(a.items,function(a,n){return n==t?Object.assign({},a,e):a}),{items:n}},function(){if(n&&!a.isNewItem()){var e=_.any(a.state.items,function(e){return!e.id})?"Guardando cambios":null;a.props.onSave({items:a.state.items},e)}})},a.onCreate=function(){a._onCreate({status:"EN PROCESO"},"Creando Ajuste")},a.onCreateAndCompletado=function(){a._onCreate({status:"COMPLETADO"},"Creando Ajuste")},a.onCompletado=function(){a.props.onSave({status:"COMPLETADO"},"Marcando como COMPLETADO")},a.onRevisado=function(){a.props.onSave({status:"REVISADO"},"Marcando como REVISASO")},a.state={descripcion:e.item.descripcion,items:e.item.items||[],status:e.item.status,aplicado:e.item.aplicado},a}return j(t,n.PureComponent),g(t,[{key:"isNewItem",value:function(){return!this.props.item.idx}},{key:"esPlanillaDescuadrada",value:function(){var e=this.state.items;return!!e&&_.reduce(e,function(e,t){return S(t.debe)+e},0)!=_.reduce(e,function(e,t){return S(t.haber)+e},0)}},{key:"validateItems",value:function(){return _.size(this.state.items)>0&&!_.any(this.state.items,function(e){return""==e.cuenta||""==e.nombre_cuenta||!e.debe&&!e.haber})}},{key:"_onCreate",value:function(e,t){this.validateItems()?this.props.onSave(Object.assign({},this.state,e),t):bootbox.alert("Ingrese el codigo de la cuenta y valor del ajuste para cada una de las filas del ajuste contable.")}},{key:"renderItemHeader",value:function(){var e=Object.assign({label:this.props.item.idx?"Ajuste #".concat(this.props.item.idx):"Ajuste Nuevo"},this.props.item);return React.createElement(o.MenuItemNewHeader,{item:e})}},{key:"renderRows",value:function(){var e=this,t=this.state.items;return React.createElement(n.Fragment,null,React.createElement(s.default.Consumer,null,function(a){return _.map(t,function(n,o){return React.createElement(k,{item:n,key:o,itemIndex:o,cuentas:a,isEditable:e.props.isEditable,canRemove:_.size(t)>1,onUpdate:e.onUpdateItem,onClickDelete:e.onDeleteItem})})}))}},{key:"renderActions",value:function(){var e=this.props.item,t=this.esPlanillaDescuadrada(),a=null;t?a="No es posible guardar los cambios realizados en este ajuste mientras la planilla esté descuadrada.":e.fecha_completado||(a="Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO.");var o=!this.isNewItem()&&React.createElement("button",{className:"ui button compact negative left floated",onClick:this.props.onClickDelete},React.createElement("i",{className:"icon trash"})," Eliminar");return this.isNewItem()?React.createElement("div",{className:"actions ab-status-actions"},React.createElement(u.default,{content:"No es posible guardar este ajuste mientras la planilla esté descuadrada.",disabled:!t,className:"disable-text",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button compact green",onClick:this.onCreate,disabled:t},"Crear"))}),React.createElement(u.default,{content:"No es posible guardar este ajuste mientras la planilla esté descuadrada.",disabled:!t,className:"disable-text",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button compact green",onClick:this.onCreateAndCompletado,disabled:t},"Crear y Completar"))})):React.createElement(n.Fragment,null,o,React.createElement(p.StatusButtonGroupActions,{completado:{permission:"hallazgo_completado",onClick:this.onCompletado,disableText:t?"No es posible guardar los cambios realizados en este ajuste mientras la planilla esté descuadrada.":null},revisado:{permission:"hallazgo_revisado",onClick:this.onRevisado,record:e,disableText:a}}))}},{key:"render",value:function(){return React.createElement(n.Fragment,null,React.createElement("div",{className:"content"},this.renderItemHeader(),React.createElement("table",{className:"ui table compact"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Código de la Cuenta"),React.createElement("th",null,"Nombre de la Cuenta"),React.createElement("th",null,"Debe"),React.createElement("th",null,"Haber"),React.createElement("th",null))),React.createElement("tbody",null,this.renderRows(),this.props.isEditable&&React.createElement("tr",null,React.createElement("td",{colSpan:5},React.createElement("button",{type:"button",className:"ui button olive fluid icon",onClick:this.onAddItem},"Añadir Fila ",React.createElement("i",{className:"icon plus"})))))),this.esPlanillaDescuadrada()&&React.createElement("div",{className:"ui red tiny message _a-center m1 "},React.createElement("i",{className:"icon exclamation triangle yellow"})," Alerta: Planilla descuadrada"),React.createElement("div",{className:"ui segment"},React.createElement(r.default,{prefixPreview:"Descripción del Ajuste",labelTitle:"Descripción del Ajuste",ckeditorOptions:"basic",editable:this.props.isEditable,data:this.state.descripcion,onSave:this.onChangeDescripcion})),React.createElement("div",{className:"ui segment basic nopad pull-left",style:{marginTop:5}},React.createElement("label",{style:{marginRight:10,display:"inline-block",fontWeight:600}},"Error Tolerable:"),accounting.formatNumber(app.vars.error_tolerable[this.props.moduleParams.id_visita])),React.createElement("div",{className:"ui right aligned segment basic nopad"},React.createElement("label",{style:{marginRight:10,display:"inline-block",fontWeight:600}},"¿Ajuste Registrado? ",React.createElement(m.GenericTooltip,{text:"@tooltip.ajustes.aplicado"})," :"),React.createElement("select",{className:"raw-select",value:""+this.state.aplicado=="1"?"1":"0",onChange:this.onChangeAplicado},React.createElement("option",{value:"1"},"Sí"),React.createElement("option",{value:"0"},"No")))),React.createElement("div",{className:"actions"},this.renderActions(),React.createElement("div",{className:"clearfix"})))}}]),t}();t.AjusteModal=O;var k=function(e){function t(e){var a;return v(this,t),(a=E(this,R(t).call(this,e))).onClickDelete=function(e){e.preventDefault(),a.props.canRemove&&bootbox.confirm("¿Desea eliminar esta fila de su ajuste contable?","Cancelar","Sí, eliminar fila",function(e){e&&a.props.onClickDelete(a.props.item,a.props.itemIndex)})},a.onSelectCuenta=function(e,t){a.setState({cuenta:t.cuenta,nombre_cuenta:t.nombre_cuenta},function(){a.notifyUpdate()})},a.onChangeCuenta=function(e,t){a.setState({cuenta:t,nombre_cuenta:""})},a.onChangeNombreCuenta=function(e,t){a.setState({nombre_cuenta:t,cuenta:""})},a.onBlurCuenta=function(){var e=a.props.cuentas;a.setState(function(t){if(""==t.cuenta&&""==t.nombre_cuenta)return null;if(""!=t.cuenta&&""!=t.nombre_cuenta)return null;if(""!=t.cuenta){var a=(0,l.getNombreCuenta)(e,t.cuenta);return{cuenta:t.cuenta,nombre_cuenta:a}}if(""!=t.nombre_cuenta){var n=_.find(e,function(e){return e.nombre_cuenta.toUpperCase()==t.nombre_cuenta.toUpperCase()});return{cuenta:n?n.cuenta:"",nombre_cuenta:t.nombre_cuenta}}},function(){return a.notifyUpdate()})},a.onChangeInput=function(e,t,n){"debe"==e?a.setState({debe:t},function(){return a.notifyUpdate(n)}):a.setState({haber:t},function(){return a.notifyUpdate(n)})},a.state={cuenta:e.item.cuenta,nombre_cuenta:e.item.nombre_cuenta,debe:e.item.debe,haber:e.item.haber},a}return j(t,n.PureComponent),g(t,[{key:"notifyUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object.assign({},this.props.item,this.state);""!=t.cuenta&&""!=t.nombre_cuenta&&(t.debe||t.haber)&&this.props.onUpdate(t,this.props.itemIndex,e)}},{key:"render",value:function(){var e=this;return React.createElement("tr",null,React.createElement("td",null,React.createElement(c.default,{items:this.props.cuentas,getItemValue:function(e){return e.cuenta},renderItem:function(e,t){return React.createElement("div",{key:e.id,className:"item "+(t?"item-highlighted":"")},React.createElement("div",null,e.cuenta),React.createElement("div",{className:"description"},e.nombre_cuenta))},value:this.state.cuenta,onChange:this.onChangeCuenta,onSelect:this.onSelectCuenta,inputProps:{type:"text",spellCheck:!1,required:!0,onBlur:this.onBlurCuenta},shouldItemRender:function(e,t){return e.cuenta.replace(/\D/g,"").startsWith(t.replace(/\D/g,""))},renderMenu:function(e){return React.createElement("div",{className:"autocomplete-menu",style:{position:"absolute",zIndex:1002},children:e})},wrapperProps:{className:(0,d.default)({error:!this.state.cuenta})},wrapperStyle:{display:"inline-block",position:"relative"}}),!this.state.cuenta&&React.createElement("div",{className:"ui pointing above prompt mini label"},"Requerido")),React.createElement("td",null,React.createElement(c.default,{items:this.props.cuentas,getItemValue:function(e){return e.nombre_cuenta},renderItem:function(e,t){return React.createElement("div",{key:e.id,className:"item "+(t?"item-highlighted":"")},React.createElement("div",null,e.nombre_cuenta),React.createElement("div",{className:"description"},e.cuenta))},value:this.state.nombre_cuenta,onChange:this.onChangeNombreCuenta,onSelect:this.onSelectCuenta,inputProps:{type:"text",spellCheck:!1,required:!0},shouldItemRender:function(e,t){var a=e.nombre_cuenta.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return _.str.contains(a,t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase())},renderMenu:function(e){return React.createElement("div",{className:"autocomplete-menu",style:{position:"absolute",zIndex:1002},children:e})},wrapperProps:{className:(0,d.default)({error:!this.state.nombre_cuenta})},wrapperStyle:{display:"inline-block",position:"relative"}}),!this.state.nombre_cuenta&&React.createElement("div",{className:"ui pointing above prompt mini label"},"Requerido")),React.createElement("td",null,React.createElement("div",{className:(0,d.default)({error:!this.state.debe&&!this.state.haber})},React.createElement(i.default,{isEditable:this.props.isEditable,value:this.state.debe,disabled:!!this.state.haber,onChange:function(t,a){return e.onChangeInput("debe",a,!1)},onBlur:function(t,a){return e.onChangeInput("debe",a,!0)}})),!this.state.debe&&!this.state.haber&&React.createElement("div",{className:"ui pointing above prompt mini label"},"Requerido")),React.createElement("td",null,React.createElement("div",{className:(0,d.default)({error:!this.state.haber&&!this.state.debe})},React.createElement(i.default,{isEditable:this.props.isEditable,value:this.state.haber,disabled:!!this.state.debe,onChange:function(t,a){return e.onChangeInput("haber",a,!1)},onBlur:function(t,a){return e.onChangeInput("haber",a,!0)}})),!this.state.haber&&!this.state.debe&&React.createElement("div",{className:"ui pointing above prompt mini label"},"Requerido")),React.createElement("td",null,this.props.isEditable&&React.createElement(u.default,{disabled:this.props.canRemove,content:"Todo ajuste contable debe tener un mínimo de 1 cuenta (fila).",trigger:React.createElement("a",{href:"#",onClick:this.onClickDelete,title:"Eliminar Fila"},React.createElement("i",{className:"icon cancel red"})),header:"Eliminar fila | Opción deshabilitada",className:"disable-text"})))}}]),t}(),S=function(e){var t=parseFloat(e);return isNaN(t)?0:t},w=function(){return{cuenta:"",debe:null,haber:null,nombre_cuenta:""}}},347:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,a(1).createContext)([]);t.default=n},348:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNombreCuenta=void 0;t.getNombreCuenta=function(e,t){var a=_.findWhere(e,{cuenta:t});if(a)return a.nombre_cuenta;var n=function(e){return e.replace(/\D/g,"")};return(a=_.findWhere(_.map(e,function(e){return{cuenta:n(e.cuenta),cuenta_real:e.cuenta_real,nombre_cuenta:e.nombre_cuenta}}),{cuenta:n(t)}))?a.nombre_cuenta:""}},349:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanSpacesFromHtml=r,t.truncateText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;if(null==e)return e;e=(e=r(e)).replace(/<table.*\/table>/g,'<img src="/images/icon_tabular.png" title="Tabla" />');var a=(0,o.default)(""+e,t,{keepImageTag:!0});return(a=(a=(a=a.replace(/(min-)?width:.+?;/g,"")).replace(/(min-)?height:.+?;/g,"")).replace(/style=".+?"/g,"")).trim()};var n,o=(n=a(698))&&n.__esModule?n:{default:n};function r(e){return null==e?e:e=(e=(e=e.trim().replace(/\r?\n|\r/g,"")).replace(/>\s+</g,"><")).replace(/\s{2,}/g," ")}},350:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoModal=void 0;var n=f(a(1)),o=m(a(177)),r=a(122),i=f(a(702)),s=m(a(705)),c=a(751),l=a(715),u=a(229),p=m(a(9)),d=a(181);function m(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};n.get||n.set?Object.defineProperty(t,a,n):t[a]=e[a]}return t.default=e,t}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function v(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t,a){return t&&g(e.prototype,t),a&&g(e,a),e}function R(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(0,i.registerLocale)("es",s.default);var k=function(e){function t(e){var a;return y(this,t),(a=R(this,j(t).call(this,e))).handlers={},a.onCreate=function(){a._onCreate({status:"EN PROCESO"})},a.onCreateAndCompletado=function(){a._onCreate({status:"COMPLETADO"})},a.onCompletado=function(){a.props.onSave({status:"COMPLETADO"})},a.onRevisado=function(){a.props.onSave({status:"REVISADO"})},a.onEditorChange=function(e){return a.attachHandler(e,function(t,n,o,r){var i=t.getData();"hallazgo"!=e||a.isNewItem()||0!=_.size(_.str.trim(i))?(a.updateModel(v({},e,i)),$.isFunction(r)&&r()):bootbox.alert("La descripción del hallazgo NO puede ser un campo vacío.")})},a.onInputChange=function(e){return a.attachHandler(e,function(t){a.updateModel(v({},e,t.target.value))})},a.onDateChange=function(e){return a.attachHandler(e,function(t){a.updateModel(v({},e,(0,c.format)(t,"yyyy-MM-dd")))})},a.onValueChange=function(e){return a.attachHandler(e,function(t){a.updateModel(v({},e,t))})},a.onClickDelete=function(e){$.isFunction(a.props.onClickDelete)&&a.props.onClickDelete(e)},a.state={value:e.item},a}return C(t,n.PureComponent),E(t,[{key:"attachHandler",value:function(e,t){return this.handlers[e]||(this.handlers[e]=t),this.handlers[e]}},{key:"isNewItem",value:function(){return null==this.props.item.id}},{key:"updateModel",value:function(e){this.setState(function(t){return{value:Object.assign({},t.value,e)}}),this.isNewItem()||this.props.onSave(e)}},{key:"getDate",value:function(e){if(!e)return null;var t=(0,c.parseISO)(e);return(0,c.isValid)(t)?t:null}},{key:"formatImplementadoChoice",value:function(e){return null===e||""===e?"":!0===e||"1"===e?"1":"0"}},{key:"_onCreate",value:function(e){_.isEmpty(this.state.value.hallazgo)?bootbox.alert("La descripción del hallazgo NO puede ser un campo vacío."):this.props.onSave(Object.assign({},this.state.value,e))}},{key:"renderActions",value:function(){var e=this.props.item,t=null!==e.id&&n.default.createElement("button",{className:"ui button compact negative left floated",onClick:this.onClickDelete},n.default.createElement("i",{className:"icon trash"})," Eliminar");return null===e.id?n.default.createElement("div",{className:"actions ab-status-actions"},n.default.createElement("button",{className:"ui button compact green",onClick:this.onCreate},"Crear"),n.default.createElement("button",{className:"ui button compact green",onClick:this.onCreateAndCompletado},"Crear y Completar")):n.default.createElement(n.Fragment,null,t,n.default.createElement(r.StatusButtonGroupActions,{completado:{permission:"hallazgo_completado",onClick:this.onCompletado},revisado:{permission:"hallazgo_revisado",onClick:this.onRevisado,record:e}}))}},{key:"renderItemHeader",value:function(){var e=Object.assign({label:this.props.item.id?u.HallazgoUtils.formatName(this.props.item.name):"Hallazgo Nuevo"},this.props.item);return n.default.createElement(d.MenuItemNewHeader,{item:e})}},{key:"render",value:function(){var e=this.props.item,t=this.state.value;return n.default.createElement(n.Fragment,null,n.default.createElement("div",{className:"content"},this.renderItemHeader(),e.id&&n.default.createElement("div",{className:"description-text"},n.default.createElement("strong",null,"NOTA:")," El hallazgo debe describir la situación actual, causa, impacto y recomendación."),n.default.createElement(o.default,{className:"editor-preview-hallazgo",wrapperClassName:(0,p.default)(!e.id||"ui segment"),data:t.hallazgo,inline:null==e.id,ckeditorOptions:{attach_disableText:"Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo.",height:e.id?300:150},ckeditorUploadOptions:{model:"".concat(this.props.moduleParams.model,"__hallazgo"),modelId:e.id},footer:"AttachmentList",onSave:this.onEditorChange("hallazgo"),previewStyle:{overflowY:"auto",maxHeight:200,width:"100%"},label:'<div class="description-text"><strong>NOTA:</strong> El hallazgo debe describir la situación actual, causa, impacto y recomendación</div>'}),n.default.createElement("hr",null),n.default.createElement("div",{className:"ui segment"},n.default.createElement(o.default,{data:t.plan_accion,prefixPreview:"Descripción Plan de Acción: ",labelTitle:"Descripción Plan de Acción:",ckeditorOptions:{attach_disableText:"Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo."},ckeditorUploadOptions:{model:"".concat(this.props.moduleParams.model,"__plan_accion"),modelId:e.id},footer:"AttachmentList",onSave:this.onEditorChange("plan_accion")})),n.default.createElement("div",{className:"ui three column grid"},n.default.createElement("div",{className:"column"},n.default.createElement("label",{htmlFor:"hallazgo_modal__responsable"},"Responsable del Plan Acción: "),n.default.createElement(S,{value:t.responsable,onChange:this.onValueChange("responsable"),attrs:{placeholder:"Escriba el Nombre",style:{display:"inline-block"}}})),n.default.createElement("div",{className:"column"},n.default.createElement("label",{htmlFor:"hallazgo_modal__fecha_implementado"},"Fecha Implementación: "),n.default.createElement(i.default,{id:"hallazgo_modal__fecha_implementado",dateFormat:"yyyy-MM-dd",locale:"es",fixedHeight:!0,placeholderText:"AAAA-mm-dd",className:"react-datepicker--input",selected:this.getDate(t.fecha_implementado),onChange:this.onDateChange("fecha_implementado")})),n.default.createElement("div",{className:"column right aligned"},n.default.createElement("label",{htmlFor:"hallazgo_modal__implementado"},"Estado Implementación: "),n.default.createElement("select",{id:"hallazgo_modal__implementado",value:this.formatImplementadoChoice(t.implementado),onChange:this.onInputChange("implementado")},n.default.createElement("option",{value:""},"Pendiente"),n.default.createElement("option",{value:"0"},"En Proceso"),n.default.createElement("option",{value:"1"},"Hecho"))))),n.default.createElement("div",{className:"actions"},this.renderActions(),n.default.createElement("div",{className:"clearfix"})))}}]),t}();t.HallazgoModal=k;var S=function(e){function t(e){var a;return y(this,t),(a=R(this,j(t).call(this,e))).mentionStyle={display:"inline-block",minWidth:"200px",suggestions:{list:{backgroundColor:"white",border:"1px solid rgba(0,0,0,0.15)",fontSize:14},item:{padding:"5px 15px",borderBottom:"1px solid rgba(0,0,0,0.15)","&focused":{backgroundColor:"#cee4e5"}}}},a.onChange=function(e,t,n,o){a.setState({value:t}),a.props.onChange(t)},a.state={value:e.value},a.users=_.map(app.vars.proyecto_equipo,function(e){return{id:e.user_id,display:e.name}}),a}return C(t,n.PureComponent),E(t,[{key:"render",value:function(){return n.default.createElement(l.MentionsInput,b({singleLine:!0,type:"text",value:null==this.state.value?"":this.state.value,onChange:this.onChange,allowSpaceInQuery:!0},this.props.attrs,{className:"mentions-input",style:this.mentionStyle}),n.default.createElement(l.Mention,{trigger:"@",data:this.users,appendSpaceOnAdd:!0}))}}]),t}()},371:function(e,t,a){"use strict";var n=a(25),o=i(a(372)),r=i(a(733));function i(e){return e&&e.__esModule?e:{default:e}}accounting.settings.number.precision=0,accounting.settings.number.thousand=".",accounting.settings.number.decimal=",","PERIODO"==app.vars.hoja_trabajo.paso.tipo?(0,n.render)(React.createElement(r.default,{hoja_trabajo:app.vars.hoja_trabajo}),document.getElementById("root")):(0,n.render)(React.createElement(o.default,{hoja_trabajo:app.vars.hoja_trabajo}),document.getElementById("root"))},372:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=j(a(190)),o=j(a(85)),r=j(a(93)),i=j(a(283)),s=j(a(114)),c=j(a(35)),l=j(a(162)),u=a(1),p=j(a(286)),d=j(a(39)),m=j(a(55)),f=j(a(729)),h=j(a(730)),b=j(a(731)),v=j(a(732)),y=j(a(228)),_=j(a(337)),g=a(333),E=j(a(335)),R=j(a(180));function j(e){return e&&e.__esModule?e:{default:e}}function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=k(this,S(t).call(this,e))).handleClick=function(e,t){var n=t.index;a.setState({activeIndex:n});var o=(0,l.default)(a.state.hoja_trabajo.visitas,{index:n});app.vars.current_idvisita=o.id_visita,$("#table-visita-instrucciones-".concat(o.id)).floatThead("reflow"),window.location.hash="#!vis-"+n},a.showModal=function(){a.setState({assocModalOpen:!0})},a.onChangeVisita=function(e){a.setState(function(t){var a=Object.assign({},t.hoja_trabajo);return a.visitas=(0,c.default)(a.visitas,function(t){return t.index+""==e.index+""?e:t}),{hoja_trabajo:a}})},a.onChangeApp=function(e){a.setState(function(t){return{hoja_trabajo:Object.assign({},t.hoja_trabajo,e)}})};var n,o,r=window.location.hash.replace(/^#!vis-/,"");return r?(n=+r,o=(0,l.default)(a.props.hoja_trabajo.visitas,{index:n})):n=(o=(0,l.default)(a.props.hoja_trabajo.visitas,{is_current:!0}))?o.index:null,o&&(app.vars.current_idvisita=o.id_visita),a.state={activeIndex:n,selectedVisitas:(0,s.default)((0,c.default)(a.props.hoja_trabajo.visitas,function(e,t){return e.id?t:null})),newVisitaOpen:!1,assocModalOpen:!1,hoja_trabajo:a.props.hoja_trabajo},a}var a,j,C;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,u.Component),a=t,(j=[{key:"componentDidMount",value:function(){var e=90/(0,i.default)((0,s.default)(this.panes,{type:"sheet"}));$("#visita-tabs").find(".menu>a.visita-tab").css({width:e+"%"})}},{key:"getUrlFor",value:function(e){return url_for("proyecto/".concat(this.props.hoja_trabajo.proyecto.id,"/hoja-trabajo/paso/").concat(this.props.hoja_trabajo.paso.id,"/").concat(e))}},{key:"isAllowedAsociarVisita",value:function(){return!!user_has_role_permission("paso_asociar_visita")}},{key:"getAssocModal",value:function(){var e=this;if(!this.isAllowedAsociarVisita())return null;if(!this.state.hoja_trabajo.proyecto.isOpen)return null;var t=this.state,a=t.assocModalOpen,n=t.selectedVisitas,o=t.newVisitaOpen,i={moveLeft:React.createElement("i",{className:"icon angle left"}),moveAllLeft:React.createElement("i",{className:"icon angle double left"}),moveRight:React.createElement("i",{className:"icon angle right"}),moveAllRight:React.createElement("i",{className:"icon angle double right"}),moveDown:React.createElement("i",{className:"icon angle down"}),moveUp:React.createElement("i",{className:"icon angle up"})},s=this.props.hoja_trabajo.visitas,c=[];(0,r.default)(s,function(e,t){c.push({value:t,label:e.label})});var l=function(){e.setState({assocModalOpen:!1})};return React.createElement(y.default,{open:a,closeIcon:!0,dimmer:"inverted",size:"small",onClose:l,className:"modal-ab"},React.createElement(y.default.Header,null," Asociación de Visitas a este Paso"),React.createElement(y.default.Content,null,React.createElement("form",{method:"post",className:"ui form",action:this.getUrlFor("visita")},React.createElement("div",{style:{marginBottom:"15px"}},"Asocie las visitas a relacionar con este paso: ")," ",React.createElement("br",null),React.createElement(E.default,{name:"visitas",options:c,availableLabel:"Por asociar",selectedLabel:"Asociadas",selected:n,icons:i,onChange:function(t){e.setState({selectedVisitas:t})}}),React.createElement(f.default,{horizontal:!0},"O"),React.createElement(_.default,null,React.createElement(_.default.Title,{active:o,onClick:function(){e.setState(function(e){return{newVisitaOpen:!e.newVisitaOpen}})}},React.createElement(d.default,{name:"caret right"})," Crear Nueva Visita"),React.createElement(_.default.Content,{active:o},React.createElement(b.default.Field,{inline:!0},React.createElement("label",null,"Nombre de la visita"),React.createElement("div",{className:"ui input"}," ",React.createElement("input",{placeholder:"Nombre de la visita",name:"visita_name",type:"text"})," ")))),React.createElement("button",{className:"primary small ui button right floated"},"Guardar"),React.createElement("button",{className:"negative small ui button right floated",type:"button",onClick:l},"Cancelar"),React.createElement("div",{className:"clearfix"}))))}},{key:"render",value:function(){var e=this,t=this,a=this.state.activeIndex,i=this.getAssocModal();this.panes=[];var s=(0,o.default)(t.state.hoja_trabajo.visitas);return s=(0,n.default)(s,"position"),(0,r.default)(s,function(e,n){null!=e.id&&(e.HojaTrabajo=t.state.hoja_trabajo,t.panes.push({type:"sheet",menuItem:function(){return React.createElement(h.default.Item,{key:e.id,index:e.index,className:"tab-nav-item visita-tab",name:e.label,onClick:t.handleClick,active:a==e.index},React.createElement(g.AppVisitaDefaultTab,{visita:e}))},pane:function(){return React.createElement(p.default,{key:e.id,idx:e.index,active:a==e.index,visita:e,isEditable:t.state.hoja_trabajo.proyecto.isOpen,onChange:t.onChangeVisita,onChangeApp:t.onChangeApp})}}))}),0==t.panes.length?React.createElement("div",{className:"alert alert-block nocontent"},React.createElement("h3",null,"Sin visitas"),React.createElement("p",null,React.createElement("span",{className:"icon-warning-sign"}),"Este paso aun no tiene visitas asociadas."," "),t.state.hoja_trabajo.proyecto.isOpen&&this.isAllowedAsociarVisita()&&[React.createElement(m.default,{key:"button",content:"Asociar visitas",color:"green",compact:!0,icon:"info circle",onClick:this.showModal,style:{marginTop:"30px"}}),React.createElement("div",{key:"modal"},i)]):(this.isAllowedAsociarVisita()&&t.state.hoja_trabajo.proyecto.isOpen&&t.panes.push({type:"action",menuItem:function(){return React.createElement(h.default.Item,{key:"plus",className:"tab-nav-item tab-add",title:"Asociar/Desasociar visitas a este paso",onClick:e.showModal},React.createElement(d.default,{name:"plus"}))}}),React.createElement(R.default.Provider,{value:{hoja_trabajo:this.state.hoja_trabajo,update:this.onChangeApp}},React.createElement("div",{id:"visita-tabs",className:"paso-code-".concat(this.state.hoja_trabajo.paso.code,"  paso-default")},React.createElement(v.default,{panes:this.panes,activeIndex:a,renderActiveOnly:!1}),i)))}}])&&O(a.prototype,j),C&&O(a,C),t}();t.default=N},602:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),o=f(a(55)),r=f(a(39)),i=f(a(323)),s=f(a(75)),c=f(a(603)),l=f(a(121)),u=f(a(316)),p=f(a(325)),d=f(a(177)),m=a(327);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=v(this,y(t).call(this,e))).evalIsDone=function(e){return!!e.answer||!!e.observations},a.checkIsDoneDisabled=function(e){return!user_has_role_permission("hoja_trabajo_edit")||(!a.props.isEditable||!e.answer&&!e.observations)},a.onChecked=function(e){var t=e.target.checked;a.setState(function(e){var a=Object.assign({},e.instruccion);return a.is_done=t,{instruccion:a}},function(){return a.props.onUpdate(a.state.instruccion,a.props.index)})},a.onActionChanged=function(e,t){a.updateModel("answer",t.value)},a.onChangeEditor=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0);"description"==e?($.blockUI(create_blockUI_loading_message("Guardando los cambios... Por Favor Espere")),a.updateModel(e,t.getData(),function(){$.isFunction(o)&&o(),$.unblockUI()})):a.updateModel(e,t.getData(),o),n&&a.setState({isEditorOpen:!1})}},a.onRemove=function(){bootbox.warningConfirm("¿Desea eliminar permanentemente esta instruccion ?","Cancelar","Aceptar",function(e){if(e)if($.blockUI(create_blockUI_loading_message("Eliminando instrucción...")),a.props.onRemove(a.props.index),a.props.instruccion.id){var t=url_for("proyecto/".concat(a.state.instruccion.Visita.HojaTrabajo.proyecto.id,"/hoja-trabajo/instruccion/remove"));$.ajax(t,{type:"POST",data:{id:{local_id:a.props.instruccion.local_id}},dataType:"json"}).done(function(e){e.response.record&&a.props.onUpdateVisita([e.response.record]),$.unblockUI()})}else $.unblockUI()})},a.onUpload=function(){a.fetchAttachments()},a.onClickAttachmentCell=function(e){e.preventDefault(),a.setState({isEditorOpen:!0})},a.onUpdateAttachment=function(){a.fetchAttachments()},a.onDeleteAttachment=function(e,t){a.fetchAttachments(),a.setState(function(t){var n=Object.assign({},t.instruccion),o=public_path("uploads/proyecto_adjunto/".concat(e.filepath),!0).replace(/\./g,".").replace(/\\/g,"/"),r=new RegExp('<a .*href="'+o+'"(.+?)/a>\\s*(<br\\s?/?>)?',"g");return n.observations=n.observations.replace(r,""),a.updateModel("observations",n.observations),{instruccion:n}},function(){$.isFunction(t)&&t()})},a.state={instruccion:e.instruccion,isEditorOpen:!1,isLoadingAttachments:!1},a}var a,f,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,n.Component),a=t,h=[{key:"getDerivedStateFromProps",value:function(e,t){return e.instruccion.updated_at!=t.instruccion.updated_at?{instruccion:e.instruccion}:null}}],(f=[{key:"getFormattedIteration",value:function(){return _.padLeft(String(this.props.iteration+1),3,"0")}},{key:"getFormattedDescription",value:function(){var e=this.state.instruccion.description;return null==e?"":(e=e.replace(/(?!^)\([a-z]\)/g,"<br/>&nbsp;&nbsp;$& "),'<span key="instruction-iteration" class="instruction-iteration">'+this.getFormattedIteration()+".</span> "+e)}},{key:"getFormattedObservations",value:function(){var e=this.state.instruccion.observations;if(!e)return"";var t=(e=e.trim()).replace(/<img[\0-\uFFFF]*?>/g," [** IMAGEN ó TABLA **] ");return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<table[\0-\uFFFF]*?\/table>/g,"[** TABLA **]")).replace(/<figure[\0-\uFFFF]*?\/figure>/g,"[** IMAGEN **]")).replace(/<\/p>/g,"<br>")).replace(/<\/h\d>/g,"<br>")).replace(/&nbsp;/g,"")).replace(/<(?!(br)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\/?)[\0-=\?-\uFFFF]+>/g,"")).replace(/<br>[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*<br>/g,"<br>")).replace(/\[\*\*([\0-\uFFFF]+?)\*\*\]/g,'<span class="special-tag">$&</span>')}},{key:"doUpdateModel",value:function(e,t,a){var n=this,o=[];this.setState(function(a){var r=Object.assign({},a.instruccion);return""==_.str.trim(t)&&(t=null),r[e]="is_done"==e?!!t:t,o.push({field:e,value:t}),"description"!=e&&(r.is_done=n.evalIsDone(r),o.push({field:"is_done",value:r.is_done?1:0})),"observations"!=e||null==r.observations||""==r.observations||r.answer||(r.answer="Hecho",o.push({field:"answer",value:"Hecho"})),{instruccion:r}},function(){n.props.onUpdate(n.state.instruccion,n.props.index),$.isFunction(a)&&a(o)})}},{key:"updateModel",value:function(e,t,a){var n=this;this.doUpdateModel(e,t,function(e){n.sendInstructionToServer(e,function(){n.fetchAttachments(!1),$.isFunction(a)&&a()})})}},{key:"sendInstructionToServer",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={id:{local_id:this.state.instruccion.local_id},id_paso:this.state.instruccion.Visita.HojaTrabajo.paso.id,id_visita:this.state.instruccion.Visita.id_visita,data:e},o=url_for("proyecto/".concat(this.state.instruccion.Visita.HojaTrabajo.proyecto.id,"/hoja-trabajo/instruccion"));this.state.instruccion.id||$.blockUI(create_blockUI_loading_message("Creando instrucción...")),$.ajax(o,{type:"POST",data:n,dataType:"json"}).done(function(e){e.response.new&&(t.setState({instruccion:Object.assign({},t.state.instruccion,e.response.record)}),$.unblockUI()),t.props.onUpdateVisita(e.response.visitas,e.response.changed),$.isFunction(a)&&a()})}},{key:"fetchAttachments",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&this.setState({isLoadingAttachments:!0});var a=url_for("proyecto/".concat(this.state.instruccion.Visita.HojaTrabajo.proyecto.id,"/hoja-trabajo/instruccion/attachments"));$.ajax(a,{type:"GET",data:{local_id:this.state.instruccion.local_id},dataType:"json"}).done(function(t){e.doUpdateModel("Attachments",t.response.Attachments),e.setState({isLoadingAttachments:!1})})}},{key:"render",value:function(){var e=this,t=this.state.instruccion,a=["Hecho","Sí","No","Cumple","No Cumple","Aplica","No Aplica"];a=a.map(function(e){return{key:e,value:e,text:e}});var n=this.getFormattedDescription(),f={uploadUrl:url_for("proyecto/"+t.Visita.HojaTrabajo.proyecto.id+"/master_data/paso/"+t.Visita.HojaTrabajo.paso.id+"/upload?id_visita="+t.Visita.id_visita+"&model=instruccion_item__instr&model_id="+t.local_id),imageUploadUrl:url_for("proyecto/"+t.Visita.HojaTrabajo.proyecto.id+"/master_data/paso/"+t.Visita.HojaTrabajo.paso.id+"/upload?id_visita="+t.Visita.id_visita+"&model=instruccion_item__instr&model_id="+t.local_id),filebrowserUploadUrl:url_for("proyecto/"+t.Visita.HojaTrabajo.proyecto.id+"/master_data/paso/"+t.Visita.HojaTrabajo.paso.id+"/upload?id_visita="+t.Visita.id_visita+"&n=attachment&model=instruccion_item__instr&model_id="+t.local_id),link_to_muestreo_enabled:!0},h={uploadUrl:url_for("proyecto/"+t.Visita.HojaTrabajo.proyecto.id+"/master_data/paso/"+t.Visita.HojaTrabajo.paso.id+"/upload?id_visita="+t.Visita.id_visita+"&model=instruccion_item__obs&model_id="+t.local_id),imageUploadUrl:url_for("proyecto/"+t.Visita.HojaTrabajo.proyecto.id+"/master_data/paso/"+t.Visita.HojaTrabajo.paso.id+"/upload?id_visita="+t.Visita.id_visita+"&model=instruccion_item__obs&model_id="+t.local_id),filebrowserUploadUrl:url_for("proyecto/"+t.Visita.HojaTrabajo.proyecto.id+"/master_data/paso/"+t.Visita.HojaTrabajo.paso.id+"/upload?id_visita="+t.Visita.id_visita+"&n=attachment&model=instruccion_item__obs&model_id="+t.local_id),link_to_muestreo_enabled:!0},b=React.createElement("div",{style:{position:"relative"}},React.createElement(u.default,{inverted:!0,active:this.state.isLoadingAttachments},React.createElement(i.default,{inverted:!0})),React.createElement(m.AttachmentListPanel,{attachments:t.Attachments,onUpdateItem:this.onUpdateAttachment,onDeleteItem:this.onDeleteAttachment})),v=null;return this.props.isEditable&&user_has_role_permission("instruccion_delete")&&(v=React.createElement(o.default,{negative:!0,floated:"left",icon:"trash alternate outline",content:"Eliminar instrucción",onClick:this.onRemove})),React.createElement(c.default.Row,{className:"hoverable-actions instruccion-row ".concat(this.props.iteration%2?"even":"odd"),id:"table-instruccion-".concat(t.local_id)},React.createElement(c.default.Cell,{className:"td-chk",collapsing:!0},React.createElement("label",{className:"container-checkbox"},React.createElement("input",{id:"checkbox-".concat(t.id),type:"checkbox",checked:t.is_done,disabled:this.checkIsDoneDisabled(t),value:"1",onChange:this.onChecked}),React.createElement("span",{className:"checkmark"})),this.props.isEditable&&this.props.isSortable&&user_has_role_permission("hoja_trabajo_edit")&&React.createElement("div",{className:"action-list"},React.createElement("div",{className:"drag-icon sort-handler"}))),React.createElement(c.default.Cell,{width:"6",className:"instruction-text"},React.createElement(d.default,{className:"instruction-text-editor",ckeditorOptions:f,preview:n,data:t.description,required:!0,label:" ",labelTitle:"Descripción de la instrucción",open:!t.id&&!t.description,editable:this.props.isEditable&&user_has_role_permission("instruccion_edit"),leftActions:v,autosave:!0,onSave:this.onChangeEditor("description")})),React.createElement(c.default.Cell,{style:{width:"auto"}},this.props.isEditable&&user_has_role_permission("hoja_trabajo_edit")?React.createElement(p.default,{placeholder:"Seleccione...",className:"instruccion-action",value:t.answer,clearable:!0,onChange:this.onActionChanged,options:a}):React.createElement("span",null,t.answer)),React.createElement(c.default.Cell,{width:"7",className:"observations-text"},React.createElement(d.default,{className:"observations-text-editor",ckeditorOptions:h,preview:this.getFormattedObservations(),data:t.observations,label:n,open:this.state.isEditorOpen,editable:this.props.isEditable&&user_has_role_permission("hoja_trabajo_edit"),autosave:!0,onSave:this.onChangeEditor("observations"),onClose:function(){return e.setState({isEditorOpen:!1})},onUpload:this.onUpload,onClickPreview:this.onClickAttachmentCell,footer:b})),React.createElement(c.default.Cell,{className:"attachments"},React.createElement("div",null,React.createElement("a",{href:"#",className:"btn-attach",onClick:this.onClickAttachmentCell},React.createElement(s.default,{circular:!0,floating:!0,color:"green",size:"mini"},_.size(t.Attachments)),React.createElement(r.default,{name:"copy outline",className:"attachments-icon"})))),React.createElement(c.default.Cell,{textAlign:"right",collapsing:!0,className:"computer"},this.props.isEditable&&user_has_role_permission("instruccion_delete")&&React.createElement(l.default,{className:"action",inline:!0,direction:"left",icon:!1,trigger:React.createElement(r.default,{name:"ellipsis vertical",color:"grey"})},React.createElement(l.default.Menu,null,React.createElement(l.default.Item,{icon:"trash alternate outline",content:"Eliminar instrucción",onClick:this.onRemove})))))}}])&&b(a.prototype,f),h&&b(a,h),t}();t.default=E},646:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a(178)),o=i(a(64)),r=i(a(9));function i(e){return e&&e.__esModule?e:{default:e}}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var c=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a},l=function(e){var t=e.children,a=c(e,["children"]);return a.className=(0,r.default)(a.className,"action"),a=Object.assign({icon:!0,basic:!0,compact:!0,size:"mini",title:"Editar"},a),void 0===t&&(t=React.createElement(o.default,{name:"pencil square",color:"green",size:"large"})),React.createElement(n.default,s({},a,{type:"button"}),t)};t.default=l},682:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),o=s(a(55)),r=s(a(39)),i=s(a(179));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,p(t).apply(this,arguments))).onClickCompletado=function(){var t=url_for("proyecto/".concat(e.props.visita.HojaTrabajo.proyecto.id,"/hoja-trabajo/paso/").concat(e.props.visita.HojaTrabajo.paso.id,"/visita/").concat(e.props.visita.id_visita,"/save")),a="PERIODO"==e.props.type?"Marcando periodo como Completado...":"Marcando visita como Completada...";$.blockUI(create_blockUI_loading_message(a)),$.ajax(t,{type:"POST",data:{op:"c"},dataType:"json"}).done(function(t){t.hasErrors?($.unblockUI(),bootbox.alert(t.message)):(e.updateVisita(t.response.record),$.unblockUI())})},e.onClickRevisado=function(){var t=url_for("proyecto/".concat(e.props.visita.HojaTrabajo.proyecto.id,"/hoja-trabajo/paso/").concat(e.props.visita.HojaTrabajo.paso.id,"/visita/").concat(e.props.visita.id_visita,"/save")),a="PERIODO"==e.props.type?"Marcando periodo como Revisado...":"Marcando visita como Revisada...";$.blockUI(create_blockUI_loading_message(a)),$.ajax(t,{type:"POST",data:{op:"r"},dataType:"json"}).done(function(t){t.hasErrors?($.unblockUI(),bootbox.alert(t.message)):(e.updateVisita(t.response.record),$.unblockUI())})},e.onUpdate=function(t,a){$.isArray(t)||(t=[t]),e.updateVisita(t[0]),t=_.rest(t),_.size(t)&&_.forEach(t,function(t){var a=_.find(e.props.visita.HojaTrabajo.visitas,{id_visita:t.id_visita});a=Object.assign(a,t)}),a&&_.forEach(a,function(t){var a=_.find(e.props.visita.HojaTrabajo.visitas,{id_visita:t.id_visita});switch(t.cmd){case"CREATE":a.instructions.push(t.data);break;case"UPDATE":a.instructions=_.map(a.instructions,function(e){return e.local_id==t.data.local_id?Object.assign(e,t.data):e})}})},e}var a,s,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n.Component),a=t,c=[{key:"getDerivedStateFromProps",value:function(e,t){return e.visita.id_status!=t.id_status?{id_status:""+e.visita.id_status}:null}}],(s=[{key:"updateVisita",value:function(e){var t=Object.assign(this.props.visita,e);this.props.onChange(t),this.setState({id_status:""+t.id_status})}},{key:"getCompletadoDisabledText",value:function(){return null}},{key:"getRevisadoDisabledText",value:function(){var e="PERIODO"==this.props.type?"Este periodo":"Esta visita";return _.includes(["1","2","3"],this.state.id_status)||this.getCompletadoDisabledText()?e+" debe estar primero en estado COMPLETADO, para poder marcar esta hoja de trabajo como REVISADA.":_.includes(["6"],this.state.id_status)?e+" tiene Notas de Revisión que deben primero ser atendidas para poder marcar esta hoja de trabajo como REVISADA.":this.props.visita.additionals.revisiones>0?e+" tiene Notas de Revisión pendientes por revisar que deben primero ser revisadas para poder marcar esta hoja de trabajo como REVISADA.":null}},{key:"renderStatusActions",value:function(){if(!this.props.isEditable)return null;var e,t=this.getRevisadoDisabledText(),a=this.props.visita;if(a.fecha_completado&&a.fecha_revision&&Date.create(a.fecha_completado)>Date.create(a.fecha_revision)){var n="PERIODO"==this.props.type?"Este periodo":"Esta visita";e=React.createElement(i.default,{trigger:React.createElement(r.default,{color:"red",name:"warning circle"}),content:n+" ha recibido modificaciones después de su última revisión."})}var s=this.getCompletadoDisabledText();return React.createElement("div",{className:"actions ab-status-actions"},user_has_role_permission("paso_completado")&&React.createElement(i.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(o.default,{primary:!0,icon:!0,compact:!0,onClick:this.onClickCompletado,disabled:null!=s}," ",React.createElement(r.default,{name:"check"})," Completado")),content:s,header:"Marcar como Completado | Opción deshabilitada",disabled:null==s,className:"disable-text",on:"hover"}),user_has_role_permission(["paso_revisado"])&&React.createElement(i.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(o.default,{color:"olive",icon:!0,compact:!0,onClick:this.onClickRevisado,disabled:null!=t}," ",React.createElement(r.default,{name:"check",fitted:!0}),React.createElement(r.default,{name:"check"})," Revisado ",e)),content:t,header:"Marcar como Revisado | Opción deshabilitada",disabled:null==t,className:"disable-text",on:"hover"}))}}])&&l(a.prototype,s),c&&l(a,c),t}();m.defaultProps={type:"DEFAULT"};var f=m;t.default=f},683:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),o=b(a(176)),r=b(a(220)),i=b(a(216)),s=b(a(64)),c=a(684),l=b(a(180)),u=a(334),p=a(685),d=a(699),m=a(723),f=a(725),h=b(a(9));function b(e){return e&&e.__esModule?e:{default:e}}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=E(this,R(t).apply(this,arguments))).state={panelOpen:null,openAsignarUsuarioModal:!1},e.onItemOpen=function(t){e.setState({panelOpen:t})},e.closeAllPanel=function(){e.setState({panelOpen:null})},e}var a,l,b;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,n.Component),a=t,(l=[{key:"isActionItemEnabled",value:function(e){return void 0===this.props.actionItems["_".concat(e)]||this.props.actionItems["_".concat(e)]}},{key:"renderAsignUserModal",value:function(){var e=this;if(this.state.openAsignarUsuarioModal){var t=this.context,a=t.hoja_trabajo,n=t.update;return React.createElement(c.HojaTrabajoAsignarVisitaModal,{visita:this.props.visita,onSave:function(t){var o=url_for("proyecto/".concat(a.proyecto.id,"/hoja-trabajo/paso/").concat(a.paso.id,"/visita/").concat(e.props.visita.id_visita,"/save"));$.blockUI(create_blockUI_loading_message("Guardando asignado...")),$.ajax(o,{type:"POST",data:{op:"a",paso_id_usuario:t},dataType:"json"}).done(function(t){var o=u.HojaTrabajoUpdateUtils.updateVisita(a,e.props.visita,t.response.record);n(o),$.unblockUI()}),e.setState({openAsignarUsuarioModal:!1})},onClose:function(){return e.setState({openAsignarUsuarioModal:!1})}})}}},{key:"render",value:function(){var e=this,t=this.props.visita.HojaTrabajo.proyecto.id,a=this.props.visita.HojaTrabajo.paso.id,l=this.props.visita.id_visita,u=null!=this.props.visita.HojaTrabajo.proyecto.id_parent,b="proyecto/".concat(t,"/paso/").concat(a,"/visita/").concat(l,"/"),v=this.props.visita.additionals,g=public_path("images/sidebar_right/");return React.createElement(n.Fragment,null,React.createElement("div",{className:(0,h.default)("sidebar-fixed-overlay ui page dimmer inverted",{active:null!=this.state.panelOpen}),onClick:function(){return e.closeAllPanel()}}),React.createElement(r.default,{fixed:"right",vertical:!0,compact:!0,icon:!0,className:"visita-sidebar right-sidebar",id:"app-right-sidebar"},React.createElement(r.default.Menu,null,_.map(this.props.actionItems,function(t,a){if("_"==a.substr(0,1)||null===t)return null;var n=t.onClick;return t.onClick=function(t,a){e.closeAllPanel(),n(t,a)},React.createElement(r.default.Item,y({key:a},t))}),this.props.visita.HojaTrabajo.proyecto.isOpen&&user_has_role_permission("paso_asignar_usuario")&&this.isActionItemEnabled("assign_user")&&React.createElement(r.default.Item,{link:!0,title:"Asignar usuario a esta visita",onClick:function(t){e.closeAllPanel(),e.setState({openAsignarUsuarioModal:!0})}},React.createElement(s.default.Group,{size:"large"},React.createElement(s.default,{name:"user outline"}),React.createElement(s.default,{corner:!0,name:"plus"}))),this.renderAsignUserModal(),u&&this.isActionItemEnabled("history")&&React.createElement(c.HojaTrabajoHistoryModal,{trigger:React.createElement(r.default.Item,{title:"Hoja Trabajo Año Anterior ",icon:{name:"history",size:"large"},onClick:this.closeAllPanel}),url:url_for(b+"prev")})),React.createElement(r.default.Menu,null,this.isActionItemEnabled("ajustes")&&React.createElement(p.MenuItemAjuste,{counter:v.ajustes,moduleParams:{id_paso:a,id_visita:l,model:"ajuste"},open:"ajuste"==this.state.panelOpen,onOpen:this.onItemOpen,modelManager:null}),this.isActionItemEnabled("hallazgo")&&React.createElement(d.MenuItemHallazgo,{modelManager:f.HallazgoHojaTrabajoModelManager.getInstance(),counter:v.hallazgos,moduleParams:{id_paso:a,id_visita:l,model:"hallazgo"},open:"hallazgo"==this.state.panelOpen,onOpen:this.onItemOpen}),this.isActionItemEnabled("muestreo")&&React.createElement(r.default.Item,{as:"a",className:"badged",href:url_for(b+"muestreo"),title:"Muestreo",onClick:this.closeAllPanel},React.createElement(i.default,{src:g+"muestreo.svg",size:"large"})," "," ",React.createElement(o.default,{size:"mini",className:"right",floating:!0,circular:!0,content:v.muestreos,color:0==v.muestreos?"green":"red"})),this.isActionItemEnabled("revision")&&React.createElement(m.MenuItemRevision,{counter:v.revisiones,moduleParams:{id_paso:a,id_visita:l,model:"revision"},modelManager:f.RevisionHojaTrabajoModelManager.getInstance(this.context),open:"revision"==this.state.panelOpen,onOpen:this.onItemOpen})),this.isActionItemEnabled("pdf")&&React.createElement(r.default.Menu,null,React.createElement(r.default.Item,{as:"a",href:url_for(b+"pdf.pdf"),target:"_blank",title:"Exportar como PDF",content:React.createElement(i.default,{src:g+"exportar_pdf.svg",size:"large"})}))))}}])&&g(a.prototype,l),b&&g(a,b),t}();t.default=C,C.contextType=l.default,C.defaultProps={actionItems:{}}},684:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HojaTrabajoAsignarVisitaModal=t.HojaTrabajoHistoryModal=void 0;var n=a(1),o=l(a(326)),r=l(a(55)),i=l(a(323)),s=l(a(228)),c=l(a(121));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,a){return t&&d(e.prototype,t),a&&d(e,a),e}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){var e;return p(this,t),(e=f(this,h(t).apply(this,arguments))).state={content:""},e.onOpen=function(){if(""==e.state.content){var t={height:350,removePlugins:"elementspath, uploadfile",toolbar:[{}]};e.setState({content:React.createElement(i.default,{active:!0})}),$.ajax(e.props.url,{dataType:"json"}).done(function(a){if(a.hasErrors)e.setState({content:React.createElement("div",{style:{color:"red",textAlign:"center",fontSize:"18px",fontWeight:"bold",marginTop:25}},"Hoja de Trabajo NO disponible")});else{var n="&nbsp;<div class='watermark-text' style='color:#08828a33; font-size:70px; font-weight: bold; transform:rotate(340deg); -webkit-transform:rotate(340deg); left: 35%; position: absolute; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;  '>Hoja Trabajo<br>Año Anterior</div>\n          <div class='watermarked-content' style='position:absolute; z-index:1;  margin-right: 20px; '>".concat(a.response.content,"</div>&nbsp;");e.setState({content:React.createElement(o.default,{data:n,readOnly:!0,config:t})})}})}},e}return b(t,n.Component),m(t,[{key:"render",value:function(){return React.createElement(s.default,{closeIcon:!0,trigger:this.props.trigger,content:this.state.content,header:"Hoja de Trabajo - Año Anterior",closeOnDimmerClick:!1,onOpen:this.onOpen,size:"fullscreen",dimmer:"inverted",style:{minHeight:400},className:"modal-ab"})}}]),t}();t.HojaTrabajoHistoryModal=y;var g=function(e){function t(e){var a;return p(this,t),(a=f(this,h(t).call(this,e))).onChange=function(e,t){a.setState({id_asignado:t.value})},a.onSave=function(){a.props.onSave(a.state.id_asignado),a.props.onClose()},a.onClose=function(){a.props.onClose()},a.state={id_asignado:e.visita.id_usuario_asignado},a}return b(t,n.Component),m(t,[{key:"render",value:function(){var e=this.props.visita,t=_.filter(e.HojaTrabajo.equipo,function(e){return e.rol.is_assignable}),a=_.map(t,function(e){return{key:e.user_id,text:e.name,value:e.user_id,description:e.rol.name,label:{content:e.sigla,circular:!0,color:"green"}}});return React.createElement(s.default,{closeIcon:!0,open:!0,closeOnDimmerClick:!1,size:"tiny",dimmer:"inverted",className:"modal-ab",onClose:this.onClose},React.createElement(s.default.Header,null,"Asignar/Reasignar visita a usuario"),React.createElement(s.default.Content,null,React.createElement("blockquote",null,React.createElement("strong",null,"Visita: ")," ",e.label),React.createElement(c.default,{placeholder:"Seleccione el usuario",defaultValue:e.id_usuario_asignado,selection:!0,clearable:!0,fluid:!0,options:a,onChange:this.onChange})),React.createElement(s.default.Actions,null,React.createElement(r.default,{primary:!0,content:"Aceptar",onClick:this.onSave})))}}]),t}();t.HojaTrabajoAsignarVisitaModal=g},685:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemAjuste=void 0;var n,o=a(1),r=a(101),i=a(181),s=a(345),c=a(697),l=(n=a(347))&&n.__esModule?n:{default:n},u=a(348);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){var e,a,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,n=f(t).apply(this,arguments),(e=!n||"object"!==p(n)&&"function"!=typeof n?h(a):n).cuentas=null,e.state={items:null},e.parseAjustes=function(t){var a=h(e),n=_.groupBy(t,"idx");return _.map(n,function(e,t){var n=_.map(e,function(e){return{id:e.id,cuenta:e.cuenta,debe:"DEBE"==e.col?e.valor:"",haber:"HABER"==e.col?e.valor:"",nombre_cuenta:a.getNombreCuenta(e.cuenta)}});return Object.assign({},{idx:t,items:n,status:e[0].status,descripcion:e[0].description,id_visita:e[0].id_proyecto_visita},_.pick(e[0],["fecha_completado","aplicado","fecha_revision","UpdateLog","RevisionLog"]))})},e.onCreateItem=function(t){return new Promise(function(a){$.blockUI(create_blockUI_loading_message("Creando ajuste"));var n=e.props.moduleParams,o=n.id_visita,r=n.id_paso;$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/visita/").concat(o,"/cifra-ajuste")),{changes:t,id_paso:r,v:2}).done(function(t){e.setState(function(a){var n=d(a.items);return n.push(e.parseAjustes(t.response.ajustes)[0]),{items:n}}),$.unblockUI(),a()})})},e.onMountPanel=function(){if(null===e.state.items){var t=e.props.moduleParams.id_visita;$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/visita/").concat(t,"/cifra-ajuste"))).done(function(a){e.cuentas=_.isEmpty(a.response.cuentas)?[]:a.response.cuentas,app.vars.error_tolerable[t]=a.response.error_tolerable,e.setState({items:_.isEmpty(a.response.ajustes)?[]:e.parseAjustes(a.response.ajustes)})})}},e.onSaveItem=function(t,a,n){return new Promise(function(o){var r=e.props.moduleParams,i=r.id_visita,s=r.id_paso;n&&setTimeout(function(){return $.blockUI(create_blockUI_loading_message(n))},100),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/visita/").concat(i,"/cifra-ajuste")),{idx:t.idx,changes:a,id_paso:s,v:2}).done(function(t){var a=e.parseAjustes(t.response.ajustes);e.setState(function(e){return{items:_.map(e.items,function(e){return e.idx==a[0].idx?a[0]:e})}}),n&&$.unblockUI(),o(a[0])})})},e.onClickDeleteItem=function(t){bootbox.warningConfirm("¿Desea eliminar el <strong>Ajuste #".concat(t.idx,"</strong>,\n      el cual contiene un total de ").concat(_.size(t.items)," registros contables?"),"No","Sí, Eliminar",function(a){if(a){var n=e.props.moduleParams.id_visita;$.blockUI(create_blockUI_loading_message("Eliminando ajustes")),$.ajax(url_for("proyecto/".concat(app.vars.idproyecto,"/visita/").concat(n,"/cifra-ajuste/").concat(t.idx)),{type:"delete"}).done(function(a){e.setState(function(e){return{items:_.reject(e.items,{idx:t.idx})}}),$.unblockUI()})}})},e}var a,n,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,o.PureComponent),a=t,(n=[{key:"getNombreCuenta",value:function(e){return(0,u.getNombreCuenta)(this.cuentas,e)}},{key:"renderContent",value:function(){var e={idx:null,status:"NUEVO",descripcion:"",id_visita:this.props.moduleParams.id_visita,items:_.fill(new Array(2),{cuenta:"",debe:null,haber:null,nombre_cuenta:""},0,2)};return React.createElement("div",{className:"content"},_.size(this.cuentas)>0&&React.createElement(i.MenuItemNew,{moduleParams:this.props.moduleParams,buttonText:"Crear Ajuste",headerText:"Nuevo Ajuste",isEditable:user_has_role_permission("ajustes_edit"),onSave:this.onCreateItem,item:e,contentAs:s.AjusteModal}),_.isArray(this.cuentas)&&0==_.size(this.cuentas)?React.createElement("div",{className:"ui message error",style:{marginTop:40}},React.createElement("i",{className:"icon warning sign"}),React.createElement("strong",null,"Advertencia: ")," Al parecer aún no se han cargado sumarias a esta visita."):React.createElement(c.AjusteList,{items:this.state.items,moduleParams:this.props.moduleParams,isEditable:es_proyecto_editable()&&user_has_role_permission("ajustes_edit"),onSaveItem:this.onSaveItem,onClickDeleteItem:this.onClickDeleteItem}))}},{key:"render",value:function(){return React.createElement(r.BaseMenuElement,{name:"ajuste",counter:null===this.state.items?this.props.counter:_.size(this.state.items),icon:"ajustes",title:"Ajustes",open:this.props.open,onToggle:this.props.onOpen,onMountPanel:this.onMountPanel},React.createElement(l.default.Provider,{value:this.cuentas},this.renderContent()))}}])&&m(a.prototype,n),v&&m(a,v),t}();t.MenuItemAjuste=v},688:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarPanelHeader=void 0;var n,o=(n=a(20))&&n.__esModule?n:{default:n},r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,l(t).apply(this,arguments))}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.PureComponent),a=t,(n=[{key:"componentDidMount",value:function(){(0,o.default)(this.props,"onMount")}},{key:"render",value:function(){return React.createElement("header",null,React.createElement("a",{href:"#",className:"close-link",onClick:this.props.onClose},React.createElement("i",{className:"ui icon close green"})),React.createElement("div",{className:"title"},this.props.title))}}])&&s(a.prototype,n),i&&s(a,i),t}();t.SidebarPanelHeader=p},689:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){void 0!==(e=Object.assign({},e,i)).value&&_.size(e.value)>0&&(e.value=+e.value);return void 0===e.isEditable||e.isEditable?React.createElement(n.default,e):React.createElement("span",{className:"autonumeric non-editable value"},o.default.format(e.value,e))};var n=r(a(690)),o=r(a(346));function r(e){return e&&e.__esModule?e:{default:e}}var i={decimalPlaces:2,decimalCharacter:",",decimalCharacterAlternative:".",digitGroupSeparator:".",allowDecimalPadding:!1,selectOnFocus:!1}},695:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericTooltip=void 0;var n=i(a(99)),o=i(a(64)),r=i(a(696));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=function(e){var t;if("object"==s(e.text))t=React.createElement("div",{className:"content"},e.text);else if("string"==typeof e.text){if(!(t="@"==e.text.substr(0,1)?(0,r.default)(app.vars.texts,e.text.substr(1)):e.text))return null;t=React.createElement("div",{dangerouslySetInnerHTML:{__html:t}})}return React.createElement(n.default,{size:"tiny",wide:e.wide,trigger:React.createElement(o.default,{color:e.iconColor,size:e.iconSize,name:"question circle",className:"tooltip-icon"}),header:e.title,content:t})};t.GenericTooltip=c,c.defaultProps={iconColor:"blue",iconSize:"small",wide:!1}},697:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AjusteList=void 0;var n=a(1),o=p(a(98)),r=a(101),i=a(345),s=a(100),c=a(122),l=p(a(99)),u=a(349);function p(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,a){return t&&f(e.prototype,t),a&&f(e,a),e}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(){return m(this,t),b(this,v(t).apply(this,arguments))}return y(t,n.PureComponent),h(t,[{key:"render",value:function(){var e=this;if(null===this.props.items)return React.createElement("div",{style:{height:300,position:"relative"}},React.createElement("div",{className:"ui active inverted text loader elastic olive"},"Cargando Listado de Ajustes"));if(0==_.size(this.props.items))return React.createElement("div",{className:"empty nocontent"},"0 Ajustes");var t=this.props.items;return React.createElement(r.MenuElementListPanel,{className:"ajustes-list"},_.map(t,function(t){return React.createElement("div",{key:t.idx,className:"listitem ajuste-listitem"},React.createElement(R,{item:t,isEditable:e.props.isEditable,onSave:e.props.onSaveItem,onClickDelete:e.props.onClickDeleteItem}))}))}}]),t}();t.AjusteList=E;var R=function(e){function t(){var e;return m(this,t),(e=b(this,v(t).apply(this,arguments))).state={isModalEdit:!1},e.onClickDelete=function(t){t.preventDefault(),e.props.onClickDelete(e.props.item)},e.onClickEdit=function(t){t.preventDefault(),e.setState({isModalEdit:!0})},e.onCloseEdit=function(){e.setState({isModalEdit:!1})},e.onSave=function(t,a,n){e.props.onSave(t,a,n)},e}return y(t,n.PureComponent),h(t,[{key:"render",value:function(){var e=this.props.item;return React.createElement("div",null,this.props.isEditable&&React.createElement(r.MenuElementListActions,{actions:{edit:{label:"Editar",callback:this.onClickEdit,permission:"ajustes_edit"},delete:{label:"Eliminar",callback:this.onClickDelete,permission:"ajustes_delete"}}}),React.createElement("div",{onClick:this.onClickEdit},React.createElement("div",{className:"row r1"},React.createElement("div",{className:"pull-left r1_1"},React.createElement("span",{className:"title-h1"}," Ajuste #",e.idx),React.createElement(s.AuthorIconLogDefaultWrapper,{model:e,size:"small"}),React.createElement("div",{className:"r1_2"},React.createElement("strong",null,"Ajuste Registrado: ")," ",""+e.aplicado=="1"?"Sí":"No")),React.createElement(c.StatusDivBlock,{wrapperClassName:"pull-right text-mini",status:e.status||"EN PROCESO",className:"mini",hideLabel:!0})),React.createElement("table",{className:"ui compact very basic celled striped small table table-ajustes"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Cuenta"),React.createElement("th",null,"Debe"),React.createElement("th",null,"Haber"))),React.createElement("tbody",null,_.map(e.items,function(e){return React.createElement(n.Fragment,{key:e.id},!C(e.debe)&&React.createElement("tr",null,React.createElement("td",null,React.createElement(l.default,{trigger:React.createElement("span",null,e.cuenta),content:e.nombre_cuenta,header:e.cuenta,size:"mini"})),React.createElement("td",{className:"right aligned"},accounting.formatNumber(e.debe)),React.createElement("td",null," ")),!C(e.haber)&&React.createElement("tr",null,React.createElement("td",null,React.createElement(l.default,{trigger:React.createElement("span",null,e.cuenta),content:e.nombre_cuenta,header:e.cuenta,size:"mini"})),React.createElement("td",null," "),React.createElement("td",{className:"right aligned"},accounting.formatNumber(e.haber))))}))),e.descripcion&&React.createElement("div",{className:"item-description"},React.createElement("div",{className:"editor-preview",dangerouslySetInnerHTML:{__html:(0,u.truncateText)(e.descripcion)}}))),this.state.isModalEdit&&React.createElement(j,{item:e,onSave:this.onSave,onClickDelete:this.onClickDelete,onClose:this.onCloseEdit,isEditable:this.props.isEditable}))}}]),t}(),j=function(e){function t(){var e;return m(this,t),(e=b(this,v(t).apply(this,arguments))).onSave=function(t,a){e.props.onSave(e.props.item,t,a)},e}return y(t,n.PureComponent),h(t,[{key:"render",value:function(){return React.createElement(o.default,{open:!0,dimmer:"inverted",className:"modal-ab modal-sidebarmenuitem",size:"large",closeIcon:!0,onClose:this.props.onClose,closeOnEscape:!1,closeOnDimmerClick:!1},React.createElement(o.default.Header,null,"Editar Ajuste"),React.createElement(i.AjusteModal,{moduleParams:{id_visita:this.props.item.id_visita,model:"ajuste"},item:this.props.item,isEditable:this.props.isEditable,onSave:this.onSave,onClickDelete:this.props.onClickDelete}))}}]),t}(),C=function(e){return!_.isNumber(e)&&0==_.size(e)}},699:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemHallazgo=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};n.get||n.set?Object.defineProperty(t,a,n):t[a]=e[a]}return t.default=e,t}(a(1)),o=a(101),r=a(181),i=a(700),s=a(229),c=a(350);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=d(this,m(t).apply(this,arguments))).state={items:null},e.onMountPanel=function(){null===e.state.items&&e.props.modelManager.getJson(e.props).then(function(t){e.setState({items:t})})},e.onCreateItem=function(t){return new Promise(function(a){$.blockUI(create_blockUI_loading_message("Creando Hallazgo")),e.props.modelManager.createItem(e.props,t).then(function(t){e.addItem(t),$.unblockUI(),a()})})},e.onSaveItem=function(t,a,n){return new Promise(function(o){n?$.blockUI(create_blockUI_loading_message(n)):e.updateItem(t,a),e.props.modelManager.saveItem(e.props,t,a).then(function(a){e.updateItem(t,a),n&&$.unblockUI(),o(a)})})},e.onClickDeleteItem=function(t){bootbox.warningConfirm("¿Desea eliminar el hallazgo <strong>".concat(s.HallazgoUtils.formatName(t.name),"</strong> ?"),"No","Sí, Eliminar",function(a){a&&($.blockUI(create_blockUI_loading_message("Eliminando Hallazgo")),e.props.modelManager.deleteItem(e.props,t).then(function(){e.deleteItem(t),$.unblockUI()}))})},e}var a,l,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.PureComponent),a=t,(l=[{key:"addItem",value:function(e){this.setState(function(t){return{items:[].concat(u(t.items),[e])}})}},{key:"updateItem",value:function(e,t){this.setState(function(a){return{items:_.map(a.items,function(a){return a.id==e.id?Object.assign({},a,t):a})}})}},{key:"deleteItem",value:function(e){this.setState(function(t){return{items:_.reject(t.items,{id:e.id})}})}},{key:"render",value:function(){return n.default.createElement(o.BaseMenuElement,{name:"hallazgo",counter:null===this.state.items?this.props.counter:_.size(this.state.items),icon:"hallazgos",title:"Hallazgos",open:this.props.open,onToggle:this.props.onOpen,onMountPanel:this.onMountPanel},n.default.createElement("div",{className:"content"},n.default.createElement(r.MenuItemNew,{moduleParams:this.props.moduleParams,buttonText:"Crear Hallazgo",headerText:"Nuevo Hallazgo",isEditable:es_proyecto_editable()&&user_has_role_permission("hallazgo_create"),item:{id:null,status:"NUEVO",implementado:null,hallazgo:"",RevisionLog:[],UpdateLog:[]},onSave:this.onCreateItem,contentAs:c.HallazgoModal}),n.default.createElement(i.HallazgoList,{isEditable:es_proyecto_editable()&&user_has_role_permission("hallazgo_edit"),moduleParams:this.props.moduleParams,items:this.state.items,onSaveItem:this.onSaveItem,onClickDeleteItem:this.onClickDeleteItem})))}}])&&p(a.prototype,l),h&&p(a,h),t}();t.MenuItemHallazgo=h},700:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoListItem=t.HallazgoList=void 0;var n=a(1),o=a(229),r=a(100),i=a(701),s=a(101),c=a(122),l=a(349);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,a){return t&&d(e.prototype,t),a&&d(e,a),e}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){return p(this,t),f(this,h(t).apply(this,arguments))}return b(t,n.PureComponent),m(t,[{key:"render",value:function(){var e=this;if(null===this.props.items)return React.createElement("div",{style:{height:300,position:"relative"}},React.createElement("div",{className:"ui active inverted text loader elastic olive"},"Cargando Listado de Hallazgos"));if(0==_.size(this.props.items))return React.createElement("div",{className:"empty nocontent"},"0 Hallazgos");var t=this.props.items;return React.createElement(s.MenuElementListPanel,null,_.map(t,function(t){return React.createElement("div",{key:t.id,className:"listitem hallazgo-listitem"},React.createElement(g,{item:t,moduleParams:e.props.moduleParams,onSave:e.props.onSaveItem,onClickDelete:e.props.onClickDeleteItem}))}))}}]),t}();t.HallazgoList=y;var g=function(e){function t(){var e;return p(this,t),(e=f(this,h(t).apply(this,arguments))).state={isModalEdit:!1},e.onClickEdit=function(t){t.preventDefault(),e.setState({isModalEdit:!0})},e.onCloseEdit=function(){e.setState({isModalEdit:!1})},e.onClickDelete=function(t){t.preventDefault(),e.props.onClickDelete(e.props.item)},e.onSave=function(t,a){var n=null;_.isEqual(a,{status:"COMPLETADO"})?n="Marcando como COMPLETADO":_.isEqual(a,{status:"REVISADO"})&&(n="Marcando como REVISADO"),e.props.onSave(t,a,n)},e}return b(t,n.PureComponent),m(t,[{key:"renderDescripcion",value:function(){var e=this.props.item,t=(0,l.truncateText)(e.hallazgo);return React.createElement("div",{dangerouslySetInnerHTML:{__html:t}})}},{key:"renderEstadoImplementacion",value:function(){var e=this.props.item;return null==e.implementado||""+e.implementado==""?"Pendiente":"0"==e.implementado?"En Proceso":"Hecho"}},{key:"render",value:function(){var e=this,t=this.props.item;return React.createElement("div",null,React.createElement(s.MenuElementListActions,{actions:{edit:{label:"Editar",callback:this.onClickEdit,permission:"hallazgo_edit"},delete:{label:"Eliminar",callback:this.onClickDelete,permission:"hallazgo_delete"}}}),React.createElement("div",{onClick:function(){return e.setState({isModalEdit:!0})}},React.createElement("div",{className:"row r1"},React.createElement("div",{className:"pull-left r1_1"},React.createElement("span",{className:"title-h1"},o.HallazgoUtils.formatName(t.name)),React.createElement(r.AuthorIconLogDefaultWrapper,{model:t,size:"small"}),React.createElement("div",{className:"r1_2"},React.createElement("strong",null,"Implementación: ")," ",this.renderEstadoImplementacion())),React.createElement(c.StatusDivBlock,{wrapperClassName:"pull-right text-mini",status:t.status,className:"mini",hideLabel:!0})),React.createElement("div",{className:"row"},React.createElement("div",{className:"editor-preview"},this.renderDescripcion())),React.createElement("div",{className:"row"})),this.state.isModalEdit&&React.createElement(i.HallazgoModalEdit,{item:t,moduleParams:this.props.moduleParams,onSave:this.onSave,onClickDelete:this.onClickDelete,onClose:this.onCloseEdit}))}}]),t}();t.HallazgoListItem=g},701:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoModalEdit=void 0;var n,o=a(1),r=(n=a(98))&&n.__esModule?n:{default:n},i=a(350);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=l(this,u(t).apply(this,arguments))).onSave=function(t){e.props.onSave(e.props.item,t)},e}var a,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,o.PureComponent),a=t,(n=[{key:"render",value:function(){return React.createElement(r.default,{open:!0,dimmer:"inverted",className:"modal-ab modal-sidebarmenuitem",size:"large",closeIcon:!0,onClose:this.props.onClose},React.createElement(r.default.Header,null,"Editar Hallazgo"),React.createElement(i.HallazgoModal,{moduleParams:this.props.moduleParams,item:this.props.item,isEditable:user_has_role_permission("hallazgo_edit"),onSave:this.onSave,onClickDelete:this.props.onClickDelete}))}}])&&c(a.prototype,n),s&&c(a,s),t}();t.HallazgoModalEdit=d},723:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemRevision=void 0;var n=a(1),o=a(101),r=s(a(724)),i=s(a(364));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,a){return t&&p(e.prototype,t),a&&p(e,a),e}function m(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).state={items:null},e.parseItems=function(e){return e},e.onMountPanel=function(){null===e.state.items&&e.props.modelManager.getJson(e.props).then(function(t){e.setState({items:t})})},e.onCreateItem=function(t,a){$.blockUI(create_blockUI_loading_message("Creando Nota de Revisión")),e.props.modelManager.createItem(e.props,{revision_text:t.text,op:t.status}).then(function(t){e.setState(function(e){var a=l(e.items);return a.push(t),{items:a}}),a(),$.unblockUI()})},e.onSaveItem=function(t,a,n){return new Promise(function(o){n&&setTimeout(function(){return $.blockUI(create_blockUI_loading_message(n))},100),e.props.modelManager.saveItem(e.props,t,a).then(function(t){e.setState(function(e){return{items:_.map(e.items,function(e){return e.id==t.id?t:e})}}),n&&$.unblockUI(),o(t)})})},e.onClickDeleteItem=function(t){bootbox.warningConfirm("¿Desea eliminar esta Nota de Revisión <b>#".concat(t.name,"</b> ?"),"No","Sí, Eliminar",function(a){a&&($.blockUI(create_blockUI_loading_message("Eliminando Nota de Revisión")),e.props.modelManager.deleteItem(e.props,t).then(function(){e.setState(function(e){return{items:_.reject(e.items,{id:t.id})}}),$.unblockUI()}))})},e}return h(t,n.PureComponent),d(t,[{key:"renderContent",value:function(){return React.createElement("div",{className:"content"},React.createElement(y,{onSubmit:this.onCreateItem}),React.createElement(r.default,{items:this.state.items,moduleParams:this.props.moduleParams,isEditable:es_proyecto_editable()&&user_has_role_permission("revision_edit"),onSaveItem:this.onSaveItem,onClickDeleteItem:this.onClickDeleteItem}))}},{key:"render",value:function(){return React.createElement(o.BaseMenuElement,{name:"revision",counter:null===this.state.items?this.props.counter:_.size(_.reject(this.state.items,{status:"REVISADO"})),icon:"notas_de_revision",title:"Notas de Revisión",open:this.props.open,onToggle:this.props.onOpen,onMountPanel:this.onMountPanel},this.renderContent())}}]),t}();t.MenuItemRevision=v;var y=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).state={text:"",isEditMode:!1},e.onChange=function(t){e.setState({text:t.target.value})},e.onTextareaKeyDown=function(t){27==t.keyCode&&e.onCancel(),!t.ctrlKey&&!t.metaKey||13!=t.keyCode&&10!=t.keyCode||e.onSubmit("NUEVO")},e.onClickNew=function(){e.setState({isEditMode:!0})},e.onCancel=function(){e.setState({isEditMode:!1,text:""})},e.onSubmit=function(t){""!=_.str.trim(e.state.text)?e.props.onSubmit({text:_.str.trim(e.state.text),status:t},function(){e.setState({text:"",isEditMode:!1})}):bootbox.alertError("La Nota de Revisión no puede estar vacía.")},e}return h(t,n.PureComponent),d(t,[{key:"render",value:function(){var e=this;return es_proyecto_editable()&&user_has_role_permission("revision_edit")?this.state.isEditMode?React.createElement("div",null,React.createElement(i.default,{minRows:2,maxRows:8,autoFocus:!0,onChange:this.onChange,value:this.state.text,style:{width:"98%"},onKeyDown:this.onTextareaKeyDown,placeholder:"Escriba aquí su Nota de Revisión"}),React.createElement("div",{style:{marginTop:8,textAlign:"right"}},React.createElement("button",{className:"ui button negative mini compact",onClick:this.onCancel},"Cancelar"),React.createElement("button",{className:"ui button primary mini compact",onClick:function(){return e.onSubmit("NUEVO")}},"Guardar"))):React.createElement("div",{style:{textAlign:"center"}},React.createElement("button",{className:"ui button primary mini compact",onClick:this.onClickNew},"Crear Nota")):null}}]),t}()},724:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),o=a(101),r=a(100),i=a(122),s=u(a(364)),c=u(a(9)),l=u(a(179));function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,a){return t&&m(e.prototype,t),a&&m(e,a),e}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){return d(this,t),h(this,b(t).apply(this,arguments))}return v(t,n.PureComponent),f(t,[{key:"render",value:function(){var e=this;if(null===this.props.items)return React.createElement("div",{style:{height:300,position:"relative"}},React.createElement("div",{className:"ui active inverted text loader elastic olive"},"Cargando Notas de Revisión"));if(0==_.size(this.props.items))return React.createElement("div",{className:"empty nocontent"},"0 Notas de Revisión");var t=this.props.items,a=_.reject(t,{status:"REVISADO"}),n=_.filter(t,{status:"REVISADO"});return React.createElement(o.MenuElementListPanel,{className:"revision-list"},0==_.size(a)?React.createElement("div",{className:"empty nocontent"},"0 Notas de Revisión Abiertas"):_.map(a,function(t){return React.createElement("div",{key:t.id,className:"listitem revision-listitem"},React.createElement(R,{item:t,isEditable:e.props.isEditable,onSave:e.props.onSaveItem,onClickDelete:e.props.onClickDeleteItem}))}),_.size(n)>0&&React.createElement(E,{items:n}))}}]),t}();t.default=g;var E=function(e){function t(){var e;return d(this,t),(e=h(this,b(t).apply(this,arguments))).state={collapsed:!0},e.toggle=function(){e.setState(function(e){return{collapsed:!e.collapsed}})},e}return v(t,n.PureComponent),f(t,[{key:"render",value:function(){var e=this.props.items;return React.createElement("div",{style:{marginTop:20,marginBottom:20,padding:"0 10px"}},React.createElement("h4",{className:"row clickable",onClick:this.toggle},React.createElement("i",{className:(0,c.default)("icon caret",this.state.collapsed?"right":"down")})," Notas Revisadas",React.createElement("span",{className:"toggle-action"},"[",this.state.collapsed?"Mostrar":"Ocultar","]"),React.createElement("span",{className:"ui mini circular green label pull-right"},_.size(e))),!this.state.collapsed&&React.createElement("div",{className:"revision-list-closed"},_.map(e,function(e){return React.createElement("div",{key:e.id,className:"listitem revision-listitem"},React.createElement(R,{item:e,isEditable:!1}))})))}}]),t}(),R=function(e){function t(){var e;return d(this,t),(e=h(this,b(t).apply(this,arguments))).state={isEditMode:!1,isThreadOpen:!1},e.onClickEdit=function(){e.setState({isEditMode:!0})},e.onClickDelete=function(t){t.preventDefault(),e.props.onClickDelete(e.props.item)},e.onClickNewComment=function(){e.props.isEditable&&e.setState({isThreadOpen:!0})},e.onCancelNewComment=function(){e.setState({isThreadOpen:!1})},e.onChange=function(t){e.props.onSave(e.props.item,t,"Guardando cambios...").then(function(){e.setState({isEditMode:!1})})},e.onClickChangeStatus=function(t){e.props.onSave(e.props.item,{op:t},"Marcando como "+t+"...")},e.onAddComment=function(t){var a={comment:t.text};t.status&&(a.op=t.status),e.props.onSave(e.props.item,a,"Guardando comentario...").then(function(){e.setState({isThreadOpen:!1})})},e}return v(t,n.PureComponent),f(t,[{key:"render",value:function(){var e=this,t=this.props.item;return React.createElement("div",null,this.props.isEditable&&React.createElement(o.MenuElementListActions,{actions:{delete:{label:"Eliminar",callback:this.onClickDelete,permission:"revision_delete"}}}),React.createElement("div",{className:"row header-item"},React.createElement("div",{className:"pull-left"},React.createElement("span",{className:"title-h1"},"Nota #",t.name),React.createElement(r.AuthorIconLogDefaultWrapper,{model:t,size:"small"})),React.createElement(i.StatusDivBlock,{wrapperClassName:"pull-right text-mini",status:t.status||"EN PROCESO",className:"mini",hideLabel:!0})),React.createElement("div",{className:"author-info"},React.createElement("i",{"aria-hidden":"true",className:"user circle icon olive",style:{float:"left"}}),React.createElement("div",{className:"content"},React.createElement("div",{className:"header"},t.Creator.User.name,React.createElement("div",{className:"pull-right description"},Date.create(t.Creator.ts).format("{d} {Mon} {year} {h}:{mm} {tt}"))))),this.props.isEditable&&this.state.isEditMode?React.createElement(j,{item:t,onSubmit:this.onChange}):React.createElement(n.Fragment,null,React.createElement("p",{onClick:this.onClickNewComment,style:{lineHeight:"1em"},dangerouslySetInnerHTML:{__html:t.description.replace(/\n/g,"<br/>")}}),React.createElement("div",{className:(0,c.default)("threadlist ui threaded comments",{empty:0==_.size(t.Comments)})},this.state.isThreadOpen&&React.createElement("h5",{className:(0,c.default)("ui header",{dividing:0==_.size(t.Comments)})},"Comentarios"),_.map(t.Comments,function(t){return React.createElement("div",{className:"comment",key:t.id,onClick:e.onClickNewComment},React.createElement("div",{className:"avatar"},React.createElement("i",{className:(0,c.default)("icon user circle",{green:"COMPLETADO"==t.status,olive:"REVISADO"==t.status})})),React.createElement("div",{className:"content"},React.createElement("div",{className:"author"},t.Creator.User.name),React.createElement("div",{className:"metadata"},Date.create(t.Creator.ts).format("{d} {Mon} {year}  {h}:{mm} {tt}")),React.createElement("div",{className:"text"},React.createElement("p",{dangerouslySetInnerHTML:{__html:t.comentario}}))))})),this.state.isThreadOpen&&this.props.isEditable?React.createElement(C,{parentItem:t,onSave:this.onAddComment,onCancel:this.onCancelNewComment}):this.props.isEditable&&React.createElement("div",{className:"actions-wrapper"},React.createElement("div",{className:"actions"},React.createElement("div",{className:"group-actions"},React.createElement("button",{className:"ui button icon blue mini compact",onClick:this.onClickNewComment},"Responder")),React.createElement("div",{className:"group-actions right-actions"},React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onClickChangeStatus("COMPLETADO")}},React.createElement("i",{className:"icon check"})," Completar"),React.createElement(l.default,{disabled:null!=t.fecha_completado,className:"disable-text",on:"hover",basic:!0,content:"Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button mini compact olive",disabled:null==t.fecha_completado,onClick:function(){return null==t.fecha_completado?void 0:e.onClickChangeStatus("REVISADO")}},React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado"))}))))))}}]),t}(),j=function(e){function t(e){var a;return d(this,t),(a=h(this,b(t).call(this,e))).onChange=function(e){a.setState({value:e.target.value})},a.onSubmit=function(e){if(""!=_.str.trim(a.state.value)){var t={revision_text:_.str.trim(a.state.value)};e&&(t.op=e),a.props.onSubmit(t)}else bootbox.alertError("La Nota de Revisión no puede estar vacía.")},a.state={value:a.props.item.description},a}return v(t,n.PureComponent),f(t,[{key:"render",value:function(){var e=this;return React.createElement(n.Fragment,null,React.createElement(s.default,{minRows:2,maxRows:8,onChange:this.onChange,value:this.state.value,style:{width:"98%"},placeholder:"Escriba aquí su Nota de Revisión"}),React.createElement("div",{style:{marginTop:8,textAlign:"right"}},React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onSubmit()}},"Guardar"),React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onSubmit("COMPLETADO")}},React.createElement("i",{className:"icon check"})," Completar"),React.createElement(l.default,{disabled:null!=this.props.item.fecha_completado,className:"disable-text",on:"hover",basic:!0,content:"Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button mini compact olive",disabled:null==this.props.item.fecha_completado,onClick:function(){return null==e.props.item.fecha_completado?void 0:e.onSubmit("REVISADO")}},React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado"))})))}}]),t}(),C=function(e){function t(){var e;return d(this,t),(e=h(this,b(t).apply(this,arguments))).cancelTimeout=null,e.state={value:""},e.onChange=function(t){e.setState({value:t.target.value})},e.onTextareaKeyDown=function(t){27==t.keyCode&&(e.props.onCancel(),e.cancelTimeout=null),!t.ctrlKey&&!t.metaKey||13!=t.keyCode&&10!=t.keyCode||e.onSubmit()},e.onSubmit=function(t){(""!=_.str.trim(e.state.value)||t)&&(null!=e.cancelTimeout&&(window.clearTimeout(e.cancelTimeout),e.cancelTimeout=null),e.props.onSave({text:_.str.trim(e.state.value),status:t}))},e.onBlur=function(){e.cancelTimeout=window.setTimeout(function(){e.props.onCancel()},500)},e}return v(t,n.PureComponent),f(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{style:{marginBottom:30}},React.createElement(s.default,{minRows:2,maxRows:5,autoFocus:!0,value:this.state.value,onChange:this.onChange,onKeyDown:this.onTextareaKeyDown,placeholder:"Escriba aquí su comentario",style:{width:"95%"},onBlur:function(){return e.onBlur()}}),React.createElement("div",{style:{textAlign:"right",marginTop:5}},React.createElement("button",{className:"ui button icon blue mini compact pull-left",onClick:function(){return e.onSubmit()}},"Enviar"),React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onSubmit("COMPLETADO")}},React.createElement("i",{className:"icon check"})," Completar"),React.createElement(l.default,{disabled:null!=this.props.parentItem.fecha_completado,className:"disable-text",on:"hover",basic:!0,content:"Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button mini compact olive",disabled:null==this.props.parentItem.fecha_completado,onClick:function(){return null==e.props.parentItem.fecha_completado?void 0:e.onSubmit("REVISADO")}},React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado"))})))}}]),t}()},725:function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionHojaTrabajoModelManager=t.HallazgoHojaTrabajoModelManager=void 0;var i=function(){function e(){n(this,e)}return r(e,[{key:"getJson",value:function(e){var t=e.moduleParams,a=t.id_paso,n=t.id_visita;return new Promise(function(e){$.getJSON(url_for2("proyecto/:id_proyecto/paso/".concat(a,"/visita/").concat(n,"/hallazgo/json"))).done(function(t){e(_.isEmpty(t.response)?[]:t.response)})})}},{key:"createItem",value:function(e,t){var a=e.moduleParams,n=a.id_paso,o=a.id_visita,r=url_for2("proyecto/:id_proyecto/paso/".concat(n,"/visita/").concat(o,"/hallazgo"));return new Promise(function(e){$.post(r,{data:t}).done(function(t){e(t.response.record)})})}},{key:"saveItem",value:function(e,t,a){var n;n=_.isEqual(a,{status:"COMPLETADO"})?"proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id/c":_.isEqual(a,{status:"REVISADO"})?"proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id/r":"proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id";var o=e.moduleParams,r=o.id_paso,i=o.id_visita;return new Promise(function(e){$.post(url_for2(n,{id_paso:r,id_visita:i,id:t.id}),{data:a}).done(function(t){e(t.response.record)})})}},{key:"deleteItem",value:function(e,t){var a=e.moduleParams,n=a.id_paso,o=a.id_visita;return new Promise(function(e){$.ajax({url:url_for2("proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/hallazgo/:id",{id_paso:n,id_visita:o,id:t.id}),type:"DELETE"}).done(function(t){1==t.status&&e()})})}},{key:"parseItems",value:function(e){return e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new this),e.instance}}]),e}();t.HallazgoHojaTrabajoModelManager=i;var s=function(){function e(){n(this,e)}return r(e,[{key:"getJson",value:function(e){var t=this,a=e.moduleParams,n=a.id_paso,o=a.id_visita;return new Promise(function(e){$.getJSON(url_for2("proyecto/:id_proyecto/paso/".concat(n,"/visita/").concat(o,"/revision"))).done(function(a){e(_.isEmpty(a.response.revisiones)?[]:t.parseItems(a.response.revisiones))})})}},{key:"createItem",value:function(e,t){var a=this,n=e.moduleParams,o=n.id_paso,r=n.id_visita,i=url_for2("proyecto/:id_proyecto/paso/".concat(o,"/visita/").concat(r,"/revision"));return new Promise(function(e){$.post(i,t).done(function(t){e(t.response.revision),a.updateVisita(r,t.response.paso_visita)})})}},{key:"saveItem",value:function(e,t,a){var n=this,o=e.moduleParams,r=o.id_visita,i=o.id_paso,s=url_for2("proyecto/:id_proyecto/paso/".concat(i,"/visita/").concat(r,"/revision/").concat(t.id));return new Promise(function(e){$.post(s,a).done(function(t){e(t.response.revision),n.updateVisita(r,t.response.paso_visita)})})}},{key:"deleteItem",value:function(e,t){var a=this,n=e.moduleParams,o=n.id_paso,r=n.id_visita;return new Promise(function(e){$.ajax({url:url_for2("proyecto/:id_proyecto/paso/:id_paso/visita/:id_visita/revision/:item_id",{id_paso:o,id_visita:r,item_id:t.id}),type:"DELETE"}).done(function(t){e(),a.updateVisita(r,t.response.paso_visita)})})}},{key:"parseItems",value:function(e){return e}},{key:"updateVisita",value:function(e,t){var a=this.hojaTrabajoContext,n=a.hoja_trabajo,o=a.update,r=Object.assign({},n);r.visitas=_.mapValues(r.visitas,function(a){return a.id_visita==e&&(a=Object.assign({},a,t)),a}),o(r)}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new this,e.instance.hojaTrabajoContext=t),e.instance}}]),e}();t.RevisionHojaTrabajoModelManager=s},733:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),o=u(a(286)),r=a(100),i=u(a(75)),s=a(734),c=a(750),l=u(a(180));function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=m(this,f(t).call(this,e))).handleClick=function(e){a.setState({activeIndex:e});var t=_.find(a.state.hoja_trabajo.visitas,{index:e});app.vars.current_idvisita=t.id_visita,$("#table-visita-instrucciones-".concat(t.id)).floatThead("reflow")},a.onChangeVisita=function(e){a.setState(function(t){var a=Object.assign({},t.hoja_trabajo);return a.visitas=_.map(a.visitas,function(t){return t.index+""==e.index+""?e:t}),{hoja_trabajo:a}})},a.onChangeApp=function(e){a.setState(function(t){return{hoja_trabajo:Object.assign({},t.hoja_trabajo,e)}})},a.onClickActionElement=function(e,t,n){switch(e.preventDefault(),t){case"CREATE":bootbox.prompt({header:"Nuevo Periodo",content:"<div>Escriba el nombre del periodo que desea crear.</div>"},"Cancelar","Crear",function(e){if(e&&""!=_.str.trim(e)){var t=a.getUrlFor("periodo");$.blockUI(create_blockUI_loading_message("Creando Nuevo Periodo")),$.ajax(t,{type:"POST",data:{id_paso:a.state.hoja_trabajo.paso.id,name:_.str.trim(e)},dataType:"json"}).done(function(e){e.hasErrors?bootbox.alert(e.message):a.setState(function(t){var a=t.hoja_trabajo;return a.visitas[e.response.id_visita]=e.response,{hoja_trabajo:a,activeIndex:e.response.index}}),$.unblockUI()})}},""),$(".bootbox.modal").addClass("modal-ab");break;case"RENAME":bootbox.prompt({header:"Renombrar Periodo",content:"Escriba el nombre que desea asignarle a este periodo."},"Cancelar","Aceptar",function(e){if(e&&""!=_.str.trim(e)){$.blockUI(create_blockUI_loading_message("Guardando cambios"));var t=url_for("proyecto/".concat(a.state.hoja_trabajo.proyecto.id,"/master_data/paso-visita/rename/").concat(n.id_visita));$.ajax(t,{type:"POST",data:{name:_.str.trim(e)},dataType:"json"}).done(function(t){t.hasErrors||a.setState(function(t){var a=t.hoja_trabajo;return a.visitas=_.map(a.visitas,function(t){return t.id_visita==n.id_visita&&(t.label=_.str.trim(e)),t}),{hoja_trabajo:a}}),$.unblockUI()})}},n.label),$(".bootbox.modal").addClass("modal-ab");break;case"DELETE":bootbox.warningConfirm("¿Desea eliminar este periodo?","No","Sí, Eliminar periodo",function(e){if(e){$.blockUI(create_blockUI_loading_message('Eliminando Periodo "'.concat(n.label,'"')));var t=url_for("proyecto/".concat(a.state.hoja_trabajo.proyecto.id,"/master_data/paso-visita/delete/").concat(n.id_visita));$.ajax(t,{type:"POST",dataType:"json"}).done(function(e){$.unblockUI(),e.hasErrors||a.setState(function(e){var t=e.hoja_trabajo;t.visitas=_.reject(t.visitas,function(e){return e.id_visita==n.id_visita});var a=e.activeIndex;return a==n.index&&(a=_.head(t.visitas).index),{hoja_trabajo:t,activeIndex:a}})})}})}};var n=_.find(a.props.hoja_trabajo.visitas,{is_current:!0}),o=n?n.index:null;return n&&(app.vars.current_idvisita=n.id_visita),a.state={activeIndex:o,newVisitaOpen:!1,hoja_trabajo:a.props.hoja_trabajo},a}var a,u,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n.Component),a=t,p=[{key:"shortVisitaName",value:function(e){return _.forEach({Enero:"Ene",Febrero:"Feb",Marzo:"Mar",Abril:"Abr",Mayo:"May",Junio:"Jun",Julio:"Jul",Agosto:"Ago",Septiembre:"Sept",Octubre:"Oct",Noviembre:"Nov",Diciembre:"Dic"},function(t,a){e=e.replace(new RegExp(a,"gi"),t)}),e}}],(u=[{key:"getUrlFor",value:function(e){return url_for("proyecto/".concat(this.props.hoja_trabajo.proyecto.id,"/hoja-trabajo/paso/").concat(this.props.hoja_trabajo.paso.id,"/").concat(e))}},{key:"isAllowedAsociarVisita",value:function(){return!!user_has_role_permission("paso_asociar_visita")&&!!this.state.hoja_trabajo.proyecto.isOpen&&void 0}},{key:"renderTab",value:function(e,a){var n=null;e.status&&(n=React.createElement(i.default,{style:{backgroundColor:e.status_color},className:"visita-status visita-status-".concat(_.str.underscored(e.status)),size:"mini"},e.status));var o=e.fecha_completado&&e.fecha_revision&&Date.create(e.fecha_completado)>Date.create(e.fecha_revision)?"Modificado despues de Revisado":null;return React.createElement(s.Tab,{key:e.id,className:"item tab-nav-item visita-tab"},React.createElement("span",{className:"tabname"},t.shortVisitaName(e.label)),React.createElement("div",{className:"author-icon-log-wrapper"},React.createElement(r.AuthorIconLog,{log:e.UpdateLog,name:"Preparado por",label:"P",iconColor:"green"}),React.createElement(r.AuthorIconLog,{log:e.RevisionLog,name:"Revisado por",label:"R",iconColor:"olive",alertText:o})),n)}},{key:"renderPanel",value:function(e,t){return React.createElement(s.Panel,{key:e.id},React.createElement(o.default,{idx:e.index,active:this.state.activeIndex==e.index,visita:e,type:"PERIODO",isEditable:this.state.hoja_trabajo.proyecto.isOpen,onChange:this.onChangeVisita,onChangeApp:this.onChangeApp}))}},{key:"renderModalContent",value:function(){var e=this;if(!this.state.hoja_trabajo.proyecto.isOpen)return null;var t=_.values(this.state.hoja_trabajo.visitas);t=_.sortBy(t,"position");var a=(0,c.SortableHandle)(function(){return React.createElement("span",{className:"sort-handler drag-icon"})}),n=(0,c.SortableElement)(function(t){var n=t.visita;return React.createElement("li",{className:"list-group-item visita-li",id:"visita-li-".concat(n.id)},user_has_role_permission("hoja_trabajo_edit")&&React.createElement(a,null),React.createElement("span",null,n.label),React.createElement("div",{className:"pull-right"},user_has_role_permission("hoja_trabajo_edit")&&[React.createElement("a",{href:"#",key:"rename",className:"btn-mini btn-link",onClick:function(t){return e.onClickActionElement(t,"RENAME",n)}},"Cambiar nombre"),"|",React.createElement("a",{href:"#",key:"delete",className:"btn-link btn-mini delete",onClick:function(t){return e.onClickActionElement(t,"DELETE",n)}},"Eliminar")]))}),o=(0,c.SortableContainer)(function(e){var t=e.visitas;return React.createElement("ul",{id:"paso-periodo-sortlist",className:"list-group compact",style:{marginLeft:0}},_.map(t,function(e,t){return React.createElement(n,{visita:e,key:"visita-li-".concat(e.id),index:t})}))});return React.createElement("div",{style:{padding:"5px 20px"}},React.createElement("p",{className:"description-text"},"Listado de periodos asociados a este paso."),React.createElement(o,{visitas:t,lockAxis:"y",helperClass:"sortable_placeholder",useDragHandle:!0,onSortEnd:function(t){var a=t.oldIndex,n=t.newIndex;e.setState(function(e){var t=e.hoja_trabajo,o=_.values(t.visitas);o=_.sortBy(o,"position");var r,i,s,c=(i=a,s=n,function(e,t,a){e.splice(a<0?e.length+a:a,0,e.splice(t,1)[0])}(r=(r=o).slice(),i,s),r);return c=_.map(c,function(e,t){return e.position=t,e}),t.visitas=c,{hoja_trabajo:t}},function(){var t={};_.forEach(e.state.hoja_trabajo.visitas,function(e){t[e.position]=e.id_visita});var a=url_for("proyecto/".concat(e.state.hoja_trabajo.proyecto.id,"/master_data/paso-visita/sort"));$.ajax(a,{type:"POST",data:{sort:t},dataType:"json"})})},helperContainer:function(){return document.getElementById("paso-periodo-sortlist")}}),React.createElement("div",{style:{margin:"auto",textAlign:"center"}},React.createElement("button",{className:"btn btn-primary",onClick:function(t){return e.onClickActionElement(t,"CREATE")}},React.createElement("span",{className:"icon-plus"})," Nuevo Periodo")),React.createElement("br",null))}},{key:"render",value:function(){var e=this,t=this,a=_.values(t.state.hoja_trabajo.visitas);return 0==_.size(a)?React.createElement("div",{id:"visita-tabs",className:"paso-code-".concat(this.state.hoja_trabajo.paso.code," paso-periodo")},React.createElement("div",{className:"alert alert-block nocontent"},React.createElement("h3",null,"Sin Periodos"),React.createElement("p",null,React.createElement("span",{className:"icon-warning-sign"}),"Este paso aun no tiene periodos creados."),user_has_role_permission("hoja_trabajo_edit")&&React.createElement("button",{className:"btn btn-primary",onClick:function(t){return e.onClickActionElement(t,"CREATE")},style:{marginTop:"30px"}},React.createElement("span",{className:"icon-plus"})," Nuevo periodo"))):(a=_.sortBy(a,"position"),React.createElement(l.default.Provider,{value:{hoja_trabajo:this.state.hoja_trabajo,update:this.onChangeApp}},React.createElement("div",{id:"visita-tabs",className:"paso-code-".concat(this.state.hoja_trabajo.paso.code," paso-periodo")},React.createElement(s.Tabs,{activeIndex:this.state.activeIndex,onTabChange:this.handleClick,showModalButton:this.state.hoja_trabajo.proyecto.isOpen,modalHeader:"Administración de Periodos",modalContent:this.renderModalContent()},React.createElement(s.TabList,{className:"ui tabular menu"},_.map(a,function(a,n){return a.HojaTrabajo=t.state.hoja_trabajo,e.renderTab(a,n)})),React.createElement(s.PanelList,null,_.map(a,function(a,n){return a.HojaTrabajo=t.state.hoja_trabajo,e.renderPanel(a,n)}))))))}}])&&d(a.prototype,u),p&&d(a,p),t}();t.default=b}});
//# sourceMappingURL=http://auditbrain.local/webapps/dist/proyecto__hoja_trabajo.js.map