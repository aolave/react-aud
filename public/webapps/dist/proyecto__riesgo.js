var webpackLibs=function(e){function t(t){for(var a,i,c=t[0],l=t[1],s=t[2],d=0,p=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(u&&u(t);p.length;)p.shift()();return r.push.apply(r,s||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,c=1;c<n.length;c++){var l=n[c];0!==o[l]&&(a=!1)}a&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},o={0:0},r=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonpwebpackLibs=window.webpackJsonpwebpackLibs||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var u=l;return r.push([321,1]),n()}({1:function(e,t){e.exports=React},156:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(1),o=d(n(106)),r=n(83),i=d(n(105)),c=d(n(593)),l=d(n(8)),s=d(n(303)),u=n(594);function d(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g={basic:{height:150,toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","TextColor"]}],autoParagraph:!1,removePlugins:"elementspath, uploadfile, uploadfileab, resize",extraPlugins:"openlink"}},b=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=f(this,h(t).call(this,e))).previewRef=(0,a.createRef)(),n.handleEscape=function(e){i.default.getCode(e)===i.default.Escape&&("undefined"!=typeof CKEDITOR&&null!=CKEDITOR.dialog.getCurrent()||n.onClose())},n.onChange=function(e){n.props.inline&&n.props.onSave(e.editor,!1,!1),n._cachedEditor||(n._cachedEditor=e.editor),n.props.autosave&&(n.autosaveId||(n.autosaveId=setTimeout(n.autosave,1e3*t.AUTOSAVE_DELAY)))},n.onClickEdit=function(e){e.preventDefault(),n.setState({isModalEditOpen:!0,isLoading:!0})},n.onSave=function(){n.autosaveId&&(clearTimeout(n.autosaveId),n.autosaveId=null),$.isFunction(n.props.onSave)?(n.props.onSave(n.getEditor(),!0,!1,function(){n.setState({isAutosaving:!1}),n.fetchAttachments()}),n.setState({isModalEditOpen:!1})):(n.setState({isModalEditOpen:!1,isAutosaving:!1}),n.fetchAttachments())},n.onCancel=function(){n.setState({isModalEditOpen:!1}),$.isFunction(n.props.onClose)&&n.props.onClose()},n.onClose=function(){n.autosaveId&&(clearInterval(n.autosaveId),n.autosaveId=null),n.setState({isModalEditOpen:!1}),$.isFunction(n.props.onClose)&&n.props.onClose()},n.onModalMount=function(){r.instance.sub("keydown",n.handleEscape,{pool:"default"}),null==n.state.attachments&&n.fetchAttachments()},n.autosave=function(){n.setState({isAutosaving:!0});var e=n.getEditor();null!=e&&(n.props.onSave(e,!1,!0,function(){return n.setState({isAutosaving:!1})}),n.fetchAttachments()),n.autosaveId&&(clearInterval(n.autosaveId),n.autosaveId=null)},n.onClickPreview=function(e){n.props.onClickPreview&&n.props.onClickPreview(e),n.props.openOnClickPreview&&n.setState({isModalEditOpen:!0})},n.onUpdateAttachment=function(){n.fetchAttachments()},n.onDeleteAttachment=function(e,t){n.setState({isLoadingAttachments:!0});var a=(0,u.cleanAttachmentFrom)(n.props.data,e);$.isFunction(t)&&t();var o=n.getEditor();o&&(o.setData(a),n.autosave())},n.state={isModalEditOpen:n.props.open,isAutosaving:!1,isLoading:!0,attachments:null,isLoadingAttachments:!1},n}var n,d,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,a.PureComponent),n=t,(d=[{key:"getEditor",value:function(){return null!=this.ckeditorComp?this.ckeditorComp.editor:this._cachedEditor?this._cachedEditor:null}},{key:"assertRequired",value:function(){if(!this.props.editable)return!1;if(!this.props.required)return!1;var e=this.getEditor();return""==_.trim(e.getData())&&(bootbox.alert("Esta campo es requerido, por lo tanto no puede quedar vacío."),!0)}},{key:"componentWillReceiveProps",value:function(e){e.open&&!this.state.isModalEditOpen&&this.setState({isModalEditOpen:!0})}},{key:"componentDidMount",value:function(){$(this.previewRef.current).find("a[href]").each(function(){$(this).attr("target","_blank")})}},{key:"parseCkeditorOptions",value:function(){var e=this.props.ckeditorOptions;if("string"==typeof e&&(e=g[e]),void 0!==this.props.ckeditorUploadOptions){var t="proyecto/"+app.vars.idproyecto+"/adjunto/upload",n=this.props.ckeditorUploadOptions,a=n.url,o=void 0===a?t:a,r=n.model,i=n.modelId;null==i?e.removePlugins="elementspath,uploadimage,uploadfile,uploadfileab":(e.uploadUrl=url_for("".concat(o,"?model=").concat(r,"&model_id=").concat(i)),e.imageUploadUrl=url_for("".concat(o,"?model=").concat(r,"&model_id=").concat(i)),e.filebrowserUploadUrl=url_for("".concat(o,"?model=").concat(r,"&model_id=").concat(i,"&n=attachment")))}return e}},{key:"fetchAttachments",value:function(){var e=this;if(void 0!==this.props.ckeditorUploadOptions){var t=this.props.ckeditorUploadOptions,n=t.model,a=t.modelId;this.setState({isLoadingAttachments:!0}),$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/adjunto/json")),{model:n,model_id:a}).done(function(t){e.setState({attachments:t.response,isLoadingAttachments:!1})})}}},{key:"getCkeditorOptions",value:function(){var e=this,t=Object.assign({height:200,toolbar:[{name:"clipboard",items:["Cut","Copy","Paste","-","Undo","Redo"]},{name:"links",items:["Link","pasolink","muestreolink","Attachments"]},{name:"insert",items:["Table","SpecialChar"]},{name:"tools",items:["Maximize"]},{name:"basicstyles",items:["Bold","Italic","Underline"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","TextColor"]},{name:"styles",items:["Styles","Format"]}],autoParagraph:!1,enterMode:CKEDITOR.ENTER_BR,removePlugins:"elementspath",extraPlugins:"uploadimage,pastebase64,uploadfileab,openlink,attach,justify,colorbutton,pastefromexcel,colordialog,pasolink",openlink_modifier:0,onAttachmentUpload:function(t,n){t=t.replace("<pre>","").replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"").replace("</pre>","");var a=JSON.parse(t);console.log(a),_.forEach(a,function(e){e.uploaded?n.insertHtml("<a href='"+e.url+"' target='_blank' class='proyecto-attachment' >"+e.fileName+"</a><br> "):alert(e.error)}),CKEDITOR.dialog.getCurrent().hide(),e.props.onUpload&&e.props.onUpload(),e.fetchAttachments();var o=e.getEditor();o&&e.props.onSave(o,!1,!1)}},this.parseCkeditorOptions());return t.on=Object.assign({fileUploadRequest:function(e){var t=e.data.fileLoader;t.on("abort",function(){$.unblockUI()}),t.on("error",function(){console.log(t),$.unblockUI()}),$.blockUI({message:'<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">Cargando archivo al servidor.<br> Por favor Espere ...</h3>'})},fileUploadResponse:function(){$.unblockUI(),this.fire("change")},paste:function(e){e.data.dataValue=e.data.dataValue.replace(/(min-)?width:.+?;/g,"")}},t.on||{}),t}},{key:"renderFooter",value:function(){var e=this.props.footer;return"AttachmentList"===e?React.createElement(u.AttachmentListPanel,{isLoading:this.state.isLoadingAttachments,attachments:this.state.attachments,onUpdateItem:this.onUpdateAttachment,onDeleteItem:this.onDeleteAttachment}):e}},{key:"renderModal",value:function(){if(this.state.isModalEditOpen){var e=(0,l.default)(["editor-preview-modal",!!this.props.className&&this.props.className+"-modal"]);return React.createElement(o.default,{className:e,open:!0,closeIcon:!0,closeOnDimmerClick:!1,dimmer:"inverted",onClose:this.onClose,closeOnEscape:!1,onMount:this.onModalMount,size:"large"},React.createElement(o.default.Content,null,this.renderEditor()),this.props.editable?React.createElement(o.default.Actions,null,this.props.leftActions,React.createElement("button",{className:"ui button negative",onClick:this.onCancel},"Cancelar"),React.createElement("button",{className:"ui button primary",onClick:this.onSave},"Guardar")):React.createElement(o.default.Actions,null,this.props.leftActions,React.createElement("button",{className:"ui button negative",onClick:this.onCancel},"Cerrar")))}}},{key:"renderEditor",value:function(){var e,t=this;return(this.props.label||this.props.labelTitle)&&(e='<div class="editor-label"> <strong class="editor-label-title">'+(this.props.labelTitle||"")+"</strong> "+(this.props.label||"")+" </div>"),React.createElement(a.Fragment,null,e&&React.createElement("div",{dangerouslySetInnerHTML:{__html:e}}),React.createElement("div",{style:{minHeight:"200px"}},React.createElement("div",{className:"loading"},React.createElement("div",{className:this.state.isAutosaving?"":"ui-helper-hidden"},React.createElement("span",{className:"ajax-loader-snake"})," Guardando...")),React.createElement("div",{className:(0,l.default)("ui dimmer inverted",{active:this.state.isLoading})},React.createElement("div",{className:"ui loader"},"Cargando...")),React.createElement(c.default,{ref:function(e){return t.ckeditorComp=e},data:this.props.data,config:this.getCkeditorOptions(),onChange:this.onChange,onInstanceReady:function(){return t.setState({isLoading:!1})},readOnly:!this.props.editable})),this.renderFooter())}},{key:"render",value:function(){if(this.props.inline)return React.createElement("div",{className:"editor-inline"}," ",this.renderEditor());var e=null==this.props.preview?this.props.data||"":this.props.preview,t=(0,l.default)(["editor-preview",this.props.className,e?"text-non-empty":"text-empty"]);return this.props.prefixPreview&&(e='<strong class="editor-preview-title" >'+this.props.prefixPreview+"</strong> "+e),e=e.replace(/(min-)?width:.+?;/g,""),React.createElement(a.Fragment,null,React.createElement("div",{className:(0,l.default)("editor-preview-wrapper",this.props.wrapperClassName),onClick:this.onClickPreview},React.createElement("div",{ref:this.previewRef,className:t,dangerouslySetInnerHTML:{__html:e},style:this.props.previewStyle}),this.props.editable&&React.createElement("div",{className:"action-list"},React.createElement(s.default,{onClick:this.onClickEdit}))),this.renderModal())}}])&&m(n.prototype,d),p&&m(n,p),t}();t.default=b,b.AUTOSAVE_DELAY=60,b.defaultProps={open:!1,autosave:!1,required:!1,editable:!0,openOnClickPreview:!0,ckeditorOptions:{}}},158:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=(0,n(1).createContext)({riesgos:null,updateRiesgos:function(e){}});t.default=a},159:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuElementListActions=t.MenuElementListPanel=t.BaseMenuElement=t.BaseMenuItem=void 0;var a=n(1),o=l(n(309)),r=l(n(8)),i=n(632),c=n(308);function l(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function m(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){return u(this,t),m(this,f(t).apply(this,arguments))}return h(t,a.PureComponent),p(t,[{key:"render",value:function(){var e=public_path("images/sidebar_right/");return React.createElement("a",{className:(0,r.default)("item badged",!this.props.open||"active"),title:this.props.title,onClick:this.props.onClick},React.createElement("img",{src:"".concat(e).concat(this.props.image,".svg"),className:"ui large image"})," "," ",React.createElement("div",{className:(0,r.default)("ui mini circular floating label right",0==this.props.counter?"green":"red")},this.props.counter))}}]),t}();t.BaseMenuItem=g;var b=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).onToggle=function(){e.props.onToggle(e.props.open?null:e.props.name)},e.onClose=function(t){t.preventDefault(),e.props.onToggle(null)},e}return h(t,a.PureComponent),p(t,[{key:"render",value:function(){return React.createElement(a.Fragment,null,React.createElement(c.DefaultErrorHandler,null,React.createElement(g,{counter:this.props.counter,open:this.props.open,title:this.props.title,image:this.props.icon,onClick:this.onToggle}),this.props.open&&React.createElement(o.default.Group,{animation:"slide right",duration:1500},React.createElement("div",{className:"sidebar-fixed-content ui vertical right fixed menu menu-".concat(this.props.name),style:{right:45}},React.createElement(i.SidebarPanelHeader,{title:this.props.title,onClose:this.onClose,onMount:this.props.onMountPanel}),this.props.children))))}}]),t}();t.BaseMenuElement=b;var y=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).listRef=(0,a.createRef)(),e.listHeight=null,e}return h(t,a.PureComponent),p(t,[{key:"componentDidMount",value:function(){this.listRef.current&&this.calculateHeight()}},{key:"componentDidUpdate",value:function(){this.listRef.current&&!this.listHeight&&this.calculateHeight()}},{key:"calculateHeight",value:function(){var e=$(this.listRef.current);this.listHeight=window.innerHeight-e.position().top-30,e.height(this.listHeight)}},{key:"render",value:function(){return React.createElement("div",{className:"main-list ".concat(this.props.className),ref:this.listRef},this.props.children)}}]),t}();t.MenuElementListPanel=y;t.MenuElementListActions=function(e){return React.createElement("div",{className:"pull-right sf_admin_td_actions"},React.createElement("div",{className:"btn-group dropdown-modern"},React.createElement("a",{className:"btn btn-mini dropdown-toggle","data-toggle":"dropdown",href:"#"},React.createElement("span",{className:"icon-tc-ellipsis-v"})),React.createElement("ul",{className:"dropdown-menu pull-right"},_.map(e.actions,function(e,t){return user_has_role_permission(e.permission)&&React.createElement("li",{key:t},React.createElement("a",{href:"#",onClick:e.callback},e.label))}))))}},204:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRiesgoCellBlock=function(e,t,n){var a;switch(t){case"riesgo_inherente":a=b.BMA;break;case"riesgo_residual":a=b.BMA2;break;case"control_valoracion":a=b.DMF;break;case"control_efectividad":a=b.IDE}var r=e[t]?e[t]:0,i=(0,o.default)(n?n.className:null,"cell-block-value-".concat(r),"field-".concat(t));return React.createElement(y,u({className:i},n),(c=e[t],l=a,c&&"0"!=c?l[c]:"Por Definir"));var c,l},t.RiesgoCriterioEvaluacionControlTable=t.RiesgoFieldDropdown=t.RiesgoCellBlock=void 0;var a=n(1),o=c(n(8)),r=c(n(607)),i=c(n(203));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function m(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var b=function e(){g(this,e)};b.BMA={1:"Bajo",3:"Medio",5:"Alto"},b.BMA2={1:"Bajo",3:"Moderado",5:"Alto"},b.DMF={1:"Débil",3:"Moderado",5:"Fuerte"},b.IDE={1:"Inefectivo",3:"Con Deficiencias",5:"Efectivo"};var y=function(e){function t(){return g(this,t),m(this,f(t).apply(this,arguments))}return h(t,a.PureComponent),p(t,[{key:"render",value:function(){return this.props.loading?React.createElement("div",{className:"ui active centered inline tiny loader"}):React.createElement("div",{className:(0,o.default)("cell-block",this.props.className),style:this.props.style,onClick:this.props.onClick},this.props.children)}}]),t}();t.RiesgoCellBlock=y,y.defaultProps={loading:!1};var E=function(e){function t(e){var n;return g(this,t),(n=m(this,f(t).call(this,e))).choices=[],n.onClickRemoveItem=function(e){var t=_.reject(n.props.value,s({},n.props.field,e));n.props.onChange(t)},n.onChange=function(e,t){var a=_.map(t.value,function(e){return s({},n.props.field,e)});n.props.onChange(_.union(n.props.value,a))},n.choices=_.map(n.props.choices,function(e){return{key:e.id,text:"name"in e?e.name:e.descripcion,value:e.id,tooltip:e.description}}),n}return h(t,a.PureComponent),p(t,[{key:"parseValue",value:function(){var e=this;return _.map(this.props.value,function(t){return t[e.props.field]})}},{key:"render",value:function(){var e=this,t=this.parseValue(),n=_.reject(this.choices,function(e){return _.include(t,e.key)}),a=null,c=null;switch(this.props.value.length){case 0:a="Seleccionar";break;case 1:c="1 Seleccionado";break;default:c=this.props.value.length+" Seleccionados"}return React.createElement("div",{className:(0,o.default)("riesgo-field-dropdown",this.props.editable||"disabled")},this.props.editable&&React.createElement(r.default,{multiple:!0,selection:!0,options:n,placeholder:a,text:c,closeOnChange:!0,value:[],onChange:this.onChange}),React.createElement("ul",{className:"riesgo-dropdown-selectedlist unstyled"},_.map(this.props.value,function(t){var n=_.find(e.choices,{key:t[e.props.field]});return React.createElement(i.default,{key:n.key,header:n.text,content:n.tooltip,disabled:!n.tooltip,size:"mini",trigger:React.createElement("li",{className:"dropdown-selectedlist-item"},React.createElement("span",null,n.text),e.props.editable&&React.createElement("i",{className:"icon delete pull-right",onClick:function(){return e.onClickRemoveItem(n.key)}}))})})))}}]),t}();t.RiesgoFieldDropdown=E,E.defaultProps={editable:!0};var R=function(e){function t(){return g(this,t),m(this,f(t).apply(this,arguments))}return h(t,a.PureComponent),p(t,[{key:"getChoiceValue",value:function(e){var t=this.props.riesgo[e];return null==t?null:!0===t?1:+t}},{key:"render",value:function(){var e=this,t=app.vars.riesgocontext.criterios_evaluacion;return React.createElement("table",{className:"ui striped basic small table table-riesgo-criterios"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,React.createElement("div",{className:"criterio-name"},"Criterio de Evaluación")),React.createElement("th",null,"Valoración"))),React.createElement("tbody",null,_.map(t,function(t,n){var a=_.map(t.choices,function(e,t){return{text:e.label,value:+e.value,key:t}});return React.createElement("tr",{key:n},React.createElement("td",null,React.createElement("div",{className:"criterio-name"},t.label)),React.createElement("td",{className:"criterio-value"},React.createElement(C,{choices:a,editable:e.props.editable,value:e.getChoiceValue(n),onChange:function(t,a){return e.props.onChange(n,a)}})))})))}}]),t}();t.RiesgoCriterioEvaluacionControlTable=R,R.defaultProps={editable:!0};var C=function(e){var t=e.choices,n=e.value,a=e.onChange,o=e.editable,i=null==n?null:_.find(t,{value:n});if(!o)return React.createElement("div",{className:"text"},null==n?"":i.text);var c=null==n?React.createElement("div",{className:"default text"},"Seleccione"):React.createElement("div",{className:"text"},i.text);return React.createElement(r.default,{selectOnBlur:!1,closeOnChange:!0,scrolling:!0,trigger:c,onChange:a,options:t})}},205:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.RiesgoModel=void 0,t.RiesgoModel=a,function(e){function t(e,t){var n=0;return _.each(t,function(t){if(t in e){var a=e[t];if(!0===a?a=1:!1===a&&(a=0),""===a)return n=0,!1;if(a=parseFloat(a),isNaN(a))return n=0,!1;n+=a}}),0==n?null:n<=5?1:n<=7?3:n<=10?5:void 0}function n(e){if(isNaN(parseInt(""+e.control_efectividad)))return null;if(null===e.control_valoracion)return null;switch(+e.control_valoracion+ +e.control_efectividad){case 10:return 5;case 8:return 3;default:return 1}}function a(e){if(isNaN(parseInt(""+e.control_efectividad))&&null===e.control_valoracion)return e.riesgo_inherente;var t=n(e);return null===t?null:1==e.riesgo_inherente||5==t?1:3==t||1==t&&3==e.riesgo_inherente?3:5}e.calculateRiesgoInherente=function(e){if(e.probabilidad&&e.impacto){var t=+e.probabilidad+e.impacto;return 10==t||8==t?5:6==t?3:1}},e.calculateControlValoracion=t,e.calculateRiesgoSolidez=n,e.calculateRiesgoResidual=a,e.create=function(e){return new Promise(function(t,n){var a="bibliotecaIds"in e?e:{fields:e};$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/riesgos/create")),a).done(function(e){e.hasErrors||t("records"in e.response?e.response.records:e.response.record)}).fail(n)})},e.setChanges=function(e,n){n.control_valoracion=t(Object.assign({},e,n),_.keys(app.vars.riesgocontext.criterios_evaluacion)),n.control_valoracion||(n.control_efectividad=null),n.riesgo_residual=a(Object.assign({},e,n));var o=!1;return _.each(n,function(t,n){if(e[n]!=t)return o=!0,!1}),o?n:null},e.getChangesWhenRemoveControlCodigo=function(e){var t={control_codigo:null,control_descripcion:null,control_efectividad:null};return _.each(_.keys(app.vars.riesgocontext.criterios_evaluacion),function(e){t[e]=null}),t},e.save=function(e,t){return new Promise(function(n,a){null!==t?$.post(url_for("/proyecto/".concat(app.vars.idproyecto,"/riesgos/").concat(e.id)),{fields:t}).done(function(e){e.success?n():a(e.message)}):n()})}}(a||(t.RiesgoModel=a={}))},206:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthorIconLogDefaultWrapper=t.AuthorIconLogEditable=t.AuthorIconLog=void 0;var a=n(1),o=u(n(8)),r=u(n(70)),i=u(n(157)),c=u(n(307)),l=u(n(84)),s=u(n(199));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}function h(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){return p(this,t),h(this,v(t).apply(this,arguments))}return g(t,a.Component),f(t,[{key:"render",value:function(){var e=["author-icon-log"];this.props.className&&e.push(this.props.className),this.props.inline&&e.push("inline"),e=(0,o.default)(e,this.props.size);var t,n=React.createElement(r.default,{name:"user circle",size:this.props.size,color:0==_.size(this.props.log)?null:this.props.iconColor,disabled:0==_.size(this.props.log)});if(this.props.alertText&&(n=React.createElement(r.default.Group,null,n,React.createElement(r.default,{corner:"top right",color:"red",name:"warning circle"}))),this.props.inline){var a=null==this.props.log?null:this.props.log[0];t=React.createElement("div",null,this.props.label&&React.createElement("span",{className:"lb"},this.props.label),n,this.props.alertText&&React.createElement("span",{className:"alert-text"},React.createElement(r.default,{color:"red",name:"warning circle"})," ",this.props.alertText),a&&React.createElement("div",{className:"content user-info"},React.createElement("div",{className:"user-sigla"},a.User.sigla),React.createElement("time",{dateTime:Date.create(a.ts).format("{year}-{MM}-{dd}")},Date.create(a.ts).format("{year}-{MM}-{dd}"))))}else t=React.createElement("div",null,this.props.label&&React.createElement("span",{className:"lb"},this.props.label),n);return React.createElement("div",{className:e},React.createElement(l.default,{trigger:t,position:"bottom center",className:"author-icon-log-popup",pinned:!0,size:this.props.size},React.createElement(l.default.Header,null,this.props.name,this.props.alertText&&React.createElement("div",{className:"alert-text"},React.createElement(r.default,{color:"red",name:"warning circle"})," ",this.props.alertText)),React.createElement(l.default.Content,null,null==this.props.log?React.createElement("div",{className:"label"},"Sin Especificar"):React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,this.props.log.map(function(e,t){return React.createElement("tr",{key:t},React.createElement("td",null,n," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))))}}]),t}();t.AuthorIconLog=y;var E=function(e){function t(){var e;return p(this,t),(e=h(this,v(t).apply(this,arguments))).state={isLoading:!1},e.onClickEdit=function(t){t.preventDefault(),e.setState({isLoading:!0}),e.props.onClickEdit()},e}return g(t,a.Component),f(t,[{key:"render",value:function(){var e=["author-icon-log"];this.props.className&&e.push(this.props.className),e=(0,o.default)(e,this.props.size);var t=React.createElement(r.default,{name:"user circle",size:this.props.size,color:null==this.props.log?null:this.props.iconColor,disabled:null==this.props.log}),n=React.createElement("div",{style:{position:"relative"}},React.createElement(s.default,{inverted:!0,active:this.state.isLoading},React.createElement(c.default,{inverted:!0})),this.props.label&&React.createElement("span",{className:"lb"},this.props.label),t,React.createElement(i.default,{className:"action edit",disabled:this.props.disableEdit,compact:!0,size:"mini",color:this.props.iconColor,onClick:this.onClickEdit},this.props.editText));return React.createElement("div",{className:e},React.createElement(l.default,{trigger:n,position:"bottom center",pinned:!0,size:this.props.size},React.createElement(l.default.Header,{content:this.props.name}),React.createElement(l.default.Content,null,null==this.props.log?React.createElement("div",{className:"label"},"Sin Especificar"):React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,this.props.log.map(function(e,n){return React.createElement("tr",{key:n},React.createElement("td",null,t," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))))}}]),t}();t.AuthorIconLogEditable=E,E.defaultProps={disableEdit:!1};var R=function(e){function t(){return p(this,t),h(this,v(t).apply(this,arguments))}return g(t,a.Component),f(t,[{key:"render",value:function(){var e=this.props.model,t=e.fecha_completado&&e.fecha_revision&&Date.create(e.fecha_completado)>Date.create(e.fecha_revision)?"Modificado despues de Revisado":null;return React.createElement("div",{className:(0,o.default)("author-icon-log-wrapper",this.props.size,this.props.className)},React.createElement(y,{log:e.UpdateLog,name:"Preparado por",label:"P",iconColor:"green",size:this.props.size}),React.createElement(y,{log:e.RevisionLog,name:"Revisado por",label:"R",iconColor:"olive",size:this.props.size,alertText:t}))}}]),t}();t.AuthorIconLogDefaultWrapper=R},207:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoUtils=void 0,t.HallazgoUtils=a,function(e){e.formatName=function(e){return(""+e).match(/^\d+$/)?"Hallazgo #"+e:e}}(a||(t.HallazgoUtils=a={}))},208:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusDivBlock=t.StatusButtonGroupActions=t.RevisadoButtonAction=t.CompletadoButtonAction=void 0;var a=n(1),o=c(n(84)),r=c(n(157)),i=c(n(8));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){return s(this,t),p(this,m(t).apply(this,arguments))}return f(t,a.PureComponent),d(t,[{key:"render",value:function(){var e=this.props.disableText;return React.createElement(o.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(r.default,{primary:!0,icon:!0,compact:!0,onClick:this.props.onClick,disabled:null!=e}," ",React.createElement("i",{className:"icon check"})," Completado")),content:e,header:"Marcar como Completado | Opción deshabilitada",disabled:null==e,className:"disable-text",on:"hover"})}}]),t}();t.CompletadoButtonAction=v;var g=function(e){function t(){return s(this,t),p(this,m(t).apply(this,arguments))}return f(t,a.PureComponent),d(t,[{key:"render",value:function(){var e,t=this.props.disableText;if(null==t&&this.props.record&&!this.props.record.fecha_completado&&(t="Debe estar primero en estado COMPLETADO, para poder marcarse como REVISADO."),null!==this.props.showAlert&&void 0!==this.props.showAlert||!this.props.record)e=this.props.showAlert;else{var n=this.props.record;e=n.fecha_completado&&n.fecha_revision&&Date.create(n.fecha_completado)>Date.create(n.fecha_revision)}var a=e?React.createElement(o.default,{trigger:React.createElement("i",{className:"icon warning circle red"}),content:"Ha recibido modificaciones después de su última revisión."}):null;return React.createElement(o.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement(r.default,{color:"olive",icon:!0,compact:!0,onClick:this.props.onClick,disabled:null!=t}," ",React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado ",a)),content:t,header:"Marcar como Revisado | Opción deshabilitada",disabled:null==t,className:"disable-text",on:"hover"})}}]),t}();t.RevisadoButtonAction=g;var b=function(e){function t(){return s(this,t),p(this,m(t).apply(this,arguments))}return f(t,a.PureComponent),d(t,[{key:"render",value:function(){return React.createElement("div",{className:"actions ab-status-actions"},this.props.prepend,user_has_role_permission(this.props.completado.permission)&&React.createElement(v,this.props.completado),user_has_role_permission(this.props.revisado.permission)&&React.createElement(g,this.props.revisado),this.props.append)}}]),t}();t.StatusButtonGroupActions=b;t.StatusDivBlock=function(e){return React.createElement("div",{className:(0,i.default)("lb-status-wrapper",e.wrapperClassName)},!e.hideLabel&&"Estado:",React.createElement("div",{className:(0,i.default)(e.className,"lb-status","lb-status-".concat(_.str.dasherize(e.status.toLowerCase())))},e.status||""))}},303:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(301)),o=i(n(70)),r=i(n(8));function i(e){return e&&e.__esModule?e:{default:e}}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var l=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n},s=function(e){var t=e.children,n=l(e,["children"]);return n.className=(0,r.default)(n.className,"action"),n=Object.assign({icon:!0,basic:!0,compact:!0,size:"mini",title:"Editar"},n),void 0===t&&(t=React.createElement(o.default,{name:"pencil square",color:"green",size:"large"})),React.createElement(a.default,c({},n,{type:"button"}),t)};t.default=s},308:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultErrorHandler=void 0;var a=n(1);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=i(this,c(t).apply(this,arguments))).state={hasError:!1},e}var n,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a.Component),n=t,s=[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}],(o=[{key:"componentDidCatch",value:function(e,t){this.isLocalhost()&&alert("ERROR: "+e.message)}},{key:"isLocalhost",value:function(){return"auditbrain.local"===window.location.host}},{key:"render",value:function(){return this.state.hasError?this.props.errorMessage:this.props.children}}])&&r(n.prototype,o),s&&r(n,s),t}();t.DefaultErrorHandler=s,s.defaultProps={errorMessage:null}},310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemNewHeader=t.MenuItemNew=void 0;var a,o=n(1),r=(a=n(106))&&a.__esModule?a:{default:a},i=n(206);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=s(this,u(t).apply(this,arguments))).state={modalOpen:!1},e.onClick=function(){e.setState({modalOpen:!0})},e.onCloseModal=function(){e.setState({modalOpen:!1})},e.onSave=function(t){e.props.onSave(t).then(function(){e.onCloseModal()})},e}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.PureComponent),n=t,(a=[{key:"render",value:function(){if(this.props.isEditable){var e=this.props.contentAs;return React.createElement("div",{className:"_a-center"},React.createElement("button",{className:"button ui right tiny compact plain green rounded",onClick:this.onClick},this.props.buttonText," ",React.createElement("i",{className:"icon plus"})),this.state.modalOpen&&React.createElement(r.default,{open:!0,dimmer:"inverted",className:"modal-ab modal-sidebarmenuitem",size:"large",closeIcon:!0,closeOnDimmerClick:!1,closeOnEscape:!1,onClose:this.onCloseModal},React.createElement(r.default.Header,null,this.props.headerText),React.createElement(e,{onSave:this.onSave,moduleParams:this.props.moduleParams,isEditable:this.props.isEditable,item:this.props.item})))}}}])&&l(n.prototype,a),i&&l(n,i),t}();t.MenuItemNew=p;t.MenuItemNewHeader=function(e){var t=e.item.status||"EN PROCESO";return React.createElement("div",{className:"ui grid padded",style:{marginBottom:0}},React.createElement("div",{className:"row",style:{paddingTop:0}},React.createElement("div",{className:"column four wide"},React.createElement("strong",{style:{fontWeight:600}},e.item.label)),React.createElement("div",{className:"column four wide"},React.createElement("span",null,"Estado: "),React.createElement("div",{className:"lb-status-wrapper"},React.createElement("div",{className:"lb-status lb-status-".concat(_.str.dasherize(t.toLowerCase()))},t))),React.createElement("div",{className:"column four wide"},React.createElement(i.AuthorIconLogDefaultWrapper,{model:e.item}))))}},311:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoModal=void 0;var a=f(n(1)),o=m(n(156)),r=n(208),i=f(n(635)),c=m(n(638)),l=n(660),s=n(661),u=n(207),d=m(n(8)),p=n(310);function m(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};a.get||a.set?Object.defineProperty(t,n,a):t[n]=e[n]}return t.default=e,t}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function E(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function R(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(0,i.registerLocale)("es",c.default);var O=function(e){function t(e){var n;return b(this,t),(n=R(this,C(t).call(this,e))).handlers={},n.onCreate=function(){n._onCreate({status:"EN PROCESO"})},n.onCreateAndCompletado=function(){n._onCreate({status:"COMPLETADO"})},n.onCompletado=function(){n.props.onSave({status:"COMPLETADO"})},n.onRevisado=function(){n.props.onSave({status:"REVISADO"})},n.onEditorChange=function(e){return n.attachHandler(e,function(t,a,o,r){var i=t.getData();"hallazgo"!=e||n.isNewItem()||0!=_.size(_.str.trim(i))?(n.updateModel(g({},e,i)),$.isFunction(r)&&r()):bootbox.alert("La descripción del hallazgo NO puede ser un campo vacío.")})},n.onInputChange=function(e){return n.attachHandler(e,function(t){n.updateModel(g({},e,t.target.value))})},n.onDateChange=function(e){return n.attachHandler(e,function(t){n.updateModel(g({},e,(0,l.format)(t,"yyyy-MM-dd")))})},n.onValueChange=function(e){return n.attachHandler(e,function(t){n.updateModel(g({},e,t))})},n.onClickDelete=function(e){$.isFunction(n.props.onClickDelete)&&n.props.onClickDelete(e)},n.state={value:e.item},n}return k(t,a.PureComponent),E(t,[{key:"attachHandler",value:function(e,t){return this.handlers[e]||(this.handlers[e]=t),this.handlers[e]}},{key:"isNewItem",value:function(){return null==this.props.item.id}},{key:"updateModel",value:function(e){this.setState(function(t){return{value:Object.assign({},t.value,e)}}),this.isNewItem()||this.props.onSave(e)}},{key:"getDate",value:function(e){if(!e)return null;var t=(0,l.parseISO)(e);return(0,l.isValid)(t)?t:null}},{key:"formatImplementadoChoice",value:function(e){return null===e||""===e?"":!0===e||"1"===e?"1":"0"}},{key:"_onCreate",value:function(e){_.isEmpty(this.state.value.hallazgo)?bootbox.alert("La descripción del hallazgo NO puede ser un campo vacío."):this.props.onSave(Object.assign({},this.state.value,e))}},{key:"renderActions",value:function(){var e=this.props.item,t=null!==e.id&&a.default.createElement("button",{className:"ui button compact negative left floated",onClick:this.onClickDelete},a.default.createElement("i",{className:"icon trash"})," Eliminar");return null===e.id?a.default.createElement("div",{className:"actions ab-status-actions"},a.default.createElement("button",{className:"ui button compact green",onClick:this.onCreate},"Crear"),a.default.createElement("button",{className:"ui button compact green",onClick:this.onCreateAndCompletado},"Crear y Completar")):a.default.createElement(a.Fragment,null,t,a.default.createElement(r.StatusButtonGroupActions,{completado:{permission:"hallazgo_completado",onClick:this.onCompletado},revisado:{permission:"hallazgo_revisado",onClick:this.onRevisado,record:e}}))}},{key:"renderItemHeader",value:function(){var e=Object.assign({label:this.props.item.id?u.HallazgoUtils.formatName(this.props.item.name):"Hallazgo Nuevo"},this.props.item);return a.default.createElement(p.MenuItemNewHeader,{item:e})}},{key:"render",value:function(){var e=this.props.item,t=this.state.value;return a.default.createElement(a.Fragment,null,a.default.createElement("div",{className:"content"},this.renderItemHeader(),e.id&&a.default.createElement("div",{className:"description-text"},a.default.createElement("strong",null,"NOTA:")," El hallazgo debe describir la situación actual, causa, impacto y recomendación."),a.default.createElement(o.default,{className:"editor-preview-hallazgo",wrapperClassName:(0,d.default)(!e.id||"ui segment"),data:t.hallazgo,inline:null==e.id,ckeditorOptions:{attach_disableText:"Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo.",height:e.id?300:150},ckeditorUploadOptions:{model:"".concat(this.props.moduleParams.model,"__hallazgo"),modelId:e.id},footer:"AttachmentList",onSave:this.onEditorChange("hallazgo"),previewStyle:{overflowY:"auto",maxHeight:200,width:"100%"},label:'<div class="description-text"><strong>NOTA:</strong> El hallazgo debe describir la situación actual, causa, impacto y recomendación</div>'}),a.default.createElement("hr",null),a.default.createElement("div",{className:"ui segment"},a.default.createElement(o.default,{data:t.plan_accion,prefixPreview:"Descripción Plan de Acción: ",labelTitle:"Descripción Plan de Acción:",ckeditorOptions:{attach_disableText:"Esta opción (adjuntar archivos) sólo estará disponible una vez haya guardado este hallazgo."},ckeditorUploadOptions:{model:"".concat(this.props.moduleParams.model,"__plan_accion"),modelId:e.id},footer:"AttachmentList",onSave:this.onEditorChange("plan_accion")})),a.default.createElement("div",{className:"ui three column grid"},a.default.createElement("div",{className:"column"},a.default.createElement("label",{htmlFor:"hallazgo_modal__responsable"},"Responsable del Plan Acción: "),a.default.createElement(w,{value:t.responsable,onChange:this.onValueChange("responsable"),attrs:{placeholder:"Escriba el Nombre",style:{display:"inline-block"}}})),a.default.createElement("div",{className:"column"},a.default.createElement("label",{htmlFor:"hallazgo_modal__fecha_implementado"},"Fecha Implementación: "),a.default.createElement(i.default,{id:"hallazgo_modal__fecha_implementado",dateFormat:"yyyy-MM-dd",locale:"es",fixedHeight:!0,placeholderText:"AAAA-mm-dd",className:"react-datepicker--input",selected:this.getDate(t.fecha_implementado),onChange:this.onDateChange("fecha_implementado")})),a.default.createElement("div",{className:"column right aligned"},a.default.createElement("label",{htmlFor:"hallazgo_modal__implementado"},"Estado Implementación: "),a.default.createElement("select",{id:"hallazgo_modal__implementado",value:this.formatImplementadoChoice(t.implementado),onChange:this.onInputChange("implementado")},a.default.createElement("option",{value:""},"Pendiente"),a.default.createElement("option",{value:"0"},"En Proceso"),a.default.createElement("option",{value:"1"},"Hecho"))))),a.default.createElement("div",{className:"actions"},this.renderActions(),a.default.createElement("div",{className:"clearfix"})))}}]),t}();t.HallazgoModal=O;var w=function(e){function t(e){var n;return b(this,t),(n=R(this,C(t).call(this,e))).mentionStyle={display:"inline-block",minWidth:"200px",suggestions:{list:{backgroundColor:"white",border:"1px solid rgba(0,0,0,0.15)",fontSize:14},item:{padding:"5px 15px",borderBottom:"1px solid rgba(0,0,0,0.15)","&focused":{backgroundColor:"#cee4e5"}}}},n.onChange=function(e,t,a,o){n.setState({value:t}),n.props.onChange(t)},n.state={value:e.value},n.users=_.map(app.vars.proyecto_equipo,function(e){return{id:e.user_id,display:e.name}}),n}return k(t,a.PureComponent),E(t,[{key:"render",value:function(){return a.default.createElement(s.MentionsInput,v({singleLine:!0,type:"text",value:null==this.state.value?"":this.state.value,onChange:this.onChange,allowSpaceInQuery:!0},this.props.attrs,{className:"mentions-input",style:this.mentionStyle}),a.default.createElement(s.Mention,{trigger:"@",data:this.users,appendSpaceOnAdd:!0}))}}]),t}()},321:function(e,t,n){"use strict";var a,o=n(48),r=(a=n(322))&&a.__esModule?a:{default:a};$.unblockUI(),(0,o.render)(React.createElement(r.default,null),document.getElementById("root"))},322:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(234)),o=i(n(155)),r=i(n(529));function i(e){return e&&e.__esModule?e:{default:e}}var c=[{key:"riesgos",name:"Riesgos",pane:React.createElement(r.default,null)}],l=function(){var e=_.map(c,function(e,t){return{key:e.name,menuItem:React.createElement(o.default.Item,{className:"tab-nav-item",content:React.createElement("span",{className:"tabname"},e.name),key:"".concat(e.key,"-tab"),index:t,as:"a",style:{width:"99%"}}),render:function(){return e.pane}}}),t=function(){var e=window.location.hash.replace(/^#!/,"").split("/")[0];if(""==e)return 0;var t=_.findIndex(c,{key:e});return-1==t?0:t}();return React.createElement("div",{id:"app-tabs",className:"app-tabs"},React.createElement(a.default,{panes:e,defaultActiveIndex:t,renderActiveOnly:!0,onTabChange:function(e,t){var n=t.activeIndex;window.location.hash="#!"+c[n].key}}))};t.default=l},48:function(e,t){e.exports=ReactDOM},529:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(1),o=h(n(530)),r=h(n(535)),i=h(n(84)),c=h(n(156)),l=n(308),s=h(n(158)),u=h(n(8)),d=h(n(599)),p=n(627),m=n(204),f=n(205);function h(e){return e&&e.__esModule?e:{default:e}}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function y(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}function E(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(){var e;return g(this,t),(e=E(this,R(t).apply(this,arguments))).state={riesgos:null},e.updateRiesgos=function(t){e.setState({riesgos:t})},e}return C(t,a.PureComponent),y(t,[{key:"componentDidMount",value:function(){var e=this;$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/riesgos/list"))).done(function(t){e.setState({riesgos:t.response.riesgos})}),$.getJSON(url_for("proyecto/"+app.vars.idproyecto+"/master_data_tree"),{export_options:{type:"pasolink"}}).done(function(e){app.vars.masterdatatree=e.response,app.vars.masterdatapasos={},_.each(e.response,function(e){_.each(e.Subfases,function(e){_.each(e.Pasos,function(e){app.vars.masterdatapasos[e.id]=e})})})})}},{key:"render",value:function(){return React.createElement(s.default.Provider,{value:{riesgos:this.state.riesgos,updateRiesgos:this.updateRiesgos}},React.createElement("div",{id:"tablelistriesgo_wrapper"},React.createElement(O,null)),React.createElement(l.DefaultErrorHandler,null,React.createElement(p.ProyectoRiesgoListSidebar,null)))}}]),t}();t.default=N;var O=function(e){function t(){var e;return g(this,t),(e=E(this,R(t).apply(this,arguments))).state={currentPage:1,filters:null},e.TOTAL_PER_PAGE=25,e.onPageChange=function(t,n){e.setState({currentPage:n.activePage})},e}return C(t,a.PureComponent),y(t,[{key:"getFilteredList",value:function(e){var t=this.state.filters;if(!_.size(t))return e;var n=function(e,t){return void 0===e||("-1"==e?"null"==t||""==t:"!"==e.substr(0,1)?t!==e.substr(1):""+e==""+t)},a=function(e,t){return void 0===e||t.toUpperCase().includes(e.trim().toUpperCase())},o=[];return _.each(e,function(e){n(t.rf,e.fraude_material?"1":"0")&&n(t.ri,""+e.riesgo_inherente)&&n(t.ec,""+e.control_valoracion)&&n(t.vc,""+e.control_efectividad)&&n(t.rr,""+e.riesgo_residual)&&(a(t.desc,e.codigo)||a(t.desc,e.description))&&o.push(e)}),o}},{key:"getPagedList",value:function(e){if(null===e)return{riesgos:null,paginationInfo:null};var t=this.getFilteredList(e);return{riesgos:t.slice((this.state.currentPage-1)*this.TOTAL_PER_PAGE,this.state.currentPage*this.TOTAL_PER_PAGE),paginationInfo:{start:(this.state.currentPage-1)*this.TOTAL_PER_PAGE+1,end:Math.min(this.state.currentPage*this.TOTAL_PER_PAGE,t.length),total:t.length}}}},{key:"componentDidMount",value:function(){$("#tableriesgolist").floatThead()}},{key:"componentWillUnmount",value:function(){$("#tableriesgolist").floatThead("destroy")}},{key:"componentDidUpdate",value:function(){setTimeout(function(){$("#tableriesgolist").floatThead("reflow")},100)}},{key:"render",value:function(){var e=this,t=["Fraude","Riesgo","Riesgo Inherente","Evaluación de Control","Validación de Control","Riesgo Residual",""],n=this.context.riesgos,i=this.getPagedList(n),c=i.riesgos,l=i.paginationInfo;return React.createElement(o.default,{id:"tableriesgolist",className:"tableriesgolist",basic:"very",compact:!0},React.createElement(o.default.Header,null,React.createElement("tr",null,_.map(t,function(e,t){return React.createElement(o.default.HeaderCell,{collapsing:0==t,key:t,className:"th-".concat(t),content:e})}))),React.createElement(o.default.Body,null,null===n?React.createElement("tr",null,React.createElement("td",{colSpan:t.length},React.createElement("div",{style:{height:300,position:"relative"}},React.createElement("div",{className:"ui active inverted text loader elastic olive"},"Cargando Listado de Riesgos")))):React.createElement(a.Fragment,null,React.createElement(w,{onChange:function(t){return e.setState({filters:t})}}),c.length>0?_.map(c,function(e){return React.createElement(S,{riesgo:e,key:e.id})}):React.createElement("tr",null,React.createElement("td",{colSpan:t.length},React.createElement("div",{className:"nocontent empty",style:{margin:"7% auto"}},"0 Riesgos Encontrados"))))),React.createElement(o.default.Footer,null,React.createElement("tr",null,React.createElement("td",{colSpan:t.length},null!==n&&l.total>this.TOTAL_PER_PAGE&&React.createElement("div",{className:"pull-left pagination-wrapper"},React.createElement(r.default,{activePage:this.state.currentPage,boundaryRange:2,totalPages:Math.ceil(l.total/this.TOTAL_PER_PAGE),size:"mini",onPageChange:this.onPageChange})),null!==n&&React.createElement("div",{className:"pull-right pagination-info"},l.start," — ",l.end," / ",l.total," Riesgos",_.size(this.state.filters)>0&&React.createElement("span",{className:"filtered-label"}," (FILTRADOS)"))))))}}]),t}();O.contextType=s.default;var w=function(e){function t(){var e;return g(this,t),(e=E(this,R(t).apply(this,arguments))).state={desc:"",rf:"",ri:"",ec:"",vc:"",rr:""},e.onClickReset=function(t){t.preventDefault(),e.setState({desc:"",rf:"",ri:"",ec:"",vc:"",rr:""},function(){e.props.onChange(e.getActiveFilters())})},e}return C(t,a.PureComponent),y(t,[{key:"onChange",value:function(e,t){var n=this,a=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t);this.setState(a,function(){n.props.onChange(n.getActiveFilters())})}},{key:"getActiveFilters",value:function(){var e={};return _.each(this.state,function(t,n){""!==t&&(e[n]=t)}),e}},{key:"render",value:function(){var e=this;return React.createElement(a.Fragment,null,React.createElement("tr",{className:"filters-row"},React.createElement("td",{className:"collapsing"},React.createElement("select",{className:(0,u.default)("rawselect rf",""!==this.state.rf?"active":null),value:this.state.rf,onChange:function(t){return e.onChange("rf",t.target.value)}},React.createElement("option",{value:""},"TODOS"),React.createElement("option",{value:"1"},"SI"),React.createElement("option",{value:"0"},"NO"))),React.createElement("td",null,React.createElement("input",{type:"search",spellCheck:!1,className:(0,u.default)(""!==this.state.desc?"active":null),value:this.state.desc,onChange:function(t){return e.onChange("desc",t.target.value)}})),React.createElement("td",null,React.createElement("select",{className:(0,u.default)("rawselect",""!==this.state.ri?"active":null),value:this.state.ri,onChange:function(t){return e.onChange("ri",t.target.value)}},React.createElement("option",{value:""},"TODOS"),React.createElement("option",{value:"5"},"Alto"),React.createElement("option",{value:"3"},"Medio"),React.createElement("option",{value:"1"},"Bajo"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"!1"},"Alto y Medio"),React.createElement("option",{value:"!3"},"Alto y Bajo"),React.createElement("option",{value:"!5"},"Medio y Bajo"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"-1"},"Por Definir"))),React.createElement("td",null,React.createElement("select",{className:(0,u.default)("rawselect",""!==this.state.ec?"active":null),value:this.state.ec,onChange:function(t){return e.onChange("ec",t.target.value)}},React.createElement("option",{value:""},"TODOS"),React.createElement("option",{value:"5"},"Fuerte"),React.createElement("option",{value:"3"},"Moderado"),React.createElement("option",{value:"1"},"Débil"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"!1"},"Fuerte y Moderado"),React.createElement("option",{value:"!3"},"Fuerte y Débil"),React.createElement("option",{value:"!5"},"Moderado y Débil"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"-1"},"Por Definir"))),React.createElement("td",null,React.createElement("select",{className:(0,u.default)("rawselect",""!==this.state.vc?"active":null),value:this.state.vc,onChange:function(t){return e.onChange("vc",t.target.value)}},React.createElement("option",{value:""},"TODOS"),React.createElement("option",{value:"5"},"Efectivo"),React.createElement("option",{value:"3"},"Con Deficiencias"),React.createElement("option",{value:"1"},"Inefectivo"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"!1"},"Efectivo o Con Deficiencias"),React.createElement("option",{value:"!3"},"Efectivo o Inefectivo"),React.createElement("option",{value:"!5"},"Con Deficiencias o Inefectivo"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"-1"},"Por Definir"))),React.createElement("td",null,React.createElement("select",{className:(0,u.default)("rawselect",""!==this.state.rr?"active":null),value:this.state.rr,onChange:function(t){return e.onChange("rr",t.target.value)}},React.createElement("option",{value:""},"TODOS"),React.createElement("option",{value:"5"},"Alto"),React.createElement("option",{value:"3"},"Medio"),React.createElement("option",{value:"1"},"Bajo"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"!1"},"Alto y Medio"),React.createElement("option",{value:"!3"},"Alto y Bajo"),React.createElement("option",{value:"!5"},"Medio y Bajo"),React.createElement("option",{disabled:!0},"-"),React.createElement("option",{value:"-1"},"Por Definir")))),_.size(this.getActiveFilters())>0&&React.createElement("tr",null,React.createElement("td",{colSpan:7},React.createElement("div",{id:"filteralerts",className:"alert-2 alert-primary"},React.createElement("span",{className:"icon-info-sign",style:{marginRight:3}}),"NOTA: La visibilidad de los riesgos está afectada por los filtros aplicados.",React.createElement("a",{href:"#",className:"resetfilters",style:{marginLeft:10},onClick:this.onClickReset},"Quitar filtros")))))}}]),t}(),S=function(e){function t(){var e;return g(this,t),(e=E(this,R(t).apply(this,arguments))).state={openModal:!1,loading:!1},e.onEditDescription=function(e){e.getData()},e.onClickEdit=function(t){t.preventDefault(),e.setState({openModal:!0})},e.onCloseModal=function(){e.setState({openModal:!1})},e}return C(t,a.PureComponent),y(t,[{key:"componentDidMount",value:function(){var e=this,t=f.RiesgoModel.setChanges(this.props.riesgo,{});if(t){this.setState({loading:!0});var n=this.context,a=n.riesgos,o=n.updateRiesgos;f.RiesgoModel.save(this.props.riesgo,t).then(function(){var n=_.map(a,function(n){return n.id==e.props.riesgo.id?Object.assign({},n,t):n});e.setState({loading:!1}),o(n)})}}},{key:"getLabel",value:function(e,t){return e?t[e]:"Por Definir"}},{key:"getRiesgo",value:function(){return _.find(this.context.riesgos,{id:this.props.riesgo.id})}},{key:"render",value:function(){var e=this.props.riesgo,t=this.state.loading,n='<strong class="riesgo-code">'+e.codigo+"</strong> - "+(e.description||""),a=app.vars.proyecto.isOpen;return React.createElement("tr",{className:"hoverable-actions"},React.createElement("td",{className:"collapsing center aligned",style:{padding:"0.5em 0"}},1==+e.fraude_material&&React.createElement(i.default,{trigger:React.createElement("i",{className:"red exclamation circle large icon","aria-hidden":"true"}),content:"Riesgo de Fraude",size:"mini"})),React.createElement("td",{className:"table-cell-riesgo-description"},React.createElement("div",{className:"ui compact segment",onClick:this.onClickEdit},React.createElement(c.default,{preview:n,data:e.description,editable:!1}))),React.createElement("td",null,(0,m.createRiesgoCellBlock)(e,"riesgo_inherente",{onClick:this.onClickEdit,loading:t})),React.createElement("td",null,(0,m.createRiesgoCellBlock)(e,"control_valoracion",{onClick:this.onClickEdit,loading:t})),React.createElement("td",null,(0,m.createRiesgoCellBlock)(e,"control_efectividad",{onClick:this.onClickEdit,loading:t})),React.createElement("td",null,(0,m.createRiesgoCellBlock)(e,"riesgo_residual",{onClick:this.onClickEdit,loading:t})),React.createElement("td",null,a&&React.createElement("div",{className:"btn-group dropdown-modern"},React.createElement("a",{className:"dropdown-toggle","data-toggle":"dropdown",href:"#"},React.createElement("i",{className:"ellipsis vertical grey icon"})),React.createElement("ul",{className:"dropdown-menu pull-right"},user_has_role_permission("riesgo_edit")&&React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickEdit},"Editar Riesgo")),user_has_role_permission("riesgo_delete")&&React.createElement(P,{riesgo:e}))),this.state.openModal&&React.createElement(d.default,{riesgo:e,onClose:this.onCloseModal,editable:a&&user_has_role_permission("riesgos_edit")})))}}]),t}();S.contextType=s.default;var P=function(e){function t(){var e;return g(this,t),(e=E(this,R(t).apply(this,arguments))).onClick=function(t){t.preventDefault();var n=e.props.riesgo,a=e.context,o=a.riesgos,r=a.updateRiesgos;bootbox.warningConfirm('¿Esta seguro de querer eliminar por completo el riesgo "<strong>'.concat(n.codigo,'</strong>"?'),"No","Sí, Eliminar Riesgo",function(e){e&&($.blockUI(create_blockUI_loading_message("Eliminando Riesgo...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/riesgos/").concat(n.id)),{sf_method:"delete"}).done(function(){r(_.reject(o,{id:n.id})),$.unblockUI()}).fail(function(){return $.unblockUI()}))})},e}return C(t,a.PureComponent),y(t,[{key:"render",value:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClick},"Eliminar Riesgo"))}}]),t}();P.contextType=s.default},594:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanAttachmentFrom=function(e,t){var n=public_path("uploads/proyecto_adjunto/".concat(t.filepath),!0).replace(/\./g,".").replace(/\\/g,"/"),a=new RegExp('<a .*href="'+n+'"(.+?)/a>\\s*(<br\\s?/?>)?',"g");return e.replace(a,"")},t.AttachmentListPanel=t.AttachmentListItem=void 0;var a=n(1),o=u(n(69)),r=u(n(200)),i=u(n(595)),c=u(n(203)),l=u(n(199)),s=u(n(307));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}function h(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){var e;return p(this,t),(e=h(this,v(t).apply(this,arguments))).onRemove=function(t){t.preventDefault();var n=url_for("proyecto/".concat(e.props.attachment.id_proyecto,"/adjunto/").concat(e.props.attachment.id,"/remove"));bootbox.warningConfirm("¿Esta seguro de querer borrar este archivo?<br><br>Tenga en cuenta que el sistema intentará borrar automáticamente los enlaces existentes a este archivo.","Cancelar","Aceptar",function(t){t&&($.blockUI({message:'<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">Borrando archivo.<br> Por favor Espere ...</h3>'}),$.ajax(n,{type:"POST",data:{},dataType:"json"}).done(function(){e.props.onDelete(e.props.attachment,function(){return $.unblockUI()})}).fail(function(){$.pnotify({text:"El archivo no pudo ser borrado.",type:"error"}),$.unblockUI()}))})},e}return g(t,a.Component),f(t,[{key:"changeStatus",value:function(e,t){var n=this;e.preventDefault();var a=url_for("proyecto/".concat(this.props.attachment.id_proyecto,"/adjunto/").concat(this.props.attachment.id,"/").concat(t));$.blockUI({message:'<div class="ajax-loader-snake-32  _a-center"></div><h3 class="loading-block-text">Marcando archivo como '+_.str.capitalize(t)+".<br> Por favor Espere ...</h3>"}),$.ajax(a,{type:"POST",data:{},dataType:"json"}).done(function(e){n.props.onUpdate(e.response.record),$.unblockUI()}).fail(function(){$.pnotify({text:"El archivo no pudo ser actualizado.",type:"error"}),$.unblockUI()})}},{key:"render",value:function(){var e,n,a,r=this,i=this.props.attachment;return i.fecha_completado&&(e=React.createElement("div",{style:{display:"inline-block"}},React.createElement("strong",{className:"title"},"(P) "),React.createElement("div",{style:{display:"inline-block",minWidth:20,textAlign:"center",marginRight:2},title:"Preparado por: ".concat(i.UpdateLog[0].User.name)},i.UpdateLog[0].User.sigla," "),React.createElement("div",{style:{display:"inline-block"},title:i.fecha_completado},React.createElement("span",{className:"icon-moon-calendar"})," ",Date.create(i.fecha_completado).format("{year}-{MM}-{dd}")))),i.fecha_revisado&&(n=React.createElement("div",{style:{display:"inline-block"}},React.createElement("strong",{className:"title"},"(R) "),React.createElement("div",{style:{display:"inline-block",minWidth:20,textAlign:"center",marginRight:2},title:"Revisado por: ".concat(i.RevisionLog[0].User.name)},i.RevisionLog[0].User.sigla," "),React.createElement("div",{style:{display:"inline-block"},title:i.fecha_revisado},React.createElement("span",{className:"icon-moon-calendar"})," ",Date.create(i.fecha_revisado).format("{year}-{MM}-{dd}")))),user_has_role(["PM","SR"])&&(a=i.fecha_completado?React.createElement("button",{style:{marginLeft:"8px"},onClick:function(e){return r.changeStatus(e,"revisado")},className:"act"},React.createElement("span",{className:"icon-moon-checkmark-8"})," Revisar"):React.createElement(c.default,{trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{style:{marginLeft:"8px"},className:"act disabled"},React.createElement("span",{className:"icon-moon-checkmark-8"})," Revisar")),content:"Esta archivo adjunto debe estar primero en estado COMPLETADO, para poder ser marcado como REVISADO",header:"Marcar como Revisado | Opción deshabilitada",className:"disable-text",on:"hover"})),React.createElement("li",{key:i.id,style:{marginBottom:2}},React.createElement("div",{style:{background:"#f5f9f8",borderRadius:6,border:"1px solid #aecec7"}},React.createElement("div",{className:"col-md-1",style:{marginTop:5,borderRight:"1px inset #d7e1e2"}},React.createElement("img",{src:t.getFileIconUrl(i.filename),alt:"Icono"})),React.createElement("div",{className:"col-md-11",style:{padding:"3px 10px"}},React.createElement("div",{className:"noqtip",title:i.filename,style:{fontWeight:"bold",fontSize:"12px",maxWidth:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},i.filename),React.createElement("div",{style:{fontSize:"12px"}},React.createElement("span",{style:{fontStyle:"italic"},className:"noqtip",title:"Peso del archivo: ".concat(i.filesize_human)},i.filesize_human)," ","|",React.createElement("div",{className:"attachment-actionsbar"},React.createElement("div",{className:"section-a"},React.createElement("a",{href:public_path("uploads/proyecto_adjunto/".concat(i.filepath)),target:"_blank",className:"act",style:{color:"#777"}},React.createElement("span",{className:"icon-moon-download",style:{fontSize:"10px"}})," Descargar")),user_has_role(["PM","SR","JR"])&&React.createElement("div",{className:"section-a"},React.createElement("a",{href:"#",className:"act",onClick:this.onRemove},React.createElement("span",{className:"icon-tc-trash"})," Borrar")),React.createElement("div",{className:"section-a",style:{minWidth:90}},i.fecha_completado?React.createElement(c.default,{trigger:e,position:"bottom center"},React.createElement(c.default.Header,{content:"Preparado por"}),React.createElement(c.default.Content,null,React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,i.UpdateLog.map(function(e,t){return React.createElement("tr",{key:t},React.createElement("td",null,React.createElement(o.default,{name:"user circle",color:"green"})," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))):user_has_role(["PM","SR","JR"])&&React.createElement("button",{style:{marginLeft:"8px"},onClick:function(e){return r.changeStatus(e,"completado")},className:"act"},React.createElement("span",{className:"icon-moon-checkmark-8"})," Completar")),React.createElement("div",{className:"section-a"},i.fecha_revisado&&React.createElement(c.default,{trigger:n,position:"bottom center"},React.createElement(c.default.Header,{content:"Revisado por"}),React.createElement(c.default.Content,null,React.createElement("table",{className:"table nowrap"},React.createElement("tbody",null,i.RevisionLog.map(function(e,t){return React.createElement("tr",{key:t},React.createElement("td",null,React.createElement(o.default,{name:"user circle",color:"olive"})," ",e.User.name," (",e.User.sigla,")"),React.createElement("td",null,React.createElement("em",null,Date.create(e.ts).format("{year}-{MM}-{dd}"))))}))))),a))),React.createElement("div",null)),React.createElement("div",{className:"clearfix"})))}}],[{key:"getFileExtension",value:function(e){return e.split(".").pop()}},{key:"getFileIconUrl",value:function(e){var n=t.getFileExtension(e);return public_path("images/file_icons/".concat(function(){switch(n){case"xls":case"xlsx":case"xlsm":case"xlsxm":return"excel";case"doc":case"docx":return"word";case"pdf":return"pdf";case"png":case"jpg":case"jpeg":case"bmp":case"gif":return"image";case"zip":case"rar":return"zip";default:return"default"}}(),".png"))}}]),t}();t.AttachmentListItem=y;var E=function(e){function t(){return p(this,t),h(this,v(t).apply(this,arguments))}return g(t,a.Component),f(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.isLoading,a=t.attachments;return React.createElement("div",{className:"attachment-list-panel dimmable",style:{minHeight:40}},n&&React.createElement(l.default,{inverted:!0,active:!0},React.createElement(s.default,{inverted:!0,active:!0,className:"elastic grey"})),React.createElement("h3",{className:"panel-title"},"Adjuntos:",React.createElement(r.default,{circular:!0,color:"green"},_.size(a))),_.size(a)>0&&React.createElement(i.default,{divided:!0,className:"attachment-list"},_.map(a,function(t,n){return React.createElement(y,{key:t.id,attachment:t,onUpdate:e.props.onUpdateItem,onDelete:e.props.onDeleteItem})})))}}]),t}();t.AttachmentListPanel=E,E.defaultProps={isLoading:!1}},599:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(1),o=v(n(106)),r=n(83),i=v(n(600)),c=v(n(105)),l=v(n(158)),s=v(n(156)),u=v(n(303)),d=n(604),p=n(606),m=n(204),f=n(205),h=v(n(8));function v(e){return e&&e.__esModule?e:{default:e}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function C(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),e}function k(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return React.createElement(a.Fragment,null,e," ",React.createElement(d.GenericTooltip,{text:t,title:n||e}))},P=function(e){function t(){var e;return E(this,t),(e=k(this,N(t).apply(this,arguments))).handlers={},e.handleEscape=function(t){c.default.getCode(t)===c.default.Escape&&("undefined"!=typeof CKEDITOR&&null!=CKEDITOR.dialog.getCurrent()||$(".bootbox:visible").length>0||e.onClose())},e.onClose=function(){e.props.onClose()},e.onModalMount=function(){r.instance.sub("keydown",e.handleEscape,{pool:"default"})},e.onClickEditCodigo=function(t){return e.attachHandler(t,function(){var n=e.props.riesgo,a=function(){switch(t){case"codigo":return{content:"Escriba el nuevo Código del Riesgo.",header:"Código del Riesgo"};case"control_codigo":return{content:"Escriba el nuevo Código del Control.",header:"Código del Control"}}}(),o=n[t]||"";bootbox.prompt(a,"Cancelar","Aceptar",function(n){""!=(n=_.str.trim(n))&&e.sendToServer(y({},t,n))},o),$(".bootbox.modal").addClass("modal-ab")})},e.onClickEditDescription=function(t){return e.attachHandler(t,function(n,a,o,r){e.sendToServer(y({},t,n.getData())),r()})},e.onChangeControlCodigo=function(t){e.sendToServer({control_codigo:t},!0)},e.onClickRemoveControlCodigo=function(){bootbox.warningConfirm("¿Desea eliminar este control?<br/>Tenga en cuenta que esto eliminará TODA la información (Código, Descripción, Valoración, Evaluaciones y Validaciones) registrada en este control","No","Sí, eliminar control",function(t){if(t){var n=f.RiesgoModel.getChangesWhenRemoveControlCodigo(e.props.riesgo);e.sendToServer(n,!0)}})},e.onChangeRiesgoFraude=function(t){e.sendToServer({fraude_material:t?1:0},!0)},e.onChangeSlider=function(t){return e.attachHandler(t,function(n){var a=y({},t,n=2*n-1);if("probabilidad"==t||"impacto"==t){var o=e.calcularRiesgoInherente(a);o&&(a.riesgo_inherente=o)}e.sendToServer(a,!0)})},e.onChangeDropdown=function(t){return e.attachHandler(t,function(n){var a=y({},t,n);e.sendToServer(a,!0)})},e.onChangeCriterioEvaluacion=function(t,n){var a=y({},t,n.value);e.sendToServer(a,!0)},e.onSavePaso=function(t){var n=_.map(t,function(e){return{id_master_data_paso:e,id:e}});e.sendToServer({ProyectoRiesgoHasPaso:n})},e}return O(t,a.PureComponent),C(t,[{key:"sendToServer",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.props.riesgo;(e=f.RiesgoModel.setChanges(a,e))&&(n?this.updateModel(e):$.blockUI(create_blockUI_loading_message("Guardando Cambios...")),f.RiesgoModel.save(a,e).then(function(){n||(t.updateModel(e),$.unblockUI())}).catch(function(e){bootbox.dialog(e,[{label:"OK",class:"btn-danger"}],{header:'<span class="icon-warning-sign"></span> Error de Validación - Dato no válido',classes:"bootbox-error"}),$.unblockUI()}))}},{key:"updateModel",value:function(e){var t=this.props.riesgo,n=this.context,a=n.riesgos;(0,n.updateRiesgos)(_.map(a,function(n){return n.id==t.id&&(n=Object.assign({},n,e)),n}))}},{key:"attachHandler",value:function(e,t){return this.handlers[e]||(this.handlers[e]=t),this.handlers[e]}},{key:"cloneRiesgoWithChanges",value:function(e){var t=this.props.riesgo;return Object.assign({},t,e||{})}},{key:"calcularRiesgoInherente",value:function(e){return f.RiesgoModel.calculateRiesgoInherente(this.cloneRiesgoWithChanges(e))}},{key:"renderSection1",value:function(){var e=this.props,t=e.riesgo,n=e.editable,o=React.createElement("div",{className:"row ui middle aligned  grid "},React.createElement("div",{className:"four wide column"},React.createElement("strong",null,"Riesgo: "),React.createElement("span",null,t.codigo)),React.createElement("div",{className:"nine wide column right aligned"},React.createElement("strong",null,"Riesgo Inherente: "),(0,m.createRiesgoCellBlock)(t,"riesgo_inherente")),React.createElement("div",{className:"three wide column right aligned"},1==+t.fraude_material&&React.createElement("strong",null,"Fraude ",React.createElement("i",{className:"red exclamation circle large icon","aria-hidden":"true"})))),r=React.createElement(a.Fragment,null,React.createElement("div",{className:"row"},React.createElement("div",{className:"eight wide column"},React.createElement("strong",null,"ID del Riesgo: "),React.createElement("span",null,t.codigo),n&&React.createElement(u.default,{onClick:this.onClickEditCodigo("codigo")}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"sixteen wide column"},React.createElement("div",{className:"ui segment"},React.createElement(s.default,{className:"riesgo-descripcion descripcion-field",data:t.description,editable:n,ckeditorOptions:"basic",prefixPreview:"Descripción del Riesgo: ",labelTitle:"Descripción del Riesgo:",openOnClickPreview:n,onSave:this.onClickEditDescription("description")})))),React.createElement("div",{className:"three column row"},React.createElement("div",{className:"column field _a-center"},React.createElement("header",null,React.createElement("strong",null,"Rubros")),React.createElement(m.RiesgoFieldDropdown,{value:t.ProyectoRiesgoHasRubro,choices:app.vars.riesgocontext.rubros,field:"id_master_data_fase",onChange:this.onChangeDropdown("ProyectoRiesgoHasRubro"),editable:n})),React.createElement("div",{className:"column field _a-center"},React.createElement("header",null,React.createElement("strong",null,"Aserciones")),React.createElement(m.RiesgoFieldDropdown,{value:t.ProyectoRiesgoHasObjetivo,choices:app.vars.riesgocontext.objetivos,field:"id_master_data_objetivo",onChange:this.onChangeDropdown("ProyectoRiesgoHasObjetivo"),editable:n}))),React.createElement("div",{className:"three column  row n1"},React.createElement("div",{className:"column field _a-center"},React.createElement("header",null,React.createElement("div",{className:"title"},"Probabilidad ",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.probabilidad",title:"Probabilidad"})),React.createElement("div",{className:"bordertopline"})),React.createElement(j,{value:t.probabilidad,labels:{1:S("Bajo","@tooltip.riesgos.probabilidad__bajo","Probabilidad Baja"),2:S("Medio","@tooltip.riesgos.probabilidad__medio","Probabilidad Medio"),3:S("Alto","@tooltip.riesgos.probabilidad__alto","Probabilidad Alta")},editable:n,onChange:this.onChangeSlider("probabilidad")})),React.createElement("div",{className:"column field _a-center"},React.createElement("header",null,React.createElement("div",{className:"title"},"Impacto ",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.impacto",title:"Impacto"})),React.createElement("div",{className:"bordertopline"})),React.createElement(j,{value:t.impacto,labels:{1:"Bajo",2:"Medio",3:"Alto"},editable:n,onChange:this.onChangeSlider("impacto")})),React.createElement("div",{className:"column field _a-center"},React.createElement("header",null,React.createElement("div",{className:"title"},"Riesgo Inherente",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.riesgo_inherente",title:"Riesgo Inherente"})),React.createElement("div",{className:"bordertopline"})),React.createElement(x,{value:t.riesgo_inherente}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"sixteen wide column right aligned"},React.createElement("div",{className:"zone-g"},React.createElement("strong",null,"¿Este riesgo tiene probabilidad de un fraude material?"),React.createElement(I,{editable:n,checked:1==t.fraude_material,onChange:this.onChangeRiesgoFraude})))));return React.createElement(M,{header:o,content:r})}},{key:"renderSection2",value:function(){var e=this.props,t=e.riesgo,n=e.editable,o=React.createElement("div",{className:"row ui middle aligned  grid "},React.createElement("div",{className:"six wide column"},React.createElement("strong",null,"Control: ",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.control",title:"Control del Riesgo"})," "),React.createElement("span",null,t.control_codigo)),React.createElement("div",{className:"nine wide column right aligned"},React.createElement("strong",null,"Evaluación del Control:",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.control_valoracion",title:"Evaluación del Control"})),(0,m.createRiesgoCellBlock)(t,"control_valoracion"))),r=React.createElement(a.Fragment,null,React.createElement("div",{className:"row"},React.createElement("div",{className:"eight wide column"},React.createElement("strong",null,"ID del Control: "),React.createElement(T,{value:t.control_codigo,onChange:this.onChangeControlCodigo}),n&&t.control_codigo&&React.createElement(u.default,{onClick:this.onClickEditCodigo("control_codigo")}),n&&t.control_codigo&&React.createElement("button",{className:"ui button mini negative compact icon basic action",title:"Eliminar Control",onClick:this.onClickRemoveControlCodigo},React.createElement("i",{className:"trash icon"})))),React.createElement("div",{className:"row"},React.createElement("div",{className:"sixteen wide column"},React.createElement("div",{className:"ui segment"},React.createElement(s.default,{className:"control-descripcion  descripcion-field",data:t.control_descripcion,editable:n,ckeditorOptions:"basic",prefixPreview:"Descripción del Control: ",labelTitle:"Descripción del Control:",openOnClickPreview:n,onSave:this.onClickEditDescription("control_descripcion")})))),React.createElement("div",{className:"row"},React.createElement("div",{className:"sixteen wide column"},React.createElement("div",{className:(0,h.default)("ui segment nopad noborder",t.control_codigo?null:"dimmable")},React.createElement(m.RiesgoCriterioEvaluacionControlTable,{riesgo:t,onChange:this.onChangeCriterioEvaluacion,editable:n}),React.createElement(D,{riesgo:t,editable:n})))));return React.createElement(M,{header:o,content:r})}},{key:"renderSection3",value:function(){var e=this.props,t=e.riesgo,n=e.editable,o=React.createElement("div",{className:"row ui middle aligned  grid "},React.createElement("div",{className:"six wide column"},React.createElement("strong",null,"Validación del Control: ")),React.createElement("div",{className:"nine wide column right aligned"},React.createElement("strong",null,"Riesgo Residual: "),(0,m.createRiesgoCellBlock)(t,"riesgo_residual"))),r={efectividad:{1:S("Inefectivo","@tooltip.riesgos.control_efectividad__inefectivo"),2:S("Con Deficiencias","@tooltip.riesgos.control_efectividad__condeficiencias"),3:S("Efectivo","@tooltip.riesgos.control_efectividad__efectivo")}},i=React.createElement(a.Fragment,null,React.createElement("div",{className:"row"},React.createElement("div",{className:"sixteen wide column"},React.createElement("div",{className:(0,h.default)("ui segment",!!t.control_codigo||"dimmable")},React.createElement(s.default,{className:"control-validacion-control  descripcion-field",data:t.control_debilidad_descripcion,editable:n,prefixPreview:"Validación del Control: ",labelTitle:"Validación del Control:",openOnClickPreview:n,onSave:this.onClickEditDescription("control_debilidad_descripcion"),ckeditorUploadOptions:{model:"riesgo__control_validacion",modelId:t.id},footer:"AttachmentList"}),React.createElement("br",null),React.createElement(A,{riesgo:t,editable:n,onSave:this.onSavePaso}),React.createElement(D,{riesgo:t,editable:n})))),React.createElement("div",{className:"two column  row n1"},React.createElement("div",{className:(0,h.default)("column field _a-center",!!t.control_codigo||"dimmable")},React.createElement("header",null,React.createElement("div",{className:"title"},"Efectividad del Control",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.control_efectividad",title:"Efectividad del Control"})),React.createElement("div",{className:"bordertopline"})),React.createElement(j,{value:t.control_efectividad,labels:r.efectividad,onChange:this.onChangeSlider("control_efectividad"),editable:n,inverted:!0}),React.createElement(D,{riesgo:t,editable:n})),React.createElement("div",{className:"column field _a-center"},React.createElement("header",null,React.createElement("div",{className:"title"},"Riesgo Residual",React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.riesgo_residual",title:"Riesgo Residual"})),React.createElement("div",{className:"bordertopline"})),React.createElement(x,{value:t.riesgo_residual,tooltips:{1:React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.riesgo_residual__bajo",title:"Riesgo Residual - Bajo"}),3:React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.riesgo_residual__moderado",title:"Riesgo Residual - Medio"}),5:React.createElement(d.GenericTooltip,{text:"@tooltip.riesgos.riesgo_residual__alto",title:"Riesgo Residual - Alto"})}}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"sixteen wide column"},React.createElement("div",{className:(0,h.default)("ui segment",!!t.control_codigo||"dimmable")},React.createElement(s.default,{className:"control-impacto-descripcion  descripcion-field",data:t.control_impacto_descripcion,editable:n,prefixPreview:"Impacto en la Auditoría según la clasificación del Riesgo Residual: ",labelTitle:"Impacto en la Auditoría según la clasificación del Riesgo Residual:",openOnClickPreview:n,onSave:this.onClickEditDescription("control_impacto_descripcion"),ckeditorUploadOptions:{model:"riesgo__impacto",modelId:t.id},footer:"AttachmentList"}),React.createElement(D,{riesgo:t,editable:n})))));return React.createElement(M,{header:o,content:i})}},{key:"render",value:function(){return React.createElement(o.default,{open:!0,dimmer:"inverted",closeIcon:!0,onClose:this.onClose,closeOnDimmerClick:!1,closeOnEscape:!1,onMount:this.onModalMount,className:"proyecto-riesgo-modal"},this.renderSection1(),this.renderSection2(),this.renderSection3(),React.createElement(o.default.Actions,null,React.createElement("button",{className:"ui button primary",onClick:this.props.onClose},"Aceptar")))}}]),t}();t.default=P,P.contextType=l.default,P.defaultProps={editable:!0};var M=function(e){function t(){var e;return E(this,t),(e=k(this,N(t).apply(this,arguments))).state={open:!0},e.onToggle=function(){e.setState(function(e){return{open:!e.open}})},e}return O(t,a.PureComponent),C(t,[{key:"render",value:function(){return React.createElement("section",{className:(0,h.default)("modal-section",open?"open":"closed")},React.createElement("header",{className:"modal-section-header"},React.createElement("div",{className:"ui middle aligned grid"},React.createElement("div",{className:"row"},React.createElement("div",{className:"fourteen wide column"},this.props.header),React.createElement("div",{className:"two wide column center aligned clickable toggle-collapse",onClick:this.onToggle},this.state.open?React.createElement(a.Fragment,null,React.createElement("i",{className:"angle down large icon",title:"Contraer"})," Contraer"):React.createElement(a.Fragment,null,React.createElement("i",{className:"angle left large icon",title:"Expandir"})," Expandir"))))),this.state.open&&React.createElement("div",{className:"section-body ui top aligned grid"},this.props.content))}}]),t}(),I=function(e){function t(){var e;return E(this,t),(e=k(this,N(t).apply(this,arguments))).onChange=function(t){if(e.props.editable)return function(){e.props.onChange(t)}},e}return O(t,a.PureComponent),C(t,[{key:"render",value:function(){return React.createElement("div",{className:(0,h.default)("riesgo-fraude-checkboxgroup",this.props.editable?null:"disabled")},React.createElement("label",{htmlFor:"riesgofraudechk1",className:this.props.checked?"active":"",onClick:this.onChange(!0)},React.createElement("span",{className:"lb-title"},"SI"),React.createElement("div",{className:"riesgofraudechk",id:"riesgofraudechk1"})),React.createElement("label",{htmlFor:"riesgofraudechk0",className:this.props.checked?"":"active",onClick:this.onChange(!1)},React.createElement("span",{className:"lb-title"},"NO"),React.createElement("div",{className:"riesgofraudechk",id:"riesgofraudechk0"})))}}]),t}(),x=function(e){function t(){return E(this,t),k(this,N(t).apply(this,arguments))}return O(t,a.PureComponent),C(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.tooltips;return React.createElement("div",{className:(0,h.default)("bma-checkboxgroup","bma-value-"+this.props.value)},React.createElement("div",{className:(0,h.default)("bma-checkbox-wrap",1==t?"active":"",t>=1?"on":"")},React.createElement("div",{className:"bma-checkbox"})," ",React.createElement("div",{className:"checkbox-label"},"Bajo ",n&&n[1])),React.createElement("div",{className:(0,h.default)("bma-checkbox-wrap",3==t?"active":"",t>=3?"on":"")},React.createElement("div",{className:"bma-checkbox"}),React.createElement("div",{className:"checkbox-label"},"Medio ",n&&n[3])),React.createElement("div",{className:(0,h.default)("bma-checkbox-wrap",5==t?"active":"",5==t?"on":"")},React.createElement("div",{className:"bma-checkbox"}),React.createElement("div",{className:"checkbox-label"},"Alto ",n&&n[5])))}}]),t}(),j=function(e){function t(){var e;return E(this,t),(e=k(this,N(t).apply(this,arguments))).onChange=function(t){if(e.props.editable&&0!=t)return e.props.onChange(t)},e}return O(t,a.PureComponent),C(t,[{key:"render",value:function(){var e=this.props.value;return e=e&&0!=e?(+e+1)/2:0,React.createElement("div",null,React.createElement(i.default,{min:0,max:3,tooltip:!1,value:e,labels:this.props.labels,onChange:this.onChange,className:(0,h.default)("slider-value-".concat(e||"0"),!this.props.inverted||"inverted",this.props.editable||"disabled")}))}}]),t}();j.defaultProps={editable:!0,inverted:!1};var D=function(e){var t=e.riesgo,n=e.editable;return!t.control_codigo&&React.createElement("div",{className:"ui dimmer active inverted riesgo-control-dimmer"},n&&React.createElement("div",{className:"content"},React.createElement("div",{className:"ui basic red label"},"Diligencie el Código del Control para habilitar la edición de este campo.")))},T=function(e){var t=e.value,n=e.onChange,o=g((0,a.useState)(t),2),r=o[0],i=o[1],c=function(){r&&n(r)};return t&&r!=t&&i(t),t?React.createElement("span",null,t):React.createElement(a.Fragment,null,React.createElement("div",{className:"ui action mini input"},React.createElement("input",{type:"text",placeholder:"ID del Control",className:"",style:{marginBottom:0,width:140},value:r||"",onChange:function(e){return i(e.target.value)},onBlur:c}),React.createElement("button",{type:"button",className:"ui button compact icon green",onClick:c},React.createElement("i",{className:"ui check icon large"}))))},A=function(e){function t(){var e;return E(this,t),(e=k(this,N(t).apply(this,arguments))).state={open:!1,selectedIds:[]},e.submit=function(){e.props.onSave(e.state.selectedIds),e.setState({open:!1})},e.onChange=function(t){e.setState({selectedIds:t})},e.onClickDeleteItem=function(t){bootbox.warningConfirm('¿Desea desvincular el paso "'.concat(app.vars.masterdatapasos[t].descripcion,'" de este riesgo?'),"Cancelar","Sí, Desvincular paso",function(n){n&&e.setState(function(n){var a=_.intersection(n.selectedIds,[t]);return e.props.onSave(a),{selectedIds:a}})})},e}return O(t,a.PureComponent),C(t,[{key:"componentDidMount",value:function(){this.setState({selectedIds:_.pluck(this.props.riesgo.ProyectoRiesgoHasPaso,"id_master_data_paso")})}},{key:"render",value:function(){var e=this;return React.createElement("div",{style:{borderTop:"1px solid #CCC",marginTop:5,paddingTop:5}},this.props.riesgo.ProyectoRiesgoHasPaso.length>0&&React.createElement("strong",{className:"title-field"},"Pasos vinculados: "),this.props.riesgo.ProyectoRiesgoHasPaso.length>0&&React.createElement("div",{className:"ui list horizontal",role:"list"},_.map(this.props.riesgo.ProyectoRiesgoHasPaso,function(t){return React.createElement("div",{className:"item",key:"haspaso-".concat(t.id),role:"listitem"},React.createElement("div",{className:"ui label"},React.createElement("a",{href:url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/paso/").concat(t.id_master_data_paso)),target:"_blank"},app.vars.masterdatapasos[t.id_master_data_paso].descripcion),React.createElement("i",{"aria-hidden":"true",className:"delete icon",onClick:function(){return e.onClickDeleteItem(t.id_master_data_paso)}})))})),this.props.editable&&React.createElement("button",{type:"button",className:"ui button mini compact primary inline",onClick:function(){return e.setState({open:!0})}},"Vincular pasos"),this.state.open&&React.createElement(o.default,{className:"modal-ab",open:!0,onClose:function(){return e.setState({open:!1})}},React.createElement(o.default.Header,{content:"Vincular Pasos al Riesgo ".concat(this.props.riesgo.codigo)}),React.createElement(o.default.Content,null,React.createElement("p",{className:"description-text"},"Seleccione los pasos que desea vincular a este riesgo"),React.createElement(p.PasoSelect,{selectedIds:this.state.selectedIds,onChange:this.onChange})),React.createElement(o.default.Actions,{actions:[{content:"Cancelar",negative:!0,key:"cancel",onClick:function(){return e.setState({open:!1})}},{content:"Vincular pasos",primary:!0,key:"ok",onClick:this.submit}]})))}}]),t}()},604:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericTooltip=void 0;var a=i(n(84)),o=i(n(70)),r=i(n(605));function i(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l=function(e){var t;if("object"==c(e.text))t=React.createElement("div",{className:"content"},e.text);else if("string"==typeof e.text){if(!(t="@"==e.text.substr(0,1)?(0,r.default)(app.vars.texts,e.text.substr(1)):e.text))return null;t=React.createElement("div",{dangerouslySetInnerHTML:{__html:t}})}return React.createElement(a.default,{size:"tiny",wide:e.wide,trigger:React.createElement(o.default,{color:e.iconColor,size:e.iconSize,name:"question circle",className:"tooltip-icon"}),header:e.title,content:t})};t.GenericTooltip=l,l.defaultProps={iconColor:"blue",iconSize:"small",wide:!1}},606:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasoSelect=void 0;var a,o=n(1),r=(a=n(8))&&a.__esModule?a:{default:a};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=(0,o.createContext)({selectedIds:[],updateSelectedIds:function(){}}),h=function(e){function t(){var e;return c(this,t),(e=u(this,d(t).apply(this,arguments))).state={tree:null,selectedIds:[]},e.updateSelectedIds=function(t){e.setState({selectedIds:t}),$.isFunction(e.props.onChange)&&e.props.onChange(t)},e}return p(t,o.PureComponent),s(t,[{key:"componentDidMount",value:function(){var e=this;null==t.MasterDataTree&&app.vars.masterdatatree&&(t.MasterDataTree=b(app.vars.masterdatatree)),null==t.MasterDataTree?$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data_tree")),{export_options:{type:"pasolink"}}).done(function(n){t.MasterDataTree=app.vars.masterdatatree=b(n.response),e.setState({tree:t.MasterDataTree})}):this.setState({tree:t.MasterDataTree}),this.props.selectedIds&&this.setState({selectedIds:this.props.selectedIds})}},{key:"render",value:function(){return null===this.state.tree?React.createElement("div",{className:"ui segment",style:{minHeight:120}},React.createElement("div",{className:"ui active transition inverted dimmer"},React.createElement("div",{className:"content"},React.createElement("div",{className:"ui active inverted text loader"},"Cargando pasos...")))):React.createElement("div",{className:""},React.createElement(f.Provider,{value:{selectedIds:this.state.selectedIds,updateSelectedIds:this.updateSelectedIds}},React.createElement("ul",{className:"methodology checkbox-list methodology-all unstyled nav nav-stacked"},_.map(this.state.tree,function(e){return React.createElement(v,{key:e.id,item:e})}))))}}]),t}();t.PasoSelect=h,h.MasterDataTree=null;var v=function(e){function t(){var e;return c(this,t),(e=u(this,d(t).apply(this,arguments))).state={collapsed:!0},e.onClick=function(t){t.preventDefault(),e.setState(function(e){return{collapsed:!e.collapsed}})},e}return p(t,o.PureComponent),s(t,[{key:"render",value:function(){var e=this.props.item,n=this.state.collapsed;return React.createElement("li",{className:(0,r.default)("methodology-item",e.type)},React.createElement("div",{className:"methodology-item-head"},React.createElement("a",{href:"#",onClick:this.onClick},React.createElement("span",{className:"item-name"},e.descripcion))),React.createElement("ul",{className:(0,r.default)("methodology unstyled collapse",n?"hide":"in")},_.map(e.items,function(e){return"paso"==e.type?React.createElement(g,{key:e.id,item:e}):React.createElement(t,{item:e,key:e.id})})))}}]),t}(),g=function(e){function t(){var e;return c(this,t),(e=u(this,d(t).apply(this,arguments))).onChangeCheckbox=function(t){var n=e.props.item,a=e.context,o=a.selectedIds;(0,a.updateSelectedIds)(o=o.includes(n.id)?_.difference(o,[n.id]):_.union(o,[n.id]))},e}return p(t,o.PureComponent),s(t,[{key:"render",value:function(){var e=this.props.item,t=this.context.selectedIds;return React.createElement("li",{key:e.id,className:"methodology-item paso"},React.createElement("div",{className:"methodology-item-head"},React.createElement("label",{htmlFor:"paso-select-tree-paso-".concat(e.id)},React.createElement("input",{type:"checkbox",className:"checkbox pull-right",id:"paso-select-tree-paso-".concat(e.id),checked:t.includes(e.id),onChange:this.onChangeCheckbox}),React.createElement("span",{className:"item-name"},e.descripcion))))}}]),t}();g.contextType=f;var b=function(e){return _.map(e,function(e){return{id:e.id,descripcion:e.descripcion,type:"phase",items:_.map(e.Subfases,function(e){return{id:e.id,descripcion:e.descripcion,type:"subphase",items:_.map(e.Pasos,function(e){return{id:e.id,descripcion:e.descripcion,code:e.code,type:"paso"}})}})}})}},627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProyectoRiesgoListSidebar=void 0;var a=n(1),o=p(n(155)),r=n(628),i=p(n(158)),c=n(205),l=n(629),s=n(657),u=n(659),d=p(n(8));function p(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function v(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function g(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var R=function(e){function t(){var e;return f(this,t),(e=g(this,b(t).apply(this,arguments))).state={panelOpen:null},e.onItemOpen=function(t){e.setState({panelOpen:t})},e.closeAllPanel=function(){e.setState({panelOpen:null})},e}return y(t,a.PureComponent),v(t,[{key:"render",value:function(){var e=this,t=app.vars.proyecto.isOpen,n="proyecto/".concat(app.vars.idproyecto,"/"),r=public_path("images/sidebar_right/"),i=app.vars.riesgocontext.counters;return React.createElement(a.Fragment,null,React.createElement("div",{className:(0,d.default)("sidebar-fixed-overlay ui page dimmer inverted",{active:null!=this.state.panelOpen}),onClick:function(){return e.closeAllPanel()}}),React.createElement(o.default,{fixed:"right",vertical:!0,compact:!0,icon:!0,className:"app-sidebar right-sidebar",id:"app-right-sidebar"},React.createElement(o.default.Menu,null,React.createElement(o.default.Item,null),t&&React.createElement(C,null)),React.createElement(o.default.Menu,null,React.createElement(l.MenuItemHallazgo,{moduleParams:{model:"riesgo_hallazgo"},counter:i.hallazgos,open:"hallazgo"==this.state.panelOpen,onOpen:this.onItemOpen,modelManager:u.HallazgoRiesgoModelManager.getInstance()})),React.createElement(o.default.Menu,null,React.createElement(s.MenuItemRevision,{moduleParams:{model:"riesgo_revision"},counter:i.revisiones,open:"revision"==this.state.panelOpen,onOpen:this.onItemOpen,modelManager:u.RevisionRiesgoModelManager.getInstance()})),React.createElement(o.default.Menu,null,React.createElement(o.default.Item,{as:"a",href:url_for(n+"riesgos/export"),target:"_blank",title:"Exportar",content:React.createElement("img",{src:r+"exportar_excel.svg",className:"ui large image"})})),React.createElement(o.default.Menu,null,React.createElement(o.default.Item,{as:"a",href:url_for(n+"riesgos/config"),title:"Configuraciones",content:React.createElement("img",{src:r+"configuraciones.svg",className:"ui large image"})}))))}}]),t}();t.ProyectoRiesgoListSidebar=R;var C=function(e){function t(){var e;return f(this,t),(e=g(this,b(t).apply(this,arguments))).state={open:!1},e.onClick=function(){e.setState({open:!0})},e.onClose=function(){e.setState({open:!1})},e.onCreate=function(t){var n=e.context,a=n.riesgos,o=n.updateRiesgos;"bibliotecaIds"in t?($.blockUI(create_blockUI_loading_message("Creando riesgos")),c.RiesgoModel.create(t).then(function(t){var n=a.slice();_.each(t,function(e){n.push(e)}),e.setState({open:!1}),o(n),$.unblockUI()})):($.blockUI(create_blockUI_loading_message("Creando riesgo")),c.RiesgoModel.create(t).then(function(t){var n=a.slice();n.push(t),o(n),e.setState({open:!1}),$.unblockUI()}))},e}return y(t,a.PureComponent),v(t,[{key:"render",value:function(){return React.createElement(a.Fragment,null,React.createElement(o.default.Item,{link:!0,title:"Crear Riesgo",className:"item-create",onClick:this.onClick,content:React.createElement("img",{src:public_path("images/sidebar_right/")+"riesgos_new.svg",className:"ui large image"})}),this.state.open&&React.createElement(r.ProyectoRiesgoCreateModal,{onClose:this.onClose,onCreate:this.onCreate}))}}]),t}();C.contextType=i.default},628:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProyectoRiesgoCreateFromLibrary=t.ProyectoRiesgoCreateNew=t.ProyectoRiesgoCreateModal=void 0;var a=n(1),o=d(n(106)),r=d(n(234)),i=d(n(84)),c=d(n(8)),l=d(n(156)),s=n(204),u=d(n(158));function d(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function h(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function v(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(){return m(this,t),v(this,g(t).apply(this,arguments))}return b(t,a.PureComponent),h(t,[{key:"render",value:function(){var e=this,t=[{menuItem:{key:"library",className:"tab-nav-item",content:React.createElement("span",{className:"tabname"},"Desde Biblioteca")},render:function(){return React.createElement(r.default.Pane,null,React.createElement(C,{onCancel:e.props.onClose,onCreate:e.props.onCreate}))}},{menuItem:{key:"new",className:"tab-nav-item",content:React.createElement("span",{className:"tabname"},"Nuevo")},render:function(){return React.createElement(r.default.Pane,null,React.createElement(R,{onCancel:e.props.onClose,onCreate:e.props.onCreate}))}}];return React.createElement(o.default,{dimmer:"inverted",open:!0,closeIcon:!0,closeOnDimmerClick:!1,className:"modal-ab",onClose:this.props.onClose},React.createElement(o.default.Header,null,"Crear Riesgo"),React.createElement(o.default.Content,null,React.createElement(r.default,{panes:t,menu:{widths:2,tabular:!0,attached:"top"},className:"ab-tabs"})))}}]),t}();t.ProyectoRiesgoCreateModal=E;var R=function(e){function t(){var e;return m(this,t),(e=v(this,g(t).apply(this,arguments))).state={codigo:"",description:"",ProyectoRiesgoHasRubro:[],ProyectoRiesgoHasObjetivo:[]},e.onSubmit=function(){""!=e.state.codigo||""!=e.state.description?$.isFunction(e.props.onCreate)&&e.props.onCreate(e.state):bootbox.alert("Ingrese el código o la descripción del riesgo")},e}return b(t,a.PureComponent),h(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{className:"ui form"},React.createElement("p",{className:"description-text"},"Diligencie los siguientes campos para crear un nuevo riesgo en este proyecto."),React.createElement("div",{className:"inline fields"},React.createElement("div",{className:"field"},React.createElement("label",{htmlFor:"proyecto_riesgo_new_codigo"},"ID del Riesgo: "),React.createElement("div",{className:"ui input"},React.createElement("input",{id:"proyecto_riesgo_new_codigo",type:"text",value:this.state.codigo,placeholder:"ID del Riesgo",onChange:function(t){return e.setState({codigo:_.trim(t.target.value)})}})))),React.createElement("div",{className:"fields"},React.createElement("div",{className:"field sixteen wide"},React.createElement("div",{className:"ui segment",style:{minHeight:90}},React.createElement(l.default,{data:this.state.description,className:"riesgo-descripcion descripcion-field",ckeditorOptions:"basic",prefixPreview:"Descripción del Riesgo: ",labelTitle:"Descripción del Riesgo:",openOnClickPreview:!0,onSave:function(t){return e.setState({description:t.getData()})}})))),React.createElement("div",{className:"equal width fields"},React.createElement("div",{className:"field"},React.createElement("label",null,"Rubros"),React.createElement("div",{className:"ui input"},React.createElement(s.RiesgoFieldDropdown,{value:this.state.ProyectoRiesgoHasRubro,choices:app.vars.riesgocontext.rubros,field:"id_master_data_fase",onChange:function(t){return e.setState({ProyectoRiesgoHasRubro:t})}}))),React.createElement("div",{className:"field"},React.createElement("label",null,"Aserciones"),React.createElement("div",{className:"ui input"},React.createElement(s.RiesgoFieldDropdown,{value:this.state.ProyectoRiesgoHasObjetivo,choices:app.vars.riesgocontext.objetivos,field:"id_master_data_objetivo",onChange:function(t){return e.setState({ProyectoRiesgoHasObjetivo:t})}})))),React.createElement("div",{className:"field"},React.createElement(i.default,{disabled:""!==this.state.codigo||""!==this.state.description,content:"Ingrese el código o la descripción del riesgo",header:"Opción deshabilitada",className:"disabled-text",trigger:React.createElement("div",{style:{display:"inline-block",float:"right"}},React.createElement("button",{type:"button",className:"ui button right floated  primary",disabled:""==this.state.codigo&&""==this.state.description,onClick:this.onSubmit},"Crear Riesgo"))}),React.createElement("button",{type:"button",className:"ui button right floated  negative",onClick:this.props.onCancel},"Cancelar"),React.createElement("div",{className:"clearfix"})))}}]),t}();t.ProyectoRiesgoCreateNew=R;var C=function(e){function t(){var e;return m(this,t),(e=v(this,g(t).apply(this,arguments))).state={riesgos:null,selectedIds:[]},e._isMounted=!1,e.onChange=function(t){var n=t.target;e.setState(function(e){var t=e.selectedIds.slice();return _.includes(t,n.value)?t=_.difference(t,[n.value]):t.push(n.value),{selectedIds:t}})},e.onSubmit=function(){if(e.state.selectedIds.length>=0){var t=e.context.riesgos,n=_.pluck(t,"id_riesgo"),a=_.difference(e.state.selectedIds,n);e.props.onCreate({bibliotecaIds:a}),e.setState({selectedIds:a})}},e}return b(t,a.PureComponent),h(t,[{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,app.vars.riesgocontext.biblioteca?this.setState({riesgos:app.vars.riesgocontext.biblioteca}):$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/riesgos/list")),{type:"biblioteca"}).done(function(t){app.vars.riesgocontext.biblioteca=t.response.riesgos,e._isMounted&&e.setState({riesgos:t.response.riesgos})})}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this;if(null===this.state.riesgos)return React.createElement("div",{style:{minHeight:160}},React.createElement("div",{className:"ui active transition visible inverted dimmer"},React.createElement("div",{className:"ui inverted text loader"},"Cargando Riesgos de la Biblioteca")));var t=this.context.riesgos,n=_.pluck(t,"id_riesgo");return React.createElement(a.Fragment,null,React.createElement("div",{style:{maxHeight:420,overflowY:"auto",marginBottom:5}},React.createElement("p",null,"Seleccione los riesgos de la biblioteca que desea agregar a su proyecto."),React.createElement("table",{className:"ui table compact small striped"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null),React.createElement("th",null,"Riesgo"),React.createElement("th",null,"Rubro"),React.createElement("th",null,"Aserciones"))),React.createElement("tbody",null,_.map(this.state.riesgos,function(t){return React.createElement("tr",{key:t.id,className:(0,c.default)(_.include(n,t.id)?"success":null)},React.createElement("td",null,_.include(n,t.id)?React.createElement("i",{className:"check icon green"}):React.createElement("input",{type:"checkbox",name:"biblioteca[id][]",checked:_.include(e.state.selectedIds,t.id),value:t.id,onChange:e.onChange})),React.createElement("td",{className:"riesgo_descr"},t.description),React.createElement("td",null,t.rubro),React.createElement("td",null,_.map(t.Objetivos,function(e){return React.createElement(i.default,{key:e.id,trigger:React.createElement("span",{className:"label label-success",style:{marginRight:2}},e.code),size:"small",header:"Objetivo: ".concat(e.name),content:e.description})})))})))),React.createElement("div",{className:"field"},React.createElement("button",{type:"button",className:"ui button right floated  primary",onClick:this.onSubmit},"Crear Riesgos"),React.createElement("button",{type:"button",className:"ui button right floated  negative",onClick:this.props.onCancel},"Cancelar"),React.createElement("div",{className:"clearfix"})))}}]),t}();t.ProyectoRiesgoCreateFromLibrary=C,C.contextType=u.default},629:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemHallazgo=void 0;var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};a.get||a.set?Object.defineProperty(t,n,a):t[n]=e[n]}return t.default=e,t}(n(1)),o=n(159),r=n(310),i=n(633),c=n(207),l=n(311);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=p(this,m(t).apply(this,arguments))).state={items:null},e.onMountPanel=function(){null===e.state.items&&e.props.modelManager.getJson(e.props).then(function(t){e.setState({items:t})})},e.onCreateItem=function(t){return new Promise(function(n){$.blockUI(create_blockUI_loading_message("Creando Hallazgo")),e.props.modelManager.createItem(e.props,t).then(function(t){e.addItem(t),$.unblockUI(),n()})})},e.onSaveItem=function(t,n,a){return new Promise(function(o){a?$.blockUI(create_blockUI_loading_message(a)):e.updateItem(t,n),e.props.modelManager.saveItem(e.props,t,n).then(function(n){e.updateItem(t,n),a&&$.unblockUI(),o(n)})})},e.onClickDeleteItem=function(t){bootbox.warningConfirm("¿Desea eliminar el hallazgo <strong>".concat(c.HallazgoUtils.formatName(t.name),"</strong> ?"),"No","Sí, Eliminar",function(n){n&&($.blockUI(create_blockUI_loading_message("Eliminando Hallazgo")),e.props.modelManager.deleteItem(e.props,t).then(function(){e.deleteItem(t),$.unblockUI()}))})},e}var n,s,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,a.PureComponent),n=t,(s=[{key:"addItem",value:function(e){this.setState(function(t){return{items:[].concat(u(t.items),[e])}})}},{key:"updateItem",value:function(e,t){this.setState(function(n){return{items:_.map(n.items,function(n){return n.id==e.id?Object.assign({},n,t):n})}})}},{key:"deleteItem",value:function(e){this.setState(function(t){return{items:_.reject(t.items,{id:e.id})}})}},{key:"render",value:function(){return a.default.createElement(o.BaseMenuElement,{name:"hallazgo",counter:null===this.state.items?this.props.counter:_.size(this.state.items),icon:"hallazgos",title:"Hallazgos",open:this.props.open,onToggle:this.props.onOpen,onMountPanel:this.onMountPanel},a.default.createElement("div",{className:"content"},a.default.createElement(r.MenuItemNew,{moduleParams:this.props.moduleParams,buttonText:"Crear Hallazgo",headerText:"Nuevo Hallazgo",isEditable:es_proyecto_editable()&&user_has_role_permission("hallazgo_create"),item:{id:null,status:"NUEVO",implementado:null,hallazgo:"",RevisionLog:[],UpdateLog:[]},onSave:this.onCreateItem,contentAs:l.HallazgoModal}),a.default.createElement(i.HallazgoList,{isEditable:es_proyecto_editable()&&user_has_role_permission("hallazgo_edit"),moduleParams:this.props.moduleParams,items:this.state.items,onSaveItem:this.onSaveItem,onClickDeleteItem:this.onClickDeleteItem})))}}])&&d(n.prototype,s),h&&d(n,h),t}();t.MenuItemHallazgo=h},632:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarPanelHeader=void 0;var a,o=(a=n(19))&&a.__esModule?a:{default:a},r=n(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,s(t).apply(this,arguments))}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.PureComponent),n=t,(a=[{key:"componentDidMount",value:function(){(0,o.default)(this.props,"onMount")}},{key:"render",value:function(){return React.createElement("header",null,React.createElement("a",{href:"#",className:"close-link",onClick:this.props.onClose},React.createElement("i",{className:"ui icon close green"})),React.createElement("div",{className:"title"},this.props.title))}}])&&c(n.prototype,a),i&&c(n,i),t}();t.SidebarPanelHeader=d},633:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoListItem=t.HallazgoList=void 0;var a=n(1),o=n(207),r=n(206),i=n(634),c=n(159),l=n(208),s=n(655);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function m(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){return d(this,t),f(this,h(t).apply(this,arguments))}return v(t,a.PureComponent),m(t,[{key:"render",value:function(){var e=this;if(null===this.props.items)return React.createElement("div",{style:{height:300,position:"relative"}},React.createElement("div",{className:"ui active inverted text loader elastic olive"},"Cargando Listado de Hallazgos"));if(0==_.size(this.props.items))return React.createElement("div",{className:"empty nocontent"},"0 Hallazgos");var t=this.props.items;return React.createElement(c.MenuElementListPanel,null,_.map(t,function(t){return React.createElement("div",{key:t.id,className:"listitem hallazgo-listitem"},React.createElement(y,{item:t,moduleParams:e.props.moduleParams,onSave:e.props.onSaveItem,onClickDelete:e.props.onClickDeleteItem}))}))}}]),t}();t.HallazgoList=b;var y=function(e){function t(){var e;return d(this,t),(e=f(this,h(t).apply(this,arguments))).state={isModalEdit:!1},e.onClickEdit=function(t){t.preventDefault(),e.setState({isModalEdit:!0})},e.onCloseEdit=function(){e.setState({isModalEdit:!1})},e.onClickDelete=function(t){t.preventDefault(),e.props.onClickDelete(e.props.item)},e.onSave=function(t,n){var a=null;_.isEqual(n,{status:"COMPLETADO"})?a="Marcando como COMPLETADO":_.isEqual(n,{status:"REVISADO"})&&(a="Marcando como REVISADO"),e.props.onSave(t,n,a)},e}return v(t,a.PureComponent),m(t,[{key:"renderDescripcion",value:function(){var e=this.props.item,t=(0,s.truncateText)(e.hallazgo);return React.createElement("div",{dangerouslySetInnerHTML:{__html:t}})}},{key:"renderEstadoImplementacion",value:function(){var e=this.props.item;return null==e.implementado||""+e.implementado==""?"Pendiente":"0"==e.implementado?"En Proceso":"Hecho"}},{key:"render",value:function(){var e=this,t=this.props.item;return React.createElement("div",null,React.createElement(c.MenuElementListActions,{actions:{edit:{label:"Editar",callback:this.onClickEdit,permission:"hallazgo_edit"},delete:{label:"Eliminar",callback:this.onClickDelete,permission:"hallazgo_delete"}}}),React.createElement("div",{onClick:function(){return e.setState({isModalEdit:!0})}},React.createElement("div",{className:"row r1"},React.createElement("div",{className:"pull-left r1_1"},React.createElement("span",{className:"title-h1"},o.HallazgoUtils.formatName(t.name)),React.createElement(r.AuthorIconLogDefaultWrapper,{model:t,size:"small"}),React.createElement("div",{className:"r1_2"},React.createElement("strong",null,"Implementación: ")," ",this.renderEstadoImplementacion())),React.createElement(l.StatusDivBlock,{wrapperClassName:"pull-right text-mini",status:t.status,className:"mini",hideLabel:!0})),React.createElement("div",{className:"row"},React.createElement("div",{className:"editor-preview"},this.renderDescripcion())),React.createElement("div",{className:"row"})),this.state.isModalEdit&&React.createElement(i.HallazgoModalEdit,{item:t,moduleParams:this.props.moduleParams,onSave:this.onSave,onClickDelete:this.onClickDelete,onClose:this.onCloseEdit}))}}]),t}();t.HallazgoListItem=y},634:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallazgoModalEdit=void 0;var a,o=n(1),r=(a=n(106))&&a.__esModule?a:{default:a},i=n(311);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=s(this,u(t).apply(this,arguments))).onSave=function(t){e.props.onSave(e.props.item,t)},e}var n,a,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.PureComponent),n=t,(a=[{key:"render",value:function(){return React.createElement(r.default,{open:!0,dimmer:"inverted",className:"modal-ab modal-sidebarmenuitem",size:"large",closeIcon:!0,onClose:this.props.onClose},React.createElement(r.default.Header,null,"Editar Hallazgo"),React.createElement(i.HallazgoModal,{moduleParams:this.props.moduleParams,item:this.props.item,isEditable:user_has_role_permission("hallazgo_edit"),onSave:this.onSave,onClickDelete:this.props.onClickDelete}))}}])&&l(n.prototype,a),c&&l(n,c),t}();t.HallazgoModalEdit=p},655:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanSpacesFromHtml=r,t.truncateText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;if(null==e)return e;e=(e=r(e)).replace(/<table.*\/table>/g,'<img src="/images/icon_tabular.png" title="Tabla" />');var n=(0,o.default)(""+e,t,{keepImageTag:!0});return(n=(n=(n=n.replace(/(min-)?width:.+?;/g,"")).replace(/(min-)?height:.+?;/g,"")).replace(/style=".+?"/g,"")).trim()};var a,o=(a=n(656))&&a.__esModule?a:{default:a};function r(e){return null==e?e:e=(e=(e=e.trim().replace(/\r?\n|\r/g,"")).replace(/>\s+</g,"><")).replace(/\s{2,}/g," ")}},657:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItemRevision=void 0;var a=n(1),o=n(159),r=c(n(658)),i=c(n(318));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function m(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).state={items:null},e.parseItems=function(e){return e},e.onMountPanel=function(){null===e.state.items&&e.props.modelManager.getJson(e.props).then(function(t){e.setState({items:t})})},e.onCreateItem=function(t,n){$.blockUI(create_blockUI_loading_message("Creando Nota de Revisión")),e.props.modelManager.createItem(e.props,{revision_text:t.text,op:t.status}).then(function(t){e.setState(function(e){var n=s(e.items);return n.push(t),{items:n}}),n(),$.unblockUI()})},e.onSaveItem=function(t,n,a){return new Promise(function(o){a&&setTimeout(function(){return $.blockUI(create_blockUI_loading_message(a))},100),e.props.modelManager.saveItem(e.props,t,n).then(function(t){e.setState(function(e){return{items:_.map(e.items,function(e){return e.id==t.id?t:e})}}),a&&$.unblockUI(),o(t)})})},e.onClickDeleteItem=function(t){bootbox.warningConfirm("¿Desea eliminar esta Nota de Revisión <b>#".concat(t.name,"</b> ?"),"No","Sí, Eliminar",function(n){n&&($.blockUI(create_blockUI_loading_message("Eliminando Nota de Revisión")),e.props.modelManager.deleteItem(e.props,t).then(function(){e.setState(function(e){return{items:_.reject(e.items,{id:t.id})}}),$.unblockUI()}))})},e}return h(t,a.PureComponent),p(t,[{key:"renderContent",value:function(){return React.createElement("div",{className:"content"},React.createElement(b,{onSubmit:this.onCreateItem}),React.createElement(r.default,{items:this.state.items,moduleParams:this.props.moduleParams,isEditable:es_proyecto_editable()&&user_has_role_permission("revision_edit"),onSaveItem:this.onSaveItem,onClickDeleteItem:this.onClickDeleteItem}))}},{key:"render",value:function(){return React.createElement(o.BaseMenuElement,{name:"revision",counter:null===this.state.items?this.props.counter:_.size(_.reject(this.state.items,{status:"REVISADO"})),icon:"notas_de_revision",title:"Notas de Revisión",open:this.props.open,onToggle:this.props.onOpen,onMountPanel:this.onMountPanel},this.renderContent())}}]),t}();t.MenuItemRevision=g;var b=function(e){function t(){var e;return u(this,t),(e=m(this,f(t).apply(this,arguments))).state={text:"",isEditMode:!1},e.onChange=function(t){e.setState({text:t.target.value})},e.onTextareaKeyDown=function(t){27==t.keyCode&&e.onCancel(),!t.ctrlKey&&!t.metaKey||13!=t.keyCode&&10!=t.keyCode||e.onSubmit("NUEVO")},e.onClickNew=function(){e.setState({isEditMode:!0})},e.onCancel=function(){e.setState({isEditMode:!1,text:""})},e.onSubmit=function(t){""!=_.str.trim(e.state.text)?e.props.onSubmit({text:_.str.trim(e.state.text),status:t},function(){e.setState({text:"",isEditMode:!1})}):bootbox.alertError("La Nota de Revisión no puede estar vacía.")},e}return h(t,a.PureComponent),p(t,[{key:"render",value:function(){var e=this;return es_proyecto_editable()&&user_has_role_permission("revision_edit")?this.state.isEditMode?React.createElement("div",null,React.createElement(i.default,{minRows:2,maxRows:8,autoFocus:!0,onChange:this.onChange,value:this.state.text,style:{width:"98%"},onKeyDown:this.onTextareaKeyDown,placeholder:"Escriba aquí su Nota de Revisión"}),React.createElement("div",{style:{marginTop:8,textAlign:"right"}},React.createElement("button",{className:"ui button negative mini compact",onClick:this.onCancel},"Cancelar"),React.createElement("button",{className:"ui button primary mini compact",onClick:function(){return e.onSubmit("NUEVO")}},"Guardar"))):React.createElement("div",{style:{textAlign:"center"}},React.createElement("button",{className:"ui button primary mini compact",onClick:this.onClickNew},"Crear Nota")):null}}]),t}()},658:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(1),o=n(159),r=n(206),i=n(208),c=u(n(318)),l=u(n(8)),s=u(n(203));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}function h(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){return p(this,t),h(this,v(t).apply(this,arguments))}return g(t,a.PureComponent),f(t,[{key:"render",value:function(){var e=this;if(null===this.props.items)return React.createElement("div",{style:{height:300,position:"relative"}},React.createElement("div",{className:"ui active inverted text loader elastic olive"},"Cargando Notas de Revisión"));if(0==_.size(this.props.items))return React.createElement("div",{className:"empty nocontent"},"0 Notas de Revisión");var t=this.props.items,n=_.reject(t,{status:"REVISADO"}),a=_.filter(t,{status:"REVISADO"});return React.createElement(o.MenuElementListPanel,{className:"revision-list"},0==_.size(n)?React.createElement("div",{className:"empty nocontent"},"0 Notas de Revisión Abiertas"):_.map(n,function(t){return React.createElement("div",{key:t.id,className:"listitem revision-listitem"},React.createElement(R,{item:t,isEditable:e.props.isEditable,onSave:e.props.onSaveItem,onClickDelete:e.props.onClickDeleteItem}))}),_.size(a)>0&&React.createElement(E,{items:a}))}}]),t}();t.default=y;var E=function(e){function t(){var e;return p(this,t),(e=h(this,v(t).apply(this,arguments))).state={collapsed:!0},e.toggle=function(){e.setState(function(e){return{collapsed:!e.collapsed}})},e}return g(t,a.PureComponent),f(t,[{key:"render",value:function(){var e=this.props.items;return React.createElement("div",{style:{marginTop:20,marginBottom:20,padding:"0 10px"}},React.createElement("h4",{className:"row clickable",onClick:this.toggle},React.createElement("i",{className:(0,l.default)("icon caret",this.state.collapsed?"right":"down")})," Notas Revisadas",React.createElement("span",{className:"toggle-action"},"[",this.state.collapsed?"Mostrar":"Ocultar","]"),React.createElement("span",{className:"ui mini circular green label pull-right"},_.size(e))),!this.state.collapsed&&React.createElement("div",{className:"revision-list-closed"},_.map(e,function(e){return React.createElement("div",{key:e.id,className:"listitem revision-listitem"},React.createElement(R,{item:e,isEditable:!1}))})))}}]),t}(),R=function(e){function t(){var e;return p(this,t),(e=h(this,v(t).apply(this,arguments))).state={isEditMode:!1,isThreadOpen:!1},e.onClickEdit=function(){e.setState({isEditMode:!0})},e.onClickDelete=function(t){t.preventDefault(),e.props.onClickDelete(e.props.item)},e.onClickNewComment=function(){e.props.isEditable&&e.setState({isThreadOpen:!0})},e.onCancelNewComment=function(){e.setState({isThreadOpen:!1})},e.onChange=function(t){e.props.onSave(e.props.item,t,"Guardando cambios...").then(function(){e.setState({isEditMode:!1})})},e.onClickChangeStatus=function(t){e.props.onSave(e.props.item,{op:t},"Marcando como "+t+"...")},e.onAddComment=function(t){var n={comment:t.text};t.status&&(n.op=t.status),e.props.onSave(e.props.item,n,"Guardando comentario...").then(function(){e.setState({isThreadOpen:!1})})},e}return g(t,a.PureComponent),f(t,[{key:"render",value:function(){var e=this,t=this.props.item;return React.createElement("div",null,this.props.isEditable&&React.createElement(o.MenuElementListActions,{actions:{delete:{label:"Eliminar",callback:this.onClickDelete,permission:"revision_delete"}}}),React.createElement("div",{className:"row header-item"},React.createElement("div",{className:"pull-left"},React.createElement("span",{className:"title-h1"},"Nota #",t.name),React.createElement(r.AuthorIconLogDefaultWrapper,{model:t,size:"small"})),React.createElement(i.StatusDivBlock,{wrapperClassName:"pull-right text-mini",status:t.status||"EN PROCESO",className:"mini",hideLabel:!0})),React.createElement("div",{className:"author-info"},React.createElement("i",{"aria-hidden":"true",className:"user circle icon olive",style:{float:"left"}}),React.createElement("div",{className:"content"},React.createElement("div",{className:"header"},t.Creator.User.name,React.createElement("div",{className:"pull-right description"},Date.create(t.Creator.ts).format("{d} {Mon} {year} {h}:{mm} {tt}"))))),this.props.isEditable&&this.state.isEditMode?React.createElement(C,{item:t,onSubmit:this.onChange}):React.createElement(a.Fragment,null,React.createElement("p",{onClick:this.onClickNewComment,style:{lineHeight:"1em"},dangerouslySetInnerHTML:{__html:t.description.replace(/\n/g,"<br/>")}}),React.createElement("div",{className:(0,l.default)("threadlist ui threaded comments",{empty:0==_.size(t.Comments)})},this.state.isThreadOpen&&React.createElement("h5",{className:(0,l.default)("ui header",{dividing:0==_.size(t.Comments)})},"Comentarios"),_.map(t.Comments,function(t){return React.createElement("div",{className:"comment",key:t.id,onClick:e.onClickNewComment},React.createElement("div",{className:"avatar"},React.createElement("i",{className:(0,l.default)("icon user circle",{green:"COMPLETADO"==t.status,olive:"REVISADO"==t.status})})),React.createElement("div",{className:"content"},React.createElement("div",{className:"author"},t.Creator.User.name),React.createElement("div",{className:"metadata"},Date.create(t.Creator.ts).format("{d} {Mon} {year}  {h}:{mm} {tt}")),React.createElement("div",{className:"text"},React.createElement("p",{dangerouslySetInnerHTML:{__html:t.comentario}}))))})),this.state.isThreadOpen&&this.props.isEditable?React.createElement(k,{parentItem:t,onSave:this.onAddComment,onCancel:this.onCancelNewComment}):this.props.isEditable&&React.createElement("div",{className:"actions-wrapper"},React.createElement("div",{className:"actions"},React.createElement("div",{className:"group-actions"},React.createElement("button",{className:"ui button icon blue mini compact",onClick:this.onClickNewComment},"Responder")),React.createElement("div",{className:"group-actions right-actions"},React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onClickChangeStatus("COMPLETADO")}},React.createElement("i",{className:"icon check"})," Completar"),React.createElement(s.default,{disabled:null!=t.fecha_completado,className:"disable-text",on:"hover",basic:!0,content:"Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button mini compact olive",disabled:null==t.fecha_completado,onClick:function(){return null==t.fecha_completado?void 0:e.onClickChangeStatus("REVISADO")}},React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado"))}))))))}}]),t}(),C=function(e){function t(e){var n;return p(this,t),(n=h(this,v(t).call(this,e))).onChange=function(e){n.setState({value:e.target.value})},n.onSubmit=function(e){if(""!=_.str.trim(n.state.value)){var t={revision_text:_.str.trim(n.state.value)};e&&(t.op=e),n.props.onSubmit(t)}else bootbox.alertError("La Nota de Revisión no puede estar vacía.")},n.state={value:n.props.item.description},n}return g(t,a.PureComponent),f(t,[{key:"render",value:function(){var e=this;return React.createElement(a.Fragment,null,React.createElement(c.default,{minRows:2,maxRows:8,onChange:this.onChange,value:this.state.value,style:{width:"98%"},placeholder:"Escriba aquí su Nota de Revisión"}),React.createElement("div",{style:{marginTop:8,textAlign:"right"}},React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onSubmit()}},"Guardar"),React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onSubmit("COMPLETADO")}},React.createElement("i",{className:"icon check"})," Completar"),React.createElement(s.default,{disabled:null!=this.props.item.fecha_completado,className:"disable-text",on:"hover",basic:!0,content:"Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button mini compact olive",disabled:null==this.props.item.fecha_completado,onClick:function(){return null==e.props.item.fecha_completado?void 0:e.onSubmit("REVISADO")}},React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado"))})))}}]),t}(),k=function(e){function t(){var e;return p(this,t),(e=h(this,v(t).apply(this,arguments))).cancelTimeout=null,e.state={value:""},e.onChange=function(t){e.setState({value:t.target.value})},e.onTextareaKeyDown=function(t){27==t.keyCode&&(e.props.onCancel(),e.cancelTimeout=null),!t.ctrlKey&&!t.metaKey||13!=t.keyCode&&10!=t.keyCode||e.onSubmit()},e.onSubmit=function(t){(""!=_.str.trim(e.state.value)||t)&&(null!=e.cancelTimeout&&(window.clearTimeout(e.cancelTimeout),e.cancelTimeout=null),e.props.onSave({text:_.str.trim(e.state.value),status:t}))},e.onBlur=function(){e.cancelTimeout=window.setTimeout(function(){e.props.onCancel()},500)},e}return g(t,a.PureComponent),f(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{style:{marginBottom:30}},React.createElement(c.default,{minRows:2,maxRows:5,autoFocus:!0,value:this.state.value,onChange:this.onChange,onKeyDown:this.onTextareaKeyDown,placeholder:"Escriba aquí su comentario",style:{width:"95%"},onBlur:function(){return e.onBlur()}}),React.createElement("div",{style:{textAlign:"right",marginTop:5}},React.createElement("button",{className:"ui button icon blue mini compact pull-left",onClick:function(){return e.onSubmit()}},"Enviar"),React.createElement("button",{className:"ui button icon primary mini compact",onClick:function(){return e.onSubmit("COMPLETADO")}},React.createElement("i",{className:"icon check"})," Completar"),React.createElement(s.default,{disabled:null!=this.props.parentItem.fecha_completado,className:"disable-text",on:"hover",basic:!0,content:"Debe estar primero en estado COMPLETADO, para poder marcarla como REVISADA.",trigger:React.createElement("div",{className:"button-wrapper"},React.createElement("button",{className:"ui button mini compact olive",disabled:null==this.props.parentItem.fecha_completado,onClick:function(){return null==e.props.parentItem.fecha_completado?void 0:e.onSubmit("REVISADO")}},React.createElement("i",{className:"icon check fitted"}),React.createElement("i",{className:"icon check"})," Revisado"))})))}}]),t}()},659:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionRiesgoModelManager=t.HallazgoRiesgoModelManager=void 0;var i=function(){function e(){a(this,e)}return r(e,[{key:"getJson",value:function(e){return new Promise(function(e){$.getJSON(url_for2("proyecto/:id_proyecto/riesgo_hallazgo/json")).done(function(t){e(_.isEmpty(t.response)?[]:t.response)})})}},{key:"createItem",value:function(e,t){var n=url_for2("proyecto/:id_proyecto/riesgo_hallazgo");return new Promise(function(e){$.post(n,{data:t}).done(function(t){e(t.response.record)})})}},{key:"saveItem",value:function(e,t,n){var a;return a=_.isEqual(n,{status:"COMPLETADO"})?"proyecto/:id_proyecto/riesgo_hallazgo/:id/c":_.isEqual(n,{status:"REVISADO"})?"proyecto/:id_proyecto/riesgo_hallazgo/:id/r":"proyecto/:id_proyecto/riesgo_hallazgo/:id",new Promise(function(e){$.post(url_for2(a,{id:t.id}),{data:n}).done(function(t){e(t.response.record)})})}},{key:"deleteItem",value:function(e,t){return new Promise(function(e){$.ajax({url:url_for2("proyecto/:id_proyecto/riesgo_hallazgo/:item_id",{item_id:t.id}),type:"DELETE"}).done(function(t){1==t.status&&e()})})}},{key:"parseItems",value:function(e){return e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new this),e.instance}}]),e}();t.HallazgoRiesgoModelManager=i;var c=function(){function e(){a(this,e)}return r(e,[{key:"getJson",value:function(e){var t=this;return new Promise(function(e){$.getJSON(url_for2("proyecto/:id_proyecto/riesgo_revision")).done(function(n){e(_.isEmpty(n.response.revisiones)?[]:t.parseItems(n.response.revisiones))})})}},{key:"createItem",value:function(e,t){var n=url_for2("proyecto/:id_proyecto/riesgo_revision");return new Promise(function(e){$.post(n,t).done(function(t){e(t.response.revision)})})}},{key:"saveItem",value:function(e,t,n){var a=url_for2("proyecto/:id_proyecto/riesgo_revision/".concat(t.id));return new Promise(function(e){$.post(a,n).done(function(t){e(t.response.revision)})})}},{key:"deleteItem",value:function(e,t){return new Promise(function(e){$.ajax({url:url_for2("proyecto/:id_proyecto/riesgo_revision/:item_id",{item_id:t.id}),type:"DELETE"}).done(function(t){e()})})}},{key:"parseItems",value:function(e){return e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new this),e.instance}}]),e}();t.RevisionRiesgoModelManager=c}});
//# sourceMappingURL=http://auditbrain.local/webapps/dist/proyecto__riesgo.js.map