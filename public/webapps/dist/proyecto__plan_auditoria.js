var webpackLibs=function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],p=0,d=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(u&&u(t);d.length;)d.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,s=1;s<a.length;s++){var c=a[s];0!==r[c]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={0:0},o=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonpwebpackLibs=window.webpackJsonpwebpackLibs||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;return o.push([222,1]),a()}({1:function(e,t){e.exports=React},105:function(e,t){e.exports=ReactDOM},222:function(e,t,a){"use strict";var n,r=a(105),o=(n=a(223))&&n.__esModule?n:{default:n};$.unblockUI(),(0,r.render)(React.createElement(o.default,null),document.getElementById("root"))},223:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),r=c(a(37)),o=a(224),i=c(a(502)),s=c(a(6));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=p(this,d(t).call(this,e))).updateTree=function(e,t){a.setState(function(){return{tree:e}},t)},a.updateVisitas=function(e,t){a.setState(function(){return{visitas:e}},t)},a.updateFilters=function(e){a.setState(function(t){var a=null===e?{}:Object.assign({},t.filters,e);return _.each(a,function(e,t){""===e&&delete a[t]}),{filters:a}},function(){var e={};_.each(a.state.filters,function(t,a){t&&""!==t&&(e[a]=t)}),$.post(url_for("proyecto/"+app.vars.idproyecto+"/master_data/setfilters"),{filters:e})})},a.state={tree:null,visitas:app.vars.plan_auditoria.visitas,filters:Object.assign({},app.vars.plan_auditoria.settings.filters)},a}var a,c,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,n.Component),a=t,(c=[{key:"render",value:function(){var e={tree:this.state.tree,visitas:this.state.visitas,filters:this.state.filters,updateTree:this.updateTree,updateFilters:this.updateFilters,updateVisitas:this.updateVisitas},t=(0,s.default)("app-body",_.size(this.state.filters)>0?"has-filters":null);return React.createElement(r.default.Provider,{value:e},React.createElement("div",{className:t},React.createElement(o.AppTopBar,null),React.createElement(i.default,null),React.createElement(o.AppBottomBar,null)))}}])&&u(a.prototype,c),l&&u(a,l),t}();t.default=f},224:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppBottomBar=t.AppTopBar=void 0;var n,r=a(1),o=(n=a(37))&&n.__esModule?n:{default:n},i=a(225),s=a(69),c=a(226),l=a(498);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,a){return t&&d(e.prototype,t),a&&d(e,a),e}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(){var e=(0,r.useContext)(o.default),t=e.tree,a=e.updateTree;return React.createElement(r.Fragment,null,React.createElement("a",{href:"#",className:"expandall",onClick:function(e){e.preventDefault(),$.blockUI(),setTimeout(function(){s.ProyectoPlanAuditoriaUtils.changeOpenToAll(t,!0),a(t),$.unblockUI()},100)}},"Expandir todo"),"|",React.createElement("a",{href:"#",className:"collapseall",onClick:function(e){e.preventDefault(),s.ProyectoPlanAuditoriaUtils.changeOpenToAll(t,!1),a(t)}},"Contraer todo"))},g=function(e){function t(){var e;return p(this,t),(e=f(this,v(t).apply(this,arguments))).onClick=function(t){t.preventDefault();var a=e.context,n=a.tree,r=a.updateTree,o=bootbox.prompt({header:"Nueva Fase",content:"<div>Escriba el nombre de la fase que desea crear.</div>"},"Cancelar","Crear",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Creando Fase... Por Favor Espere")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/fase")),{fase_name:e}).done(function(e){if(!e.hasErrors){var t=e.response.record;n.push({id:t.id_master_data_fase,code:t.code,descripcion:t.descripcion,position:t.position,index:n.length,sortIndex:n.length,open:!0,items:[]}),r(n),o.modal("hide")}$.unblockUI()}).fail(function(){$.pnotify({type:"error",text:"Un error ocurriÃ³ al intentar crear la fase."}),$.unblockUI()}),!1},"");$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e}return h(t,r.PureComponent),m(t,[{key:"render",value:function(){return React.createElement("a",{href:"#",onClick:this.onClick},"Crear Fase")}}]),t}();g.contextType=o.default;var E=function(e){function t(){return p(this,t),f(this,v(t).apply(this,arguments))}return h(t,r.PureComponent),m(t,[{key:"render",value:function(){if(null===this.context.tree)return React.createElement("div",{className:"pull-right",style:{position:"relative"}},React.createElement("a",{className:"btn btn-mini dropdown-toggle btn-new pull-right","data-toggle":"dropdown",href:"#"},React.createElement("div",{className:"ui mini active inline loader"})));var e=app.vars.plan_auditoria.proyecto.isOpen;return React.createElement("div",{className:"pull-right",style:{position:"relative"}},React.createElement("a",{className:"btn btn-mini dropdown-toggle btn-new pull-right","data-toggle":"dropdown",href:"#"},"Opciones"),React.createElement("ul",{className:"dropdown-menu pull-right",style:{textAlign:"left"}},e&&user_has_role_permission("fase_create")&&React.createElement("li",null,React.createElement(g,null)),e&&user_has_role_permission("visita_edit")&&React.createElement("li",null,React.createElement(l.AppActionVisitasManage,null)),e&&user_has_role_permission("paso_asignar_usuario")&&React.createElement("li",null,React.createElement(c.ModalPasoMassAssign,null)),React.createElement("li",null,React.createElement("a",{href:url_for("proyecto/".concat(app.vars.idproyecto,"/master_data?sf_format=pdf")),target:"_blank"},"Exportar como PDF"))))}}]),t}();E.contextType=o.default;var R=function(e){function t(){var e;return p(this,t),(e=f(this,v(t).apply(this,arguments))).scrollboxRef=(0,r.createRef)(),e}return h(t,r.PureComponent),m(t,[{key:"componentDidMount",value:function(){var e=$(this.scrollboxRef.current),t=e.offset().top;$(window).scroll(function(){$(this).scrollTop()>=t?e.addClass("fixed"):e.removeClass("fixed")})}},{key:"render",value:function(){return React.createElement("div",{className:"topbar sticky-scroll-box",ref:this.scrollboxRef},React.createElement("div",{className:"ui grid"},React.createElement("div",{className:"five wide column"},React.createElement(y,null)),React.createElement("div",{className:"nine wide column"},React.createElement(i.AppFilters,null)),React.createElement("div",{className:"two wide column"},React.createElement(E,null))),React.createElement(i.AppFilterMessage,null))}}]),t}();t.AppTopBar=R;var k=function(e){function t(){return p(this,t),f(this,v(t).apply(this,arguments))}return h(t,r.Component),m(t,[{key:"render",value:function(){return React.createElement("div",{className:"bottombar"},React.createElement(y,null))}}]),t}();t.AppBottomBar=k},225:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppFilterMessage=t.AppFilters=void 0;var n=a(1),r=s(a(6)),o=s(a(37)),i=a(69);function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,p(t).apply(this,arguments))}var a,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n.Component),a=t,(o=[{key:"setFilter",value:function(e,t){var a=this.context,n=a.tree,r=a.updateFilters,o=a.updateTree;r(function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},e,t)),$.blockUI(),setTimeout(function(){i.ProyectoPlanAuditoriaUtils.changeOpenToAll(n,!0),o(n),$.unblockUI()},100)}},{key:"renderVisitasFilterChoices",value:function(){var e=this,t=this.context.filters,a=app.vars.plan_auditoria.visitas;return React.createElement("select",{className:(0,r.default)("raw-select input-medium",t.visita?"active":null),id:"master_data_filters_visita",style:{maxWidth:150},onChange:function(t){e.setFilter("visita",t.target.value)},value:t.visita||""},React.createElement("option",{value:""},"- Visita -"),_.map(a,function(e){return React.createElement("option",{key:e.id,value:e.id},e.name)}))}},{key:"renderStatusFilterChoices",value:function(){var e=this,t=this.context.filters;return React.createElement("select",{className:(0,r.default)("raw-select input-medium",t.status?"active":null),id:"master_data_filters_status",onChange:function(t){e.setFilter("status",t.target.value)},value:t.status||""},React.createElement("option",{value:""},"- Estado -"),_.map(["Sin asignar","Asignado","En proceso","Completado","Revisado","Notas RevisiÃ³n"],function(e,t){return React.createElement("option",{key:t+1,value:t+1},e)}))}},{key:"renderUsersFilterChoices",value:function(){var e=this,t=this.context.filters,a=app.vars.plan_auditoria.equipo;return React.createElement("select",{className:(0,r.default)("raw-select input-medium",t.asignado?"active":null),id:"master_data_filters_asignado",style:{maxWidth:150},onChange:function(t){e.setFilter("asignado",t.target.value)},value:t.asignado||""},React.createElement("option",{value:""},"- Asignado a -"),_.map(a,function(e){return React.createElement("option",{key:e.id,value:e.user_id},e.fullname)}))}},{key:"render",value:function(){return React.createElement("div",{id:"master_data_filters",className:"pull-right"},React.createElement("span",{className:"lb"},"Filtrar por: "),this.renderVisitasFilterChoices(),this.renderStatusFilterChoices(),this.renderUsersFilterChoices())}}])&&l(a.prototype,o),s&&l(a,s),t}();t.AppFilters=m,m.contextType=o.default;t.AppFilterMessage=function(){var e=(0,n.useContext)(o.default),t=e.filters,a=e.updateFilters;if(!(_.reject(t,function(e){return""===e||!e}).length>0))return null;return React.createElement("div",{id:"filteralerts",className:"alert-2 alert-primary"},React.createElement("span",{className:"icon-info-sign",style:{marginRight:3}}),"NOTA: La visibilidad de los pasos estÃ¡ afectada por los filtros aplicados.",React.createElement("a",{href:"#",className:"resetfilters",style:{marginLeft:10},onClick:function(e){e.preventDefault(),a(null)}},"Quitar filtros"))}},226:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalPasoMassAssign=void 0;var n=a(1),r=u(a(54)),o=u(a(102)),i=u(a(140)),s=u(a(104)),c=u(a(6)),l=a(69);function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var b=(0,n.createContext)({tree:[],updateTree:null,filters:{ignore_assigned:!1},updateFilter:null}),y=function(e){var t=e.item,a=_.size(t.alias)?{name:t.alias}:l.ProyectoPlanAuditoriaUtils.getVisitaById(t.id_visita),r=l.ProyectoPlanAuditoriaUtils.getUserById(t.user_id),o=(0,n.useContext)(b),i=o.updateTree,s=o.filters;return React.createElement("li",{key:t.id,className:(0,c.default)("methodology-item visita",r?"assigned":"unassigned")},React.createElement("label",{htmlFor:"massassign-paso-visita-".concat(t.id)},React.createElement("input",{type:"checkbox",id:"massassign-paso-visita-".concat(t.id),checked:t.selected,className:"checkbox",disabled:s.ignore_assigned&&!!t.user_id,onChange:function(){t.selected=!t.selected,i(t)}}),React.createElement("span",{className:"item-name"},a?a.name:"-"),React.createElement("span",{className:(0,c.default)("user-assigned",r?"label label-success":"")},r?r.sigla:"")))},g=function e(t){var a=t.item,r=h((0,n.useState)(!0),2),o=r[0],i=r[1],s=(0,n.useContext)(b),l=s.updateTree,u=s.filters,p=function e(t){var a=0,n=0,r=0;return"paso"==t.type?(n=_.size(t.items),a=_.size(_.reject(t.items,{user_id:null})),r=_.size(_.filter(t.items,{selected:!0}))):_.each(t.items,function(t){var o=e(t),i=o.assigned,s=o.checked,c=o.total;a+=i,r+=s,n+=c}),{assigned:a,checked:r,total:n}}(a),d=p.assigned,m=p.checked,f=p.total,v=f>0&&d<f;return React.createElement("li",{key:a.id,className:(0,c.default)("methodology-item",a.type)},React.createElement("div",{className:"methodology-item-head"},React.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),i(!o)}},React.createElement("span",{className:"item-name"},a.descripcion)),React.createElement("input",{type:"checkbox",checked:a.selected,title:"Seleccionar todos",className:"checkbox",disabled:0==_.size(a.items),onChange:function(){a.selected=!a.selected,l(a),u.ignore_assigned&&k(a)&&$.pnotify({title:"Advertencia",text:"Este elemento contiene pasos/visitas que no pueden ser seleccionados debido que ya fueron asignados. ",delay:2e3})}}),m>0&&React.createElement("strong",{className:"checked-counter pull-right",title:"# Hojas de Trabajo seleccionadas"},"(",m,")"),React.createElement("span",{className:(0,c.default)("badge badge-counter",v?"badge-important":"badge-success"),title:"# Hojas de trabajo con usuario responsable asignado / # Hojas de trabajo en total"},d," / ",f)),React.createElement("ul",{className:(0,c.default)("methodology collapse",o?"hide":"in")},_.map(a.items,function(t){return t.parent=a,"pasovisita"==t.type?React.createElement(y,{key:t.id,item:t}):React.createElement(e,{key:t.id,item:t})})))},E=function(){return React.createElement(b.Consumer,null,function(e){var t=e.tree;return React.createElement("ul",{className:"methodology checkbox-list methodology-all nav nav-stacked"},_.map(t,function(e){return React.createElement(g,{key:"tree-item-".concat(e.type,"-").concat(e.id),item:e})}))})},R=function(){return React.createElement(b.Consumer,null,function(e){var t=e.filters,a=e.updateFilter;return React.createElement("div",{className:"filtersbar"},React.createElement("div",{className:"filters"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:t.ignore_assigned,onChange:function(e){return a({ignore_assigned:e.target.checked})}}),"Excluir pasos ya asignados")))})},k=function e(t){if("paso"==t.type)return _.some(t.items,function(e){return null!=e.user_id});var a=!1;return _.each(t.items,function(t){if(e(t))return a=!0,!0}),a},C=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=m(this,f(t).call(this,e))).onSelectUser=function(e,t){a.setState({user_id:t.value})},a.onClickToContinueToStep2=function(){a.state.user_id?a.setState({step:2}):bootbox.alert("Seleccione un usuario antes de continuar.")},a.onClose=function(){a.setState({open:!1})},a.onSubmit=function(){$.blockUI(create_blockUI_loading_message("Guardando los cambios... Por Favor Espere")),$.post(url_for("proyecto/".concat(app.vars.plan_auditoria.proyecto.id,"/mass_assign_user")),{user_id:a.state.user_id,pasos:a.state.pasosChecked}).done(function(){location.reload()})},a.state={open:!1,step:1,user_id:null,tree:null,filters:{ignore_assigned:!1},pasosChecked:[]},a}var a,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,n.Component),a=t,(c=[{key:"componentDidMount",value:function(){var e;this.setState({tree:(e=app.vars.plan_auditoria.fases,_.map(e,function(e){return{id:e.id,descripcion:e.descripcion,type:"phase",selected:!1,parent:null,items:_.map(e.Subfases,function(e){return{id:e.id,descripcion:e.descripcion,type:"subphase",selected:!1,parent:null,items:_.map(e.MasterDataPaso,function(e){return{id:e.id,descripcion:e.descripcion,type:"paso",selected:!1,parent:null,items:_.map(e.MasterDataPasoHasProyectoVisita,function(e){return{id:e.id,type:"pasovisita",alias:e.visita_alias,id_visita:e.id_proyecto_visita,user_id:e.id_usuario_asignado,parent:null,selected:!1}})}})}})}}))})}},{key:"updateTree",value:function(e){var t=this;this.setState(function(a){for(var n=Object.assign({},a.tree),r=[],o=e;o.parent;)r.push(o.parent),o=o.parent;for(var i=n;r.length>0;)o=r.pop(),i=_.find(i,{id:o.id}).items;var s=_.find(i,{id:e.id});return s.selected=e.selected,s.items&&t.setItemsChecked(s.items,s.selected),t.fixIncompletedCheckedItem(n),{tree:n,pasosChecked:t.findPasosChecked(n)}})}},{key:"updateFilter",value:function(e){var t=this;this.setState(function(t){return{filters:Object.assign({},t.filters,e)}},function(){var e=Object.assign({},t.state.tree);t.refreshItemsChecked(),t.fixIncompletedCheckedItem(e),t.setState({tree:e})})}},{key:"setItemsChecked",value:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_.each(e,function(e){e.selected=a&&t.isItemCheckable(e),e.items&&t.setItemsChecked(e.items,a)})}},{key:"findPasosChecked",value:function(e){var t=this,a=[];return _.each(e,function(e){"pasovisita"==e.type?e.selected&&a.push(e.id):a=_.union(a,t.findPasosChecked(e.items))}),a}},{key:"isItemCheckable",value:function(e){return"pasovisita"!=e.type||!e.user_id||!this.state.filters.ignore_assigned}},{key:"refreshItemsChecked",value:function(){var e=this;!function t(a){_.each(a,function(a){"pasovisita"==a.type?a.selected=a.selected&&e.isItemCheckable(a):a.items&&t(a.items)})}(this.state.tree)}},{key:"fixIncompletedCheckedItem",value:function(e){var t=this,a=function e(a){var n=_.filter(a.items,function(e){return t.isItemCheckable(e)}),r=_.size(_.filter(n,{selected:!1}));a.selected=_.size(a.items)>0&&_.size(n)>0&&0==r,a.parent&&e(a.parent)};!function e(t){_.each(t,function(t){t.items?e(t.items):a(t.parent)})}(e)}},{key:"renderStepContent",value:function(){var e=this;switch(this.state.step){case 1:var t=_.map(app.vars.plan_auditoria.equipo,function(e){return{key:e.user_id,text:e.fullname,value:e.user_id,description:e.rol.name,label:{content:e.sigla,circular:!0,color:"green"}}});return React.createElement("div",{className:"step-content  step-content-1"},React.createElement("h4",{className:"ui centered header"},"Seleccione el usuario al cual desea realizar la asignaciÃ³n de pasos"),React.createElement("div",{className:"ui field centered user-dropdown-wrapper"},React.createElement(o.default,{placeholder:"Seleccione el usuario",defaultValue:this.state.user_id,selection:!0,fluid:!0,options:t,onChange:this.onSelectUser})),React.createElement("div",{className:"btn-actions"},React.createElement("button",{className:"btn btn-primary pull-right",onClick:this.onClickToContinueToStep2},"Continuar")));case 2:var a=l.ProyectoPlanAuditoriaUtils.getUserById(this.state.user_id),n={tree:this.state.tree,filters:this.state.filters,updateTree:this.updateTree.bind(this),updateFilter:this.updateFilter.bind(this)};return React.createElement("div",{className:"step-content  step-content-2"},React.createElement("h4",{className:"ui centered header"},"Seleccione los pasos los cuales desea asignarle al usuario:",React.createElement("strong",{className:"selected-user"},a.fullname," (",a.sigla,")")),React.createElement(b.Provider,{value:n},React.createElement(R,null),React.createElement(E,null)),React.createElement("div",{className:"btn-actions"},React.createElement("button",{className:"btn ",onClick:function(){return e.setState({step:1})}},"Volver"),React.createElement(s.default,{trigger:React.createElement("button",{className:"btn btn-primary pull-right",onClick:this.onSubmit,disabled:0==this.state.pasosChecked.length},"Guardar"),content:"Seleccione por lo menos un paso al cual asignarle el usuario responsable",disabled:this.state.pasosChecked.length>0,on:"hover",className:"disabled-text"})))}}},{key:"render",value:function(){var e=this,t=this.state.step;return React.createElement(n.Fragment,null,React.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),e.setState({open:!0})}},"Asignar Responsables"),this.state.open&&React.createElement(r.default,{open:!0,className:"modal-ab modal-pasomassassign",closeIcon:!0,onClose:this.onClose},React.createElement(r.default.Header,{content:"AsignaciÃ³n masiva de usuarios a pasos"}),React.createElement(r.default.Content,null,React.createElement("div",{className:"stepbar"},React.createElement(i.default.Group,{attached:"top",size:"small",widths:2},React.createElement(i.default,{active:1==t,completed:t>1,icon:t>1?"check":null,title:"1. Usuario"}),React.createElement(i.default,{active:2==t,title:"2. Pasos"}))),this.renderStepContent())))}}])&&d(a.prototype,c),u&&d(a,u),t}();t.ModalPasoMassAssign=C},37:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,a(1).createContext)({tree:null,filters:null,updateTree:function(e){},updateFilters:function(e){}});t.default=n},498:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalVisitasManage=t.AppActionVisitasManage=void 0;var n=a(1),r=s(a(37)),o=s(a(54)),i=s(a(499));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,a){return t&&u(e.prototype,t),a&&u(e,a),e}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(){var e;return l(this,t),(e=d(this,m(t).apply(this,arguments))).state={open:!1},e.onClickAction=function(t){t.preventDefault(),e.setState({open:!0})},e}return f(t,n.PureComponent),p(t,[{key:"render",value:function(){var e=this;return React.createElement(n.Fragment,null,React.createElement("a",{href:"#",onClick:this.onClickAction},"Administrar Visitas"),this.state.open&&React.createElement(y,{onClose:function(){return e.setState({open:!1})}}))}}]),t}();t.AppActionVisitasManage=h;var b=function(e){function t(){var e;return l(this,t),(e=d(this,m(t).apply(this,arguments))).onClickDelete=function(t){t.preventDefault();var a=e.props.visita,n=e.context,r=n.visitas,o=n.updateVisitas;bootbox.warningConfirm("Â¿Esta seguro de querer eliminar por completo esta visita?","No","SÃ­, Eliminar visita",function(e){e&&($.blockUI(create_blockUI_loading_message("Eliminando Visita...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/visita/").concat(a.id)),{sf_method:"delete"}).done(function(){r=_.reject(r,{id:a.id}),o(r),$.unblockUI()}).fail(function(){return $.unblockUI()}))})},e.onClickEdit=function(t){t.preventDefault();var a=e.props.visita,n=e.context,r=n.visitas,o=n.updateVisitas,i=bootbox.prompt({header:"Renombrar Visita - ".concat(a.name),content:"<div>Escriba el nuevo nombre que desea asignarle a la visita seleccionada.</div>"},"Cancelar","Actualizar",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Actualizando Visita...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/visita/").concat(a.id)),{visita_name:e}).done(function(e){if(e.hasErrors)$.unblockUI(),bootbox.alert('<p>El siguiente ocurriÃ³ al intentar actualizar la visita:</p>\n                <div class="alert alert-error alert-block _a-center">'.concat(e.message,"</div>"));else{var t=_.findWhere(r,{id:a.id});t.name=e.response.record.name,t.position=e.response.record.position,t.sumaria_periodo_actual=e.response.record.sumaria_periodo_actual,o(r),i.modal("hide"),$.unblockUI()}}).fail(function(){$.pnotify({type:"error",text:"Un error inesperado ocurriÃ³ al intentar actualizar la visita."}),$.unblockUI()}),!1},a.name);$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e}return f(t,n.PureComponent),p(t,[{key:"render",value:function(){var e=this.props.visita,t=app.vars.plan_auditoria.proyecto.isOpen;return React.createElement(i.default.Item,{id:"visita-li-".concat(e.id),className:"visita-listitem"},React.createElement("span",{className:"sort-handler drag-icon"}),React.createElement(i.default.Content,{style:{display:"inline-block"}},e.name),t&&React.createElement(i.default.Content,{floated:"right"},user_has_role_permission("visita_edit")&&React.createElement(n.Fragment,null,React.createElement("button",{className:"ui tertiary button compact mini btnedit",onClick:this.onClickEdit},"Cambiar nombre"),React.createElement("button",{className:"ui tertiary button negative compact mini",onClick:this.onClickDelete},"Eliminar"))))}}]),t}();b.contextType=r.default;var y=function(e){function t(){var e;return l(this,t),(e=d(this,m(t).apply(this,arguments))).onSortEnd=function(){var t=e.context,a=t.visitas,n=t.updateVisitas,r=$("#visitas-adminlist").sortable("toArray");r=r.map(function(e){return e.substr(10)}),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/visita/sort")),{sort:r}),_.each(r,function(e,t){var n=_.findIndex(a,{id:e});a[n].position=t+1}),n(a)},e.onClickNew=function(t){t.preventDefault();var a=e.context,n=a.visitas,r=a.updateVisitas,o=a.tree,i=a.updateTree,s=bootbox.prompt({header:"Nueva Visita",content:"<div>Escriba el nombre de la visita que desea crear.</div>"},"Cancelar","Crear",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Creando Visita...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/create-visita")),{visita_name:e}).done(function(e){if(e.hasErrors)$.unblockUI(),bootbox.alert('<p>El siguiente ocurriÃ³ al intentar crear la visita:</p>\n                <div class="alert alert-error alert-block _a-center">'.concat(e.message,"</div>"));else{var t=e.response.record;n.push({id:t.id_proyecto_visita,id_proyecto_visita:t.id_proyecto_visita,name:t.name,position:t.position,sumaria_periodo_actual:t.sumaria_periodo_actual}),r(n),s.modal("hide");var a=e.response.paso_materialidad,c=!1;_.each(o,function(e){if(_.each(e.items,function(e){if(_.each(e.items,function(e){if(e.id==a.id)return e.paso_visitas=a.MasterDataPasoHasProyectoVisita,c=!0,!1}),c)return!1}),c)return!1}),i(o),$.unblockUI()}}).fail(function(){$.pnotify({type:"error",text:"Un error inesperado ocurriÃ³ al intentar crear la visita."}),$.unblockUI()}),!1},"");$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e}return f(t,n.PureComponent),p(t,[{key:"componentDidMount",value:function(){$("#visitas-adminlist").sortable({handle:".sort-handler",items:".visita-listitem",axis:"y",placeholder:"sortable_placeholder",update:this.onSortEnd})}},{key:"render",value:function(){var e=this.context.visitas,t=app.vars.plan_auditoria.proyecto.isOpen;return React.createElement(o.default,{open:!0,closeIcon:!0,className:"modal-ab",onClose:this.props.onClose,size:"small"},React.createElement(o.default.Header,{content:"AdministraciÃ³n de Visitas"}),React.createElement(o.default.Content,null,_.size(e)>0?React.createElement(n.Fragment,null,React.createElement("p",{className:"description-text"},"Listado de visitas de este proyecto:"),React.createElement(i.default,{divided:!0,id:"visitas-adminlist"},_.map(e,function(e){return React.createElement(b,{key:e.id,visita:e})}))):React.createElement("div",{className:"alert alert-block"},React.createElement("span",{className:"icon-warning-sign"})," Aun no hay visitas creadas en este proyecto."),React.createElement("div",{className:"_a-center"},t&&user_has_role_permission("visita_create")&&React.createElement("a",{href:"#",className:"btn btn-new",style:{marginRight:5},onClick:this.onClickNew},"Nueva Visita"),React.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.props.onClose},"Cerrar"))))}}]),t}();t.ModalVisitasManage=y,y.contextType=r.default},502:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(1),r=u(a(104)),o=u(a(102)),i=u(a(37)),s=u(a(6)),c=a(69),l=a(503);function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,a){return t&&m(e.prototype,t),a&&m(e,a),e}function v(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).listRef=(0,n.createRef)(),e.toggle=function(t){t.preventDefault();var a=e.context,n=a.tree,r=a.updateTree,o=e.props.item;n[o.index].open=!o.open,r(n)},e}return b(t,n.PureComponent),f(t,[{key:"componentDidMount",value:function(){this.makeSortable()}},{key:"makeSortable",value:function(){var e=this;if(!app.vars.plan_auditoria.proyecto.isOpen||!user_has_role_permission("hoja_trabajo_edit"))return!1;var t=this.props.item;$(this.listRef.current).sortable({handle:".handle-dragdrop.subphase-handle",items:"li.subphase",placeholder:"sortable_placeholder",axis:"y",revert:"100",forceHelperSize:!1,containment:"parent",helper:function(e,t){var a=t.clone();return $(a).find("ul.methodology-paso-list").remove(),a},start:function(e,t){$(this).sortable("refreshPositions"),$(t.item).addClass("sortable_dragging")},stop:function(e,t){$(t.item).removeClass("sortable_dragging")},update:function(a,n){var r=$(e.listRef.current).sortable("toArray");$(".methodology-item.subphase.sortable-enabled").removeClass("sortable-enabled"),r=r.map(function(e){return e.substr(8)}),$.blockUI(create_blockUI_loading_message("Guardando los cambios")),$.post(url_for("proyecto/"+app.vars.idproyecto+"/master_data/rubro/sort"),{sort:r}).done(function(a){if(1==a.success){var n={};r.each(function(e,t){n[e]=t});var o=e.context,i=o.tree,s=o.updateTree;i[t.index].items=_.map(i[t.index].items,function(e){return e.position=""+(n[e.id]+1),e.sortIndex=n[e.id],e}),s(i),$.unblockUI()}})}})}},{key:"render",value:function(){var e=this.props.item,t=app.vars.plan_auditoria.proyecto.isOpen,a=(0,s.default)("methodology-item phase",e.items.length>0?"has-rubros":"no-rubros");return React.createElement("li",{className:a,id:"fase".concat(e.id)},React.createElement("div",{className:"methodology-item-head"},React.createElement("span",{className:"handle handle-dragdrop phase-handle"}),React.createElement("a",{className:"phase-name",onClick:this.toggle,href:"#"},React.createElement("span",{className:"fase-iteration"},_.str.lpad(e.sortIndex+1,2,"0")),"-",_.str.trim(e.descripcion.toUpperCase())),t&&React.createElement(l.TreeItemFaseActions,{item:e}),React.createElement("div",{className:"clearfix"})),React.createElement("ul",{className:"methodology methodology-rubro-list",ref:this.listRef},e.open&&_.map(_.sortBy(e.items,function(e){return parseInt(e.position)}),function(t){return t.parent=e,React.createElement(E,{key:t.id,item:t})})))}}]),t}();g.contextType=i.default;var E=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).fetchingRiesgos=!1,e.listRef=(0,n.createRef)(),e.toggle=function(t){t.preventDefault();var a=e.props.item,n=e.context,r=n.tree,o=n.updateTree;r[a.parent.index].items[a.index].open=!a.open,o(r)},e}return b(t,n.PureComponent),f(t,[{key:"componentDidMount",value:function(){this.loadSumarias(),this.loadRiesgos(),this.makeSortable()}},{key:"componentDidUpdate",value:function(){this.loadSumarias(),this.checkSortable()}},{key:"loadSumarias",value:function(){if(!t.fetchingSumarias){var e=this.props.item,a=this.context,n=a.tree,r=a.updateTree,o=_.size(this.context.filters)>0;null!==e.sumarias||e.parent.id!=app.vars.plan_auditoria.settings.ejecucion_fase_id||o||(t.fetchingSumarias=!0,$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data_tree")),{export_options:{type:"sumarias",fase_id:e.parent.id}}).done(function(t){_.each(t.response,function(t,a){var r=_.findIndex(n[e.parent.index].items,{id:a});n[e.parent.index].items[r].sumarias=t}),r(n)}))}}},{key:"loadRiesgos",value:function(){if(!this.fetchingRiesgos){this.fetchingRiesgos=!0;var e=this.props.item,t=this.context,a=t.tree,n=t.updateTree;a[e.parent.index].items[e.index].riesgosLoaded||$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data_tree")),{export_options:{type:"riesgos",rubro_id:e.id}}).done(function(t){_.each(t.response,function(t,n){var r=_.findIndex(a[e.parent.index].items[e.index].items,{id:n});a[e.parent.index].items[e.index].items[r].riesgos=t}),a[e.parent.index].items[e.index].riesgosLoaded=!0,n(a)})}}},{key:"makeSortable",value:function(){var e=this;if(!app.vars.plan_auditoria.proyecto.isOpen||!user_has_role_permission("hoja_trabajo_edit"))return!1;var t=this.props.item,a=this.context.filters,n=$(this.listRef.current);n.sortable({handle:".handle-dragdrop.paso-handle, .sortable-enabled ",items:"li.paso.paso-sortable",placeholder:"sortable_placeholder",axis:"y",revert:"100",helper:"clone",disabled:_.size(a)>0,containment:"parent",start:function(e,t){$(t.item).addClass("sortable_dragging")},stop:function(e,t){$(t.item).removeClass("sortable_dragging")},update:function(a,r){var o=n.sortable("toArray");$(".methodology-item.paso.sortable-enabled").removeClass("sortable-enabled"),o=o.map(function(e){return e.substr(5)}),$.blockUI(create_blockUI_loading_message("Guardando los cambios")),$.post(url_for("proyecto/"+app.vars.idproyecto+"/master_data/paso/sort"),{sort:o}).done(function(a){if(1==a.success){var n={};o.each(function(e,t){n[e]=t});var r=e.context,i=r.tree,s=r.updateTree;i[t.parent.index].items[t.index].items=_.map(i[t.parent.index].items[t.index].items,function(e){return e.position=""+(n[e.id]+1),e.sortIndex=n[e.id],e}),s(_.clone(i,!0)),$.unblockUI()}})}})}},{key:"checkSortable",value:function(){if(!app.vars.plan_auditoria.proyecto.isOpen||!user_has_role_permission("hoja_trabajo_edit"))return!1;var e=this.context.filters;_.size(e)?$(this.listRef.current).sortable("option","disable",!0):$(this.listRef.current).sortable("option","disable",!1)}},{key:"matchesPasoToFilters",value:function(e,t){return 0==_.size(t)||_.some(e.paso_visitas,function(e){return!(!t.visita||e.id_proyecto_visita!=t.visita)||(!(!t.status||e.id_proyecto_paso_estado!=t.status)||!(!t.asignado||e.id_usuario_asignado!=t.asignado))})}},{key:"render",value:function(){var e=this,a=this.props.item,r=_.size(this.context.filters)>0,o=app.vars.plan_auditoria.proyecto.isOpen,i=_.map(_.sortBy(a.items,function(e){return parseInt(e.position)}),function(t){return t.parent=a,e.matchesPasoToFilters(t,e.context.filters)?React.createElement(R,{key:t.id,item:t}):null}),c=(0,s.default)("methodology-item subphase",0==_.filter(i).length?"no-pasos":"has-pasos",r?"has-filters":"");return React.createElement("li",{className:c,id:"subphase".concat(a.id)},React.createElement("div",{className:"methodology-item-head"},React.createElement("span",{className:"handle handle-dragdrop subphase-handle"}),React.createElement("a",{className:"phase-name",onClick:this.toggle,href:"#"},React.createElement("span",{className:"fase-iteration"},t.getIndexChar(a.sortIndex).toUpperCase()),"-",_.str.trim(a.descripcion)),o&&React.createElement(l.TreeItemSubfaseActions,{item:a}),React.createElement("div",{className:"clearfix"})),React.createElement("ul",{className:"methodology methodology-paso-list",ref:this.listRef},a.open&&React.createElement(n.Fragment,null,app.vars.plan_auditoria.settings.ejecucion_fase_id==a.parent.id&&!r&&React.createElement(k,{rubro:a}),i)))}}],[{key:"getIndexChar",value:function(e){var t="";return e>25&&(t=String.fromCharCode(Math.floor(e/25)-1+97)),t+String.fromCharCode(97+e%26)}}]),t}();E.fetchingSumarias=!1,E.contextType=i.default;var R=function(e){function t(){return d(this,t),v(this,h(t).apply(this,arguments))}return b(t,n.PureComponent),f(t,[{key:"countRiesgos",value:function(){var e=this.props.item;if(null===e.riesgos)return React.createElement("div",{className:"ui mini active inline loader"});if(0===_.size(e.riesgos))return 0;var t=_.take(e.riesgos,30),a=React.createElement("div",null,_.map(t,function(e){return e.code}).join(", "),_.size(e.riesgos)>_.size(t)&&" y ".concat(_.size(e.riesgos)-_.size(t)," mÃ¡s..."));return React.createElement(r.default,{header:"Riesgos",content:a,size:"mini",trigger:React.createElement("span",null,_.size(e.riesgos))})}},{key:"render",value:function(){var e=this.props.item,t=(0,s.default)("methodology-item paso paso-sortable","paso-code-".concat(e.code),"paso-tipo-".concat((e.tipo||"default").toLowerCase())),a=app.vars.plan_auditoria.proyecto.isOpen,o=app.vars.plan_auditoria.paso_hallazgos[e.id]||0,i=this.countRiesgos();return React.createElement("li",{className:t,id:"paso-".concat(e.id)},React.createElement("div",{className:"methodology-item-head"},React.createElement("span",{className:"handle handle-dragdrop paso-handle"}),React.createElement("a",{href:url_for("proyecto//".concat(app.vars.idproyecto,"/hoja-trabajo/paso/").concat(e.id)),className:"paso-name"},React.createElement("span",{className:"paso-iteration"},_.str.lpad(e.sortIndex+1,3,"0")),"-",e.descripcion),a&&React.createElement(l.TreeItemPasoActions,{item:e}),React.createElement("div",{className:"pull-right sf_admin_td_actions valign"},React.createElement("div",{className:"section-a"},"PERIODO"==e.tipo?React.createElement(x,{paso:e}):React.createElement(N,{paso:e})),React.createElement("div",{className:"divider-vertical"}),React.createElement("div",{className:"section-a"},React.createElement("div",{className:"header"},React.createElement("strong",{className:"title"},"Riesgos")),React.createElement("span",null,i)),React.createElement("div",{className:"section-a"},React.createElement("div",{className:"header"},React.createElement("strong",{className:"title"},"Hallazgos")),React.createElement("span",null,o)),React.createElement("div",{className:"divider-vertical"}),React.createElement("div",{className:e.aserciones.length>0?"section-a":"",style:{display:"inline-block",marginRight:10,marginTop:-5,minWidth:250,width:250}},e.aserciones.length>0?React.createElement(n.Fragment,null,React.createElement("div",{className:"header"},React.createElement("strong",{className:"title"},"Aserciones")),React.createElement("ul",{className:"unstyled"},_.map(e.aserciones,function(e){var t=_.find(app.vars.plan_auditoria.objetivos,{id:e.id_master_data_objetivo});return React.createElement("li",{key:e.id_master_data_objetivo,className:"label label-info objetivo-sigla"},React.createElement(r.default,{basic:!0,size:"mini",content:t.description,header:"AserciÃ³n: ".concat(t.name),trigger:React.createElement("span",null,t.code)}))}))):React.createElement("span",null,"Â "))),React.createElement("div",{className:"clearfix"})))}}]),t}();R.contextType=i.default;var k=function(e){function t(){return d(this,t),v(this,h(t).apply(this,arguments))}return b(t,n.PureComponent),f(t,[{key:"render",value:function(){var e=this.props.rubro,t=this.context.visitas;return React.createElement("li",{className:"methodology-item paso sumaria"},React.createElement("div",{className:"methodology-item-head"},React.createElement("span",{className:"handle"}),React.createElement("a",{href:url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/rubro/").concat(e.id,"/sumarias")),className:"paso-name"},"000-Subsumaria"),React.createElement("div",{className:"sf_admin_td_actions"},React.createElement("div",{className:"section-a"},_.map(t,function(t){return React.createElement(C,{key:"".concat(e.id,"-").concat(t.id),rubro:e,visita:t})}))),React.createElement("div",{className:"clearfix"})))}}]),t}();k.contextType=i.default;var C=function(e){function t(){return d(this,t),v(this,h(t).apply(this,arguments))}return b(t,n.PureComponent),f(t,[{key:"getTotal",value:function(){var e=this.props,t=e.rubro,a=e.visita,n=this.context.tree[t.parent.index].items[t.index].sumarias;return null===n?React.createElement("div",{className:"ui mini active inline loader"}):void 0===n[a.id]||null===n[a.id]?"-":accounting.formatMoney(n[a.id])}},{key:"render",value:function(){var e=this.props.visita;return React.createElement("div",{className:"visita"},React.createElement("a",{className:"title pasovisita-name"},S(e.name)),React.createElement("div",null,React.createElement("div",{className:"subsumaria-total"},this.getTotal())))}}]),t}();C.contextType=i.default;var x=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).onContextMenu=function(e){e.preventDefault(),$(e.currentTarget).find("i.dropdown.icon").click()},e}return b(t,n.PureComponent),f(t,[{key:"getDropdownItems",value:function(e){var t=this.props.paso,a=url_for("proyecto/".concat(app.vars.idproyecto,"/hoja-trabajo/paso/").concat(t.id,"?id_visita=").concat(e.id_proyecto_visita)),r=app.vars.plan_auditoria.proyecto.isOpen;return React.createElement(n.Fragment,null,React.createElement(o.default.Item,{key:"link"},React.createElement("a",{href:a},"Ir a Hoja de Trabajo")),r&&user_has_role_permission(["paso_asignar_usuario"])&&React.createElement(l.DropdownItemAssignUser,{key:"assignuser",paso_visita:e,paso:t}),r&&user_has_role_permission("hoja_trabajo_edit")&&React.createElement(l.DropdownItemDeletePasoVisita,{key:"delete",paso_visita:e,paso:t}))}},{key:"render",value:function(){var e=this,t=this.props.paso,a=_.sortBy(t.paso_visitas,function(e){return parseInt(e.position)});return React.createElement(n.Fragment,null,_.map(a,function(n,r){var i=_.findWhere(app.vars.plan_auditoria.paso_estados,{id_proyecto_paso_estado:n.id_proyecto_paso_estado}),s=c.ProyectoPlanAuditoriaUtils.getUserById(n.id_usuario_asignado),l=url_for("proyecto/".concat(app.vars.idproyecto,"/hoja-trabajo/paso/").concat(t.id,"?id_visita=").concat(n.id));return[React.createElement("div",{className:"visita",key:"visita-".concat(n.id)},React.createElement("div",{className:"header",onContextMenu:e.onContextMenu},React.createElement("a",{className:"title pasovisita-name has-contextmenu",href:l},S(n.visita_alias)),React.createElement(o.default,{compact:!0,inline:!0,icon:{name:"dropdown",size:"small"},className:"contextmenu"},React.createElement(o.default.Menu,null,e.getDropdownItems(n)))),React.createElement("a",{className:"title pasovisita-name has-contextmenu",key:n.id,href:l}),React.createElement("div",null,React.createElement("div",{title:s?"Asignado a: ".concat(s.name):"Sin Asignar",style:{display:"inline-block"}},s?s.sigla:"","Â "),React.createElement("div",{className:"label visita-status",style:{backgroundColor:i.color}},React.createElement("span",{title:"Estado: ".concat(i.name)},P(i.name))))),r==a.length-1?null:React.createElement("div",{className:"divider-vertical",key:"divider-".concat(n.id)})]}))}}]),t}();x.contextType=i.default;var N=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).onClickRename=function(t){var a=e.context,n=a.visitas,r=a.updateVisitas,o=_.find(n,{id_proyecto_visita:t.id_proyecto_visita}),i=bootbox.prompt({header:"Renombrar Visita - ".concat(o.name),content:"<div>Escriba el nuevo nombre que desea asignarle a la visita seleccionada.</div>"},"Cancelar","Actualizar",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Actualizando Visita...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/visita/").concat(o.id)),{visita_name:e}).done(function(e){e.hasErrors?($.unblockUI(),bootbox.alert('<p>El siguiente ocurriÃ³ al intentar actualizar la visita:</p>\n                <div class="alert alert-error alert-block _a-center">'.concat(e.message,"</div>"))):(o.name=e.response.record.name,r(n),i.modal("hide"),$.unblockUI())}).fail(function(){$.pnotify({type:"error",text:"Un error inesperado ocurriÃ³ al intentar actualizar la visita."}),$.unblockUI()}),!1},o.name);$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e.onContextMenu=function(e){e.preventDefault(),$(e.currentTarget).find("i.dropdown.icon").click()},e}return b(t,n.PureComponent),f(t,[{key:"getVisitaById",value:function(e){var t=this.context.visitas;return _.findWhere(t,{id:e})}},{key:"getPasoVisitas",value:function(){var e=this,t=this.props.paso,a=_.map(t.paso_visitas,function(t){var a=e.getVisitaById(t.id_proyecto_visita);return a?(t.position=+a.position,t):null});return a=_.filter(a),_.sortBy(a,"position")}},{key:"getDropdownItems",value:function(e){var t=this,a=this.props.paso,r=app.vars.plan_auditoria.proyecto.isOpen,i=url_for("proyecto/".concat(app.vars.idproyecto,"/hoja-trabajo/paso/").concat(a.id,"?id_visita=").concat(e.id_proyecto_visita));return"MATERIALIDAD"==a.tipo?React.createElement(n.Fragment,null,React.createElement(o.default.Item,null,React.createElement("a",{href:i},"Ir a Hoja de Trabajo")),r&&user_has_role_permission("hoja_trabajo_edit")&&React.createElement(l.DropdownItemAssignUser,{paso_visita:e,paso:a})):React.createElement(n.Fragment,null,React.createElement(o.default.Item,null,React.createElement("a",{href:i},"Ir a Hoja de Trabajo")),r&&user_has_role_permission("visita_edit")&&React.createElement(o.default.Item,{onClick:function(){return t.onClickRename(e)}},"Cambiar nombre"),r&&user_has_role_permission("hoja_trabajo_edit")&&React.createElement(l.DropdownItemAssignUser,{paso_visita:e,paso:a}),r&&user_has_role_permission("hoja_trabajo_edit")&&React.createElement(l.DropdownItemDeletePasoVisita,{paso_visita:e,paso:a}))}},{key:"render",value:function(){var e=this,t=this.props.paso,a=this.getPasoVisitas();return React.createElement(n.Fragment,null,_.map(a,function(n,r){var i=_.findWhere(app.vars.plan_auditoria.paso_estados,{id_proyecto_paso_estado:n.id_proyecto_paso_estado}),s=c.ProyectoPlanAuditoriaUtils.getUserById(n.id_usuario_asignado),l=url_for("proyecto/".concat(app.vars.idproyecto,"/hoja-trabajo/paso/").concat(t.id,"?id_visita=").concat(n.id_proyecto_visita));return[React.createElement("div",{className:"visita",key:"visita-".concat(n.id)},React.createElement("div",{className:"header",onContextMenu:e.onContextMenu},React.createElement("a",{className:"title pasovisita-name has-contextmenu",href:l},S(e.getVisitaById(n.id_proyecto_visita).name)),React.createElement(o.default,{compact:!0,inline:!0,icon:{name:"dropdown",size:"small"},className:"contextmenu"},React.createElement(o.default.Menu,null,e.getDropdownItems(n)))),React.createElement("div",null,React.createElement("div",{title:s?"Asignado a: ".concat(s.name):"Sin Asignar",style:{display:"inline-block",width:30,fontSize:10}},s?s.sigla:"","Â "),React.createElement("div",{className:"label visita-status",style:{backgroundColor:i.color}},a.length>=6?React.createElement("span",{title:"Estado: ".concat(i.name)},P(i.name)):i.name))),r==a.length-1?null:React.createElement("div",{className:"divider-vertical",key:"divider-".concat(n.id)})]}))}}]),t}();N.contextType=i.default;var S=function(e){return _.each({Enero:"Ene",Febrero:"Feb",Marzo:"Mar",Abril:"Abr",Mayo:"May",Junio:"Jun",Julio:"Jul",Agosto:"Ago",Septiembre:"Sept",Octubre:"Oct",Noviembre:"Nov",Diciembre:"Dic"},function(t,a){e=e.replace(new RegExp(a,"ig"),t)}),e},P=function(e){return e.match(/\b\w/g).join("").toUpperCase()},I=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).listRef=(0,n.createRef)(),e}return b(t,n.Component),f(t,[{key:"componentDidMount",value:function(){var e=this.context,t=e.tree,a=e.updateTree,n=e.filters;null===t&&$.getJSON(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data_tree")),{export_options:{type:"base"}}).done(function(e){app.vars.plan_auditoria.fases=e.response;var r=_.size(n)>0;t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _.map(e,function(e,a){return{id:e.id,code:e.code,descripcion:e.descripcion,position:e.position,index:a,sortIndex:a,open:t,items:_.map(e.Subfases,function(e,a){return{id:e.id,code:e.code,descripcion:e.descripcion,position:e.position,index:a,sortIndex:a,open:t,sumarias:null,riesgosLoaded:!1,items:_.map(e.MasterDataPaso,function(e,t){return{id:e.id,code:e.code,descripcion:e.descripcion,position:e.position,tipo:e.paso_tipo,paso_visitas:e.MasterDataPasoHasProyectoVisita,aserciones:e.MasterDataPasoHasObjetivo,riesgos:null,index:t,sortIndex:t}})}})}})}(e.response,r),r||function(e,t){var a=!1;switch(t.element){case"fase":e[_.findIndex(e,{id:t.value})].open=!0;break;case"rubro":a=!1,_.each(e,function(e){if(_.each(e.items,function(n){if(n.id==t.value)return a=!0,e.open=!0,n.open=!0,!1}),a)return!1});break;case"paso":a=!1,_.each(e,function(e){if(_.each(e.items,function(n){if(_.each(n.items,function(r){if(r.id==t.value)return a=!0,e.open=!0,n.open=!0,!1}),a)return!1}),a)return!1})}}(t,app.vars.plan_auditoria.settings.default_open),a(t)}),this.makeSortable()}},{key:"makeSortable",value:function(){var e=this;if(!app.vars.plan_auditoria.proyecto.isOpen||!user_has_role_permission("hoja_trabajo_edit"))return!1;$(this.listRef.current).sortable({handle:".handle-dragdrop.phase-handle",items:"li.phase",placeholder:"sortable_placeholder",axis:"y",revert:"100",forceHelperSize:!1,containment:"parent",helper:function(e,t){var a=t.clone();return $(a).find("ul.methodology-rubro-list").remove(),a},start:function(e,t){$(this).sortable("refreshPositions"),$(t.item).addClass("sortable_dragging")},stop:function(e,t){$(t.item).removeClass("sortable_dragging")},update:function(t,a){var n=$(e.listRef.current).sortable("toArray");n=n.map(function(e){return e.substr(4)}),$.blockUI(create_blockUI_loading_message("Guardando los cambios")),$.post(url_for("proyecto/"+app.vars.idproyecto+"/master_data/rubro/sort"),{sort:n}).done(function(t){if(1==t.success){var a={};n.each(function(e,t){a[e]=t});var r=e.context,o=r.tree;(0,r.updateTree)(_.map(o,function(e){return e.position=""+(a[e.id]+1),e.sortIndex=a[e.id],e})),$.unblockUI()}})}})}},{key:"render",value:function(){var e=this.context.tree;return React.createElement(n.Fragment,null,null===e&&React.createElement("div",{className:"ui basic segment",style:{minHeight:200}},React.createElement("div",{className:"ui active inverted dimmer"},React.createElement("div",{className:"ui text loader elastic olive"},"Cargando Plan de AuditorÃ­a")),React.createElement("p",null)),React.createElement("ul",{className:"methodology methodology-all methodology-sortable nav nav-stacked sf_admin_list_records",id:"methodology-accordion",ref:this.listRef},null!==e&&_.map(_.sortBy(e,function(e){return parseInt(e.position)}),function(e){return React.createElement(g,{key:e.id,item:e})})))}}]),t}();t.default=I,I.contextType=i.default},503:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropdownItemDeletePasoVisita=t.DropdownItemAssignUser=t.TreeItemPasoActions=t.TreeItemSubfaseActions=t.TreeItemFaseActions=void 0;var n=a(1),r=l(a(37)),o=a(504),i=a(528),s=l(a(102)),c=l(a(54));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,a){return t&&d(e.prototype,t),a&&d(e,a),e}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){var e;return p(this,t),(e=f(this,v(t).apply(this,arguments))).onClickEdit=function(t){t.preventDefault();var a=e.props.item,n=e.context,r=n.tree,o=n.updateTree,i=bootbox.prompt({header:"Renombrar Fase",content:"<div>Escriba el nuevo nombre que desea asignarle a la fase seleccionada.</div>"},"Cancelar","Actualizar",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Actualizando Fase...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/fase/").concat(a.id)),{fase_name:e}).done(function(t){t.hasErrors?($.unblockUI(),bootbox.alert('<p>El siguiente ocurriÃ³ al intentar actualizar la fase:</p>\n                <div class="alert alert-error alert-block _a-center">'.concat(t.message,"</div>"))):(r[a.index].descripcion=e,o(r),i.modal("hide"),$.unblockUI())}).fail(function(){$.pnotify({type:"error",text:"Un error inesperado ocurriÃ³ al intentar actualizar la fase."}),$.unblockUI()}),!1},a.descripcion);$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e.onClickDelete=function(t){t.preventDefault();var a=e.props.item;if(a.id!=app.vars.plan_auditoria.settings.ejecucion_fase_id){var n=e.context,r=n.tree,o=n.updateTree;bootbox.warningConfirm('Â¿Esta seguro de querer eliminar por completo la fase "<strong>'.concat(a.descripcion,'</strong>"?'),"No","SÃ­, Eliminar fase",function(e){e&&($.blockUI(create_blockUI_loading_message("Eliminando Fase...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/fase/").concat(a.id)),{sf_method:"delete"}).done(function(){r=_.reject(r,{id:a.id}),o(r),$.unblockUI()}).fail(function(){return $.unblockUI()}))})}else bootbox.alert("Esta fase NO es posible eliminarla, debido a que ha sido marcada como la fase de ejecuciÃ³n de este proyecto.")},e.onClickAdd=function(t){t.preventDefault();var a=e.props.item,n=e.context,r=n.tree,o=n.updateTree,i=bootbox.prompt({header:"Crear Rubro",content:"<blockquote><strong>Fase: </strong>".concat(a.descripcion," </blockquote> <div>Escriba el nuevo nombre del rubro a crear.</div>")},"Cancelar","Crear",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Creando Rubro...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/fase")),{id_parent:a.id,fase_name:e}).done(function(e){if(e.hasErrors)$.unblockUI(),bootbox.alert('<p>El siguiente ocurriÃ³ al intentar crear el rubro:</p>\n                <div class="alert alert-error alert-block _a-center">'.concat(e.message,"</div>"));else{var t=e.response.record;r[a.index].items.push({id:t.id_master_data_fase,code:t.code,descripcion:t.descripcion,position:t.position,index:r[a.index].items.length,sortIndex:r[a.index].items.length,open:!1,sumarias:null,items:[]}),r[a.index].open=!0,o(r),i.modal("hide"),$.unblockUI()}}).fail(function(){$.pnotify({type:"error",text:"Un error inesperado ocurriÃ³ al intentar crear el rubro."}),$.unblockUI()}),!1},"");$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e}return h(t,n.PureComponent),m(t,[{key:"render",value:function(){return React.createElement("div",{className:"pull-right sf_admin_td_actions"},React.createElement("div",{className:"btn-group dropdown-modern"},React.createElement("a",{className:"btn btn-mini dropdown-toggle","data-toggle":"dropdown",href:"#"},React.createElement("span",{className:"icon-tc-ellipsis-v"})),React.createElement("ul",{className:"dropdown-menu pull-right"},user_has_role_permission("fase_edit")&&React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickEdit},"Editar")),user_has_role_permission("subfase_create")&&React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickAdd},"Crear Rubro")),user_has_role_permission("fase_delete")&&React.createElement(n.Fragment,null,React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickDelete},"Eliminar"))))))}}]),t}();t.TreeItemFaseActions=y,y.contextType=r.default;var g=function(e){function t(){var e;return p(this,t),(e=f(this,v(t).apply(this,arguments))).onClickEdit=function(t){t.preventDefault();var a=e.props.item,n=e.context,r=n.tree,o=n.updateTree,i=bootbox.prompt({header:"Renombrar Rubro",content:"<div>Escriba el nuevo nombre que desea asignarle al rubro seleccionado.</div>"},"Cancelar","Actualizar",function(e){if(e&&""!=_.str.trim(e))return $.blockUI(create_blockUI_loading_message("Actualizando Rubro...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/fase/").concat(a.id)),{fase_name:e}).done(function(t){t.hasErrors?($.unblockUI(),bootbox.alert('<p>El siguiente ocurriÃ³ al intentar actualizar el rubro:</p>\n                <div class="alert alert-error alert-block _a-center">'.concat(t.message,"</div>"))):(r[a.parent.index].items[a.index].descripcion=e,o(r),i.modal("hide"),$.unblockUI())}).fail(function(){$.pnotify({type:"error",text:"Un error inesperado ocurriÃ³ al intentar actualizar el rubro."}),$.unblockUI()}),!1},a.descripcion);$(".bootbox.modal").addClass("bootbox-prompt modal-ab")},e.onClickDelete=function(t){t.preventDefault();var a=e.props.item,n=e.context,r=n.tree,o=n.updateTree;bootbox.warningConfirm('Â¿Esta seguro de querer eliminar por completo el rubro "<strong>'.concat(a.descripcion,'</strong>"?'),"No","SÃ­, Eliminar rubro",function(e){e&&($.blockUI(create_blockUI_loading_message("Eliminando Rubro...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/fase/").concat(a.id)),{sf_method:"delete"}).done(function(){r[a.parent.index].items=_.reject(r[a.parent.index].items,{id:a.id}),o(r),$.unblockUI()}).fail(function(){return $.unblockUI()}))})},e}return h(t,n.PureComponent),m(t,[{key:"render",value:function(){var e=this.props.item;return React.createElement("div",{className:"pull-right sf_admin_td_actions"},React.createElement("div",{className:"btn-group dropdown-modern"},React.createElement("a",{className:"btn btn-mini dropdown-toggle","data-toggle":"dropdown",href:"#"},React.createElement("span",{className:"icon-tc-ellipsis-v"})),React.createElement("ul",{className:"dropdown-menu pull-right"},user_has_role_permission("fase_edit")&&React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickEdit},"Editar")),user_has_role_permission("paso_create")&&React.createElement(n.Fragment,null,React.createElement("li",null,React.createElement(o.ModalPasoNew,{rubro:e})),React.createElement("li",null,React.createElement(i.ModalPasoCopyFrom,{rubro:e}))),user_has_role_permission("fase_delete")&&React.createElement(n.Fragment,null,React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickDelete},"Eliminar"))))))}}]),t}();t.TreeItemSubfaseActions=g,g.contextType=r.default;var E=function(e){function t(){var e;return p(this,t),(e=f(this,v(t).apply(this,arguments))).onClickDelete=function(t){t.preventDefault();var a=e.props.item,n=e.context,r=n.tree,o=n.updateTree;bootbox.warningConfirm('Â¿Esta seguro de querer eliminar por completo el paso "<strong>'.concat(a.descripcion,'</strong>"?'),"No","SÃ­, Eliminar paso",function(e){e&&($.blockUI(create_blockUI_loading_message("Eliminando Paso...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/paso/").concat(a.id)),{sf_method:"delete"}).done(function(){r[a.parent.parent.index].items[a.parent.index].items=_.reject(r[a.parent.parent.index].items[a.parent.index].items,{id:a.id}),o(r),$.unblockUI()}).fail(function(){return $.unblockUI()}))})},e}return h(t,n.PureComponent),m(t,[{key:"render",value:function(){var e=this.props.item;return React.createElement("div",{className:"pull-right sf_admin_td_actions"},React.createElement("div",{className:"btn-group dropdown-modern"},React.createElement("a",{className:"btn btn-mini dropdown-toggle","data-toggle":"dropdown",href:"#"},React.createElement("span",{className:"icon-tc-ellipsis-v"})),React.createElement("ul",{className:"dropdown-menu pull-right"},user_has_role_permission("paso_edit")&&React.createElement(n.Fragment,null,React.createElement("li",null,React.createElement(o.ModalPasoEdit,{paso:e})),!_.include(["PERIODO","MATERIALIDAD"],e.tipo)&&React.createElement("li",null,React.createElement(o.ModalPasoAssoc,{paso:e}))),!_.include(["14","2A9"],e.code)&&user_has_role_permission("paso_delete")&&React.createElement(n.Fragment,null,React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.onClickDelete},"Eliminar"))))))}}]),t}();t.TreeItemPasoActions=E,E.contextType=r.default;var R=function(e){function t(e){var a;return p(this,t),(a=f(this,v(t).call(this,e))).onChange=function(e,t){a.setState({id_asignado:t.value})},a.onSubmit=function(){var e=a.props,t=e.paso,n=e.paso_visita,r=a.context,o=r.tree,i=r.updateTree,s=n.id_master_data_paso_has_proyecto_visita;$.blockUI(create_blockUI_loading_message("Guardando cambios")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/visita/").concat(s,"/asignar")),{paso_id_usuario:a.state.id_asignado}).done(function(e){e.hasErrors||(o[t.parent.parent.index].items[t.parent.index].open=!0,o[t.parent.parent.index].items[t.parent.index].items[t.index].paso_visitas=e.response.paso_visitas,i(o)),$.unblockUI()}).fail(function(){return $.unblockUI()}),a.setState({isOpen:!1})},a.onClickItem=function(){a.setState({isOpen:!0}),setTimeout(function(){return $(".ui.dropdown.contextmenu .menu.visible").removeClass("visible")},30)},a.state={isOpen:!1,id_asignado:e.paso_visita.id_usuario_asignado},a}return h(t,n.PureComponent),m(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.paso,r=t.paso_visita,o=this.context.visitas,i=_.find(o,{id_proyecto_visita:r.id_proyecto_visita}),l=_.map(app.vars.plan_auditoria.equipo,function(e){return{key:e.user_id,text:e.name,value:e.user_id,description:e.rol.name,label:{content:e.sigla,circular:!0,color:"green"}}});return React.createElement(n.Fragment,null,React.createElement(s.default.Item,{onClick:this.onClickItem},"Asignar usuario"),this.state.isOpen&&React.createElement(c.default,{open:!0,size:"tiny",dimmer:"inverted",className:"modal-ab modal-pasouser",onClose:function(){return e.setState({isOpen:!1})},closeIcon:!0},React.createElement(c.default.Header,{content:"Asignar usuario"}),React.createElement(c.default.Content,null,React.createElement("blockquote",null,React.createElement("div",null,React.createElement("strong",null,"Rubro:")," ",a.parent.descripcion),React.createElement("div",null,React.createElement("strong",null,"Paso:")," ",a.descripcion),"PERIODO"==a.tipo?React.createElement("div",null,React.createElement("strong",null,"Periodo:")," ",r.visita_alias):React.createElement("div",null,React.createElement("strong",null,"Visita:")," ",i.name)),React.createElement("div",{className:"ui form"},React.createElement("div",{className:"field"},React.createElement("label",{htmlFor:""},"Asocie las visitas relacionadas con este paso"),React.createElement("br",null),React.createElement(s.default,{placeholder:"Seleccione el usuario",defaultValue:r.id_usuario_asignado,selection:!0,clearable:!0,fluid:!0,options:l,onChange:this.onChange})))),React.createElement(c.default.Actions,null,React.createElement("button",{className:"ui button negative",onClick:function(){return e.setState({isOpen:!1})}},"Cancelar"),React.createElement("button",{className:"ui button primary",onClick:this.onSubmit},"Aceptar"))))}}]),t}();t.DropdownItemAssignUser=R,R.contextType=r.default;var k=function(e){function t(){var e;return p(this,t),(e=f(this,v(t).apply(this,arguments))).onClickDelete=function(){var t=e.props,a=t.paso,n=t.paso_visita,r=e.context,o=r.tree,i=r.updateTree,s=r.visitas,c=_.find(s,{id_proyecto_visita:n.id_proyecto_visita});bootbox.warningConfirm('Â¿EstÃ¡ seguro de querer desvincular la visita <strong>"'.concat(c.name,'"</strong> del paso <strong>"').concat(a.descripcion,'"</strong>?'),"No","SÃ­, Desvincular visita",function(e){if(e){var t=n.id_master_data_paso_has_proyecto_visita;$.blockUI(create_blockUI_loading_message("Desvinculando Visita del Paso...")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/visita/").concat(t,"/desasociar")),{sf_method:"delete"}).done(function(e){o[a.parent.parent.index].items[a.parent.index].open=!0,o[a.parent.parent.index].items[a.parent.index].items[a.index].paso_visitas=e.response.paso_visitas,i(o),$.unblockUI()}).fail(function(){return $.unblockUI()})}})},e}return h(t,n.PureComponent),m(t,[{key:"render",value:function(){return React.createElement(s.default.Item,{key:"delete",onClick:this.onClickDelete},"Desvincular visita")}}]),t}();t.DropdownItemDeletePasoVisita=k,k.contextType=r.default},504:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalPasoAssoc=t.ModalPasoEdit=t.ModalPasoNew=void 0;var n=a(1),r=h(a(54)),o=h(a(140)),i=h(a(101)),s=h(a(139)),c=h(a(68)),l=h(a(216)),u=h(a(507)),p=h(a(524)),d=h(a(218)),m=h(a(104)),f=h(a(527)),v=h(a(37));function h(e){return e&&e.__esModule?e:{default:e}}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t,a){return t&&g(e.prototype,t),a&&g(e,a),e}function R(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N={moveLeft:React.createElement("i",{className:"icon angle left"}),moveAllLeft:React.createElement("i",{className:"icon angle double left"}),moveRight:React.createElement("i",{className:"icon angle right"}),moveAllRight:React.createElement("i",{className:"icon angle double right"}),moveDown:React.createElement("i",{className:"icon angle down"}),moveUp:React.createElement("i",{className:"icon angle up"})},S=function(e){function t(){return y(this,t),R(this,k(t).apply(this,arguments))}return C(t,n.Component),E(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{className:"step-content step-content-1"},React.createElement("h4",{className:"ui centered header"},"Â¿QuÃ© tipo de paso de auditorÃ­a desea crear?"),React.createElement(l.default,{relaxed:!0,centered:!0,columns:4,textAlign:"center"},React.createElement(l.default.Column,null,React.createElement(p.default,{textAlign:"center",centered:!0,className:"paso-tipo",onClick:function(){return e.props.onSelect("DEFAULT")}},React.createElement(c.default,{name:"list ul",size:"big"}),React.createElement("div",{className:"paso-tipo-name"},"Lista de Chequeo",React.createElement(m.default,{size:"tiny",trigger:React.createElement(c.default,{color:"blue",size:"small",name:"question circle"}),header:"Paso - Tipo Lista de Chequeo",content:"RelaciÃ³n de instrucciones o actividades definidas como guÃ­a detallada\n                  para ser ejecutadas por el auditor permitiendo una revisiÃ³n efectiva,\n                  por lo general contienen el paso a paso de un programa de trabajo para realizar pruebas sustantivas\n                  (prueba de detalle, revisiones analÃ­ticas, etc)."})))),React.createElement(l.default.Column,null,React.createElement(p.default,{textAlign:"center",disabled:"1"==app.vars.plan_auditoria.proyecto.version,className:"paso-tipo",onClick:function(){if("1"!=app.vars.plan_auditoria.proyecto.version)return e.props.onSelect("PERIODO");bootbox.alert("Esta opciÃ³n solo estÃ¡ disponible para los proyectos actualizados con la nueva versiÃ³n de la Hoja de Trabajo.")}},React.createElement(c.default,{name:"calendar alternate outline",size:"big"}),React.createElement("div",{className:"paso-tipo-name"},"Impuestos",React.createElement(m.default,{size:"tiny",trigger:React.createElement(c.default,{color:"blue",size:"small",name:"question circle"}),header:"Paso - Tipo Impuesto",content:"Programa de trabajo para la revisiÃ³n periÃ³dica de impuestos por parte del auditor,\n                  es requerido crear un paso de impuestos por cada impuesto a verificar.\n                  La principal diferencia con un paso de lista de chequeo consiste que los impuestos\n                  se vinculan a periodos de vencimientos y las listas de chequeo se vinculan a\n                  visitas fuerte de auditoria (planeaciÃ³n,prefinal, final, etc.)\n                  por tanto, para pasos de impuestos no es requerido subir cifras en sumarias."})))),React.createElement(l.default.Column,null,React.createElement(p.default,{textAlign:"center",disabled:!0,className:"paso-tipo comingsoon"},React.createElement(i.default,{color:"orange",ribbon:"right",size:"medium"},"PrÃ³ximamente"),React.createElement("div",{className:"clearfix"}),React.createElement(c.default,{name:"file alternate outline",size:"big"}),React.createElement("div",{className:"paso-tipo-name"},"Formatos")))),React.createElement("br",null))}}]),t}(),P=function(e){function t(){var e;return y(this,t),(e=R(this,k(t).apply(this,arguments))).onChange=function(t){e.props.onChange(t.target.value)},e.onSubmit=function(t){t.preventDefault(),e.props.onContinue()},e}return C(t,n.Component),E(t,[{key:"render",value:function(){return React.createElement("div",{className:"step-content step-content-2"},React.createElement(u.default,{onSubmit:this.onSubmit},React.createElement(l.default,{centered:!0,textAlign:"center"},React.createElement(l.default.Column,{width:10},React.createElement(u.default.Field,{required:!0,label:"Ingrese el nombre del paso"}),React.createElement(u.default.Input,{type:"text",name:"paso_name",placeholder:"Nombre del paso",defaultValue:this.props.value,onChange:this.onChange,maxLength:255,required:!0}))),React.createElement("br",null),React.createElement(s.default,{negative:!0,content:"Volver",onClick:this.props.onCancel,type:"button"}),React.createElement(s.default,{positive:!0,content:"Continuar",floated:"right"})))}}]),t}(),I=function(e){function t(e){var a;return y(this,t),(a=R(this,k(t).call(this,e))).onChange=function(e){a.setState({value:e}),a.props.onChange(e)},a.onSubmit=function(e){e.preventDefault(),a.props.onContinue()},a.state={value:a.props.value},a}return C(t,n.Component),E(t,[{key:"render",value:function(){var e=[];return _.forEach(app.vars.plan_auditoria.objetivos,function(t){e.push({value:t.id,label:t.name})}),React.createElement("div",{className:"step-content step-content-3"},React.createElement(u.default,{onSubmit:this.onSubmit},React.createElement(l.default,{centered:!0,textAlign:"center"},React.createElement(l.default.Column,{width:10},React.createElement(u.default.Field,{label:"Asocie las aserciones a relacionar con este paso"})," ",React.createElement("br",null),React.createElement(f.default,{name:"aserciones",options:e,availableLabel:"Por asociar",selectedLabel:"Asociadas",selected:this.state.value,icons:N,onChange:this.onChange}))),React.createElement("br",null),React.createElement(s.default,{negative:!0,content:"Volver",onClick:this.props.onCancel,type:"button"}),React.createElement(s.default,{positive:!0,content:"Continuar",floated:"right"})))}}]),t}(),O=function(e){function t(e){var a;return y(this,t),(a=R(this,k(t).call(this,e))).onChange=function(e){a.setState({value:e}),a.props.onChange(e)},a.onSubmit=function(e){e.preventDefault(),a.props.onContinue()},a.state={value:a.props.value},a}return C(t,n.Component),E(t,[{key:"render",value:function(){var e=[];return _.forEach(app.vars.plan_auditoria.visitas,function(t){e.push({value:t.id,label:t.name})}),React.createElement("div",{className:"step-content step-content-4"},React.createElement(u.default,{onSubmit:this.onSubmit},React.createElement(l.default,{centered:!0,textAlign:"center"},React.createElement(l.default.Column,{width:10},React.createElement(u.default.Field,{label:"Asocie las visitas a relacionar con este paso"})," ",React.createElement("br",null),React.createElement(f.default,{name:"visitas",options:e,availableLabel:"Por asociar",selectedLabel:"Asociadas",selected:this.state.value,icons:N,onChange:this.onChange}))),React.createElement("br",null),React.createElement(s.default,{negative:!0,content:"Volver",onClick:this.props.onCancel,type:"button"}),React.createElement(s.default,{positive:!0,content:"Crear Paso",floated:"right"})))}}]),t}(),w=function(e){function t(e){var a;return y(this,t),(a=R(this,k(t).call(this,e))).onChange=function(e,t){var n=t.value;a.setState({value:n}),a.props.onChange(n)},a.onSubmit=function(e){e.preventDefault(),a.props.onContinue()},a.state={value:a.props.value},a}return C(t,n.Component),E(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{className:"step-content step-content-4"},React.createElement(u.default,{onSubmit:this.onSubmit},React.createElement(l.default,{centered:!0,textAlign:"center"},React.createElement(l.default.Column,{width:10},React.createElement(u.default.Field,{label:"Indique la periodicidad para este paso"}),_.map([{value:"1",text:"Mensual",help:"Enero, Febrero, Marzo, ..."},{value:"2",text:"Bimestral",help:"Bimestre 1, Bimestre 2, ..."},{value:"3",text:"Trimestral",help:"Trimestre 1, Trimestre 2, ..."},{value:"4",text:"Cuatrimestral",help:"Cuatrimestre 1, Cuatrimestre 2, ..."},{value:"6",text:"Semestral",help:"Semestre 1, Semestre 2"},{value:"12",text:"Anual",help:"AÃ±o actual"}],function(t,a){return React.createElement(u.default.Field,{className:"field-periodo"},React.createElement(d.default,{label:React.createElement("label",null,t.text," ",React.createElement("span",{className:"help help-inline"},t.help)),name:"periodo",value:t.value,checked:e.state.value==t.value,onChange:e.onChange}))}))),React.createElement("br",null),React.createElement(s.default,{negative:!0,content:"Volver",onClick:this.props.onCancel,type:"button"}),React.createElement(s.default,{positive:!0,content:"Crear Paso",floated:"right"})))}}]),t}(),j=function(e){function t(e){var a;return y(this,t),(a=R(this,k(t).call(this,e))).nextStep=function(){a.setState(function(e){return{step:e.step+1}})},a.prevStep=function(){a.setState(function(e){return{step:e.step-1}})},a.selectPasoTipo=function(e){a.setState({step:2,pasoTipo:e})},a.assignPasoName=function(e){a._assignFormDataValue({paso_name:e})},a.assignAserciones=function(e){a._assignFormDataValue({aserciones:e})},a.assignVisitas=function(e){a._assignFormDataValue({visitas:e,periodos:null})},a.assignPeriodos=function(e){a._assignFormDataValue({visitas:null,periodos:e})},a.submit=function(){$.blockUI(create_blockUI_loading_message("Creando Paso"));var e=document.createElement("form");e.method="POST",e.action=url_for("proyecto/".concat(app.vars.plan_auditoria.proyecto.id,"/master_data/fase/").concat(a.props.rubro.id,"/paso/newcreate"));var t=document.createElement("input");t.name="tipo",t.value=a.state.pasoTipo,t.type="hidden",e.appendChild(t),_.forEach(a.state.formData,function(t,a){var n=document.createElement("input");n.name="data[".concat(a,"]"),n.value=t,n.type="hidden",e.appendChild(n)}),document.body.appendChild(e),e.submit()},a.onClose=function(){a.setState({isOpen:!1})},a.state={step:1,pasoTipo:null,isOpen:!1,formData:{paso_name:"",aserciones:[]}},a}return C(t,n.Component),E(t,[{key:"_assignFormDataValue",value:function(e){this.setState(function(t){var a=t.formData;return{formData:a=Object.assign({},a,e)}})}},{key:"_getStepContent",value:function(e){switch(e){case 1:return React.createElement(S,{onSelect:this.selectPasoTipo});case 2:return React.createElement(P,{value:this.state.formData.paso_name,onCancel:this.prevStep,onChange:this.assignPasoName,onContinue:this.nextStep});case 3:return React.createElement(I,{value:this.state.formData.aserciones,onCancel:this.prevStep,onChange:this.assignAserciones,onContinue:this.nextStep});case 4:switch(this.state.pasoTipo){case"DEFAULT":return React.createElement(O,{value:this.state.formData.visitas,onCancel:this.prevStep,onChange:this.assignVisitas,onContinue:this.submit});case"PERIODO":return React.createElement(w,{value:this.state.formData.periodos,onCancel:this.prevStep,onChange:this.assignPeriodos,onContinue:this.submit})}}}},{key:"render",value:function(){var e=this,t=this.state,a=t.step,i=t.pasoTipo,s=t.isOpen,c=" ";a>1&&(c="PERIODO"==i?"4. Periodos":"4. Visitas");var l=this.props.rubro;return React.createElement(n.Fragment,null,React.createElement("a",{href:"#",onClick:function(){return e.setState({isOpen:!0})}},"Crear Paso"),s&&React.createElement(r.default,{open:!0,className:"modal-ab modal-pasocreate",onClose:this.onClose,closeIcon:!0},React.createElement(r.default.Header,{content:"Crear paso"}),React.createElement(r.default.Content,null,React.createElement("p",null,React.createElement("strong",null,"Rubro:")," ",l.descripcion),React.createElement(o.default.Group,{attached:"top",size:"small",widths:4},React.createElement(o.default,{active:1==a,completed:a>1,icon:a>1?"check":" ",title:"1. Tipo"}),React.createElement(o.default,{active:2==a,completed:a>2,icon:a>2?"check":" ",title:"2. Nombre"}),React.createElement(o.default,{active:3==a,completed:a>3,icon:a>3?"check":" ",title:"3. Aserciones"}),React.createElement(o.default,{active:4==a,title:c,icon:" "})),this._getStepContent(a))))}}]),t}();t.ModalPasoNew=j;var A=function(e){function t(e){var a;return y(this,t),(a=R(this,k(t).call(this,e))).onChangeName=function(e){a.setState({valueName:e.target.value})},a.onChangeAserciones=function(e){a.setState({valueAserciones:e})},a.onSubmit=function(){if(""!=_.str.trim(a.state.valueName)){var e=a.context,t=e.tree,n=e.updateTree,r=a.props.paso;$.blockUI(create_blockUI_loading_message("Guardando los cambios")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/paso/").concat(r.id)),{paso_name:a.state.valueName,paso_objetivos:a.state.valueAserciones}).done(function(e){e.hasErrors||(t[r.parent.parent.index].items[r.parent.index].open=!0,t[r.parent.parent.index].items[r.parent.index].items[r.index].descripcion=a.state.valueName,t[r.parent.parent.index].items[r.parent.index].items[r.index].aserciones=_.map(a.state.valueAserciones,function(e){return{id_master_data_objetivo:e}}),n(t),$.unblockUI(),a.setState({isOpen:!1}))})}else bootbox.alert("Indique un nombre para el paso.")},a.state={isOpen:!1,valueName:e.paso.descripcion,valueAserciones:_.pluck(e.paso.aserciones,"id_master_data_objetivo")},a}return C(t,n.PureComponent),E(t,[{key:"render",value:function(){var e=this,t=this.props.paso,a=[];return _.forEach(app.vars.plan_auditoria.objetivos,function(e){a.push({value:e.id,label:e.name})}),React.createElement(n.Fragment,null,React.createElement("a",{href:"#",onClick:function(){return e.setState({isOpen:!0})}},"Editar Paso"),this.state.isOpen&&React.createElement(r.default,{open:!0,className:"modal-ab modal-pasoedit",onClose:function(){return e.setState({isOpen:!1})},closeIcon:!0},React.createElement(r.default.Header,{content:"Editar paso"}),React.createElement(r.default.Content,null,React.createElement("p",null,React.createElement("div",null,React.createElement("strong",null,"Rubro:")," ",t.parent.descripcion),React.createElement("div",null,React.createElement("strong",null,"Paso:")," ",t.descripcion)),React.createElement("div",{className:"ui form"},React.createElement("div",{className:"field required"},React.createElement("label",{htmlFor:"paso_edit_name"},"Nombre del Paso"),React.createElement("input",{type:"text",id:"paso_edit_name",required:!0,value:this.state.valueName,onChange:this.onChangeName,placeholder:"Nombre del Paso"})),React.createElement("div",{className:"field"},React.createElement("label",{htmlFor:""},"Asocie las aserciones relacionadas con este paso"),React.createElement("br",null),React.createElement(f.default,{name:"aserciones",options:a,availableLabel:"Por asociar",selectedLabel:"Asociadas",selected:this.state.valueAserciones,icons:N,onChange:this.onChangeAserciones})))),React.createElement(r.default.Actions,null,React.createElement("button",{className:"ui button negative",onClick:function(){return e.setState({isOpen:!1})}},"Cancelar"),React.createElement("button",{className:"ui button primary",onClick:this.onSubmit},"Aceptar"))))}}]),t}();t.ModalPasoEdit=A,A.contextType=v.default;var T=function(e){function t(e){var a;return y(this,t),(a=R(this,k(t).call(this,e))).onChange=function(e){a.setState({visitas:e})},a.onSubmit=function(){var e=a.context,t=e.tree,n=e.updateTree,r=a.props.paso;$.blockUI(create_blockUI_loading_message("Guardando los cambios")),$.post(url_for("proyecto/".concat(app.vars.idproyecto,"/master_data/asociar-visita")),{id_paso:r.id,paso_visitas:a.state.visitas}).done(function(e){e.hasErrors||(t[r.parent.parent.index].items[r.parent.index].open=!0,t[r.parent.parent.index].items[r.parent.index].items[r.index].paso_visitas=e.response.paso_visitas,n(t),$.unblockUI(),a.setState({isOpen:!1}))})},a.state={isOpen:!1,visitas:_.pluck(e.paso.paso_visitas,"id_proyecto_visita")},a}return C(t,n.PureComponent),E(t,[{key:"render",value:function(){var e=this,t=this.props.paso,a=this.context.visitas,o=[];return _.forEach(a,function(e){o.push({value:e.id,label:e.name})}),React.createElement(n.Fragment,null,React.createElement("a",{href:"#",onClick:function(){return e.setState({isOpen:!0})}},"Asociar Visitas"),this.state.isOpen&&React.createElement(r.default,{open:!0,className:"modal-ab modal-pasoedit",onClose:function(){return e.setState({isOpen:!1})},closeIcon:!0},React.createElement(r.default.Header,{content:"Editar paso"}),React.createElement(r.default.Content,null,React.createElement("div",null,React.createElement("div",null,React.createElement("strong",null,"Rubro:")," ",t.parent.descripcion),React.createElement("div",null,React.createElement("strong",null,"Paso:")," ",t.descripcion)),React.createElement("div",{className:"ui form"},React.createElement("div",{className:"field"},React.createElement("label",{htmlFor:""},"Asocie las visitas relacionadas con este paso"),React.createElement("br",null),React.createElement(f.default,{name:"aserciones",options:o,availableLabel:"Por asociar",selectedLabel:"Asociadas",selected:this.state.visitas,icons:N,onChange:this.onChange})))),React.createElement(r.default.Actions,null,React.createElement("button",{className:"ui button negative",onClick:function(){return e.setState({isOpen:!1})}},"Cancelar"),React.createElement("button",{className:"ui button primary",onClick:this.onSubmit},"Aceptar"))))}}]),t}();t.ModalPasoAssoc=T,T.contextType=v.default},528:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalPasoCopyFrom=void 0;var n=a(1),r=u(a(54)),o=u(a(216)),i=u(a(529)),s=u(a(208)),c=u(a(104)),l=u(a(6));function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,a){return t&&m(e.prototype,t),a&&m(e,a),e}function v(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var E,R,k=function(e){var t=e.onSelect;return React.createElement("div",{className:"step-content step-content-1"},React.createElement("h4",{className:"ui centered header"},"Seleccione el origen del paso de auditorÃ­a que desea copiar?"),React.createElement(o.default,{relaxed:!0,centered:!0,columns:4,textAlign:"center"},React.createElement(o.default.Column,null,React.createElement("div",{className:"ui segment center aligned paso-copysource clickable",onClick:function(){return t("MasterData")}},React.createElement("div",{className:"paso-source-name"},"Desde Plan de Pruebas"))),React.createElement(o.default.Column,null,React.createElement("div",{className:"ui segment center aligned paso-copysource clickable",onClick:function(){return t("Project")}},React.createElement("div",{className:"paso-source-name"},"Desde Otro Proyecto")))))},C=function(e,t){var a=function(){var e=location.search.slice(1),t={};return e.replace(/([^=]*)=([^&]*)&*/g,function(e,a,n){return t[a]=n,e}),t}();a[e]!=t&&(a[e]=t,function(e){var t,a,n=[];for(t in e)e.hasOwnProperty(t)&&(a=e[t],n.push(t+"="+a));location.search=n.join("&")}(a))},x=(E=app.vars.plan_auditoria.fases,R=[],_.each(E,function(e){_.each(e.Subfases,function(e){_.each(e.MasterDataPaso,function(e){R.push(e.code)})})}),R),N=function e(t){var a=t.item,r=t.onChecked,o=g((0,n.useState)(!0),2),i=o[0],s=o[1],u=function e(t){var a=!1;return t.items?_.each(t.items,function(t){if(a=a||e(t))return!0}):t.code&&!_.contains(x,t.code)&&(a=!0),a}(a);return React.createElement("li",{key:a.id,className:(0,l.default)("methodology-item",a.type)},React.createElement("div",{className:"methodology-item-head"},React.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),s(!i)}},React.createElement("span",{className:"item-name"},a.descripcion)),u&&React.createElement(c.default,{trigger:React.createElement("span",{className:"pull-right ui-state-error-text"},React.createElement("span",{className:"icon-info-sign"})),content:"Este elemento contiene pasos que no se encuentran en su Plan de AuditorÃ­a",on:"hover",className:"disabled-text"})),React.createElement("ul",{className:(0,l.default)("methodology collapse",i?"hide":"in")},_.map(a.items,function(t){return t.parent=a,"paso"==t.type?React.createElement(S,{key:t.id,item:t,onChecked:function(e){return r(t,e)}}):React.createElement(e,{key:t.id,item:t,onChecked:r})})))},S=function(e){var t=e.item,a=e.onChecked,r=g((0,n.useState)(!1),2),o=r[0],i=r[1],s=_.contains(x,t.code),c=(0,l.default)("methodology-item paso",s&&!o?"ui-state-disabled":null,o?"selected":null);return React.createElement("li",{key:t.id,className:c},React.createElement("div",{className:"methodology-item-head"},React.createElement("label",{htmlFor:"tree-paso-".concat(t.id)},React.createElement("input",{type:"checkbox",id:"tree-paso-".concat(t.id),className:"checkbox",checked:o,onChange:function(e){i(e.target.checked),a(e.target.checked)}}),React.createElement("span",{className:"item-name"},t.descripcion,s&&React.createElement("span",{className:"label label-important",style:{marginLeft:5}},"Agregado")))))},P=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).state={isLoading:!1,selectedPasos:[]},e.onChangeCheckedPaso=function(t,a){var n=e.state.selectedPasos;a?t.id in n||n.push(t.id):n=_.reject(n,function(e){return e==t.id}),e.setState({selectedPasos:n}),e.props.onSelect(n)},e.onSubmit=function(){$.blockUI(create_blockUI_loading_message("Guardando cambios..."));var t={item_type:"paso",parent_id:e.props.rubroId,items:e.state.selectedPasos};$.post(url_for("proyecto/".concat(app.vars.plan_auditoria.proyecto.id,"/copy_from")),t).done(function(t){t.hasErrors||(C("rubro",e.props.rubroId),location.reload())}).fail(function(){$.unblockUI()})},e}return b(t,n.Component),f(t,[{key:"componentDidMount",value:function(){this._loadMasterData()}},{key:"_loadMasterData",value:function(){var e=this;null==t.masterData&&(this.setState({isLoading:!0}),$.getJSON(url_for("proyecto/".concat(app.vars.plan_auditoria.proyecto.id,"/master_data_tree"))).done(function(a){t.masterData=function(e){return _.map(e,function(e){return{id:e.id,descripcion:e.descripcion,type:"phase",items:_.map(e.Subfases,function(e){return{id:e.id,descripcion:e.descripcion,type:"subphase",items:_.map(e.MasterDataPaso,function(e){return{id:e.id,descripcion:e.descripcion,code:e.code,type:"paso"}})}})}})}(a.response),e.setState({isLoading:!1})}))}},{key:"renderTree",value:function(){var e=this;return React.createElement("ul",{className:"methodology checkbox-list methodology-all nav nav-stacked"},_.map(t.masterData,function(t){return React.createElement(N,{key:"tree-item-".concat(t.type,"-").concat(t.id),item:t,onChecked:e.onChangeCheckedPaso})}))}},{key:"render",value:function(){return React.createElement("div",{className:"step-content step-content-2 step-content-2-masterdata"},React.createElement("h4",{className:"ui centered header"},"Seleccione los pasos que desea copiar a su Plan de AuditorÃ­a?"),this.state.isLoading?React.createElement("div",{className:"ui segment",style:{minHeight:200}},React.createElement(s.default,{active:!0,inverted:!0},React.createElement(i.default,{inverted:!0,content:"Cargando datos..."}))):React.createElement("div",null,this.renderTree(),React.createElement("div",{className:"btn-actions"},React.createElement(c.default,{trigger:React.createElement("button",{onClick:this.onSubmit,className:"btn btn-primary pull-right",disabled:0==this.state.selectedPasos.length},"Guardar"),content:"Debe seleccionar por lo menos un paso a copiar",header:"Guardar | OpciÃ³n deshabilitada",disabled:this.state.selectedPasos.length>0,className:"disable-text",on:"hover"})),React.createElement("div",{className:"clearfix"})))}}]),t}();P.masterData=null;var I=function(e){function t(){var e;return d(this,t),(e=v(this,h(t).apply(this,arguments))).state={isOpen:!1,step:2,sourceSelected:"MasterData",pasosSelected:[]},e.onClose=function(){e.setState({isOpen:!1})},e.onSelectSource=function(t){e.setState({step:2,sourceSelected:t})},e.onSelectPasos=function(t){e.setState({pasosSelected:t})},e}return b(t,n.Component),f(t,[{key:"getStepContent",value:function(){switch(this.state.step){case 1:return React.createElement(k,{onSelect:this.onSelectSource});case 2:switch(this.state.sourceSelected){case"MasterData":return React.createElement(P,{rubroId:this.props.rubro.id,onSelect:this.onSelectPasos})}}}},{key:"renderModal",value:function(){var e=this.props.rubro,t="";switch(this.state.sourceSelected){case"MasterData":t="Biblioteca de Pasos"}return React.createElement(r.default,{open:!0,className:"modal-ab modal-pasocopyfrom",onClose:this.onClose,closeIcon:!0,closeOnDimmerClick:!1},React.createElement(r.default.Header,{content:"Copiar paso desde... ".concat(t)}),React.createElement(r.default.Content,null,React.createElement("p",null,React.createElement("strong",null,"Rubro:")," ",e.descripcion),this.getStepContent()))}},{key:"render",value:function(){var e=this;return"1"==app.vars.plan_auditoria.proyecto.version?React.createElement(c.default,{header:"OpciÃ³n deshabilitada",content:"Esta opciÃ³n no esta disponible para esta versiÃ³n de proyectos",trigger:React.createElement("a",{className:"disabled ui-state-disabled"},"Copiar Paso desde Biblioteca"),position:"left center",size:"small",className:"disabled-text"}):React.createElement(n.Fragment,null,React.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),e.setState({isOpen:!0})}},"Copiar Paso desde Biblioteca"),this.state.isOpen&&this.renderModal())}}]),t}();t.ModalPasoCopyFrom=I},69:function(e,t,a){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ProyectoPlanAuditoriaUtils=void 0,t.ProyectoPlanAuditoriaUtils=n,function(e){e.getUserById=function(e){return app.vars.plan_auditoria.equipo[e]},e.getVisitaById=function(e){return _.find(app.vars.plan_auditoria.visitas,{id:e})},e.changeOpenToAll=function e(t,a){_.each(t,function(t){void 0!==t.open&&(t.open=a),void 0!==t.items&&e(t.items,a)})}}(n||(t.ProyectoPlanAuditoriaUtils=n={}))}});
//# sourceMappingURL=http://auditbrain.local/webapps/dist/proyecto__plan_auditoria.js.map